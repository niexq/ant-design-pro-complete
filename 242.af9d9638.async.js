(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[242],{29297:function(Cr,te,$){"use strict";var Pe=$(59301),me=(0,Pe.createContext)({});te.Z=me},35577:function(Cr,te,$){"use strict";var Pe=$(33485),me=$(7484),m=$(11549),Ie=$.n(m),G=$(59301),ce=$(92691),he=$.n(ce),Fe=$(29297),ge=function(ct){var xt=(0,G.useContext)(Fe.Z),Qt=ct.children,ur=ct.contentWidth,Mt=ct.className,Jt=ct.style,zt=(0,G.useContext)(me.ZP.ConfigContext),lt=zt.getPrefixCls,pt=ct.prefixCls||lt("pro"),ir=ur||xt.contentWidth,W="".concat(pt,"-grid-content");return G.createElement("div",{className:he()(W,Mt,{wide:ir==="Fixed"}),style:Jt},G.createElement("div",{className:"".concat(pt,"-grid-content-children")},Qt))};te.Z=ge},37623:function(Cr,te,$){"use strict";$.d(te,{zP:function(){return mM},JE:function(){return TT},ns:function(){return vM}});var Pe={};$.r(Pe),$.d(Pe,{add:function(){return gr},adjoint:function(){return Xp},clone:function(){return $u},copy:function(){return Hp},create:function(){return _u},determinant:function(){return Jh},equals:function(){return _r},exactEquals:function(){return vr},frob:function(){return pr},fromQuat:function(){return Ul},fromQuat2:function(){return nh},fromRotation:function(){return wd},fromRotationTranslation:function(){return Yp},fromRotationTranslationScale:function(){return Pa},fromRotationTranslationScaleOrigin:function(){return np},fromScaling:function(){return Sd},fromTranslation:function(){return ep},fromValues:function(){return Wp},fromXRotation:function(){return Cd},fromYRotation:function(){return tp},fromZRotation:function(){return Ad},frustum:function(){return Cf},getRotation:function(){return ih},getScaling:function(){return rp},getTranslation:function(){return qp},identity:function(){return jc},invert:function(){return Qu},lookAt:function(){return Ct},mul:function(){return tt},multiply:function(){return xu},multiplyScalar:function(){return Ar},multiplyScalarAndAdd:function(){return zr},ortho:function(){return Tt},orthoNO:function(){return ke},orthoZO:function(){return tr},perspective:function(){return Kp},perspectiveFromFieldOfView:function(){return ue},perspectiveNO:function(){return kh},perspectiveZO:function(){return F},rotate:function(){return gc},rotateX:function(){return so},rotateY:function(){return Os},rotateZ:function(){return Lh},scale:function(){return qi},set:function(){return _l},str:function(){return sr},sub:function(){return Ft},subtract:function(){return br},targetTo:function(){return Yt},translate:function(){return Hc},transpose:function(){return Gc}});var me=$(59301),m=(0,me.createContext)({});function Ie(){return(0,me.useContext)(m)}var G={},ce={},he=function(n){return ce[n]},Fe=function(n,r){ce[n]=r},ge=function(n){return G[n]},Qe=function(n,r){G[n]=r},ct={},xt={},Qt=34,ur=10,Mt=13;function Jt(e){return new Function("d","return {"+e.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function zt(e,n){var r=Jt(e);return function(i,o){return n(r(i),o,e)}}function lt(e){var n=Object.create(null),r=[];return e.forEach(function(i){for(var o in i)o in n||r.push(n[o]=o)}),r}function pt(e,n){var r=e+"",i=r.length;return i<n?new Array(n-i+1).join(0)+r:r}function ir(e){return e<0?"-"+pt(-e,6):e>9999?"+"+pt(e,6):pt(e,4)}function W(e){var n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ir(e.getUTCFullYear(),4)+"-"+pt(e.getUTCMonth()+1,2)+"-"+pt(e.getUTCDate(),2)+(o?"T"+pt(n,2)+":"+pt(r,2)+":"+pt(i,2)+"."+pt(o,3)+"Z":i?"T"+pt(n,2)+":"+pt(r,2)+":"+pt(i,2)+"Z":r||n?"T"+pt(n,2)+":"+pt(r,2)+"Z":"")}function Wt(e){var n=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(I,k){var B,q,ee=o(I,function(se,De){if(B)return B(se,De-1);q=se,B=k?zt(se,k):Jt(se)});return ee.columns=q||[],ee}function o(I,k){var B=[],q=I.length,ee=0,se=0,De,Je=q<=0,ht=!1;I.charCodeAt(q-1)===ur&&--q,I.charCodeAt(q-1)===Mt&&--q;function gt(){if(Je)return xt;if(ht)return ht=!1,ct;var Vt,nr=ee,dr;if(I.charCodeAt(nr)===Qt){for(;ee++<q&&I.charCodeAt(ee)!==Qt||I.charCodeAt(++ee)===Qt;);return(Vt=ee)>=q?Je=!0:(dr=I.charCodeAt(ee++))===ur?ht=!0:dr===Mt&&(ht=!0,I.charCodeAt(ee)===ur&&++ee),I.slice(nr+1,Vt-1).replace(/""/g,'"')}for(;ee<q;){if((dr=I.charCodeAt(Vt=ee++))===ur)ht=!0;else if(dr===Mt)ht=!0,I.charCodeAt(ee)===ur&&++ee;else if(dr!==r)continue;return I.slice(nr,Vt)}return Je=!0,I.slice(nr,q)}for(;(De=gt())!==xt;){for(var Nt=[];De!==ct&&De!==xt;)Nt.push(De),De=gt();k&&(Nt=k(Nt,se++))==null||B.push(Nt)}return B}function u(I,k){return I.map(function(B){return k.map(function(q){return P(B[q])}).join(e)})}function v(I,k){return k==null&&(k=lt(I)),[k.map(P).join(e)].concat(u(I,k)).join(`
`)}function y(I,k){return k==null&&(k=lt(I)),u(I,k).join(`
`)}function _(I){return I.map(E).join(`
`)}function E(I){return I.map(P).join(e)}function P(I){return I==null?"":I instanceof Date?W(I):n.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:i,parseRows:o,format:v,formatBody:y,formatRows:_,formatRow:E,formatValue:P}}var ot=Wt(","),Ye=ot.parse,bt=ot.parseRows,Ke=ot.format,Xt=ot.formatBody,Sr=ot.formatRows,Vr=ot.formatRow,en=ot.formatValue,C=$(32526),Ee=$(39459),Re=$(56928),yt=$.n(Re);function ft(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function It(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ft(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ht(e,n){var r=n.x,i=n.y,o=n.x1,u=n.y1,v=n.coordinates,y=[];return e.forEach(function(_,E){var P=[];if(r&&i&&(P=[parseFloat(_[r]),parseFloat(_[i])]),r&&i&&o&&u){var I=[parseFloat(_[r]),parseFloat(_[i])],k=[parseFloat(_[o]),parseFloat(_[u])];P=[I,k]}if(v){var B="Polygon";Array.isArray(v[0])||(B="Point"),Array.isArray(v[0])&&!Array.isArray(v[0][0])&&(B="LineString");var q={type:B,coordinates:(0,Ee.Z)(_[v])};yt()(q,!0),P=q.coordinates}var ee=It(It({},_),{},{_id:E,coordinates:P});y.push(ee)}),{dataArray:y}}var xr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Kn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function dn(e,n){var r=Ye(e);return Ht(r,n)}var di=63710088e-1,jn={centimeters:di*100,centimetres:di*100,degrees:di/111325,feet:di*3.28084,inches:di*39.37,kilometers:di/1e3,kilometres:di/1e3,meters:di,metres:di,miles:di/1609.344,millimeters:di*1e3,millimetres:di*1e3,nauticalmiles:di/1852,radians:1,yards:di*1.0936},ni={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/di,yards:1.0936133},vi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Hn(e,n,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=n||{},i.geometry=e,i}function mi(e,n,r){switch(r===void 0&&(r={}),e){case"Point":return ha(n).geometry;case"LineString":return pa(n).geometry;case"Polygon":return Di(n).geometry;case"MultiPoint":return Bi(n).geometry;case"MultiLineString":return ga(n).geometry;case"MultiPolygon":return aa(n).geometry;default:throw new Error(e+" is invalid")}}function ha(e,n,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Sn(e[0])||!Sn(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Hn(i,n,r)}function Hi(e,n,r){return r===void 0&&(r={}),La(e.map(function(i){return ha(i,n)}),r)}function Di(e,n,r){r===void 0&&(r={});for(var i=0,o=e;i<o.length;i++){var u=o[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var v=0;v<u[u.length-1].length;v++)if(u[u.length-1][v]!==u[0][v])throw new Error("First and last Position are not equivalent.")}var y={type:"Polygon",coordinates:e};return Hn(y,n,r)}function Qi(e,n,r){return r===void 0&&(r={}),La(e.map(function(i){return Di(i,n)}),r)}function pa(e,n,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return Hn(i,n,r)}function Lo(e,n,r){return r===void 0&&(r={}),La(e.map(function(i){return pa(i,n)}),r)}function La(e,n){n===void 0&&(n={});var r={type:"FeatureCollection"};return n.id&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.features=e,r}function ga(e,n,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return Hn(i,n,r)}function Bi(e,n,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return Hn(i,n,r)}function aa(e,n,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return Hn(i,n,r)}function Ji(e,n,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return Hn(i,n,r)}function Cs(e,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,n||0);return Math.round(e*r)/r}function le(e,n){n===void 0&&(n="kilometers");var r=jn[n];if(!r)throw new Error(n+" units is invalid");return e*r}function ii(e,n){n===void 0&&(n="kilometers");var r=jn[n];if(!r)throw new Error(n+" units is invalid");return e/r}function mo(e,n){return kt(ii(e,n))}function Js(e){var n=e%360;return n<0&&(n+=360),n}function kt(e){var n=e%(2*Math.PI);return n*180/Math.PI}function Kt(e){var n=e%360;return n*Math.PI/180}function Ir(e,n,r){if(n===void 0&&(n="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return le(ii(e,n),r)}function nn(e,n,r){if(n===void 0&&(n="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=vi[n];if(!i)throw new Error("invalid original units");var o=vi[r];if(!o)throw new Error("invalid final units");return e/i*o}function Sn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Bn(e){return!!e&&e.constructor===Object}function yi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(n){if(!Sn(n))throw new Error("bbox must only contain numbers")})}function li(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function _n(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Oi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Mi(e[0]);throw new Error("coordinates must only contain numbers")}function Ja(e,n,r){if(!n||!r)throw new Error("type and name required");if(!e||e.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.type)}function fs(e,n,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.geometry.type)}function Uo(e,n,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,o=e.features;i<o.length;i++){var u=o[i];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+u.geometry.type)}}function Fa(e){return e.type==="Feature"?e.geometry:e}function ya(e,n){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Z(e,n,r){if(e!==null)for(var i,o,u,v,y,_,E,P=0,I=0,k,B=e.type,q=B==="FeatureCollection",ee=B==="Feature",se=q?e.features.length:1,De=0;De<se;De++){E=q?e.features[De].geometry:ee?e.geometry:e,k=E?E.type==="GeometryCollection":!1,y=k?E.geometries.length:1;for(var Je=0;Je<y;Je++){var ht=0,gt=0;if(v=k?E.geometries[Je]:E,v!==null){_=v.coordinates;var Nt=v.type;switch(P=r&&(Nt==="Polygon"||Nt==="MultiPolygon")?1:0,Nt){case null:break;case"Point":if(n(_,I,De,ht,gt)===!1)return!1;I++,ht++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(n(_[i],I,De,ht,gt)===!1)return!1;I++,Nt==="MultiPoint"&&ht++}Nt==="LineString"&&ht++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(o=0;o<_[i].length-P;o++){if(n(_[i][o],I,De,ht,gt)===!1)return!1;I++}Nt==="MultiLineString"&&ht++,Nt==="Polygon"&&gt++}Nt==="Polygon"&&ht++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(gt=0,o=0;o<_[i].length;o++){for(u=0;u<_[i][o].length-P;u++){if(n(_[i][o][u],I,De,ht,gt)===!1)return!1;I++}gt++}ht++}break;case"GeometryCollection":for(i=0;i<v.geometries.length;i++)if(Z(v.geometries[i],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function X(e,n,r,i){var o=r;return Z(e,function(u,v,y,_,E){v===0&&r===void 0?o=u:o=n(o,u,v,y,_,E)},i),o}function Q(e,n){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&n(e.features[r].properties,r)!==!1;r++);break;case"Feature":n(e.properties,0);break}}function fe(e,n,r){var i=r;return Q(e,function(o,u){u===0&&r===void 0?i=o:i=n(i,o,u)}),i}function Ae(e,n){if(e.type==="Feature")n(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&n(e.features[r],r)!==!1;r++);}function Ze(e,n,r){var i=r;return Ae(e,function(o,u){u===0&&r===void 0?i=o:i=n(i,o,u)}),i}function qe(e){var n=[];return Z(e,function(r){n.push(r)}),n}function ie(e,n){var r,i,o,u,v,y,_,E,P,I,k=0,B=e.type==="FeatureCollection",q=e.type==="Feature",ee=B?e.features.length:1;for(r=0;r<ee;r++){for(y=B?e.features[r].geometry:q?e.geometry:e,E=B?e.features[r].properties:q?e.properties:{},P=B?e.features[r].bbox:q?e.bbox:void 0,I=B?e.features[r].id:q?e.id:void 0,_=y?y.type==="GeometryCollection":!1,v=_?y.geometries.length:1,o=0;o<v;o++){if(u=_?y.geometries[o]:y,u===null){if(n(null,k,E,P,I)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(u,k,E,P,I)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(n(u.geometries[i],k,E,P,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function Oe(e,n,r){var i=r;return ie(e,function(o,u,v,y,_){u===0&&r===void 0?i=o:i=n(i,o,u,v,y,_)}),i}function st(e,n){ie(e,function(r,i,o,u,v){var y=r===null?null:r.type;switch(y){case null:case"Point":case"LineString":case"Polygon":return n(Hn(r,o,{bbox:u,id:v}),i,0)===!1?!1:void 0}var _;switch(y){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var P=r.coordinates[E],I={type:_,coordinates:P};if(n(Hn(I,o),i,E)===!1)return!1}})}function fr(e,n,r){var i=r;return st(e,function(o,u,v){u===0&&v===0&&r===void 0?i=o:i=n(i,o,u,v)}),i}function At(e,n){st(e,function(r,i,o){var u=0;if(!!r.geometry){var v=r.geometry.type;if(!(v==="Point"||v==="MultiPoint")){var y,_=0,E=0,P=0;if(Z(r,function(I,k,B,q,ee){if(y===void 0||i>_||q>E||ee>P){y=I,_=i,E=q,P=ee,u=0;return}var se=lineString([y,I],r.properties);if(n(se,i,o,ee,u)===!1)return!1;u++,y=I})===!1)return!1}}})}function Pt(e,n,r){var i=r,o=!1;return At(e,function(u,v,y,_,E){o===!1&&r===void 0?i=u:i=n(i,u,v,y,_,E),o=!0}),i}function hr(e,n){if(!e)throw new Error("geojson is required");st(e,function(r,i,o){if(r.geometry!==null){var u=r.geometry.type,v=r.geometry.coordinates;switch(u){case"LineString":if(n(r,i,o,0,0)===!1)return!1;break;case"Polygon":for(var y=0;y<v.length;y++)if(n(lineString(v[y],r.properties),i,o,y)===!1)return!1;break}}})}function vn(e,n,r){var i=r;return hr(e,function(o,u,v,y){u===0&&r===void 0?i=o:i=n(i,o,u,v,y)}),i}function sn(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,u=n.segmentIndex||0,v=n.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),v=v||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":v=v||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),lineString([_[u],_[u+1]],v,n);case"Polygon":return o<0&&(o=_.length+o),u<0&&(u=_[o].length+u-1),lineString([_[o][u],_[o][u+1]],v,n);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u-1),lineString([_[i][u],_[i][u+1]],v,n);case"MultiPolygon":return i<0&&(i=_.length+i),o<0&&(o=_[i].length+o),u<0&&(u=_[i][o].length-u-1),lineString([_[i][o][u],_[i][o][u+1]],v,n)}throw new Error("geojson is invalid")}function Et(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,u=n.coordIndex||0,v=n.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),v=v||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":v=v||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":return point(_,v,n);case"MultiPoint":return i<0&&(i=_.length+i),point(_[i],v,n);case"LineString":return u<0&&(u=_.length+u),point(_[u],v,n);case"Polygon":return o<0&&(o=_.length+o),u<0&&(u=_[o].length+u),point(_[o][u],v,n);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u),point(_[i][u],v,n);case"MultiPolygon":return i<0&&(i=_.length+i),o<0&&(o=_[i].length+o),u<0&&(u=_[i][o].length-u),point(_[i][o][u],v,n)}throw new Error("geojson is invalid")}function qr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Dr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?qr(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function jr(e,n){var r=[],i={};if(e.features=e.features.filter(function(u){var v=u.geometry;return u!=null&&v&&v.type&&v.coordinates&&v.coordinates.length>0}),yt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:i};var o=0;return st(e,function(u,v){var y=Oi(u),_=v,E=Dr(Dr({},u.properties),{},{coordinates:y,_id:_});r.push(E)}),{dataArray:r,featureKeys:i}}function ci(e){var n=131,r=137,i=0;e+="x";for(var o=Math.floor(9007199254740991/r),u=0;u<e.length;u++)i>o&&(i=Math.floor(i/r)),i=i*n+e.charCodeAt(u);return i}function Kr(e){e=e.toString();for(var n=5381,r=e.length;r;)n=n*33^e.charCodeAt(--r);return n>>>0}var Pn=$(12581),Vi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function si(e){this.message=e}si.prototype=new Error,si.prototype.name="InvalidCharacterError";function Ci(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new si("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",i=0,o,u,v=0;u=n.charAt(v++);~u&&(o=i%4?o*64+u:u,i++%4)?r+=String.fromCharCode(255&o>>(-2*i&6)):0)u=Vi.indexOf(u);return r}function gi(e){e=String(e);for(var n,r,i,o,u="",v=0,y=e.length%3;v<e.length;){if((r=e.charCodeAt(v++))>255||(i=e.charCodeAt(v++))>255||(o=e.charCodeAt(v++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");n=r<<16|i<<8|o,u+=Vi.charAt(n>>18&63)+Vi.charAt(n>>12&63)+Vi.charAt(n>>6&63)+Vi.charAt(n&63)}return y?u.slice(0,y-3)+"===".substring(y):u}var _t=$(33384),jt=$(87161),Aa=function(){function e(n,r){(0,_t.Z)(this,e),this.buffers=n,this.type=r}return(0,jt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,i,o){throw new Error("not implemented")}}]),e}(),xi;typeof window=="undefined"?xi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(n){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(n){return!0},Event:function(n,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:xi=window;var Ai=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Fi=Ai?my.getSystemInfoSync().pixelRatio:xi.devicePixelRatio,Hr=$(91934),En=$(48071),Dt=$(78473),ea=function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"cancelBubble",void 0),(0,C.Z)(this,"cancelable",void 0),(0,C.Z)(this,"target",void 0),(0,C.Z)(this,"currentTarget",void 0),(0,C.Z)(this,"preventDefault",void 0),(0,C.Z)(this,"stopPropagation",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=n,this.timeStamp=Date.now()},ye=$(13194);function Yo(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Yi(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Yi(e,n){if(!!e){if(typeof e=="string")return fu(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fu(e,n)}}function fu(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Na=new WeakMap,Ta=function(){function e(){(0,_t.Z)(this,e),Na.set(this,{})}return(0,jt.Z)(e,[{key:"addEventListener",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Na.get(this);u||(u={}),u[r]||(u[r]=[]),u[r].push(i),Na.set(this,u),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Na.get(this);if(u){var v=u[r];if(v&&v.length>0){for(var y=v.length;y--;y>0)if(v[y]===i){v.splice(y,1);break}}}}},{key:"dispatchEvent",value:function(r){var i=Na.get(this)[r.type];if(i){var o=Yo(i),u;try{for(o.s();!(u=o.n()).done;){var v=u.value;v(r)}}catch(y){o.e(y)}finally{o.f()}}}}]),e}();function Ga(e){var n=ta();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function ta(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xo=function(e){(0,Hr.Z)(r,e);var n=Ga(r);function r(){var i;return(0,_t.Z)(this,r),i=n.call(this),(0,C.Z)((0,ye.Z)(i),"childNodes",void 0),i.childNodes=[],i}return(0,jt.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var u=this.childNodes.findIndex(function(v){return v===o});return u>-1?this.childNodes.splice(u,1):null}}]),r}(Ta);function Zo(e){var n=wu();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lo=function(e){(0,Hr.Z)(r,e);var n=Zo(r);function r(){var i;return(0,_t.Z)(this,r),i=n.call(this),(0,C.Z)((0,ye.Z)(i),"className",void 0),(0,C.Z)((0,ye.Z)(i),"children",void 0),i.className="",i.children=[],i}return(0,jt.Z)(r,[{key:"setAttribute",value:function(o,u){this[o]=u}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,u){this[o]=u}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(xo),ko=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ra,Ha,Do,Wa;if(ko){var As=my.getSystemInfoSync();ra=As.screenWidth,Ha=As.screenHeight,Do=As.windowWidth,Wa=As.windowHeight}else{var Sl=xi.innerWidth,hs=xi.innerHeight;ra=Sl,Ha=hs,Do=Sl,Wa=hs}var K={width:ra,height:Ha,availWidth:Do,availHeight:Wa,availLeft:0,availTop:0},ve=K.availWidth,He=K.availHeight,wt={style:[]};function Mr(e,n){if(!("parentNode"in e)){var r;n===0?r=function(){return null}:n===1?r=function(){return wt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var i;n===0?i=function(){return null}:n===1?i=function(){return wt}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function Cn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ve+"px",height:He+"px",margin:"0px",padding:"0px"})}function Ti(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ve,e.clientHeight=He),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var n={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return n})}function eo(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ve,e.offsetHeight=He)}function ka(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ve,e.scrollHeight=He)}function Ba(e){var n=function(){return!0};e.classList=[],e.classList.add=n,e.classList.remove=n,e.classList.contains=n,e.classList.toggle=n}function Vo(e){var n=ps();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function io(){}var bo=function(e){(0,Hr.Z)(r,e);var n=Vo(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1?arguments[1]:void 0;return(0,_t.Z)(this,r),i=n.call(this),(0,C.Z)((0,ye.Z)(i),"className",void 0),(0,C.Z)((0,ye.Z)(i),"children",void 0),(0,C.Z)((0,ye.Z)(i),"focus",void 0),(0,C.Z)((0,ye.Z)(i),"blur",void 0),(0,C.Z)((0,ye.Z)(i),"insertBefore",void 0),(0,C.Z)((0,ye.Z)(i),"appendChild",void 0),(0,C.Z)((0,ye.Z)(i),"removeChild",void 0),(0,C.Z)((0,ye.Z)(i),"remove",void 0),(0,C.Z)((0,ye.Z)(i),"innerHTML",void 0),(0,C.Z)((0,ye.Z)(i),"tagName",void 0),i.className="",i.children=[],i.focus=io,i.blur=io,i.insertBefore=io,i.appendChild=io,i.removeChild=io,i.remove=io,i.innerHTML="",i.tagName=o.toUpperCase(),Mr((0,ye.Z)(i),u),Cn((0,ye.Z)(i)),Ba((0,ye.Z)(i)),Ti((0,ye.Z)(i)),eo((0,ye.Z)(i)),ka((0,ye.Z)(i)),i}return r}(lo);function ds(e){var n=Ts();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ds=function(e){(0,Hr.Z)(r,e);var n=ds(r);function r(i){return(0,_t.Z)(this,r),n.call(this,i)}return(0,jt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(bo);function eu(e){var n=vs();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var da=function(e){(0,Hr.Z)(r,e);var n=eu(r);function r(){return(0,_t.Z)(this,r),n.call(this,"video")}return r}(Ds),ma={},ts={};function ef(e,n){ma=e,ma.id=n,"tagName"in ma||(ma.tagName="CANVAS"),ma.type="canvas",Mixin.parentNode(ma),Mixin.style(ma),Mixin.classList(ma),Mixin.clientRegion(ma),Mixin.offsetRegion(ma),ma.focus=function(){},ma.blur=function(){}}function wl(e,n){var r=1024,i=1024;ts={width:r,height:i,clientWidth:r/devicePixelRatio,clientHeight:i/devicePixelRatio,id:n,type:"canvas"},"tagName"in ts||(ts.tagName="CANVAS"),Mixin.parentNode(ts),Mixin.style(ts),Mixin.classList(ts),Mixin.clientRegion(ts),Mixin.offsetRegion(ts),ts.getContext=function(o){if(o==="2d")return e},ts.focus=function(){},ts.blur=function(){}}function Gs(){return ma}function Ql(){return ts}var zu=function e(){(0,_t.Z)(this,e);var n=Gs(),r=n.createImage&&n.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Mr(r),Ba(r),Object.assign(r,{addEventListener:function(o,u){r["on".concat(o)]=u.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r},Hs={href:"",protocol:"",host:""};function il(e){var n=g();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A=function(e){(0,Hr.Z)(r,e);var n=il(r);function r(){return(0,_t.Z)(this,r),n.call(this,"body",0)}return(0,jt.Z)(r,[{key:"addEventListener",value:function(o,u){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u,v){}},{key:"dispatchEvent",value:function(o){}}]),r}(bo),D=function(e){(0,Hr.Z)(r,e);var n=il(r);function r(){return(0,_t.Z)(this,r),n.call(this,"html",0)}return(0,jt.Z)(r,[{key:"addEventListener",value:function(o,u){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u){}},{key:"dispatchEvent",value:function(o){}}]),r}(bo),O={},H={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Hs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(n){return n=n.toLowerCase(),n==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):n==="img"?new zu:n==="video"?new da:new bo(n)},createElementNS:function(n,r){return this.createElement(r)},createTextNode:function(n){return n},getElementById:function(n){return null},getElementsByTagName:function(n){return n=n.toLowerCase(),[]},getElementsByTagNameNS:function(n,r){return this.getElementsByTagName(r)},getElementsByName:function(n){return[]},querySelector:function(n){return null},querySelectorAll:function(n){return[]},addEventListener:function(n,r,i){O[n]||(O[n]=[]),O[n].push(r)},removeEventListener:function(n,r){var i=O[n];if(i&&i.length>0){for(var o=i.length;o--;o>0)if(i[o]===r){i.splice(o,1);break}}},dispatchEvent:function(n){var r=n.type,i=O[r];if(i)for(var o=0;o<i.length;o++)i[o](n);n.target&&typeof n.target["on"+r]=="function"&&n.target["on"+r](n)},createEvent:function(n){return new ea(n)}};H.documentElement=new D,H.head=new bo("head"),H.body=new A;var de=Object,je=$(1791),it=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"_w",void 0),(0,C.Z)(this,"_h",void 0),(0,C.Z)(this,"_data",void 0);var n=arguments.length;if(n===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else n===3&&(0,je.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,jt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),at=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",er,ar,wn;if(at){var Qn=my.getSystemInfoSync();er=Qn.system,ar=Qn.platform,wn=Qn.language}else{var On={versions:function(){var e=xi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(xi.navigator.browserLanguage||xi.navigator.language).toLowerCase()};On.versions.android?ar="android":On.versions.trident?ar="IE":On.versions.presto?ar="Opera":On.versions.webKit?ar="webKit":On.versions.gecko?ar="Firefox":On.versions.mobile?ar="mobile":On.versions.ios?ar="ios":On.versions.iPhone?ar="iPhone":On.versions.iPad?ar="ipad":On.versions.webApp?ar="webApp":On.versions.weixin?ar="weixin":On.versions.qq&&(ar="qq"),er=xi.navigator.userAgent,wn=On.language}var ji=er.toLowerCase().indexOf("android")!==-1,ca=ji?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ea="Mozilla/5.0 (".concat(ca,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(wn),zi={platform:ar,language:wn,appVersion:"5.0 (".concat(ca,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ea},ms={mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){}},tu=0,Uu=0;function tf(e){var n=Date.now(),r=Math.max(tu+23,n);return Uu=setTimeout(function(){e(tu=r)},r-n),Uu}function al(e){var n=Gs();return n.requestAnimationFrame?n.requestAnimationFrame(e):tf(e)}function Tc(e){var n=Gs();return n.cancelAnimationFrame?n.cancelAnimationFrame(e):clearTimeout(e)}var Cu=function(){function e(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,_t.Z)(this,e),(0,C.Z)(this,"href",void 0),n.indexOf("http://")==0||n.indexOf("https://")==0){this.href=n;return}this.href=r+n}return(0,jt.Z)(e,null,[{key:"createObjectURL",value:function(r){var i=r.buffers[0],o=r.type,u=Au(i),v="data:".concat(o,";base64, ");return v+u}}]),e}();function Au(e){for(var n="",r=new Uint8Array(e),i=r.byteLength,o=0;o<i;o++)n+=String.fromCharCode(r[o]);return gi(n)}var Tu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},ao={};function Ff(e){var n=Nf();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Nf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qo=new Map,Mc=new Map,Mu=new Map,ru={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function rf(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,n)}function Cl(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,rf.call(this,"readystatechange",n)}var Ri=function(e){(0,Hr.Z)(r,e);var n=Ff(r);function r(){var i;return(0,_t.Z)(this,r),i=n.call(this),(0,C.Z)((0,ye.Z)(i),"onabort",void 0),(0,C.Z)((0,ye.Z)(i),"onerror",void 0),(0,C.Z)((0,ye.Z)(i),"onload",void 0),(0,C.Z)((0,ye.Z)(i),"onloadstart",void 0),(0,C.Z)((0,ye.Z)(i),"onprogress",void 0),(0,C.Z)((0,ye.Z)(i),"ontimeout",void 0),(0,C.Z)((0,ye.Z)(i),"onloadend",void 0),(0,C.Z)((0,ye.Z)(i),"onreadystatechange",void 0),(0,C.Z)((0,ye.Z)(i),"readyState",void 0),(0,C.Z)((0,ye.Z)(i),"response",void 0),(0,C.Z)((0,ye.Z)(i),"responseText",void 0),(0,C.Z)((0,ye.Z)(i),"_responseType",void 0),(0,C.Z)((0,ye.Z)(i),"responseXML",void 0),(0,C.Z)((0,ye.Z)(i),"status",void 0),(0,C.Z)((0,ye.Z)(i),"statusText",void 0),(0,C.Z)((0,ye.Z)(i),"upload",void 0),(0,C.Z)((0,ye.Z)(i),"withCredentials",void 0),(0,C.Z)((0,ye.Z)(i),"timeout",void 0),(0,C.Z)((0,ye.Z)(i),"_url",void 0),(0,C.Z)((0,ye.Z)(i),"_method",void 0),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,qo.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,jt.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=Mu.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=Mc.get("responseHeader");return Object.keys(o).map(function(u){return"".concat(u,": ").concat(o[u])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return Mc.get("responseHeader")[o]}},{key:"open",value:function(o,u,v){this._method=o,this._url=u}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,u){var v=qo.get("requestHeader");v[o]=u,qo.set("requestHeader",v)}},{key:"addEventListener",value:function(o,u){var v=this;typeof u=="function"&&(this["on"+o]=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};y.target=y.target||v,u.call(v,y)})}},{key:"removeEventListener",value:function(o,u){this["on"+o]===u&&(this["on"+o]=null)}}]),r}(Ta);(0,C.Z)(Ri,"UNSEND",void 0),(0,C.Z)(Ri,"OPENED",void 0),(0,C.Z)(Ri,"HEADERS_RECEIVED",void 0),(0,C.Z)(Ri,"LOADING",void 0),(0,C.Z)(Ri,"DONE",void 0),Ri.UNSEND=0,Ri.OPENED=1,Ri.HEADERS_RECEIVED=2,Ri.LOADING=3,Ri.DONE=4;function Al(e){var n=xh();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function xh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ol=function(e){(0,Hr.Z)(r,e);var n=Al(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ye.Z)(o),"touches",void 0),(0,C.Z)((0,ye.Z)(o),"targetTouches",void 0),(0,C.Z)((0,ye.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=Gs(),o.currentTarget=Gs(),o}return r}(ea);function Pc(e){var n=e||{},r=n.x,i=r===void 0?0:r,o=n.y,u=o===void 0?0:o,v=n.clientX,y=v===void 0?0:v,_=n.clientY,E=_===void 0?0:_;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=u):(e.x=y,e.y=E)}function Bf(e){return function(n){var r=new ol(e);r.changedTouches=n.changedTouches,r.touches=n.touches,r.targetTouches=Array.prototype.slice.call(n.touches),r.timeStamp=n.timeStamp,r.changedTouches.forEach(function(i){return Pc(i)}),r.touches.forEach(function(i){return Pc(i)}),r.targetTouches.forEach(function(i){return Pc(i)}),H.dispatchEvent(r)}}function bh(e){return function(n){n.type=e,H.dispatchEvent(n)}}var zf=Bf("touchstart"),Ic=Bf("touchmove"),Jl=Bf("touchend"),ec=bh("mapCameaParams");function Tl(e){var n=sl();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ml=function(e){(0,Hr.Z)(r,e);var n=Tl(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ye.Z)(o),"buttons",void 0),(0,C.Z)((0,ye.Z)(o),"which",void 0),(0,C.Z)((0,ye.Z)(o),"pointerId",void 0),(0,C.Z)((0,ye.Z)(o),"bubbles",void 0),(0,C.Z)((0,ye.Z)(o),"button",void 0),(0,C.Z)((0,ye.Z)(o),"width",void 0),(0,C.Z)((0,ye.Z)(o),"height",void 0),(0,C.Z)((0,ye.Z)(o),"pressure",void 0),(0,C.Z)((0,ye.Z)(o),"isPrimary",void 0),(0,C.Z)((0,ye.Z)(o),"pointerType",void 0),(0,C.Z)((0,ye.Z)(o),"altKey",void 0),(0,C.Z)((0,ye.Z)(o),"ctrlKey",void 0),(0,C.Z)((0,ye.Z)(o),"metaKey",void 0),(0,C.Z)((0,ye.Z)(o),"shiftKey",void 0),o.target=Gs(),o.currentTarget=Gs(),o}return r}(ea),Zu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Ws=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],nf="touch";function af(e,n,r){for(var i=new Ml(e),o=0;o<Zu.length;o++){var u=Zu[o];i[u]=n[u]||Ws[o]}return i.type=e,i.target=Gs(),i.currentTarget=Gs(),i.buttons=Uf(e),i.which=i.buttons,i.pointerId=(n.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(n.radiusX||.5)*2,i.height=(n.radiusY||.5)*2,i.pressure=n.force||.5,i.isPrimary=tc(n),i.pointerType=nf,i.altKey=r.altKey,i.ctrlKey=r.ctrlKey,i.metaKey=r.metaKey,i.shiftKey=r.shiftKey,r.preventDefault&&(i.preventDefault=function(){r.preventDefault()}),i}function Uf(e){var n=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(n=1),n}var nu=null;function tc(e){return nu===e.identifier}function Oc(e){nu===null&&(nu=e.identifier)}function of(e){nu===e.identifier&&(nu=null)}function Pl(e){return function(n){for(var r=n.changedTouches,i=0;i<r.length;i++){var o=r[i];i===0&&e==="pointerdown"?Oc(o):(e==="pointerup"||e==="pointercancel")&&of(o);var u=af(e,o,n);H.dispatchEvent(u)}}}var Yh=Pl("pointerdown"),sf=Pl("pointermove"),Il=Pl("pointerup");function uf(e){var n=lf();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function lf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,Hr.Z)(r,e);var n=uf(r);function r(i){return(0,_t.Z)(this,r),n.call(this,i)}return r}(ea);function Rc(e){return function(n){n.type=e,H.dispatchEvent(n)}}var Eh=Rc("mousedown"),Sh=Rc("mousemove"),rc=Rc("mouseup"),wh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Rl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Wi=wh||Rl,nc={atob:Ci,btoa:gi,devicePixelRatio:Fi,Blob:Aa,document:H,Element:lo,Event:ea,EventTarget:Ta,HTMLCanvasElement:de,HTMLElement:bo,HTMLMediaElement:Ds,HTMLVideoElement:da,Image:zu,ImageData:it,navigator:zi,Node:xo,requestAnimationFrame:al,cancelAnimationFrame:Tc,screen:K,XMLHttpRequest:Ri,performance:ms,URL:Cu,WebGLRenderingContext:Tu,WebGL2RenderingContext:ao,addEventListener:function(n,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};H.addEventListener(n,r,i)},removeEventListener:function(n,r,i){H.removeEventListener(n,r)},dispatchEvent:function(n){H.dispatchEvent(n)},innerWidth:K.availWidth,innerHeight:K.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},oa=Wi?nc:xi,Pu=Wi?Ri:xi.XMLHttpRequest,Gi=Wi?Hs:xi.location;function Ma(e){var n=e;return typeof e=="string"&&(n=oa.document.getElementById(e)),n}function gs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Lc(e){return gs(e).split(/\s+/)}function Vu(e){var n,r,i=oa==null||(n=oa.document)===null||n===void 0||(r=n.documentElement)===null||r===void 0?void 0:r.style;if(!i)return e[0];for(var o in e)if(e[o]&&e[o]in i)return e[o];return e[0]}function za(e,n,r){var i=oa.document.createElement(e);return i.className=n||"",r&&r.appendChild(i),i}function ic(e){var n=e.parentNode;n&&n.removeChild(e)}function Ll(e,n){if(e.classList!==void 0)for(var r=Lc(n),i=0,o=r.length;i<o;i++)e.classList.add(r[i]);else if(!kc(e,n)){var u=co(e);Iu(e,(u?u+" ":"")+n)}}function ju(e,n){e.classList!==void 0?e.classList.remove(n):Iu(e,gs((" "+co(e)+" ").replace(" "+n+" "," ")))}function kc(e,n){if(e.classList!==void 0)return e.classList.contains(n);var r=co(e);return r.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(r)}function Iu(e,n){e instanceof HTMLElement?e.className=n:e.className.baseVal=n}function co(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function kl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ac=Vu(["transform","WebkitTransform"]);function fo(e,n){e.style[ac]=n}function cn(){if(typeof Event=="function")oa.dispatchEvent(new Event("resize"));else{var e=oa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,oa,0),oa.dispatchEvent(e)}}function oo(e){var n=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,n.join(""))}function Gu(){var e,n=oa.document.querySelector('meta[name="viewport"]');if(!n)return 1;var r=(e=n.content)===null||e===void 0?void 0:e.split(","),i=r.find(function(o){var u=o.split("="),v=(0,Pn.Z)(u,2),y=v[0],_=v[1];return y==="initial-scale"});return i?i.split("=")[1]*1:1}var Da=Gu()<1?1:oa.devicePixelRatio,Xs=$(53433);function Ms(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var cf=$(96435);function Br(e,n,r){return(0,cf.Z)()?Br=Reflect.construct:Br=function(o,u,v){var y=[null];y.push.apply(y,u);var _=Function.bind.apply(o,y),E=new _;return v&&(0,Xs.Z)(E,v.prototype),E},Br.apply(null,arguments)}function oc(e){var n=typeof Map=="function"?new Map:void 0;return oc=function(i){if(i===null||!Ms(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(i))return n.get(i);n.set(i,o)}function o(){return Br(i,arguments,(0,Dt.Z)(this).constructor)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Xs.Z)(o,i)},oc(e)}function ff(e){var n=ul();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sa=function(e){(0,Hr.Z)(r,e);var n=ff(r);function r(i,o,u){var v;return(0,_t.Z)(this,r),v=n.call(this,i),(0,C.Z)((0,ye.Z)(v),"status",void 0),(0,C.Z)((0,ye.Z)(v),"url",void 0),v.status=o,v.url=u,v.name=v.constructor.name,v.message=i,v}return(0,jt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(oc(Error));function ys(e){var n=new Pu;n.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&n.setRequestHeader(r,e.headers[r]);return n.withCredentials=e.credentials==="include",n}var hf=function(n,r){var i=ys(n);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var o;try{o=JSON.parse(i.response)}catch(u){return r(u)}r(null,o)}else i.status===401?r(new Sa("".concat(i.statusText),i.status,n.url)):r(new Sa(i.statusText,i.status,n.url))},i.send(),i},Ou=function(n,r){var i=ys(n);return i.responseType="arraybuffer",i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){var o=i.response;if(o.byteLength===0&&i.status===200)return r(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?r(null,{data:o,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):r(new Sa(i.statusText,i.status,n.url))},i.send(),i};function Fs(e){var n=$window.document.createElement("a");return n.href=e,n.protocol===$window.document.location.protocol&&n.host===$window.document.location.host}var Ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Zf=function(n,r){return Ou(n,function(i,o){if(i)r(i);else if(o){var u=new oa.Image;u.crossOrigin="anonymous";var v=oa.URL||oa.webkitURL;u.onload=function(){r(null,u),v.revokeObjectURL(u.src)};var y=new oa.Blob([new Uint8Array(o.data)],{type:"image/png"});u.src=o.data.byteLength?v.createObjectURL(y):Ru}})},ll=2*Math.PI*6378137/2;function Vf(e){var n=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var i=r.coordinates;pf(n,i)}),n}function pf(e,n){return Array.isArray(n[0])?n.forEach(function(r){pf(e,r)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e}function iu(e,n){return Ps(e,n)}function Ps(e,n){return Array.isArray(e[0])?e.map(function(r){return Ps(r,n)}):n(e)}function Ei(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=cl(e,n);var i=e[0],o=e[1],u=i*ll/180,v=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return v=v*ll/180,r.enable&&(u=Number(u.toFixed(r.decimal)),v=Number(v.toFixed(r.decimal))),e.length===3?[u,v,e[2]]:[u,v]}function Lu(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],i=e[1],o=r/ll*180,u=i/ll*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),n!=null&&(o=Number(o.toFixed(n)),u=Number(u.toFixed(n))),e.length===3?[o,u,e[2]]:[o,u]}function au(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function jo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function cl(e,n){if(n===!1)return e;var r=au(e[0]),i=jo(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function Ns(e){var n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=256<<20,o=Math.PI/180,u=e[0]*o,v=r*o;v=Math.log(Math.tan(Math.PI/4+v/2));var y=.5/Math.PI,_=.5,E=-.5/Math.PI;return o=.5,u=i*(y*u+_),v=i*(E*v+o),[Math.floor(u),Math.floor(v)]}function Ys(e){var n=.5/Math.PI,r=.5,i=-.5/Math.PI,o=.5,u=256<<20,v=_slicedToArray(e,2),y=v[0],_=v[1];y=(y/u-r)/n,_=(_/u-o)/i,_=(Math.atan(Math.pow(Math.E,_))-Math.PI/4)*2,o=Math.PI/180;var E=_/o,P=y/o;return[P,E]}function _s(e,n,r){var i=Kt(n[1]-e[1]),o=Kt(n[0]-e[0]),u=Kt(e[1]),v=Kt(n[1]),y=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(v);return le(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),r="meters")}function hu(e){var n=Math.PI/180,r=85.0511287798,i=6378137,o=Math.max(Math.min(r,e[1]),-r),u=Math.sin(o*n),v=i*e[0]*n,y=i*Math.log((1+u)/(1-u))/2;return[v,y]}function Tn(e,n){var r=Math.abs(e[1][1]-e[0][1])*n,i=Math.abs(e[1][0]-e[0][0])*n;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function xn(e,n){return e[0][0]<=n[0][0]&&e[0][1]<=n[0][1]&&e[1][0]>=n[1][0]&&e[1][1]>=n[1][1]}function Dc(e){return[[e[0],e[1]],[e[2],e[3]]]}var rs=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,_t.Z)(this,e),(0,C.Z)(this,"limit",void 0),(0,C.Z)(this,"cache",void 0),(0,C.Z)(this,"destroy",void 0),(0,C.Z)(this,"order",void 0),this.limit=n,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,jt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(i){r.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var i=this.cache[r];return i&&(this.deleteOrder(r),this.appendOrder(r)),i}},{key:"set",value:function(r,i){this.cache[r]?(this.delete(r),this.cache[r]=i,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=i,this.appendOrder(r))}},{key:"delete",value:function(r){var i=this.cache[r];i&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(i,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var i=this.order.findIndex(function(o){return o===r});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,i){return null}}]),e}();function ns(e,n){e.forEach(function(r){!n[r]||(n[r]=n[r].bind(n))})}var Fo=$(34663);function wa(e){var n=Fo.ZP(e),r=[0,0,0,0];return n!=null&&(r[0]=n.r/255,r[1]=n.g/255,r[2]=n.b/255,r[3]=n.opacity),r}function Hu(e){var n=e&&e[0],r=e&&e[1],i=e&&e[2],o=n+r*256+i*65536-1;return o}function Wu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function na(e){var n=oa.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=null,u=e.positions[0],v=e.positions[e.positions.length-1],y=0;y<e.colors.length;++y){var _=(e.positions[y]-u)/(v-u);i.addColorStop(_,e.colors[y])}return r.fillStyle=i,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),Wi?{data:o,width:256,height:1}:new ImageData(o,256,1)}var _a;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(_a||(_a={}));var sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fl(e,n,r){var i=e.classList;for(var o in sc)sc.hasOwnProperty(o)&&i.remove("l7-".concat(r,"-anchor-").concat(o));i.add("l7-".concat(r,"-anchor-").concat(n))}function pu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n*1}function du(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n*1}function Eo(e){if(e.length===0)return 0;for(var n=e[0]*1,r=1;r<e.length;r++)n+=e[r]*1;return n}function Xu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Eo(e)/e.length}function vu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var n=e[0],r=NaN,i=0,o=1,u=1;u<e.length+1;u++)e[u]!==n?(o>i&&(i=o,r=n),o=1,n=e[u]):o++;return r*1}var Dl={min:du,max:pu,mean:Xu,sum:Eo,mode:vu};function Yu(e,n){return e.map(function(r){return r[n]})}function uc(e,n){return Dl[e](n)}function Fc(e,n){var r=n.extent,i=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(v){lc(e,function(y){v(y)})}),u={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return u}function lc(e,n){var r=e,i=[];if(typeof r=="string")Zf({url:r},function(v,y){i.push(y),n(i)});else{var o=r.length,u=0;r.forEach(function(v){Zf({url:v},function(y,_){u++,i.push(_),u===o&&n(i)})})}return Fc}function Fl(e,n){var r=n.extent,i=n.width,o=n.height,u=n.min,v=n.max,y={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:o,min:u,max:v,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return y}var jf=$(24602),hl=$.n(jf),pl=$(7941),Bs=$.n(pl),dl=$(9363),Go=$.n(dl),df=$(20250),Nl=$.n(df),Nc=$(97671);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function cc(e,n,r,i){function o(u){return u instanceof r?u:new r(function(v){v(u)})}return new(r||(r=Promise))(function(u,v){function y(P){try{E(i.next(P))}catch(I){v(I)}}function _(P){try{E(i.throw(P))}catch(I){v(I)}}function E(P){P.done?u(P.value):o(P.value).then(y,_)}E((i=i.apply(e,n||[])).next())})}function l(e,n){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,o,u,v;return v={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function y(E){return function(P){return _([E,P])}}function _(E){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(u=E[0]&2?o.return:E[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,E[1])).done)return u;switch(o=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,o=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){r.label=E[1];break}if(E[0]===6&&r.label<u[1]){r.label=u[1],u=E;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(E);break}u[2]&&r.ops.pop(),r.trys.pop();continue}E=n.call(e,r)}catch(P){E=[6,P],o=0}finally{i=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function f(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),o,u=[],v;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)u.push(o.value)}catch(y){v={error:y}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(v)throw v.error}}return u}function c(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(f(arguments[n]));return e}function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function b(e,n){return n={exports:{}},e(n,n.exports),n.exports}var w=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=n.default});d(w);var T=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];var u=i.pop();return r.call(this,i,u)}},e.exports=n.default});d(T);var R=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=o,n.wrap=u;var r=n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=n.hasNextTick=typeof Nc=="object"&&typeof Nc.nextTick=="function";function o(y){setTimeout(y,0)}function u(y){return function(_){for(var E=[],P=arguments.length-1;P-- >0;)E[P]=arguments[P+1];return y(function(){return _.apply(void 0,E)})}}var v;r?v=setImmediate:i?v=Nc.nextTick:v=o,n.default=u(v)});d(R);var z=R.fallback,j=R.wrap,ne=R.hasSetImmediate,ae=R.hasNextTick,oe=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(T),i=o(R);function o(_){return _&&_.__esModule?_:{default:_}}function u(_){return(0,Se.isAsync)(_)?function(){for(var E=[],P=arguments.length;P--;)E[P]=arguments[P];var I=E.pop(),k=_.apply(this,E);return v(k,I)}:(0,r.default)(function(E,P){var I;try{I=_.apply(this,E)}catch(k){return P(k)}if(I&&typeof I.then=="function")return v(I,P);P(null,I)})}function v(_,E){return _.then(function(P){y(E,null,P)},function(P){y(E,P&&P.message?P:new Error(P))})}function y(_,E,P){try{_(E,P)}catch(I){(0,i.default)(function(k){throw k},I)}}e.exports=n.default});d(oe);var Se=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var r=i(oe);function i(_){return _&&_.__esModule?_:{default:_}}function o(_){return _[Symbol.toStringTag]==="AsyncFunction"}function u(_){return _[Symbol.toStringTag]==="AsyncGenerator"}function v(_){return typeof _[Symbol.asyncIterator]=="function"}function y(_){if(typeof _!="function")throw new Error("expected a function");return o(_)?(0,r.default)(_):_}n.default=y,n.isAsync=o,n.isAsyncGenerator=u,n.isAsyncIterable=v});d(Se);var Me=Se.isAsyncIterable,Ve=Se.isAsyncGenerator,be=Se.isAsync,ze=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i,o){if(o===void 0&&(o=i.length),!o)throw new Error("arity is undefined");function u(){for(var v=this,y=[],_=arguments.length;_--;)y[_]=arguments[_];return typeof y[o-1]=="function"?i.apply(this,y):new Promise(function(E,P){y[o-1]=function(I){for(var k=[],B=arguments.length-1;B-- >0;)k[B]=arguments[B+1];if(I)return P(I);E(k.length>1?k:k[0])},i.apply(v,y)})}return Object.defineProperty(u,"name",{configurable:!0,value:"awaitable("+i.name+")"}),u}e.exports=n.default});d(ze);var Xe=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=u(w),i=u(Se),o=u(ze);function u(v){return v&&v.__esModule?v:{default:v}}n.default=(0,o.default)(function(v,y,_){var E=(0,r.default)(y)?[]:{};v(y,function(P,I,k){(0,i.default)(P)(function(B){for(var q,ee=[],se=arguments.length-1;se-- >0;)ee[se]=arguments[se+1];ee.length<2&&(q=ee,ee=q[0]),E[I]=ee,k(B)})},function(P){return _(P,E)})},3),e.exports=n.default});d(Xe);var ut=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){function o(){for(var u=[],v=arguments.length;v--;)u[v]=arguments[v];if(i!==null){var y=i;i=null,y.apply(this,u)}}return Object.assign(o,i),o}e.exports=n.default});d(ut);var Ut=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=n.default});d(Ut);var Ot=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=_;var r=o(w),i=o(Ut);function o(E){return E&&E.__esModule?E:{default:E}}function u(E){var P=-1,I=E.length;return function(){return++P<I?{value:E[P],key:P}:null}}function v(E){var P=-1;return function(){var k=E.next();return k.done?null:(P++,{value:k.value,key:P})}}function y(E){var P=E?Object.keys(E):[],I=-1,k=P.length;return function(){var q=P[++I];return I<k?{value:E[q],key:q}:null}}function _(E){if((0,r.default)(E))return u(E);var P=(0,i.default)(E);return P?v(P):y(E)}e.exports=n.default});d(Ot);var Zt=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(i===null)throw new Error("Callback was already called.");var v=i;i=null,v.apply(this,o)}}e.exports=n.default});d(Zt);var lr=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};n.default=r,e.exports=n.default});d(lr);var Or=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var r=i(lr);function i(u){return u&&u.__esModule?u:{default:u}}function o(u,v,y,_){var E=!1,P=!1,I=!1,k=0,B=0;function q(){k>=v||I||E||(I=!0,u.next().then(function(De){var Je=De.value,ht=De.done;if(!(P||E)){if(I=!1,ht){E=!0,k<=0&&_(null);return}k++,y(Je,B,ee),B++,q()}}).catch(se))}function ee(De,Je){if(k-=1,!P){if(De)return se(De);if(De===!1){E=!0,P=!0;return}if(Je===r.default||E&&k<=0)return E=!0,_(null);q()}}function se(De){P||(I=!1,E=!0,_(De))}q()}e.exports=n.default});d(Or);var Pr=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=y(ut),i=y(Ot),o=y(Zt),u=y(Or),v=y(lr);function y(_){return _&&_.__esModule?_:{default:_}}n.default=function(_){return function(E,P,I){if(I=(0,r.default)(I),_<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return I(null);if((0,Se.isAsyncGenerator)(E))return(0,u.default)(E,_,P,I);if((0,Se.isAsyncIterable)(E))return(0,u.default)(E[Symbol.asyncIterator](),_,P,I);var k=(0,i.default)(E),B=!1,q=!1,ee=0,se=!1;function De(ht,gt){if(!q)if(ee-=1,ht)B=!0,I(ht);else if(ht===!1)B=!0,q=!0;else{if(gt===v.default||B&&ee<=0)return B=!0,I(null);se||Je()}}function Je(){for(se=!0;ee<_&&!B;){var ht=k();if(ht===null){B=!0,ee<=0&&I(null);return}ee+=1,P(ht.value,ht.key,(0,o.default)(De))}se=!1}Je()}},e.exports=n.default});d(Pr);var $r=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=u(Pr),i=u(Se),o=u(ze);function u(y){return y&&y.__esModule?y:{default:y}}function v(y,_,E,P){return(0,r.default)(_)(y,(0,i.default)(E),P)}n.default=(0,o.default)(v,4),e.exports=n.default});d($r);var Ln=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=o($r),i=o(ze);function o(v){return v&&v.__esModule?v:{default:v}}function u(v,y,_){return(0,r.default)(v,1,y,_)}n.default=(0,i.default)(u,3),e.exports=n.default});d(Ln);var Fn=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(Xe),i=o(Ln);function o(v){return v&&v.__esModule?v:{default:v}}function u(v,y){return(0,r.default)(i.default,v,y)}e.exports=n.default}),zn=d(Fn),ui=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return this.args=r,zn(this.tasks)},e.prototype.tap=function(n,r){var i=this;this.tasks.push(function(o){r.apply(void 0,c(i.args)),o(null,n)})},e}(),rn=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=E(w),i=E(lr),o=E($r),u=E(ut),v=E(Zt),y=E(Se),_=E(ze);function E(B){return B&&B.__esModule?B:{default:B}}function P(B,q,ee){ee=(0,u.default)(ee);var se=0,De=0,Je=B.length,ht=!1;Je===0&&ee(null);function gt(Nt,Vt){Nt===!1&&(ht=!0),ht!==!0&&(Nt?ee(Nt):(++De===Je||Vt===i.default)&&ee(null))}for(;se<Je;se++)q(B[se],se,(0,v.default)(gt))}function I(B,q,ee){return(0,o.default)(B,Infinity,q,ee)}function k(B,q,ee){var se=(0,r.default)(B)?P:I;return se(B,(0,y.default)(q),ee)}n.default=(0,_.default)(k,3),e.exports=n.default});d(rn);var ti=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(rn),i=o(Xe);function o(v){return v&&v.__esModule?v:{default:v}}function u(v,y){return(0,i.default)(r.default,v,y)}e.exports=n.default}),ai=d(ti),$n=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.promise=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return ai(this.tasks)},e.prototype.tapPromise=function(n,r){var i=this;this.tasks.push(function(o){return cc(i,void 0,void 0,function(){return l(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),o(null,n),[2]}})})})},e}(),Gn=b(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=v(ut),i=v(Zt),o=v(Se),u=v(ze);function v(_){return _&&_.__esModule?_:{default:_}}function y(_,E){if(E=(0,r.default)(E),!Array.isArray(_))return E(new Error("First argument to waterfall must be an array of functions"));if(!_.length)return E();var P=0;function I(B){var q=(0,o.default)(_[P++]);q.apply(void 0,B.concat([(0,i.default)(k)]))}function k(B){for(var q=[],ee=arguments.length-1;ee-- >0;)q[ee]=arguments[ee+1];if(B!==!1){if(B||P===_.length)return E.apply(void 0,[B].concat(q));I(q)}}I([])}n.default=(0,u.default)(y),e.exports=n.default}),fi=d(Gn),Xn=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return fi(this.tasks)},e.prototype.tap=function(n,r){this.tasks.length===0?this.tasks.push(function(i){var o=r();i(o?null:!1,o)}):this.tasks.push(function(i,o){var u=r();o(u?null:!1,n)})},e}(),Zn=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return zn(this.tasks)},e.prototype.tap=function(n,r){this.tasks.push(function(i){var o=r();i(o,n)})},e}(),xa=$(40666),Xa=$.n(xa),No=$(83437),So=$.n(No);function Ua(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function to(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ua(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ua(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xs(e,n){var r=n.radius,i=r===void 0?40:r,o=n.maxZoom,u=o===void 0?18:o,v=n.minZoom,y=v===void 0?0:v,_=n.zoom,E=_===void 0?2:_;if(e.pointIndex){var P=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=is(P),e}var I=new(So())({radius:i,minZoom:y,maxZoom:u}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(B){return{type:"Feature",geometry:{type:"Point",coordinates:B.coordinates},properties:to({},B)}}),I.load(k.features),I}function is(e){return e.map(function(n,r){return to({coordinates:n.geometry.coordinates,_id:r+1},n.properties)})}function ku(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n}function as(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n}function qs(e){if(e.length===0)return 0;for(var n=e[0],r=0,i,o=1;o<e.length;o++)i=n+e[o]*1,Math.abs(n)>=Math.abs(e[o])?r+=n-i+e[o]:r+=e[o]-i+n,n=i;return n+r*1}function Ks(e){if(e.length===0)throw new Error("mean requires at least one data point");return qs(e)/e.length}var fc={min:as,max:ku,mean:Ks,sum:qs};function Bl(e,n){return e.map(function(r){return r[n]*1})}function mu(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function vl(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?mu(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mu(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function hc(e){var n=ou();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zl(e,n){if(Array.isArray(n))return n}var gu=function(e){(0,Hr.Z)(r,e);var n=hc(r);function r(i,o){var u;return(0,_t.Z)(this,r),u=n.call(this),(0,C.Z)((0,ye.Z)(u),"data",void 0),(0,C.Z)((0,ye.Z)(u),"extent",void 0),(0,C.Z)((0,ye.Z)(u),"hooks",{init:new ui}),(0,C.Z)((0,ye.Z)(u),"parser",{type:"geojson"}),(0,C.Z)((0,ye.Z)(u),"transforms",[]),(0,C.Z)((0,ye.Z)(u),"cluster",!1),(0,C.Z)((0,ye.Z)(u),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,C.Z)((0,ye.Z)(u),"mapService",void 0),(0,C.Z)((0,ye.Z)(u),"invalidExtent",!1),(0,C.Z)((0,ye.Z)(u),"originData",void 0),(0,C.Z)((0,ye.Z)(u),"rawData",void 0),(0,C.Z)((0,ye.Z)(u),"cfg",{}),(0,C.Z)((0,ye.Z)(u),"clusterIndex",void 0),u.originData=i,u.initCfg(o),u.hooks.init.tap("parser",function(){u.excuteParser()}),u.hooks.init.tap("cluster",function(){u.initCluster()}),u.hooks.init.tap("transform",function(){u.executeTrans()}),u.init(),u}return(0,jt.Z)(r,[{key:"setData",value:function(o,u){this.rawData=o,this.originData=o,this.initCfg(u),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var u=this,v=this.clusterOptions,y=v.method,_=y===void 0?"sum":y,E=v.field,P=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,P.forEach(function(I){I.id||(I.properties.point_count=1)}),(E||Go()(_))&&(P=P.map(function(I){var k=I.id;if(k){var B=u.clusterIndex.getLeaves(k,Infinity),q=B.map(function(De){return De.properties}),ee;if(Bs()(_)&&E){var se=Bl(q,E);ee=fc[_](se)}Go()(_)&&(ee=_(q)),I.properties.stat=ee}else I.properties.point_count=1;return I})),this.data=he("geojson")({type:"FeatureCollection",features:P}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var u=this.parser.type,v=u===void 0?"geojson":u;if(v==="geojson"&&!this.cluster){var y=o<this.originData.features.length?this.originData.features[o]:"null",_=Nl()(y);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(P){return P._id===o});_.properties=E}return _}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,u){var v=this.data.dataArray.find(function(y){return y[o]===name});return v==null?void 0:v._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var u=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(u=Tn(Dc(this.extent),o)),u[0].concat(u[1])}},{key:"initCfg",value:function(o){this.cfg=hl()(this.cfg,o,zl);var u=this.cfg;u&&(u.parser&&(this.parser=u.parser),u.transforms&&(this.transforms=u.transforms),this.cluster=u.cluster||!1,u.clusterOptions&&(this.cluster=!0,this.clusterOptions=vl(vl({},this.clusterOptions),u.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,u=o.type||"geojson";if(u==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var v=he(u);this.data=v(this.originData,o),this.extent=Vf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,u=this.transforms;u.forEach(function(v){var y=v.type,_=ge(y)(o.data,v);Object.assign(o.data,_)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=xs(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(xa.EventEmitter);function go(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function yu(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qu(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function qu(e,n){if(!!e){if(typeof e=="string")return Du(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Du(e,n)}}function Du(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Xi=6378e3;function zs(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,u=o/(2*Math.PI*Xi)*(256<<20)/2,v=os(r,o),y=v.gridHash,_=v.gridOffset,E=vf(y,_,n);return{yOffset:u,xOffset:u,radius:u,type:"grid",dataArray:E}}function os(e,n){var r=Infinity,i=-Infinity,o,u=yu(e),v;try{for(u.s();!(v=u.n()).done;){var y=v.value;o=y.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,i=o>i?o:i)}}catch(ht){u.e(ht)}finally{u.f()}var _=(r+i)/2,E=Ku(n,_);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var P={},I=yu(e),k;try{for(I.s();!(k=I.n()).done;){var B=k.value,q=B.coordinates[1],ee=B.coordinates[0];if(Number.isFinite(q)&&Number.isFinite(ee)){var se=Math.floor((q+90)/E.yOffset),De=Math.floor((ee+180)/E.xOffset),Je="".concat(se,"-").concat(De);P[Je]=P[Je]||{count:0,points:[]},P[Je].count+=1,P[Je].points.push(B)}}}catch(ht){I.e(ht)}finally{I.f()}return{gridHash:P,gridOffset:E}}function Ku(e,n){var r=Bc(e),i=zc(n,e);return{yOffset:r,xOffset:i}}function Bc(e){return e/Xi*(180/Math.PI)}function zc(e,n){return n/Xi*(180/Math.PI)/Math.cos(e*Math.PI/180)}function vf(e,n,r){return Object.keys(e).reduce(function(i,o,u){var v=o.split("-"),y=parseInt(v[0],10),_=parseInt(v[1],10),E={};if(r.field&&r.method){var P=Yu(e[o].points,r.field);E[r.method]=Dl[r.method](P)}return Object.assign(E,{_id:u,coordinates:Ns([-180+n.xOffset*(_+.5),-90+n.yOffset*(y+.5)]),rawData:e[o].points,count:e[o].count}),i.push(E),i},[])}var Ko=Math.PI/3,pc=[0,Ko,2*Ko,3*Ko,4*Ko,5*Ko];function su(e){return e[0]}function ml(e){return e[1]}function Uc(){var e=0,n=0,r=1,i=1,o=su,u=ml,v,y,_;function E(I){var k={},B=[],q,ee=I.length;for(q=0;q<ee;++q)if(!(isNaN(De=+o.call(null,se=I[q],q,I))||isNaN(Je=+u.call(null,se,q,I)))){var se,De,Je,ht=Math.round(Je=Je/_),gt=Math.round(De=De/y-(ht&1)/2),Nt=Je-ht;if(Math.abs(Nt)*3>1){var Vt=De-gt,nr=gt+(De<gt?-1:1)/2,dr=ht+(Je<ht?-1:1),Jr=De-nr,ln=Je-dr;Vt*Vt+Nt*Nt>Jr*Jr+ln*ln&&(gt=nr+(ht&1?1:-1)/2,ht=dr)}var Er=gt+"-"+ht,In=k[Er];In?In.push(se):(B.push(In=k[Er]=[se]),In.x=(gt+(ht&1)/2)*y,In.y=ht*_)}return B}function P(I){var k=0,B=0;return pc.map(function(q){var ee=Math.sin(q)*I,se=-Math.cos(q)*I,De=ee-k,Je=se-B;return k=ee,B=se,[De,Je]})}return E.hexagon=function(I){return"m"+P(I==null?v:+I).join("l")+"z"},E.centers=function(){for(var I=[],k=Math.round(n/_),B=Math.round(e/y),q=k*_;q<i+v;q+=_,++k)for(var ee=B*y+(k&1)*y/2;ee<r+y/2;ee+=y)I.push([ee,q]);return I},E.mesh=function(){var I=P(v).slice(0,4).join("l");return E.centers().map(function(k){return"M"+k+"m"+I}).join("")},E.x=function(I){return arguments.length?(o=I,E):o},E.y=function(I){return arguments.length?(u=I,E):u},E.radius=function(I){return arguments.length?(v=+I,y=v*2*Math.sin(Ko),_=v*1.5,E):v},E.size=function(I){return arguments.length?(e=n=0,r=+I[0],i=+I[1],E):[r-e,i-n]},E.extent=function(I){return arguments.length?(e=+I[0][0],n=+I[0][1],r=+I[1][0],i=+I[1][1],E):[[e,n],[r,i]]},E.radius(1)}function uu(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function wo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?uu(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uu(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Zc=6378e3;function Gf(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,u=n.method,v=u===void 0?"sum":u,y=o/(2*Math.PI*Zc)*(256<<20)/2,_=r.map(function(k){var B=Ns(k.coordinates),q=(0,Pn.Z)(B,2),ee=q[0],se=q[1];return wo(wo({},k),{},{coordinates:[ee,se]})}),E=Uc().radius(y).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),P=E(_),I={dataArray:P.map(function(k,B){var q;if(n.field&&v){var ee=Yu(k,n.field);k[v]=Dl[v](ee)}return q={},(0,C.Z)(q,n.method,k[v]),(0,C.Z)(q,"count",k.length),(0,C.Z)(q,"rawData",k),(0,C.Z)(q,"coordinates",[k.x,k.y]),(0,C.Z)(q,"_id",B),q}),radius:y,xOffset:y,yOffset:y,type:"hexagon"};return I}function Hf(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function mf(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Hf(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hf(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function qh(e,n){var r=n.sourceField,i=n.targetField,o=n.data,u={};return o.forEach(function(v){u[v[r]]=v}),e.dataArray=e.dataArray.map(function(v){var y=v[i];return mf(mf({},v),u[y])}),e}function Kh(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var dc=gu;Fe("geojson",jr),Fe("image",Fc),Fe("csv",dn),Fe("json",Ht),Fe("raster",Fl),Qe("cluster",xs),Qe("filter",go),Qe("join",qh),Qe("map",Kh),Qe("grid",zs),Qe("hexagon",Gf);var gf=xr,Ch=Kn,_d=$(78892),Rr=$(99311),yf=$(11922),Gt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},xd=$(38419),_f=$.n(xd);function Ah(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function zp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ah(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ah(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Up(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zp(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Zp(e,n){if(!!e){if(typeof e=="string")return Th(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Th(e,n)}}function Th(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Wf=30;function xf(e){var n=e.characterSet,r=e.getFontWidth,i=e.fontHeight,o=e.buffer,u=e.maxCanvasWidth,v=e.mapping,y=v===void 0?{}:v,_=e.xOffset,E=_===void 0?0:_,P=e.yOffset,I=P===void 0?0:P,k=0,B=E;Array.from(n).forEach(function(ee,se){if(!y[ee]){var De=r(ee,se);B+Wf>u&&(B=0,k++),y[ee]={x:B,y:I+k*Wf,width:Wf,height:Wf,advance:De},B+=Wf}});var q=i+o*2;return{mapping:y,xOffset:B,yOffset:I+k*q,canvasHeight:Xf(I+(k+1)*q)}}function bd(e,n,r){var i=0,o=0,u=0,v=[],y={},_=Up(e),E;try{for(_.s();!(E=_.n()).done;){var P=E.value;if(!y[P.id]){var I=P.size;i+I+n>r&&(yo(y,v,o),i=0,o=u+o+n,u=0,v=[]),v.push({icon:P,xOffset:i}),i=i+I+n,u=Math.max(u,I)}}}catch(B){_.e(B)}finally{_.f()}v.length>0&&yo(y,v,o);var k=Xf(u+o+n);return{mapping:y,canvasHeight:k}}function yo(e,n,r){var i=Up(n),o;try{for(i.s();!(o=i.n()).done;){var u=o.value,v=u.icon,y=u.xOffset;e[v.id]=zp(zp({},v),{},{x:y,y:r,image:v.image,width:v.width,height:v.height})}}catch(_){i.e(_)}finally{i.f()}}function Xf(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var $h,Yf;function qf(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Kf(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Kf(e,n){if(!!e){if(typeof e=="string")return $f(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $f(e,n)}}function $f(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function bf(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function gl(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?bf(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bf(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ef=th(),Qf="sans-serif",Mh="normal",vc=24,Ph=3,Jf=.25,Ih=8,Vc=1024,Sf=1,Us=1,eh=3,Oh=null;function th(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}function wf(e,n,r,i){e.font="".concat(i," ").concat(r,"px ").concat(n),e.fillStyle="black",e.textBaseline="middle"}function rh(e,n){for(var r=0;r<e.length;r++)n.data[4*r+3]=e[r]}var yl=($h=(0,Rr.b2)(),$h(Yf=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"fontAtlas",void 0),(0,C.Z)(this,"iconFontMap",void 0),(0,C.Z)(this,"iconFontGlyphs",{}),(0,C.Z)(this,"fontOptions",void 0),(0,C.Z)(this,"key",void 0),(0,C.Z)(this,"cache",new rs(eh))}return(0,jt.Z)(e,[{key:"scale",get:function(){return Us}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Qf,fontWeight:Mh,characterSet:Ef,fontSize:vc,buffer:Ph,sdf:!0,cutoff:Jf,radius:Ih,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var i=this;r.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,i){this.iconFontMap.set(r,i)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=gl(gl({},this.fontOptions),r),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var u=this.generateFontAtlas(this.key,i,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,i,o){var u=this.fontOptions,v=u.fontFamily,y=u.fontWeight,_=u.fontSize,E=u.buffer,P=u.sdf,I=u.radius,k=u.cutoff,B=u.iconfont,q=o&&o.data;q||(q=oa.document.createElement("canvas"),q.width=Vc);var ee=q.getContext("2d");wf(ee,v,_,y);var se=xf(gl({getFontWidth:function(nl){return ee.measureText(nl).width},fontHeight:_*Us,buffer:E,characterSet:i,maxCanvasWidth:Vc},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),De=se.mapping,Je=se.canvasHeight,ht=se.xOffset,gt=se.yOffset,Nt=ee.getImageData(0,0,q.width,q.height);if(q.height=Je,ee.putImageData(Nt,0,0),wf(ee,v,_,y),P){var Vt=new(_f())(_,E,I,k,v,y),nr=ee.getImageData(0,0,Vt.size,Vt.size),dr=qf(i),Jr;try{for(dr.s();!(Jr=dr.n()).done;){var ln=Jr.value;if(B){var Er=String.fromCharCode(parseInt(ln.replace("&#x","").replace(";",""),16)),In=Vt.draw(Er);rh(In,nr)}else rh(Vt.draw(ln),nr);ee.putImageData(nr,De[ln].x,De[ln].y)}}catch(ws){dr.e(ws)}finally{dr.f()}}else{var Vn=qf(i),pi;try{for(Vn.s();!(pi=Vn.n()).done;){var Ro=pi.value;ee.fillText(Ro,De[Ro].x,De[Ro].y+_*Sf)}}catch(ws){Vn.e(ws)}finally{Vn.f()}}return{xOffset:ht,yOffset:gt,mapping:De,data:q,width:q.width,height:q.height}}},{key:"getKey",value:function(){return"key";var r,i,o,u,v,y,_,E}},{key:"getNewChars",value:function(r,i){var o=this.cache.get(r);if(!o)return i;var u=[],v=o.mapping,y=new Set(Object.keys(v)),_=new Set(i);return _.forEach(function(E){y.has(E)||u.push(E)}),u}}]),e}())||Yf),mc,Qh;function Rh(e){var n=Vp();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Vp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ed=3,jp=1024,Is=64,Gp=(mc=(0,Rr.b2)(),mc(Qh=function(e){(0,Hr.Z)(r,e);var n=Rh(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"canvasHeight",128),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"canvas",void 0),(0,C.Z)((0,ye.Z)(i),"iconData",void 0),(0,C.Z)((0,ye.Z)(i),"iconMap",void 0),(0,C.Z)((0,ye.Z)(i),"ctx",void 0),(0,C.Z)((0,ye.Z)(i),"loadingImageCount",0),i}return(0,jt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=oa.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,u){var v=this,y=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Is}),this.updateIconMap(),this.loadImage(u).then(function(_){y=_;var E=v.iconData.find(function(P){return P.id===o});E&&(E.image=y,E.width=y.width,E.height=y.height),v.update()})}},{key:"addImageMini",value:function(o,u,v){var y=this,_=v.getSceneConfig().canvas,E=_.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Is}),this.updateIconMap(),this.loadImageMini(u,_).then(function(P){E=P;var I=y.iconData.find(function(k){return k.id===o});I&&(I.image=E,I.width=E.width,I.height=E.height),y.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(u){return u.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=jp,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(u){var v=o.iconMap[u],y=v.x,_=v.y,E=v.image,P=v.width,I=P===void 0?64:P,k=v.height,B=k===void 0?64:k,q=Math.max(I,B),ee=q/Is,se=B/ee,De=I/ee;E&&o.ctx.drawImage(E,y+(Is-De)/2,_+(Is-se)/2,De,se)})}},{key:"updateIconMap",value:function(){var o=bd(this.iconData,Ed,jp),u=o.mapping,v=o.canvasHeight;this.iconMap=u,this.canvasHeight=v}},{key:"loadImage",value:function(o){return new Promise(function(u,v){if(o instanceof HTMLImageElement){u(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){u(y)},y.onerror=function(){v(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,u){return new Promise(function(v,y){var _=u.createImage();_.crossOrigin="anonymous",_.onload=function(){v(_)},_.onerror=function(){y(new Error("Could not load image at "+o))},_.src=o})}}]),r}(xa.EventEmitter))||Qh),Ca=$(72988);function _u(){var e=new Ca.WT(16);return Ca.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function $u(e){var n=new Ca.WT(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Hp(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Wp(e,n,r,i,o,u,v,y,_,E,P,I,k,B,q,ee){var se=new Ca.WT(16);return se[0]=e,se[1]=n,se[2]=r,se[3]=i,se[4]=o,se[5]=u,se[6]=v,se[7]=y,se[8]=_,se[9]=E,se[10]=P,se[11]=I,se[12]=k,se[13]=B,se[14]=q,se[15]=ee,se}function _l(e,n,r,i,o,u,v,y,_,E,P,I,k,B,q,ee,se){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e[4]=u,e[5]=v,e[6]=y,e[7]=_,e[8]=E,e[9]=P,e[10]=I,e[11]=k,e[12]=B,e[13]=q,e[14]=ee,e[15]=se,e}function jc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gc(e,n){if(e===n){var r=n[1],i=n[2],o=n[3],u=n[6],v=n[7],y=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=i,e[9]=u,e[11]=n[14],e[12]=o,e[13]=v,e[14]=y}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function Qu(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],v=n[4],y=n[5],_=n[6],E=n[7],P=n[8],I=n[9],k=n[10],B=n[11],q=n[12],ee=n[13],se=n[14],De=n[15],Je=r*y-i*v,ht=r*_-o*v,gt=r*E-u*v,Nt=i*_-o*y,Vt=i*E-u*y,nr=o*E-u*_,dr=P*ee-I*q,Jr=P*se-k*q,ln=P*De-B*q,Er=I*se-k*ee,In=I*De-B*ee,Vn=k*De-B*se,pi=Je*Vn-ht*In+gt*Er+Nt*ln-Vt*Jr+nr*dr;return pi?(pi=1/pi,e[0]=(y*Vn-_*In+E*Er)*pi,e[1]=(o*In-i*Vn-u*Er)*pi,e[2]=(ee*nr-se*Vt+De*Nt)*pi,e[3]=(k*Vt-I*nr-B*Nt)*pi,e[4]=(_*ln-v*Vn-E*Jr)*pi,e[5]=(r*Vn-o*ln+u*Jr)*pi,e[6]=(se*gt-q*nr-De*ht)*pi,e[7]=(P*nr-k*gt+B*ht)*pi,e[8]=(v*In-y*ln+E*dr)*pi,e[9]=(i*ln-r*In-u*dr)*pi,e[10]=(q*Vt-ee*gt+De*Je)*pi,e[11]=(I*gt-P*Vt-B*Je)*pi,e[12]=(y*Jr-v*Er-_*dr)*pi,e[13]=(r*Er-i*Jr+o*dr)*pi,e[14]=(ee*ht-q*Nt-se*Je)*pi,e[15]=(P*Nt-I*ht+k*Je)*pi,e):null}function Xp(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],v=n[4],y=n[5],_=n[6],E=n[7],P=n[8],I=n[9],k=n[10],B=n[11],q=n[12],ee=n[13],se=n[14],De=n[15];return e[0]=y*(k*De-B*se)-I*(_*De-E*se)+ee*(_*B-E*k),e[1]=-(i*(k*De-B*se)-I*(o*De-u*se)+ee*(o*B-u*k)),e[2]=i*(_*De-E*se)-y*(o*De-u*se)+ee*(o*E-u*_),e[3]=-(i*(_*B-E*k)-y*(o*B-u*k)+I*(o*E-u*_)),e[4]=-(v*(k*De-B*se)-P*(_*De-E*se)+q*(_*B-E*k)),e[5]=r*(k*De-B*se)-P*(o*De-u*se)+q*(o*B-u*k),e[6]=-(r*(_*De-E*se)-v*(o*De-u*se)+q*(o*E-u*_)),e[7]=r*(_*B-E*k)-v*(o*B-u*k)+P*(o*E-u*_),e[8]=v*(I*De-B*ee)-P*(y*De-E*ee)+q*(y*B-E*I),e[9]=-(r*(I*De-B*ee)-P*(i*De-u*ee)+q*(i*B-u*I)),e[10]=r*(y*De-E*ee)-v*(i*De-u*ee)+q*(i*E-u*y),e[11]=-(r*(y*B-E*I)-v*(i*B-u*I)+P*(i*E-u*y)),e[12]=-(v*(I*se-k*ee)-P*(y*se-_*ee)+q*(y*k-_*I)),e[13]=r*(I*se-k*ee)-P*(i*se-o*ee)+q*(i*k-o*I),e[14]=-(r*(y*se-_*ee)-v*(i*se-o*ee)+q*(i*_-o*y)),e[15]=r*(y*k-_*I)-v*(i*k-o*I)+P*(i*_-o*y),e}function Jh(e){var n=e[0],r=e[1],i=e[2],o=e[3],u=e[4],v=e[5],y=e[6],_=e[7],E=e[8],P=e[9],I=e[10],k=e[11],B=e[12],q=e[13],ee=e[14],se=e[15],De=n*v-r*u,Je=n*y-i*u,ht=n*_-o*u,gt=r*y-i*v,Nt=r*_-o*v,Vt=i*_-o*y,nr=E*q-P*B,dr=E*ee-I*B,Jr=E*se-k*B,ln=P*ee-I*q,Er=P*se-k*q,In=I*se-k*ee;return De*In-Je*Er+ht*ln+gt*Jr-Nt*dr+Vt*nr}function xu(e,n,r){var i=n[0],o=n[1],u=n[2],v=n[3],y=n[4],_=n[5],E=n[6],P=n[7],I=n[8],k=n[9],B=n[10],q=n[11],ee=n[12],se=n[13],De=n[14],Je=n[15],ht=r[0],gt=r[1],Nt=r[2],Vt=r[3];return e[0]=ht*i+gt*y+Nt*I+Vt*ee,e[1]=ht*o+gt*_+Nt*k+Vt*se,e[2]=ht*u+gt*E+Nt*B+Vt*De,e[3]=ht*v+gt*P+Nt*q+Vt*Je,ht=r[4],gt=r[5],Nt=r[6],Vt=r[7],e[4]=ht*i+gt*y+Nt*I+Vt*ee,e[5]=ht*o+gt*_+Nt*k+Vt*se,e[6]=ht*u+gt*E+Nt*B+Vt*De,e[7]=ht*v+gt*P+Nt*q+Vt*Je,ht=r[8],gt=r[9],Nt=r[10],Vt=r[11],e[8]=ht*i+gt*y+Nt*I+Vt*ee,e[9]=ht*o+gt*_+Nt*k+Vt*se,e[10]=ht*u+gt*E+Nt*B+Vt*De,e[11]=ht*v+gt*P+Nt*q+Vt*Je,ht=r[12],gt=r[13],Nt=r[14],Vt=r[15],e[12]=ht*i+gt*y+Nt*I+Vt*ee,e[13]=ht*o+gt*_+Nt*k+Vt*se,e[14]=ht*u+gt*E+Nt*B+Vt*De,e[15]=ht*v+gt*P+Nt*q+Vt*Je,e}function Hc(e,n,r){var i=r[0],o=r[1],u=r[2],v,y,_,E,P,I,k,B,q,ee,se,De;return n===e?(e[12]=n[0]*i+n[4]*o+n[8]*u+n[12],e[13]=n[1]*i+n[5]*o+n[9]*u+n[13],e[14]=n[2]*i+n[6]*o+n[10]*u+n[14],e[15]=n[3]*i+n[7]*o+n[11]*u+n[15]):(v=n[0],y=n[1],_=n[2],E=n[3],P=n[4],I=n[5],k=n[6],B=n[7],q=n[8],ee=n[9],se=n[10],De=n[11],e[0]=v,e[1]=y,e[2]=_,e[3]=E,e[4]=P,e[5]=I,e[6]=k,e[7]=B,e[8]=q,e[9]=ee,e[10]=se,e[11]=De,e[12]=v*i+P*o+q*u+n[12],e[13]=y*i+I*o+ee*u+n[13],e[14]=_*i+k*o+se*u+n[14],e[15]=E*i+B*o+De*u+n[15]),e}function qi(e,n,r){var i=r[0],o=r[1],u=r[2];return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=n[7]*o,e[8]=n[8]*u,e[9]=n[9]*u,e[10]=n[10]*u,e[11]=n[11]*u,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function gc(e,n,r,i){var o=i[0],u=i[1],v=i[2],y=Math.hypot(o,u,v),_,E,P,I,k,B,q,ee,se,De,Je,ht,gt,Nt,Vt,nr,dr,Jr,ln,Er,In,Vn,pi,Ro;return y<Ca.Ib?null:(y=1/y,o*=y,u*=y,v*=y,_=Math.sin(r),E=Math.cos(r),P=1-E,I=n[0],k=n[1],B=n[2],q=n[3],ee=n[4],se=n[5],De=n[6],Je=n[7],ht=n[8],gt=n[9],Nt=n[10],Vt=n[11],nr=o*o*P+E,dr=u*o*P+v*_,Jr=v*o*P-u*_,ln=o*u*P-v*_,Er=u*u*P+E,In=v*u*P+o*_,Vn=o*v*P+u*_,pi=u*v*P-o*_,Ro=v*v*P+E,e[0]=I*nr+ee*dr+ht*Jr,e[1]=k*nr+se*dr+gt*Jr,e[2]=B*nr+De*dr+Nt*Jr,e[3]=q*nr+Je*dr+Vt*Jr,e[4]=I*ln+ee*Er+ht*In,e[5]=k*ln+se*Er+gt*In,e[6]=B*ln+De*Er+Nt*In,e[7]=q*ln+Je*Er+Vt*In,e[8]=I*Vn+ee*pi+ht*Ro,e[9]=k*Vn+se*pi+gt*Ro,e[10]=B*Vn+De*pi+Nt*Ro,e[11]=q*Vn+Je*pi+Vt*Ro,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function so(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[4],v=n[5],y=n[6],_=n[7],E=n[8],P=n[9],I=n[10],k=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=u*o+E*i,e[5]=v*o+P*i,e[6]=y*o+I*i,e[7]=_*o+k*i,e[8]=E*o-u*i,e[9]=P*o-v*i,e[10]=I*o-y*i,e[11]=k*o-_*i,e}function Os(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[0],v=n[1],y=n[2],_=n[3],E=n[8],P=n[9],I=n[10],k=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=u*o-E*i,e[1]=v*o-P*i,e[2]=y*o-I*i,e[3]=_*o-k*i,e[8]=u*i+E*o,e[9]=v*i+P*o,e[10]=y*i+I*o,e[11]=_*i+k*o,e}function Lh(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[0],v=n[1],y=n[2],_=n[3],E=n[4],P=n[5],I=n[6],k=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=u*o+E*i,e[1]=v*o+P*i,e[2]=y*o+I*i,e[3]=_*o+k*i,e[4]=E*o-u*i,e[5]=P*o-v*i,e[6]=I*o-y*i,e[7]=k*o-_*i,e}function ep(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Sd(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wd(e,n,r){var i=r[0],o=r[1],u=r[2],v=Math.hypot(i,o,u),y,_,E;return v<Ca.Ib?null:(v=1/v,i*=v,o*=v,u*=v,y=Math.sin(n),_=Math.cos(n),E=1-_,e[0]=i*i*E+_,e[1]=o*i*E+u*y,e[2]=u*i*E-o*y,e[3]=0,e[4]=i*o*E-u*y,e[5]=o*o*E+_,e[6]=u*o*E+i*y,e[7]=0,e[8]=i*u*E+o*y,e[9]=o*u*E-i*y,e[10]=u*u*E+_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Cd(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tp(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ad(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yp(e,n,r){var i=n[0],o=n[1],u=n[2],v=n[3],y=i+i,_=o+o,E=u+u,P=i*y,I=i*_,k=i*E,B=o*_,q=o*E,ee=u*E,se=v*y,De=v*_,Je=v*E;return e[0]=1-(B+ee),e[1]=I+Je,e[2]=k-De,e[3]=0,e[4]=I-Je,e[5]=1-(P+ee),e[6]=q+se,e[7]=0,e[8]=k+De,e[9]=q-se,e[10]=1-(P+B),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function nh(e,n){var r=new Ca.WT(3),i=-n[0],o=-n[1],u=-n[2],v=n[3],y=n[4],_=n[5],E=n[6],P=n[7],I=i*i+o*o+u*u+v*v;return I>0?(r[0]=(y*v+P*i+_*u-E*o)*2/I,r[1]=(_*v+P*o+E*i-y*u)*2/I,r[2]=(E*v+P*u+y*o-_*i)*2/I):(r[0]=(y*v+P*i+_*u-E*o)*2,r[1]=(_*v+P*o+E*i-y*u)*2,r[2]=(E*v+P*u+y*o-_*i)*2),Yp(e,n,r),e}function qp(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function rp(e,n){var r=n[0],i=n[1],o=n[2],u=n[4],v=n[5],y=n[6],_=n[8],E=n[9],P=n[10];return e[0]=Math.hypot(r,i,o),e[1]=Math.hypot(u,v,y),e[2]=Math.hypot(_,E,P),e}function ih(e,n){var r=new Ca.WT(3);rp(r,n);var i=1/r[0],o=1/r[1],u=1/r[2],v=n[0]*i,y=n[1]*o,_=n[2]*u,E=n[4]*i,P=n[5]*o,I=n[6]*u,k=n[8]*i,B=n[9]*o,q=n[10]*u,ee=v+P+q,se=0;return ee>0?(se=Math.sqrt(ee+1)*2,e[3]=.25*se,e[0]=(I-B)/se,e[1]=(k-_)/se,e[2]=(y-E)/se):v>P&&v>q?(se=Math.sqrt(1+v-P-q)*2,e[3]=(I-B)/se,e[0]=.25*se,e[1]=(y+E)/se,e[2]=(k+_)/se):P>q?(se=Math.sqrt(1+P-v-q)*2,e[3]=(k-_)/se,e[0]=(y+E)/se,e[1]=.25*se,e[2]=(I+B)/se):(se=Math.sqrt(1+q-v-P)*2,e[3]=(y-E)/se,e[0]=(k+_)/se,e[1]=(I+B)/se,e[2]=.25*se),e}function Pa(e,n,r,i){var o=n[0],u=n[1],v=n[2],y=n[3],_=o+o,E=u+u,P=v+v,I=o*_,k=o*E,B=o*P,q=u*E,ee=u*P,se=v*P,De=y*_,Je=y*E,ht=y*P,gt=i[0],Nt=i[1],Vt=i[2];return e[0]=(1-(q+se))*gt,e[1]=(k+ht)*gt,e[2]=(B-Je)*gt,e[3]=0,e[4]=(k-ht)*Nt,e[5]=(1-(I+se))*Nt,e[6]=(ee+De)*Nt,e[7]=0,e[8]=(B+Je)*Vt,e[9]=(ee-De)*Vt,e[10]=(1-(I+q))*Vt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function np(e,n,r,i,o){var u=n[0],v=n[1],y=n[2],_=n[3],E=u+u,P=v+v,I=y+y,k=u*E,B=u*P,q=u*I,ee=v*P,se=v*I,De=y*I,Je=_*E,ht=_*P,gt=_*I,Nt=i[0],Vt=i[1],nr=i[2],dr=o[0],Jr=o[1],ln=o[2],Er=(1-(ee+De))*Nt,In=(B+gt)*Nt,Vn=(q-ht)*Nt,pi=(B-gt)*Vt,Ro=(1-(k+De))*Vt,ws=(se+Je)*Vt,nl=(q+ht)*nr,Ac=(se-Je)*nr,bl=(1-(k+ee))*nr;return e[0]=Er,e[1]=In,e[2]=Vn,e[3]=0,e[4]=pi,e[5]=Ro,e[6]=ws,e[7]=0,e[8]=nl,e[9]=Ac,e[10]=bl,e[11]=0,e[12]=r[0]+dr-(Er*dr+pi*Jr+nl*ln),e[13]=r[1]+Jr-(In*dr+Ro*Jr+Ac*ln),e[14]=r[2]+ln-(Vn*dr+ws*Jr+bl*ln),e[15]=1,e}function Ul(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],v=r+r,y=i+i,_=o+o,E=r*v,P=i*v,I=i*y,k=o*v,B=o*y,q=o*_,ee=u*v,se=u*y,De=u*_;return e[0]=1-I-q,e[1]=P+De,e[2]=k-se,e[3]=0,e[4]=P-De,e[5]=1-E-q,e[6]=B+ee,e[7]=0,e[8]=k+se,e[9]=B-ee,e[10]=1-E-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cf(e,n,r,i,o,u,v){var y=1/(r-n),_=1/(o-i),E=1/(u-v);return e[0]=u*2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2*_,e[6]=0,e[7]=0,e[8]=(r+n)*y,e[9]=(o+i)*_,e[10]=(v+u)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=v*u*2*E,e[15]=0,e}function kh(e,n,r,i,o){var u=1/Math.tan(n/2),v;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(v=1/(i-o),e[10]=(o+i)*v,e[14]=2*o*i*v):(e[10]=-1,e[14]=-2*i),e}var Kp=kh;function F(e,n,r,i,o){var u=1/Math.tan(n/2),v;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(v=1/(i-o),e[10]=o*v,e[14]=o*i*v):(e[10]=-1,e[14]=-i),e}function ue(e,n,r,i){var o=Math.tan(n.upDegrees*Math.PI/180),u=Math.tan(n.downDegrees*Math.PI/180),v=Math.tan(n.leftDegrees*Math.PI/180),y=Math.tan(n.rightDegrees*Math.PI/180),_=2/(v+y),E=2/(o+u);return e[0]=_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((v-y)*_*.5),e[9]=(o-u)*E*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function ke(e,n,r,i,o,u,v){var y=1/(n-r),_=1/(i-o),E=1/(u-v);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(n+r)*y,e[13]=(o+i)*_,e[14]=(v+u)*E,e[15]=1,e}var Tt=ke;function tr(e,n,r,i,o,u,v){var y=1/(n-r),_=1/(i-o),E=1/(u-v);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(n+r)*y,e[13]=(o+i)*_,e[14]=u*E,e[15]=1,e}function Ct(e,n,r,i){var o,u,v,y,_,E,P,I,k,B,q=n[0],ee=n[1],se=n[2],De=i[0],Je=i[1],ht=i[2],gt=r[0],Nt=r[1],Vt=r[2];return Math.abs(q-gt)<Ca.Ib&&Math.abs(ee-Nt)<Ca.Ib&&Math.abs(se-Vt)<Ca.Ib?jc(e):(P=q-gt,I=ee-Nt,k=se-Vt,B=1/Math.hypot(P,I,k),P*=B,I*=B,k*=B,o=Je*k-ht*I,u=ht*P-De*k,v=De*I-Je*P,B=Math.hypot(o,u,v),B?(B=1/B,o*=B,u*=B,v*=B):(o=0,u=0,v=0),y=I*v-k*u,_=k*o-P*v,E=P*u-I*o,B=Math.hypot(y,_,E),B?(B=1/B,y*=B,_*=B,E*=B):(y=0,_=0,E=0),e[0]=o,e[1]=y,e[2]=P,e[3]=0,e[4]=u,e[5]=_,e[6]=I,e[7]=0,e[8]=v,e[9]=E,e[10]=k,e[11]=0,e[12]=-(o*q+u*ee+v*se),e[13]=-(y*q+_*ee+E*se),e[14]=-(P*q+I*ee+k*se),e[15]=1,e)}function Yt(e,n,r,i){var o=n[0],u=n[1],v=n[2],y=i[0],_=i[1],E=i[2],P=o-r[0],I=u-r[1],k=v-r[2],B=P*P+I*I+k*k;B>0&&(B=1/Math.sqrt(B),P*=B,I*=B,k*=B);var q=_*k-E*I,ee=E*P-y*k,se=y*I-_*P;return B=q*q+ee*ee+se*se,B>0&&(B=1/Math.sqrt(B),q*=B,ee*=B,se*=B),e[0]=q,e[1]=ee,e[2]=se,e[3]=0,e[4]=I*se-k*ee,e[5]=k*q-P*se,e[6]=P*ee-I*q,e[7]=0,e[8]=P,e[9]=I,e[10]=k,e[11]=0,e[12]=o,e[13]=u,e[14]=v,e[15]=1,e}function sr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function pr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function gr(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function br(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function Ar(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function zr(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e[4]=n[4]+r[4]*i,e[5]=n[5]+r[5]*i,e[6]=n[6]+r[6]*i,e[7]=n[7]+r[7]*i,e[8]=n[8]+r[8]*i,e[9]=n[9]+r[9]*i,e[10]=n[10]+r[10]*i,e[11]=n[11]+r[11]*i,e[12]=n[12]+r[12]*i,e[13]=n[13]+r[13]*i,e[14]=n[14]+r[14]*i,e[15]=n[15]+r[15]*i,e}function vr(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function _r(e,n){var r=e[0],i=e[1],o=e[2],u=e[3],v=e[4],y=e[5],_=e[6],E=e[7],P=e[8],I=e[9],k=e[10],B=e[11],q=e[12],ee=e[13],se=e[14],De=e[15],Je=n[0],ht=n[1],gt=n[2],Nt=n[3],Vt=n[4],nr=n[5],dr=n[6],Jr=n[7],ln=n[8],Er=n[9],In=n[10],Vn=n[11],pi=n[12],Ro=n[13],ws=n[14],nl=n[15];return Math.abs(r-Je)<=Ca.Ib*Math.max(1,Math.abs(r),Math.abs(Je))&&Math.abs(i-ht)<=Ca.Ib*Math.max(1,Math.abs(i),Math.abs(ht))&&Math.abs(o-gt)<=Ca.Ib*Math.max(1,Math.abs(o),Math.abs(gt))&&Math.abs(u-Nt)<=Ca.Ib*Math.max(1,Math.abs(u),Math.abs(Nt))&&Math.abs(v-Vt)<=Ca.Ib*Math.max(1,Math.abs(v),Math.abs(Vt))&&Math.abs(y-nr)<=Ca.Ib*Math.max(1,Math.abs(y),Math.abs(nr))&&Math.abs(_-dr)<=Ca.Ib*Math.max(1,Math.abs(_),Math.abs(dr))&&Math.abs(E-Jr)<=Ca.Ib*Math.max(1,Math.abs(E),Math.abs(Jr))&&Math.abs(P-ln)<=Ca.Ib*Math.max(1,Math.abs(P),Math.abs(ln))&&Math.abs(I-Er)<=Ca.Ib*Math.max(1,Math.abs(I),Math.abs(Er))&&Math.abs(k-In)<=Ca.Ib*Math.max(1,Math.abs(k),Math.abs(In))&&Math.abs(B-Vn)<=Ca.Ib*Math.max(1,Math.abs(B),Math.abs(Vn))&&Math.abs(q-pi)<=Ca.Ib*Math.max(1,Math.abs(q),Math.abs(pi))&&Math.abs(ee-Ro)<=Ca.Ib*Math.max(1,Math.abs(ee),Math.abs(Ro))&&Math.abs(se-ws)<=Ca.Ib*Math.max(1,Math.abs(se),Math.abs(ws))&&Math.abs(De-nl)<=Ca.Ib*Math.max(1,Math.abs(De),Math.abs(nl))}var tt=xu,Ft=br,mr,kr,or=(mr=(0,Rr.b2)(),mr(kr=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"overridedViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredProjectionMatrix",void 0),(0,C.Z)(this,"viewMatrixInverse",void 0),(0,C.Z)(this,"cameraPosition",void 0)}return(0,jt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=_u(),Qu(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),i=(0,Pn.Z)(r,2),o=i[0],u=i[1];return[o,u]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,i){var o=ep(_u(),[r,i,0]);this.jitteredProjectionMatrix=xu(_u(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=xu(_u(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||kr),Tr,Wr;function Nn(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qt(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function qt(e,n){if(!!e){if(typeof e=="string")return $t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $t(e,n)}}function $t(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var mn=(Tr=(0,Rr.b2)(),Tr(Wr=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"controlCorners",void 0),(0,C.Z)(this,"controlContainer",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"controls",[]),(0,C.Z)(this,"unAddControls",[])}return(0,jt.Z)(e,[{key:"init",value:function(r,i){this.container=r.container,this.scene=i,this.mapsService=i.get(Gt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,i){var o=i.get(Gt.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(i){return i.controlOption.name===r})}},{key:"removeControl",value:function(r){var i=this.controls.indexOf(r);return i>-1&&this.controls.splice(i,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(i){i.addTo(r.scene),r.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Nn(this.controls),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;o.remove()}}catch(u){r.e(u)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},i="l7-",o=this.controlContainer=za("div",i+"control-container",this.container);function u(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],y=v.map(function(_){return i+_}).join(" ");r[v.join("")]=za("div",y,o)}u(["top","left"]),u(["top","right"]),u(["bottom","left"]),u(["bottom","right"]),u(["top","center"]),u(["right","center"]),u(["left","center"]),u(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ic(this.controlCorners[r]);this.controlContainer&&ic(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Wr),Ur,yr,Xr=(Ur=(0,Rr.b2)(),Ur(yr=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"markers",[]),(0,C.Z)(this,"markerLayers",[]),(0,C.Z)(this,"unAddMarkers",[]),(0,C.Z)(this,"unAddMarkerLayers",[])}return(0,jt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var i=this.markerLayers.indexOf(r);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(i){i.addTo(r.scene),r.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(i){r.markerLayers.push(i),i.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var i=this.markers.indexOf(r);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Gt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||yr),Yr,hi,Jn=(Yr=(0,Rr.b2)(),Yr(hi=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"popup",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"unAddPopup",void 0)}return(0,jt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Gt.IMapService)}}]),e}())||hi),Gr=$(28440),Qr=$.n(Gr),Yn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},oi=Yn,Li,Ya;function ro(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Pi(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ro(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ro(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var $o={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Za={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ho=(Li=(0,Rr.b2)(),Li(Ya=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"sceneConfigCache",{}),(0,C.Z)(this,"layerConfigCache",{})}return(0,jt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return oi[r]}},{key:"setSceneConfig",value:function(r,i){this.sceneConfigCache[r]=Pi(Pi({},$o),i)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,i,o){this.layerConfigCache[i]=Pi({},Qr()({},this.sceneConfigCache[r],Za,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Ya);function Rn(e,n,r,i){!r||Object.defineProperty(e,n,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function kn(e,n,r,i,o){var u={};return Object.keys(i).forEach(function(v){u[v]=i[v]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=r.slice().reverse().reduce(function(v,y){return y(e,n,v)||v},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,n,u),u=null),u}function Co(){var e=new Ca.WT(4);return Ca.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function bs(e){var n=new glMatrix.ARRAY_TYPE(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function uo(e,n,r,i){var o=new Ca.WT(4);return o[0]=e,o[1]=n,o[2]=r,o[3]=i,o}function _i(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Wo(e,n,r,i,o){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e}function ia(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e}function ss(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e}function ei(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e[3]=n[3]*r[3],e}function Ni(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e[3]=n[3]/r[3],e}function va(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e}function Ao(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e}function Zl(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e[3]=Math.min(n[3],r[3]),e}function we(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e[3]=Math.max(n[3],r[3]),e}function Rt(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e}function dt(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e}function fn(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e}function Ui(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],u=n[3]-e[3];return Math.hypot(r,i,o,u)}function _e(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],u=n[3]-e[3];return r*r+i*i+o*o+u*u}function re(e){var n=e[0],r=e[1],i=e[2],o=e[3];return Math.hypot(n,r,i,o)}function Ue(e){var n=e[0],r=e[1],i=e[2],o=e[3];return n*n+r*r+i*i+o*o}function rt(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e}function St(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e}function We(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],v=r*r+i*i+o*o+u*u;return v>0&&(v=1/Math.sqrt(v)),e[0]=r*v,e[1]=i*v,e[2]=o*v,e[3]=u*v,e}function Le(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function $e(e,n,r,i){var o=r[0]*i[1]-r[1]*i[0],u=r[0]*i[2]-r[2]*i[0],v=r[0]*i[3]-r[3]*i[0],y=r[1]*i[2]-r[2]*i[1],_=r[1]*i[3]-r[3]*i[1],E=r[2]*i[3]-r[3]*i[2],P=n[0],I=n[1],k=n[2],B=n[3];return e[0]=I*E-k*_+B*y,e[1]=-(P*E)+k*v-B*u,e[2]=P*_-I*v+B*o,e[3]=-(P*y)+I*u-k*o,e}function pe(e,n,r,i){var o=n[0],u=n[1],v=n[2],y=n[3];return e[0]=o+i*(r[0]-o),e[1]=u+i*(r[1]-u),e[2]=v+i*(r[2]-v),e[3]=y+i*(r[3]-y),e}function Be(e,n){n=n||1;var r,i,o,u,v,y;do r=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,v=r*r+i*i;while(v>=1);do o=glMatrix.RANDOM()*2-1,u=glMatrix.RANDOM()*2-1,y=o*o+u*u;while(y>=1);var _=Math.sqrt((1-v)/y);return e[0]=n*r,e[1]=n*i,e[2]=n*o*_,e[3]=n*u*_,e}function xe(e,n,r){var i=n[0],o=n[1],u=n[2],v=n[3];return e[0]=r[0]*i+r[4]*o+r[8]*u+r[12]*v,e[1]=r[1]*i+r[5]*o+r[9]*u+r[13]*v,e[2]=r[2]*i+r[6]*o+r[10]*u+r[14]*v,e[3]=r[3]*i+r[7]*o+r[11]*u+r[15]*v,e}function nt(e,n,r){var i=n[0],o=n[1],u=n[2],v=r[0],y=r[1],_=r[2],E=r[3],P=E*i+y*u-_*o,I=E*o+_*i-v*u,k=E*u+v*o-y*i,B=-v*i-y*o-_*u;return e[0]=P*E+B*-v+I*-_-k*-y,e[1]=I*E+B*-y+k*-v-P*-_,e[2]=k*E+B*-_+P*-y-I*-v,e[3]=n[3],e}function mt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function cr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Fr(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function Nr(e,n){var r=e[0],i=e[1],o=e[2],u=e[3],v=n[0],y=n[1],_=n[2],E=n[3];return Math.abs(r-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(u-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))}var tn=null,Lr=null,bn=null,an=null,yn=null,gn=null,hn=null,qn=function(){var e=Co();return function(n,r,i,o,u,v){var y,_;for(r||(r=4),i||(i=0),o?_=Math.min(o*r+i,n.length):_=n.length,y=i;y<_;y+=r)e[0]=n[y],e[1]=n[y+1],e[2]=n[y+2],e[3]=n[y+3],u(e,e,v),n[y]=e[0],n[y+1]=e[1],n[y+2]=e[2],n[y+3]=e[3];return n}}(),fa=Math.PI/180,Qo=512,Ia=4003e4;function sa(e){var n=e.latitude,r=n===void 0?0:n,i=e.zoom,o=i===void 0?0:i,u=e.scale,v=e.highPrecision,y=v===void 0?!1:v,_=e.flipY,E=_===void 0?!1:_;u=u!==void 0?u:Math.pow(2,o);var P={},I=Qo*u,k=Math.cos(r*fa),B=I/360,q=B/k,ee=I/Ia/k;if(P.pixelsPerMeter=[ee,-ee,ee],P.metersPerPixel=[1/ee,-1/ee,1/ee],P.pixelsPerDegree=[B,-q,ee],P.degreesPerPixel=[1/B,-1/q,1/ee],y){var se=fa*Math.tan(r*fa)/k,De=B*se/2,Je=I/Ia*se,ht=Je/q*ee;P.pixelsPerDegree2=[0,-De,Je],P.pixelsPerMeter2=[ht,0,ht],E&&(P.pixelsPerDegree2[1]=-P.pixelsPerDegree2[1],P.pixelsPerMeter2[1]=-P.pixelsPerMeter2[1])}return E&&(P.pixelsPerMeter[1]=-P.pixelsPerMeter[1],P.metersPerPixel[1]=-P.metersPerPixel[1],P.pixelsPerDegree[1]=-P.pixelsPerDegree[1],P.degreesPerPixel[1]=-P.degreesPerPixel[1]),P}var Rs;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Rs||(Rs={}));var To={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Fu,lu,Dh,$s,Vl,ah=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],uv=(Fu=(0,Rr.b2)(),lu=(0,Rr.f3)(Gt.ICameraService),Fu(Dh=($s=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"needRefresh",!0),Rn(this,"cameraService",Vl,this),(0,C.Z)(this,"coordinateSystem",void 0),(0,C.Z)(this,"viewportCenter",void 0),(0,C.Z)(this,"viewportCenterProjection",void 0),(0,C.Z)(this,"pixelsPerDegree",void 0),(0,C.Z)(this,"pixelsPerDegree2",void 0),(0,C.Z)(this,"pixelsPerMeter",void 0)}return(0,jt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),u=sa({latitude:o[1],zoom:r}),v=u.pixelsPerMeter,y=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=v,this.pixelsPerDegree=y,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Rs.LNGLAT||this.coordinateSystem===Rs.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Rs.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===Rs.P20_OFFSET&&this.calculateLnglatOffset(o,r,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,i,o,u){var v=sa({latitude:r[1],zoom:i,scale:o,flipY:u,highPrecision:!0}),y=v.pixelsPerMeter,_=v.pixelsPerDegree,E=v.pixelsPerDegree2,P=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),k=xu([],I,P),B=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,i));this.viewportCenterProjection=xe([],[B[0],B[1],0,1],k),P=this.cameraService.getViewMatrixUncentered()||P,k=xu([],I,P),k=xu([],k,ah),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=y,this.pixelsPerDegree=_,this.pixelsPerDegree2=E}}]),e}(),Vl=kn($s.prototype,"cameraService",[lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s))||Dh),Xo=$(10329),Wc=$.n(Xo),Mo;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Mo||(Mo={}));var ip,ap,$p,Af,yc;function lv(e){var n=cv();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function cv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vm={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},us=(ip=(0,Rr.b2)(),ap=(0,Rr.f3)(Gt.IMapService),ip($p=(Af=function(e){(0,Hr.Z)(r,e);var n=lv(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),Rn((0,ye.Z)(i),"mapService",yc,(0,ye.Z)(i)),(0,C.Z)((0,ye.Z)(i),"hammertime",void 0),(0,C.Z)((0,ye.Z)(i),"lastClickTime",0),(0,C.Z)((0,ye.Z)(i),"lastClickXY",[-1,-1]),(0,C.Z)((0,ye.Z)(i),"clickTimer",void 0),(0,C.Z)((0,ye.Z)(i),"$containter",void 0),(0,C.Z)((0,ye.Z)(i),"onDrag",function(y){var _=i.interactionEvent(y);_.type=vm[_.type],i.emit(Mo.Drag,_)}),(0,C.Z)((0,ye.Z)(i),"onHammer",function(y){y.srcEvent.stopPropagation();var _=i.interactionEvent(y);i.emit(Mo.Hover,_)}),(0,C.Z)((0,ye.Z)(i),"onTouch",function(y){var _=y.touches[0];i.onHover({x:_.pageX,y:_.pageY,type:"touch"})}),(0,C.Z)((0,ye.Z)(i),"onHover",function(y){var _=y.clientX,E=y.clientY,P=_,I=E,k=y.type,B=i.mapService.getMapContainer();if(B)if(Wi)P=P-B.left-0,I=I-B.top-0;else{var q=B.getBoundingClientRect(),ee=q.top,se=q.left;P=P-se-B.clientLeft,I=I-ee-B.clientTop}var De=i.mapService.containerToLngLat([P,I]);if(k==="click"){if(!Wi&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(P,I,De);return}if(k==="touch"){i.isDoubleTap(P,I,De);return}k!=="click"&&k!=="dblclick"&&i.emit(Mo.Hover,{x:P,y:I,lngLat:De,type:k,target:y})}),i}return(0,jt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Mo.Hover)}},{key:"triggerHover",value:function(o){var u=o.x,v=o.y;this.emit(Mo.Hover,{x:u,y:v})}},{key:"triggerSelect",value:function(o){this.emit(Mo.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(Mo.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if(Wi)oa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var u=new(Wc()).Manager(o);u.add(new(Wc()).Tap({event:"dblclick",taps:2})),u.add(new(Wc()).Tap({event:"click"})),u.add(new(Wc()).Pan({threshold:0,pointers:0})),u.add(new(Wc()).Press({})),u.on("dblclick click",this.onHammer),u.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=u}}},{key:"removeEventListenerOnMap",value:function(){if(Wi)oa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var u=o.type,v=o.pointerType,y,_;v==="touch"?(_=Math.floor(o.pointers[0].clientY),y=Math.floor(o.pointers[0].clientX)):(_=Math.floor(o.srcEvent.y),y=Math.floor(o.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var P=E.getBoundingClientRect(),I=P.top,k=P.left;y-=k,_-=I}var B=this.mapService.containerToLngLat([y,_]);return{x:y,y:_,lngLat:B,type:u,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,u,v){var y=this,_=new Date().getTime(),E="click";_-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-u)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(Mo.Hover,{x:o,y:u,lngLat:v,type:E})):(this.lastClickTime=_,this.lastClickXY=[o,u],this.clickTimer=setTimeout(function(){E="click",y.emit(Mo.Hover,{x:o,y:u,lngLat:v,type:E})},400))}}]),r}(Xa()),yc=kn(Af.prototype,"mapService",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af))||$p),Ls=$(51102),fv=$(92211),t=$.n(fv),a=0;function s(e){if(Wi)return null;var n=e;if(typeof e=="string"&&(n=document.getElementById(e)),n){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(a++),r.classList.add("l7-scene"),n.appendChild(r),r}return null}function h(e){var n,r,i=!0;return e==null||(n=e.target)===null||n===void 0||(r=n.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var u;o==null||(u=o.classList)===null||u===void 0||u.forEach(function(v){(v==="l7-marker"||v==="l7-popup")&&(i=!1)})}}),i}var p;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(p||(p={}));var x,S,M,L,N,U,V,Y,J,Ce,Te;function Ge(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ne(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ge(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ge(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var et=(x=(0,Rr.b2)(),S=(0,Rr.f3)(Gt.IRendererService),M=(0,Rr.f3)(Gt.IGlobalConfigService),L=(0,Rr.f3)(Gt.IInteractionService),N=(0,Rr.f3)(Gt.ILayerService),x(U=(V=function(){function e(){var n=this;(0,_t.Z)(this,e),Rn(this,"rendererService",Y,this),Rn(this,"configService",J,this),Rn(this,"interactionService",Ce,this),Rn(this,"layerService",Te,this),(0,C.Z)(this,"pickingFBO",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0),(0,C.Z)(this,"alreadyInPicking",!1),(0,C.Z)(this,"pickBufferScale",1),(0,C.Z)(this,"lastPickTime",new Date().getTime()),(0,C.Z)(this,"pickFromPickingFBO",function(r,i){var o,u=i.x,v=i.y,y=i.lngLat,_=i.type,E=i.target,P=!1,I=n.rendererService,k=I.getViewportSize,B=I.readPixels,q=I.getContainer,ee=n.getContainerSize(q()),se=ee.width,De=ee.height;se*=Da,De*=Da;var Je=r.getLayerConfig(),ht=Je.enableHighlight,gt=Je.enableSelect,Nt=u*Da,Vt=v*Da;if(Nt>se-1*Da||Nt<0||Vt>De-1*Da||Vt<0)return!1;var nr;if(nr=B({x:Math.floor(Nt/n.pickBufferScale),y:Math.floor((De-(v+1)*Da)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),nr[0]!==0||nr[1]!==0||nr[2]!==0){var dr=Hu(nr),Jr=r.getSource().getFeatureById(dr);dr!==r.getCurrentPickId()&&_==="mousemove"&&(_="mouseenter");var ln={x:u,y:v,type:_,lngLat:y,featureId:dr,feature:Jr,target:E};Jr&&(P=!0,r.setCurrentPickId(dr),n.triggerHoverOnLayer(r,ln))}else{var Er={x:u,y:v,lngLat:y,type:r.getCurrentPickId()!==null&&_==="mousemove"?"mouseout":"un"+_,featureId:null,target:E,feature:null};n.triggerHoverOnLayer(r,Ne(Ne({},Er),{},{type:"unpick"})),n.triggerHoverOnLayer(r,Er),r.setCurrentPickId(null)}if(ht&&n.highlightPickedFeature(r,nr),gt&&_==="click"&&((o=nr)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var In=Hu(nr);r.getCurrentSelectedId()===null||In!==r.getCurrentSelectedId()?(n.selectFeature(r,nr),r.setCurrentSelectedId(In)):(n.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return P})}return(0,jt.Z)(e,[{key:"init",value:function(r){var i=this.rendererService,o=i.createTexture2D,u=i.createFramebuffer,v=i.getViewportSize,y=i.getContainer,_=this.getContainerSize(y()),E=_.width,P=_.height;E*=Da,P*=Da,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=u({color:o({width:Math.round(E/this.pickBufferScale),height:Math.round(P/this.pickBufferScale),wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE})}),this.interactionService.on(Mo.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=(0,Ls.Z)(t().mark(function i(o,u,v){var y=this,_,E,P,I;return t().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:_=this.rendererService,E=_.useFramebuffer,P=_.clear,I=_.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){P({framebuffer:y.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var q=y.pickBox(o,u);v(q)});case 3:case"end":return B.stop()}},i,this)}));function r(i,o,u){return n.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,i){var o=this,u=i.map(function(Er){var In=Er<0?0:Er;return Math.floor(In*Da/o.pickBufferScale)}),v=(0,Pn.Z)(u,4),y=v[0],_=v[1],E=v[2],P=v[3],I=this.rendererService,k=I.getViewportSize,B=I.readPixels,q=I.getContainer,ee=this.getContainerSize(q()),se=ee.width,De=ee.height;if(se*=Da,De*=Da,y>(se-1)*Da/this.pickBufferScale||E<0||_>(De-1)*Da/this.pickBufferScale||P<0)return[];var Je,ht=Math.min(se/this.pickBufferScale,E)-y,gt=Math.min(De/this.pickBufferScale,P)-_;Je=B({x:y,y:Math.floor(De/this.pickBufferScale-(P+1)),width:ht,height:gt,data:new Uint8Array(ht*gt*4),framebuffer:this.pickingFBO});for(var Nt=[],Vt={},nr=0;nr<Je.length/4;nr=nr+1){var dr=Je.slice(nr*4,nr*4+4),Jr=Hu(dr);if(Jr!==-1&&!Vt[Jr]){var ln=r.getSource().getFeatureById(Jr);Nt.push(ln),Vt[Jr]=!0}}return Nt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Da,height:r.height/Da}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var n=(0,Ls.Z)(t().mark(function i(o){var u;return t().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){y.next=2;break}return y.abrupt("return");case 2:if(this.alreadyInPicking=!0,u=new Date().getTime(),!(u-this.lastPickTime>10)){y.next=7;break}return y.next=7,this.pickingLayers(o);case 7:this.lastPickTime=u,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return y.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,i=this.getContainerSize(r()),o=i.width,u=i.height;o*=Da,u*=Da,(this.width!==o||this.height!==u)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(u/this.pickBufferScale)}),this.width=o,this.height=u)}},{key:"pickingLayers",value:function(){var n=(0,Ls.Z)(t().mark(function i(o){var u=this,v,y,_,E,P;return t().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:v=this.rendererService,y=v.getViewportSize,_=v.useFramebuffer,E=v.clear,P=v.getContainer,this.resizePickingFBO(),_(this.pickingFBO,function(){var B=u.layerService.getRenderList();B.filter(function(q){return q.needPick(o.type)}).reverse().some(function(q){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),q.hooks.beforePickingEncode.call(),q.renderModels(),q.hooks.afterPickingEncode.call();var ee=u.pickFromPickingFBO(q,o);return ee&&!q.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,i){h(i)&&r.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(r,i){var o=(0,Pn.Z)(i,3),u=o[0],v=o[1],y=o[2];r.hooks.beforeHighlight.call([u,v,y])}},{key:"selectFeature",value:function(r,i){var o=(0,Pn.Z)(i,3),u=o[0],v=o[1],y=o[2];r.hooks.beforeSelect.call([u,v,y])}}]),e}(),Y=kn(V.prototype,"rendererService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=kn(V.prototype,"configService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ce=kn(V.prototype,"interactionService",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=kn(V.prototype,"layerService",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V))||U),vt=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,_t.Z)(this,e),(0,C.Z)(this,"autoStart",void 0),(0,C.Z)(this,"startTime",0),(0,C.Z)(this,"oldTime",0),(0,C.Z)(this,"running",!1),(0,C.Z)(this,"elapsedTime",0),this.autoStart=n}return(0,jt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}]),e}(),Lt,Bt,rr,wr,Zr,Mn,on,Un,un,Ii=(Lt=(0,Rr.b2)(),Bt=(0,Rr.f3)(Gt.IRendererService),rr=(0,Rr.f3)(Gt.IMapService),wr=(0,Rr.f3)(Gt.IGlobalConfigService),Lt(Zr=(Mn=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"clock",new vt),(0,C.Z)(this,"alreadyInRendering",!1),(0,C.Z)(this,"layers",[]),(0,C.Z)(this,"layerList",[]),(0,C.Z)(this,"layerRenderID",void 0),(0,C.Z)(this,"sceneInited",!1),(0,C.Z)(this,"animateInstanceCount",0),(0,C.Z)(this,"shaderPicking",!0),Rn(this,"renderService",on,this),Rn(this,"mapService",Un,this),Rn(this,"configService",un,this)}return(0,jt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(i){return i.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(i){return i.name===r})}},{key:"remove",value:function(r,i){if(i){var o=i.layerChildren.indexOf(r);o>-1&&i.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).forEach(function(i){r.layerList.push(i),i.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(i,o){return i.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(i){return i.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=oa.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=wa(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){oa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),on=kn(Mn.prototype,"renderService",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Un=kn(Mn.prototype,"mapService",[rr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),un=kn(Mn.prototype,"configService",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mn))||Zr),Wn=$(90452),An=$(93544),Si=$.n(An),bi=function(){function e(n){var r=this;(0,_t.Z)(this,e),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"scale",void 0),(0,C.Z)(this,"descriptor",void 0),(0,C.Z)(this,"featureBufferLayout",[]),(0,C.Z)(this,"needRescale",!1),(0,C.Z)(this,"needRemapping",!1),(0,C.Z)(this,"needRegenerateVertices",!1),(0,C.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,C.Z)(this,"vertexAttribute",void 0),(0,C.Z)(this,"defaultCallback",function(i){if(i.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return i.map(function(u,v){var y,_=(y=r.scale)===null||y===void 0?void 0:y.scalers[v].func,E=_(u);return E})}),this.setProps(n)}return(0,jt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var o,u=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,Ee.Z)(r));if(!Si()(u))return[u]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Ki=["buffer","update","name"],Dn,ua,qa,ho,no,Ka;function po(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Bo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?po(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):po(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ls(e){return new Promise(function(n){return setTimeout(n,e)})}var Zs=(Dn={},(0,C.Z)(Dn,p.FLOAT,4),(0,C.Z)(Dn,p.UNSIGNED_BYTE,1),(0,C.Z)(Dn,p.UNSIGNED_SHORT,2),Dn),cs=(ua=(0,Rr.b2)(),qa=(0,Rr.f3)(Gt.IRendererService),ua(ho=(no=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"attributesAndIndices",void 0),Rn(this,"rendererService",Ka,this),(0,C.Z)(this,"attributes",[]),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,jt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var i=this.getLayerStyleAttribute(r.name||"");return i?i.setProps(r):(i=new bi(r),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(r,i,o){var u=this.getLayerStyleAttribute(r);u||(u=this.registerStyleAttribute(Bo(Bo({},i),{},{name:r})));var v=i.scale;v&&u&&(u.scale=v,u.needRescale=!0,u.needRemapping=!0,u.needRegenerateVertices=!0,o&&o.featureRange&&(u.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(i){return i.name===r})}},{key:"getLayerAttributeScale",value:function(r){var i,o=this.getLayerStyleAttribute(r),u=o==null||(i=o.scale)===null||i===void 0?void 0:i.scalers;return u&&u[0]?u[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,v=this.attributes.find(function(gt){return gt.name===r});if(v&&v.descriptor){var y=v.descriptor,_=y.update,E=y.buffer,P=y.size,I=P===void 0?0:P,k=Zs[E.type||p.FLOAT];if(_){var B=this.featureLayout,q=B.elements,ee=B.sizePerElement,se=q.slice(o,u);if(!se.length)return;var De=se[0].offset,Je=De*I*k,ht=se.map(function(gt,Nt){for(var Vt=gt.featureIdx,nr=gt.vertices,dr=gt.normals,Jr=nr.length/ee,ln=[],Er=0;Er<Jr;Er++){var In=dr?dr.slice(Er*3,Er*3+3):[];ln.push.apply(ln,(0,Ee.Z)(_(i[Vt],Vt,nr.slice(Er*ee,Er*ee+ee),Nt,In)))}return ln}).reduce(function(gt,Nt){return gt.push.apply(gt,(0,Ee.Z)(Nt)),gt},[]);v.vertexAttribute.updateBuffer({data:ht,offset:Je})}}}},{key:"createAttributesAndIndices",value:function(r,i,o){var u=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var v=this.attributes.map(function(Je){return Je.resetDescriptor(),Je.descriptor}),y=0,_=[],E=[],P=[],I=3;r.forEach(function(Je,ht){var gt=u.triangulation(Je,o),Nt=gt.indices,Vt=gt.vertices,nr=gt.normals,dr=gt.size;Nt.forEach(function(In){E.push(In+y)}),I=dr;var Jr=Vt.length/dr;u.featureLayout.sizePerElement=I,u.featureLayout.elements.push({featureIdx:ht,vertices:Vt,normals:nr,offset:y}),y+=Jr;for(var ln=function(Vn){var pi=(nr==null?void 0:nr.slice(Vn*3,Vn*3+3))||[],Ro=Vt.slice(Vn*dr,Vn*dr+dr);v.forEach(function(ws,nl){if(ws&&ws.update){var Ac;(Ac=ws.buffer.data).push.apply(Ac,(0,Ee.Z)(ws.update(Je,ht,Ro,Vn,pi)))}})},Er=0;Er<Jr;Er++)ln(Er)});var k=this.rendererService,B=k.createAttribute,q=k.createBuffer,ee=k.createElements,se={};v.forEach(function(Je,ht){if(Je){var gt=Je.buffer,Nt=Je.update,Vt=Je.name,nr=(0,Wn.Z)(Je,Ki),dr=B(Bo({buffer:q(gt)},nr));se[Je.name||""]=dr,u.attributes[ht].vertexAttribute=dr}});var De=ee({data:E,type:p.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:se,elements:De},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ka=kn(no.prototype,"rendererService",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no))||ho),ks=$(67499),Po=$.n(ks),Jo,Zi,Oa,ba,$i,Vs,Es,Va,Io,Ss,la,jl,bu,Gl,_o,Hl,Ju,es,Tf,oh,_c,sh,op,uh,Fh,sp,up,xc,Nh,lh,Xc,ch,lp;function Qp(e){var n=cp();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fp=(Jo=(0,Rr.b2)(),Zi=(0,Rr.f3)(Gt.SceneID),Oa=(0,Rr.f3)(Gt.IIconService),ba=(0,Rr.f3)(Gt.IFontService),$i=(0,Rr.f3)(Gt.IControlService),Vs=(0,Rr.f3)(Gt.IGlobalConfigService),Es=(0,Rr.f3)(Gt.IMapService),Va=(0,Rr.f3)(Gt.ICoordinateSystemService),Io=(0,Rr.f3)(Gt.IRendererService),Ss=(0,Rr.f3)(Gt.ILayerService),la=(0,Rr.f3)(Gt.ICameraService),jl=(0,Rr.f3)(Gt.IInteractionService),bu=(0,Rr.f3)(Gt.IPickingService),Gl=(0,Rr.f3)(Gt.IShaderModuleService),_o=(0,Rr.f3)(Gt.IMarkerService),Hl=(0,Rr.f3)(Gt.IPopupService),Jo(Ju=(es=function(e){(0,Hr.Z)(r,e);var n=Qp(r);function r(){var i;return(0,_t.Z)(this,r),i=n.call(this),(0,C.Z)((0,ye.Z)(i),"destroyed",!1),(0,C.Z)((0,ye.Z)(i),"loaded",!1),(0,C.Z)((0,ye.Z)(i),"loadFont",!1),(0,C.Z)((0,ye.Z)(i),"fontFamily",""),Rn((0,ye.Z)(i),"id",Tf,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"iconService",oh,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"fontService",_c,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"controlService",sh,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"configService",op,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"map",uh,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"coordinateSystemService",Fh,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"rendererService",sp,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"layerService",up,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"cameraService",xc,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"interactionService",Nh,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"pickingService",lh,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"shaderModuleService",Xc,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"markerService",ch,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"popupService",lp,(0,ye.Z)(i)),(0,C.Z)((0,ye.Z)(i),"inited",!1),(0,C.Z)((0,ye.Z)(i),"initPromise",void 0),(0,C.Z)((0,ye.Z)(i),"rendering",!1),(0,C.Z)((0,ye.Z)(i),"$container",void 0),(0,C.Z)((0,ye.Z)(i),"canvas",void 0),(0,C.Z)((0,ye.Z)(i),"markerContainer",void 0),(0,C.Z)((0,ye.Z)(i),"hooks",void 0),(0,C.Z)((0,ye.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),cn(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,C.Z)((0,ye.Z)(i),"handleMapCameraChanged",function(o){i.cameraService.update(o),i.render()}),i.hooks={init:new $n},i}return(0,jt.Z)(r,[{key:"init",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ls.Z)(t().mark(function v(){return t().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.version!=="GAODE2.x"?u.map.init():E()});case 2:if(!(u.map.version==="GAODE2.x"&&u.map.initViewPort)){_.next=6;break}return _.next=5,u.map.init();case 5:u.map.initViewPort();case 6:u.map.onCameraChanged(u.handleMapCameraChanged),u.map.addMarkerContainer(),u.markerService.addMarkers(),u.markerService.addMarkerLayers(),u.popupService.initPopup(),u.interactionService.init(),u.interactionService.on(Mo.Drag,u.addSceneEvent.bind(u));case 13:case"end":return _.stop()}},v)}))),this.hooks.init.tapPromise("initRenderer",(0,Ls.Z)(t().mark(function v(){var y,_;return t().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(y=s(u.configService.getSceneConfig(u.id).id||""),u.$container=y,!y){P.next=11;break}return u.canvas=za("canvas","",y),u.setCanvas(),P.next=7,u.rendererService.init(u.canvas,u.configService.getSceneConfig(u.id));case 7:Po()(u.$container,u.handleWindowResized),oa.matchMedia&&((_=oa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||_===void 0||_.addListener(u.handleWindowResized)),P.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:u.pickingService.init(u.id);case 13:case"end":return P.stop()}},v)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ls.Z)(t().mark(function v(){return t().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.initMiniMap()});case 2:u.map.onCameraChanged(u.handleMapCameraChanged),u.interactionService.init(),u.interactionService.on(Mo.Drag,u.addSceneEvent.bind(u));case 5:case"end":return _.stop()}},v)}))),this.hooks.init.tapPromise("initRenderer",(0,Ls.Z)(t().mark(function v(){var y;return t().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(y=o.canvas,u.$container=y||null,!u.$container){E.next=7;break}return E.next=5,u.rendererService.init(o.canvas,u.configService.getSceneConfig(u.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:u.pickingService.init(u.id);case 9:case"end":return E.stop()}},v)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var i=(0,Ls.Z)(t().mark(function u(){return t().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.rendering||this.destroyed)){y.next=2;break}return y.abrupt("return");case 2:if(this.rendering=!0,this.inited){y.next=15;break}return y.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){y.next=10;break}return y.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return y.stop()}},u,this)}));function o(){return i.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,u){this.fontFamily=o;var v=document.createElement("style");v.type="text/css",v.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(u,`') format('woff2'),
            url('`).concat(u,`') format('woff'),
            url('`).concat(u,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(v),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var u,v=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0];this.render();var y=o==="jpg"?v==null?void 0:v.toDataURL("image/jpeg"):v==null?void 0:v.toDataURL("image/png");return y}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=za("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,ks.unbind)(this.$container,this.handleWindowResized),oa.matchMedia){var v;(v=oa.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,u,v=Da,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E&&(E.width=y*v,E.height=_*v),this.rendererService.viewport({x:0,y:0,width:v*y,height:v*_})}},{key:"setCanvas",value:function(){var o,u,v=Da,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E.width=y*v,E.height=_*v,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(xa.EventEmitter),Tf=kn(es.prototype,"id",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=kn(es.prototype,"iconService",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=kn(es.prototype,"fontService",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=kn(es.prototype,"controlService",[$i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),op=kn(es.prototype,"configService",[Vs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=kn(es.prototype,"map",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fh=kn(es.prototype,"coordinateSystemService",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp=kn(es.prototype,"rendererService",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=kn(es.prototype,"layerService",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xc=kn(es.prototype,"cameraService",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=kn(es.prototype,"interactionService",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=kn(es.prototype,"pickingService",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=kn(es.prototype,"shaderModuleService",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=kn(es.prototype,"markerService",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp=kn(es.prototype,"popupService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),es))||Ju),Jp=$(21691),Bh=$.n(Jp);function hp(e){var n=0;switch(e){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break;default:}return n}var pp=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function dp(e){var n={};return e=e.replace(pp,function(r,i,o){var u=o.split(":"),v=u[0].trim(),y="";switch(u.length>1&&(y=u[1].trim()),i){case"bool":y=y==="true";break;case"float":case"int":y=Number(y);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":y?y=y.replace("[","").replace("]","").split(",").reduce(function(_,E){return _.push(Number(E.trim())),_},[]):y=new Array(hp(i)).fill(0);break;default:}return n[v]=y,"uniform ".concat(i," ").concat(v,`;
`)}),{content:e,uniforms:n}}var fh,vp;function hh(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Yc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?hh(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hh(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Mf="#define PI 3.14159265359",mp=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,zh=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Td=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,hv=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float lightWeight) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB * lightWeight, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Md=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,pv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Pd=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,mm=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gp=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,Oo=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Wl=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,gm=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Pf=/precision\s+(high|low|medium)p\s+float/,Id=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,dv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,ed=(fh=(0,Rr.b2)(),fh(vp=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"moduleCache",{}),(0,C.Z)(this,"rawContentCache",{})}return(0,jt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Mf,fs:Mf}),this.registerModule("decode",{vs:mp,fs:""}),this.registerModule("projection",{vs:Pd,fs:""}),this.registerModule("project",{vs:pv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:mm}),this.registerModule("lighting",{vs:Td,fs:""}),this.registerModule("light",{vs:zh,fs:""}),this.registerModule("picking",{vs:Md,fs:hv}),this.registerModule("styleMapping",{vs:gp,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Oo,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Wl,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:gm,fs:""})}},{key:"registerModule",value:function(r,i){if(!this.rawContentCache[r]){var o=i.vs,u=i.fs,v=i.uniforms,y=dp(o),_=y.content,E=y.uniforms,P=dp(u),I=P.content,k=P.uniforms;this.rawContentCache[r]={fs:I,uniforms:Yc(Yc(Yc({},E),k),v),vs:_}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var i=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,u=this.rawContentCache[r].fs,v=this.processModule(o,[],"vs"),y=v.content,_=v.includeList,E=this.processModule(u,[],"fs"),P=E.content,I=E.includeList,k=P,B=Bh()(_.concat(I).concat(r)).reduce(function(q,ee){return Yc(Yc({},q),i.rawContentCache[ee].uniforms)},{});return Pf.test(P)||(k=Id+P),this.moduleCache[r]={fs:k.trim(),uniforms:B,vs:y.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,i,o){var u=this,v=r.replace(dv,function(y,_){var E=_.split(" "),P=E[0].replace(/"/g,"");if(i.indexOf(P)>-1)return"";var I=u.rawContentCache[P][o];i.push(P);var k=u.processModule(I,i,o),B=k.content;return B});return{content:v,includeList:i}}}]),e}())||vp),el=$(59424),Xl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Xl||(Xl={}));var Uh,yp,_p,xp,Od,If=(Uh=(0,Rr.b2)(),yp=(0,Rr.f3)(Gt.IShaderModuleService),Uh(_p=(xp=function(){function e(){(0,_t.Z)(this,e),Rn(this,"shaderModuleService",Od,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"config",void 0)}return(0,jt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Xl.Normal}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Gt.IRendererService),this.cameraService=r.getContainer().get(Gt.ICameraService),this.mapService=r.getContainer().get(Gt.IMapService),this.interactionService=r.getContainer().get(Gt.IInteractionService),this.layerService=r.getContainer().get(Gt.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Od=kn(xp.prototype,"shaderModuleService",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp))||_p),Rd,Ld;function vv(e){var n=mv();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function mv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gv=(Rd=(0,Rr.b2)(),Rd(Ld=function(e){(0,Hr.Z)(r,e);var n=vv(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,u){(0,el.Z)((0,Dt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(If))||Ld),Eu,bp,kd,xl,yv;function _v(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ph(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function ph(e,n){if(!!e){if(typeof e=="string")return dh(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dh(e,n)}}function dh(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Zh=(Eu=(0,Rr.b2)(),bp=(0,Rr.f3)(Gt.IPostProcessor),Eu(kd=(xl=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"passes",[]),Rn(this,"postProcessor",yv,this),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"renderFlag",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0)}return(0,jt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=(0,Ls.Z)(t().mark(function i(){var o,u,v;return t().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=_v(this.passes),_.prev=1,o.s();case 3:if((u=o.n()).done){_.next=9;break}return v=u.value,_.next=7,v.render(this.layer);case 7:_.next=3;break;case 9:_.next=14;break;case 11:_.prev=11,_.t0=_.catch(1),o.e(_.t0);case 14:return _.prev=14,o.f(),_.finish(14);case 17:this.layer.renderModels();case 18:case"end":return _.stop()}},i,this,[[1,11,14,17]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){(this.width!==r||this.height!==i)&&(this.width=r,this.height=i)}},{key:"add",value:function(r,i){r.getType()===Xl.PostProcessing?this.postProcessor.add(r,this.layer,i):(r.init(this.layer,i),this.passes.push(r))}},{key:"insert",value:function(r,i,o){r.init(this.layer,i),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),yv=kn(xl.prototype,"postProcessor",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl))||kd),vh,mh;function Dd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Fd(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Dd(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xv(e){var n=bv();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function bv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nd=(vh=(0,Rr.b2)(),vh(mh=function(e){(0,Hr.Z)(r,e);var n=xv(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"pickingFBO",void 0),(0,C.Z)((0,ye.Z)(i),"layer",void 0),(0,C.Z)((0,ye.Z)(i),"width",0),(0,C.Z)((0,ye.Z)(i),"height",0),(0,C.Z)((0,ye.Z)(i),"alreadyInRendering",!1),(0,C.Z)((0,ye.Z)(i),"pickFromPickingFBO",function(y){var _=y.x,E=y.y,P=y.lngLat,I=y.type;if(!(!i.layer.isVisible()||!i.layer.needPick(I))){var k=i.rendererService,B=k.getViewportSize,q=k.readPixels,ee=k.useFramebuffer,se=B(),De=se.width,Je=se.height,ht=i.layer.getLayerConfig(),gt=ht.enableHighlight,Nt=ht.enableSelect,Vt=_*Da,nr=E*Da;if(!(Vt>De||Vt<0||nr>Je||nr<0)){var dr;ee(i.pickingFBO,function(){var Jr;if(dr=q({x:Math.round(Vt),y:Math.round(Je-(E+1)*Da),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),dr[0]!==0||dr[1]!==0||dr[2]!==0){var ln=Hu(dr),Er=i.layer.getSource().getFeatureById(ln),In={x:_,y:E,type:I,lngLat:P,featureId:ln,feature:Er};Er&&(i.layer.setCurrentPickId(ln),i.triggerHoverOnLayer(In))}else{var Vn={x:_,y:E,lngLat:P,type:i.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer(Fd(Fd({},Vn),{},{type:"unpick"})),i.triggerHoverOnLayer(Vn),i.layer.setCurrentPickId(null)}gt&&i.highlightPickedFeature(dr),Nt&&I==="click"&&((Jr=dr)===null||Jr===void 0?void 0:Jr.toString())!==[0,0,0,0].toString()&&i.selectFeature(dr)})}}}),i}return(0,jt.Z)(r,[{key:"getType",value:function(){return Xl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,u){(0,el.Z)((0,Dt.Z)(r.prototype),"init",this).call(this,o,u),this.layer=o;var v=this.rendererService,y=v.createTexture2D,_=v.createFramebuffer,E=v.getViewportSize,P=E(),I=P.width,k=P.height;this.pickingFBO=_({color:y({width:I,height:k,wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE})}),this.interactionService.on(Mo.Hover,this.pickFromPickingFBO),this.interactionService.on(Mo.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Mo.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var u=this;if(!this.alreadyInRendering){var v=this.rendererService,y=v.getViewportSize,_=v.useFramebuffer,E=v.clear,P=y(),I=P.width,k=P.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==k)&&(this.pickingFBO.resize({width:I,height:k}),this.width=I,this.height=k),_(this.pickingFBO,function(){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var B=u.layer.multiPassRenderer.getRenderFlag();u.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),u.layer.multiPassRenderer.setRenderFlag(B),u.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var u=(0,Pn.Z)(o,3),v=u[0],y=u[1],_=u[2];this.layer.hooks.beforeHighlight.call([v,y,_]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var u=(0,Pn.Z)(o,3),v=u[0],y=u[1],_=u[2];this.layer.hooks.beforeSelect.call([v,y,_]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var u=o.featureId,v=Wu(u);this.selectFeature(new Uint8Array(v))}},{key:"highlightFeatureHandle",value:function(o){var u=o.featureId,v=Wu(u);this.highlightPickedFeature(new Uint8Array(v))}}]),r}(If))||mh),Bd=$(53592),qc=$.n(Bd),Ev=$(34301),zd=$.n(Ev),td,Ud,rd,nd,Zd;function id(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Vh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?id(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):id(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ep=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kc=(td=(0,Rr.b2)(),Ud=(0,Rr.f3)(Gt.IShaderModuleService),td(rd=(nd=function(){function e(){(0,_t.Z)(this,e),Rn(this,"shaderModuleService",Zd,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"config",void 0),(0,C.Z)(this,"quad",Ep),(0,C.Z)(this,"enabled",!0),(0,C.Z)(this,"renderToScreen",!1),(0,C.Z)(this,"model",void 0),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"optionsToUpdate",{})}return(0,jt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Xl.PostProcessing}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Gt.IRendererService);var o=this.rendererService,u=o.createAttribute,v=o.createBuffer,y=o.createModel,_=this.setupShaders(),E=_.vs,P=_.fs,I=_.uniforms;this.model=y({vs:E,fs:P,attributes:{a_Position:u({buffer:v({data:[-4,-4,4,-4,0,4],type:p.FLOAT}),size:2})},uniforms:Vh(Vh({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var i=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,v=u.useFramebuffer,y=u.getViewportSize,_=u.clear,E=y(),P=E.width,I=E.height;v(this.renderToScreen?null:o.getWriteFBO(),function(){_({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),i.model.draw({uniforms:Vh({u_Texture:o.getReadFBO(),u_ViewportSize:[P,I]},i.convertOptionsToUniforms(i.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Vh(Vh({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var i={};return Object.keys(r).forEach(function(o){Si()(r[o])||(i["u_".concat(qc()(zd()(o)))]=r[o])}),i}}]),e}(),Zd=kn(nd.prototype,"shaderModuleService",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd))||rd),Sp,Sv;function Vd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function wv(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Vd(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ym(e){var n=_m();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function _m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,bm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Em=(Sp=(0,Rr.b2)(),Sp(Sv=function(e){(0,Hr.Z)(r,e);var n=ym(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:bm,fs:xm});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,v=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,P=_.height;return{vs:u,fs:v,uniforms:wv(wv({},y),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Si()(o.blurRadius)||(u.u_BlurDir=[o.blurRadius,0]),u}}]),r}(Kc))||Sv),Cv,Av;function Yl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function wp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Yl(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Tv(e){var n=Cp();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mv=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ox=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sx=(Cv=(0,Rr.b2)(),Cv(Av=function(e){(0,Hr.Z)(r,e);var n=Tv(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ox,fs:Mv});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,v=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,P=_.height;return{vs:u,fs:v,uniforms:wp(wp({},y),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Si()(o.blurRadius)||(u.u_BlurDir=[0,o.blurRadius]),u}}]),r}(Kc))||Av),n0,i0;function a0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function o0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?a0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ux(e){var n=lx();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function lx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,fx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hx=(n0=(0,Rr.b2)(),n0(i0=function(e){(0,Hr.Z)(r,e);var n=ux(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:fx,fs:cx});var o=this.shaderModuleService.getModule("colorhalftone-pass"),u=o.vs,v=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,P=_.height;return{vs:u,fs:v,uniforms:o0(o0({},y),{},{u_ViewportSize:[E,P]})}}}]),r}(Kc))||i0),s0,u0;function px(e){var n=dx();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function dx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,mx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gx=(s0=(0,Rr.b2)(),s0(u0=function(e){(0,Hr.Z)(r,e);var n=px(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:mx,fs:vx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Kc))||u0),l0,c0;function f0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function h0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?f0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function yx(e){var n=_x();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function _x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,bx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ex=(l0=(0,Rr.b2)(),l0(c0=function(e){(0,Hr.Z)(r,e);var n=yx(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:bx,fs:xx});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),u=o.vs,v=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,P=_.height;return{vs:u,fs:v,uniforms:h0(h0({},y),{},{u_ViewportSize:[E,P]})}}}]),r}(Kc))||c0),p0,d0;function v0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function m0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?v0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Sx(e){var n=Cx();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Cx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ax=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Tx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Mx=(p0=(0,Rr.b2)(),p0(d0=function(e){(0,Hr.Z)(r,e);var n=Sx(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Tx,fs:Ax});var o=this.shaderModuleService.getModule("ink-pass"),u=o.vs,v=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,P=_.height;return{vs:u,fs:v,uniforms:m0(m0({},y),{},{u_ViewportSize:[E,P]})}}}]),r}(Kc))||d0),g0,y0;function Px(e){var n=Ix();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Ix(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ox=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Rx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lx=(g0=(0,Rr.b2)(),g0(y0=function(e){(0,Hr.Z)(r,e);var n=Px(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Rx,fs:Ox}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Kc))||y0),_0,x0;function kx(e){var n=Dx();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Dx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Bx=(_0=(0,Rr.b2)(),_0(x0=function(e){(0,Hr.Z)(r,e);var n=kx(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Fx,fs:Nx}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Kc))||x0),b0,E0,S0,w0,ad,C0,zx=(b0=(0,Rr.b2)(),E0=(0,Rr.f3)(Gt.IRendererService),S0=(0,Rr.zY)(),b0(w0=(ad=function(){function e(){(0,_t.Z)(this,e),Rn(this,"rendererService",C0,this),(0,C.Z)(this,"passes",[]),(0,C.Z)(this,"readFBO",void 0),(0,C.Z)(this,"writeFBO",void 0)}return(0,jt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var n=(0,Ls.Z)(t().mark(function i(o){var u,v;return t().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:u=0;case 1:if(!(u<this.passes.length)){_.next=10;break}return v=this.passes[u],v.setRenderToScreen(this.isLastEnabledPass(u)),_.next=6,v.render(o);case 6:u!==this.passes.length-1&&this.swap();case 7:u++,_.next=1;break;case 10:case"end":return _.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){this.readFBO.resize({width:r,height:i}),this.writeFBO.resize({width:r,height:i})}},{key:"add",value:function(r,i,o){r.init(i,o),this.passes.push(r)}},{key:"insert",value:function(r,i,o,u){r.init(o,u),this.passes.splice(i,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(i){return i.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var i=r+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),C0=kn(ad.prototype,"rendererService",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn(ad.prototype,"init",[S0],Object.getOwnPropertyDescriptor(ad.prototype,"init"),ad.prototype),ad))||w0),A0,T0;function Ux(e){var n=Zx();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Zx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vx=(A0=(0,Rr.b2)(),A0(T0=function(e){(0,Hr.Z)(r,e);var n=Ux(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getType",value:function(){return Xl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,u){(0,el.Z)((0,Dt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(o){var u=this.rendererService,v=u.useFramebuffer,y=u.clear;v(null,function(){y({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(If))||T0),M0,P0,I0,Sm,O0;function R0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function L0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?R0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function jx(e){var n=Gx();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hx=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,k0=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Wx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function D0(e,n){for(var r=0,i=1/n,o=e;o>0;)r=r+i*(o%n),o=Math.floor(o/n),i=i/n;return r}var Xx=1,Yx=(M0=(0,Rr.b2)(),P0=(0,Rr.f3)(Gt.IShaderModuleService),M0(I0=(Sm=function(e){(0,Hr.Z)(r,e);var n=jx(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),Rn((0,ye.Z)(i),"shaderModuleService",O0,(0,ye.Z)(i)),(0,C.Z)((0,ye.Z)(i),"haltonSequence",[]),(0,C.Z)((0,ye.Z)(i),"accumulatingId",0),(0,C.Z)((0,ye.Z)(i),"frame",0),(0,C.Z)((0,ye.Z)(i),"timer",void 0),(0,C.Z)((0,ye.Z)(i),"sampleRenderTarget",void 0),(0,C.Z)((0,ye.Z)(i),"prevRenderTarget",void 0),(0,C.Z)((0,ye.Z)(i),"outputRenderTarget",void 0),(0,C.Z)((0,ye.Z)(i),"copyRenderTarget",void 0),(0,C.Z)((0,ye.Z)(i),"blendModel",void 0),(0,C.Z)((0,ye.Z)(i),"outputModel",void 0),(0,C.Z)((0,ye.Z)(i),"copyModel",void 0),i}return(0,jt.Z)(r,[{key:"getType",value:function(){return Xl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,u){(0,el.Z)((0,Dt.Z)(r.prototype),"init",this).call(this,o,u);var v=this.rendererService,y=v.createFramebuffer,_=v.createTexture2D;this.sampleRenderTarget=y({color:_({width:1,height:1,wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE})}),this.prevRenderTarget=y({color:_({width:1,height:1,wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE})}),this.outputRenderTarget=y({color:_({width:1,height:1,wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE})}),this.copyRenderTarget=y({color:_({width:1,height:1,wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([D0(E,2),D0(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",Hx),this.outputModel=this.createTriangleModel("copy-pass",k0,{blend:{enable:!0,func:{srcRGB:p.ONE,dstRGB:p.ONE_MINUS_SRC_ALPHA,srcAlpha:p.ONE,dstAlpha:p.ONE_MINUS_SRC_ALPHA},equation:{rgb:p.FUNC_ADD,alpha:p.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",k0)}},{key:"render",value:function(o){var u=this,v=this.rendererService,y=v.clear,_=v.getViewportSize,E=v.useFramebuffer,P=_(),I=P.width,k=P.height;this.sampleRenderTarget.resize({width:I,height:k}),this.prevRenderTarget.resize({width:I,height:k}),this.outputRenderTarget.resize({width:I,height:k}),this.copyRenderTarget.resize({width:I,height:k}),this.resetFrame(),this.stopAccumulating();var B=o.multiPassRenderer.getPostProcessor().getReadFBO();E(B,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:B}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var q=function ee(se){!u.accumulatingId||se!==u.accumulatingId||u.isFinished()||(u.doRender(o),oa.requestAnimationFrame(function(){ee(se)}))};this.accumulatingId=Xx++,this.timer=oa.setTimeout(function(){q(u.accumulatingId)},50)}},{key:"doRender",value:function(o){var u=this,v=this.rendererService,y=v.clear,_=v.getViewportSize,E=v.useFramebuffer,P=_(),I=P.width,k=P.height,B=o.getLayerConfig(),q=B.jitterScale,ee=q===void 0?1:q,se=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((se[0]*2-1)/I*ee,(se[1]*2-1)/k*ee),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var De=o.getLayerConfig();E(this.outputRenderTarget,function(){u.blendModel.draw({uniforms:{u_opacity:De.opacity||1,u_MixRatio:u.frame===0?1:.9,u_Diffuse1:u.sampleRenderTarget,u_Diffuse2:u.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():u.prevRenderTarget}})}),this.frame===0&&y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){u.outputModel.draw({uniforms:{u_Texture:u.outputRenderTarget}})}),E(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){u.copyModel.draw({uniforms:{u_Texture:u.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var Je=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Je,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,oa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,u,v){this.shaderModuleService.registerModule(o,{vs:Wx,fs:u});var y=this.shaderModuleService.getModule(o),_=y.vs,E=y.fs,P=y.uniforms,I=this.rendererService,k=I.createAttribute,B=I.createBuffer,q=I.createModel;return q(L0({vs:_,fs:E,attributes:{a_Position:k({buffer:B({data:[-4,-4,4,-4,0,4],type:p.FLOAT}),size:2})},uniforms:L0({},P),depth:{enable:!1},count:3},v))}}]),r}(If),O0=kn(Sm.prototype,"shaderModuleService",[P0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sm))||I0),od=new Rr.W2;od.bind(Gt.IGlobalConfigService).to(Ho).inSingletonScope(),od.bind(Gt.IShaderModuleService).to(ed).inSingletonScope(),(0,Rr.GW)((0,Rr.b2)(),xa.EventEmitter),od.bind(Gt.IEventEmitter).to(xa.EventEmitter);var F0=(0,yf.Z)(od,!1),jd=function(n){var r=F0.lazyInject(n);return function(i,o,u){r.call(this,i,o),u&&(u.initializer=function(){return i[o]})}},ZM=function(n){var r=F0.lazyMultiInject(n);return function(i,o,u){r.call(this,i,o),u&&(u.initializer=function(){return i[o]})}},ql=od,qx=0;function Kx(){var e=new Rr.W2;return e.parent=od,e.bind(Gt.SceneID).toConstantValue("".concat(qx++)),e.bind(Gt.ILayerService).to(Ii).inSingletonScope(),e.bind(Gt.ISceneService).to(fp).inSingletonScope(),e.bind(Gt.ICameraService).to(or).inSingletonScope(),e.bind(Gt.ICoordinateSystemService).to(uv).inSingletonScope(),e.bind(Gt.IInteractionService).to(us).inSingletonScope(),e.bind(Gt.IPickingService).to(et).inSingletonScope(),e.bind(Gt.IControlService).to(mn).inSingletonScope(),e.bind(Gt.IMarkerService).to(Xr).inSingletonScope(),e.bind(Gt.IIconService).to(Gp).inSingletonScope(),e.bind(Gt.IFontService).to(yl).inSingletonScope(),e.bind(Gt.IPopupService).to(Jn).inSingletonScope(),e.bind(Gt.INormalPass).to(gv).whenTargetNamed("clear"),e.bind(Gt.INormalPass).to(Nd).whenTargetNamed("pixelPicking"),e.bind(Gt.INormalPass).to(Vx).whenTargetNamed("render"),e.bind(Gt.INormalPass).to(Yx).whenTargetNamed("taa"),e.bind(Gt.IFactoryNormalPass).toFactory(function(n){return function(r){return n.container.getNamed(Gt.INormalPass,r)}}),e.bind(Gt.IPostProcessingPass).to(gx).whenTargetNamed("copy"),e.bind(Gt.IPostProcessingPass).to(Em).whenTargetNamed("blurH"),e.bind(Gt.IPostProcessingPass).to(sx).whenTargetNamed("blurV"),e.bind(Gt.IPostProcessingPass).to(Lx).whenTargetNamed("noise"),e.bind(Gt.IPostProcessingPass).to(Bx).whenTargetNamed("sepia"),e.bind(Gt.IPostProcessingPass).to(hx).whenTargetNamed("colorHalftone"),e.bind(Gt.IPostProcessingPass).to(Ex).whenTargetNamed("hexagonalPixelate"),e.bind(Gt.IPostProcessingPass).to(Mx).whenTargetNamed("ink"),e.bind(Gt.IFactoryPostProcessingPass).toFactory(function(n){return function(r){var i=n.container.getNamed(Gt.IPostProcessingPass,r);return i.setName(r),i}}),e}function $x(e){var n=new Rr.W2;return n.parent=e,n.bind(Gt.IStyleAttributeService).to(cs).inSingletonScope(),n.bind(Gt.IMultiPassRenderer).to(Zh).inSingletonScope(),n.bind(Gt.IPostProcessor).to(zx).inSingletonScope(),n}var VM=$(61400),Qx=null;function jM(e){return Qx.indexOf(e)}var Jx=2,GM=4,eb=64,HM=128,tb=256,rb=512,WM=8192,XM=16384,YM=32768,nb=null,N0=131072,qM=262144,ib=524288,KM=1048576,ab=2097152,$M=4194304,ob=8388608,sb=16777216,ub=null;function Pv(e,n){return e=_clamp(Math.floor(e),0,255),n=_clamp(Math.floor(n),0,255),256*e+n}function QM(e){var n=e.color,r=e.radius,i=e.tileX,o=e.tileY,u=e.shape,v=e.opacity,y=e.stroke,_=e.strokeWidth,E=e.strokeOpacity,P=[],I=[],k=[],B=[Pv(n[0],n[1]),Pv(n[2],n[3])],q=[Pv(y[0],y[1]),Pv(y[2],y[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(ee){var se=_slicedToArray(ee,2),De=se[0],Je=se[1];P.push([].concat(B,[(De+1)*ob+(Je+1)*ab+getShapeIndex(u)*N0+r,(i+512)*ib+(o+512)*eb])),I.push([].concat(q,[_,E])),k.push([v,0,0,0])}),{packedBuffer:P,packedBuffer2:I,packedBuffer3:k}}function JM(e,n){if(e===0&&!n)return 0;if(e===1&&n)return 4294967295;var r=n?1:0,i=Math.floor(e*127);return i*ub+r*sb+i*N0+r*nb+i*rb+r*tb+i*Jx+r}var $c;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})($c||($c={}));var Qs;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(Qs||(Qs={}));var jh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(jh||(jh={}));var wi;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(wi||(wi={}));var lb=["mapload","mapchange"],Ap={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},wm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Gh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Gh||(Gh={}));function B0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function z0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?B0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function cb(e){var n=fb();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hb=0,Iv=function(e){(0,Hr.Z)(r,e);var n=cb(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this),(0,C.Z)((0,ye.Z)(o),"controlOption",void 0),(0,C.Z)((0,ye.Z)(o),"container",void 0),(0,C.Z)((0,ye.Z)(o),"sceneContainer",void 0),(0,C.Z)((0,ye.Z)(o),"mapsService",void 0),(0,C.Z)((0,ye.Z)(o),"renderService",void 0),(0,C.Z)((0,ye.Z)(o),"layerService",void 0),(0,C.Z)((0,ye.Z)(o),"controlService",void 0),(0,C.Z)((0,ye.Z)(o),"isShow",void 0),o.controlOption=z0(z0({},o.getDefault()),i||{}),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.TOPRIGHT,name:"".concat(hb++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Gh.BOTTOMRIGHT,u=this.controlService;return u&&u.removeControl(this),this.controlOption.position=o,u&&u.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(Gt.IMapService),this.renderService=o.get(Gt.IRendererService),this.layerService=o.get(Gt.ILayerService),this.controlService=o.get(Gt.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var u=this.container,v=this.controlOption.position,y=this.controlService.controlCorners[v];return Ll(u,"l7-control"),v.indexOf("bottom")!==-1?y.insertBefore(u,y.firstChild):y.appendChild(u),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Ll(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ju(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ic(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var u=this.mapsService.getContainer();u!==null&&u.focus()}}}]),r}(xa.EventEmitter);function pb(e){var n=db();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eP=function(e){(0,Hr.Z)(r,e);var n=pb(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ye.Z)(o),"layerControlInputs",void 0),(0,C.Z)((0,ye.Z)(o),"layers",void 0),(0,C.Z)((0,ye.Z)(o),"lastZIndex",void 0),(0,C.Z)((0,ye.Z)(o),"handlingClick",void 0),(0,C.Z)((0,ye.Z)(o),"layersLink",void 0),(0,C.Z)((0,ye.Z)(o),"baseLayersList",void 0),(0,C.Z)((0,ye.Z)(o),"separator",void 0),(0,C.Z)((0,ye.Z)(o),"overlaysList",void 0),(0,C.Z)((0,ye.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),ns(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ye.Z)(o)),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Gh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(u){u.layer.on("remove",o.onLayerChange),u.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,u){return this.addLayer(o,u,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),u=o.height;Ll(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var v=u-(this.container.offsetTop+50);return v<this.form.clientHeight?(Ll(this.form,"l7-control-layers-scrollbar"),this.form.style.height=v+"px"):ju(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ju(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(u){u.layer.off("remove",o.onLayerChange),u.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",u=this.container=za("div",o),v=this.controlOption.collapsed;u.setAttribute("aria-haspopup","true");var y=this.form=za("form",o+"-list");v&&(this.mapsService.on("click",this.collapse),u.addEventListener("mouseenter",this.expand),u.addEventListener("mouseleave",this.collapse)),this.layersLink=za("a",o+"-toggle",u);var _=this.layersLink;_.title="Layers",v||this.expand(),this.baseLayersList=za("div",o+"-base",y),this.separator=za("div",o+"-separator",y),this.overlaysList=za("div",o+"-overlays",y),u.appendChild(y)}},{key:"initLayers",value:function(){var o=this,u=this.controlOption,v=u.baseLayers,y=v===void 0?{}:v,_=u.overlayers,E=_===void 0?{}:_;Object.keys(y).forEach(function(P,I){o.addLayer(y[P],P,!1)}),Object.keys(E).forEach(function(P,I){o.addLayer(E[P],P,!0)})}},{key:"update",value:function(){if(!this.container)return this;kl(this.baseLayersList),kl(this.overlaysList),this.layerControlInputs=[];var o,u,v,y,_=0;for(v=0;v<this.layers.length;v++)y=this.layers[v],this.addItem(y),u=u||y.overlay,o=o||!y.overlay,_+=y.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&_>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=u&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,u,v,y=this.mapsService.getZoom(),_=o.length-1;_>=0;_--)if(u=o[_],v=this.layerService.getLayer(u.layerId),v&&v.inited){var E=v.getMinZoom(),P=v.getMaxZoom();u.disabled=y<E||y>P}}},{key:"addLayer",value:function(o,u,v){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:u,overlay:v});var y=this.controlOption,_=y.sortLayers,E=y.sortFunction,P=y.autoZIndex;_&&this.layers.sort(function(I,k){return E(I.layer,k.layer,I.name,k.name)}),P&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var u=this.layerService.getLayer(o.target.layerId),v=u!=null&&u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;v&&this.emit(v,u)}},{key:"createRadioElement",value:function(o,u){var v='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",y=document.createElement("div");return y.innerHTML=v,y.firstChild}},{key:"addItem",value:function(o){var u=document.createElement("label"),v=this.layerService.getLayer(o.layer.id),y=v&&v.inited&&o.layer.isVisible(),_;o.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="l7-control-layers-selector",_.defaultChecked=y):_=this.createRadioElement("l7-base-layers",y),this.layerControlInputs.push(_),_.layerId=o.layer.id,_.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+o.name;var P=document.createElement("div");u.appendChild(P),P.appendChild(_),P.appendChild(E);var I=o.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(u),this.checkDisabledLayers(),u}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,u,v,y=[],_=[];this.handlingClick=!0;for(var E=o.length-1;E>=0;E--)u=o[E],v=this.layerService.getLayer(u.layerId),u.checked?y.push(v):u.checked||_.push(v);_.forEach(function(P){P.hide()}),y.forEach(function(P){P.show()}),this.handlingClick=!1}}]),r}(Iv);function vb(e){var n=mb();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gb=function(e){(0,Hr.Z)(r,e);var n=vb(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",u=za("div",o),v=za("a","l7-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://antv.alipay.com/l7",v.setAttribute("aria-label","AntV logo"),v.setAttribute("rel","noopener nofollow"),u.appendChild(v),u}},{key:"onRemove",value:function(){return null}}]),r}(Iv);function yb(e){var n=_b();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function _b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tP=function(e){(0,Hr.Z)(r,e);var n=yb(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ye.Z)(o),"mScale",void 0),(0,C.Z)((0,ye.Z)(o),"iScale",void 0),ns(["update"],(0,ye.Z)(o)),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",u=za("div",o);this.addScales(o+"-line",u);var v=this.controlOption.updateWhenIdle;return this.mapsService.on(v?"moveend":"mapmove",this.update),this.mapsService.on(v?"zoomend":"zoomchange",this.update),this.update(),u}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,u=this.controlOption.maxWidth,v=o.getSize()[1]/2,y=o.containerToLngLat([0,v]),_=o.containerToLngLat([u,v]),E=_s([y.lng,y.lat],[_.lng,_.lat]);this.updateScales(E)}},{key:"updateScales",value:function(o){var u=this.controlOption,v=u.metric,y=u.imperial;v&&o&&this.updateMetric(o),y&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var u=this.getRoundNum(o),v=u<1e3?u+" m":u/1e3+" km";this.updateScale(this.mScale,v,u/o)}},{key:"updateImperial",value:function(o){var u=o*3.2808399,v,y,_;u>5280?(v=u/5280,y=this.getRoundNum(v),this.updateScale(this.iScale,y+" mi",y/v)):(_=this.getRoundNum(u),this.updateScale(this.iScale,_+" ft",_/u))}},{key:"updateScale",value:function(o,u,v){var y=this.controlOption.maxWidth;o.style.width=Math.round(y*v)+"px",o.innerHTML=u}},{key:"getRoundNum",value:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),v=o/u;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:1,u*v}},{key:"addScales",value:function(o,u){var v=this.controlOption,y=v.metric,_=v.imperial;y&&(this.mScale=za("div",o,u)),_&&(this.iScale=za("div",o,u))}}]),r}(Iv);function xb(e){var n=bb();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rP=function(e){(0,Hr.Z)(r,e);var n=xb(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ye.Z)(o),"disabled",void 0),(0,C.Z)((0,ye.Z)(o),"zoomInButton",void 0),(0,C.Z)((0,ye.Z)(o),"zoomOutButton",void 0),ns(["updateDisabled","zoomIn","zoomOut"],(0,ye.Z)(o)),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",u=za("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",u,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",u,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),u}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,u,v,y,_){var E=za("a",v,y);return E.innerHTML=o,E.title=u,E.href="javascript:void(0)",E.addEventListener("click",_),E}},{key:"updateDisabled",value:function(){var o=this.mapsService,u="l7-disabled";ju(this.zoomInButton,u),ju(this.zoomOutButton,u),(this.disabled||o.getZoom()<=o.getMinZoom())&&Ll(this.zoomOutButton,u),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Ll(this.zoomInButton,u)}}]),r}(Iv);function U0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Z0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Eb(e){var n=Sb();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V0=function(e){(0,Hr.Z)(r,e);var n=Eb(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this),(0,C.Z)((0,ye.Z)(o),"markerOption",void 0),(0,C.Z)((0,ye.Z)(o),"defaultMarker",void 0),(0,C.Z)((0,ye.Z)(o),"popup",void 0),(0,C.Z)((0,ye.Z)(o),"mapsService",void 0),(0,C.Z)((0,ye.Z)(o),"sceneSerive",void 0),(0,C.Z)((0,ye.Z)(o),"lngLat",void 0),(0,C.Z)((0,ye.Z)(o),"scene",void 0),(0,C.Z)((0,ye.Z)(o),"added",!1),(0,C.Z)((0,ye.Z)(o),"eventHandle",function(u){o.emit(u.type,{target:u,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=Z0(Z0({},o.getDefault()),i),ns(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ye.Z)(o)),o.init(),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:_a.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(Gt.IMapService),this.sceneSerive=o.get(Gt.ISceneService);var u=this.markerOption,v=u.element,y=u.draggable;return this.mapsService.getMarkerContainer().appendChild(v),this.registerMarkerEvent(v),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&ic(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var u=this;if(!this.added)return this.once("added",function(){u.setElement(o)}),this;var v=this.markerOption.element;return v&&ic(v),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var u=this.popup;return u?(u.isOpen()||u.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var u=this.popup;return u&&u.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,v=o.anchor;this.updatePosition(),fo(u,"".concat(sc[v]))}}},{key:"onMapClick",value:function(o){var u=this.markerOption.element;this.popup&&u&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,v=o.offsets,y=this.lngLat,_=y.lng,E=y.lat,P=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([_,E]);if(u){u.style.display="block";var k=this.mapsService.getContainer(),B=0,q=0;if(k&&(B=k.scrollWidth,q=k.scrollHeight),Math.abs(P[0][0])>180||Math.abs(P[1][0])>180){if(I.x>B){var ee=this.mapsService.lngLatToContainer([_-360,E]);I.x=ee.x}if(I.x<0){var se=this.mapsService.lngLatToContainer([_+360,E]);I.x=se.x}}(I.x>B||I.x<0||I.y>q||I.y<0)&&(u.style.display="none"),u.style.left=I.x+v[0]+"px",u.style.top=I.y-v[1]+"px"}}}},{key:"init",value:function(){var o=this,u=this.markerOption.element,v=this.markerOption,y=v.color,_=v.anchor;if(!u){this.defaultMarker=!0,u=za("div"),this.markerOption.element=u;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var P=document.createElementNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),P.setAttributeNS(null,"fill",y),E.appendChild(P),u.appendChild(E)}Ll(u,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var k,B,q=((k=o.markerOption)===null||k===void 0?void 0:k.style)&&((B=o.markerOption)===null||B===void 0?void 0:B.style[I]);u&&(u.style[I]=q)}),u.addEventListener("click",function(I){o.onMapClick(I)}),u.addEventListener("click",this.eventHandle),fl(u,_,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(xa.EventEmitter);function j0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function G0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?j0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wb(e){var n=Cb();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nP=function(e){(0,Hr.Z)(r,e);var n=wb(r);function r(i){var o,u;return(0,_t.Z)(this,r),u=n.call(this),(0,C.Z)((0,ye.Z)(u),"markers",[]),(0,C.Z)((0,ye.Z)(u),"markerLayerOption",void 0),(0,C.Z)((0,ye.Z)(u),"clusterIndex",void 0),(0,C.Z)((0,ye.Z)(u),"points",[]),(0,C.Z)((0,ye.Z)(u),"clusterMarkers",[]),(0,C.Z)((0,ye.Z)(u),"mapsService",void 0),(0,C.Z)((0,ye.Z)(u),"scene",void 0),(0,C.Z)((0,ye.Z)(u),"zoom",void 0),(0,C.Z)((0,ye.Z)(u),"bbox",void 0),u.markerLayerOption=Qr()(u.getDefault(),i),ns(["update"],(0,ye.Z)(u)),u.zoom=((o=u.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,u}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(Gt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var u=this.markerLayerOption.cluster;u&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var u=this.markers.indexOf(o);u>-1&&this.markers.splice(u,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(u){u.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,u){var v=o.getLnglat(),y=v.lng,_=v.lat,E={geometry:{type:"Point",coordinates:[y,_]},properties:G0(G0({},o.getExtData()),{},{marker_id:u})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,u=o.radius,v=o.minZoom,y=v===void 0?0:v,_=o.maxZoom;this.clusterIndex=new(So())({radius:u,minZoom:y,maxZoom:_}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,u){var v=this,y=o[0].concat(o[1]),_=this.clusterIndex.getClusters(y,u);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],_.forEach(function(E){var P,I=v.markerLayerOption.clusterOption,k=I.field,B=I.method;if(E.properties&&(P=E.properties)!==null&&P!==void 0&&P.cluster_id){var q,ee=v.getLeaves((q=E.properties)===null||q===void 0?void 0:q.cluster_id);if(E.properties.clusterData=ee,k&&B){var se=ee==null?void 0:ee.map(function(Nt){var Vt=(0,C.Z)({},k,Nt.properties[k]);return Vt}),De=Yu(se,k),Je=uc(B,De),ht="point_"+B;E.properties[ht]=Je.toFixed(2)}}var gt=v.clusterMarker(E);v.clusterMarkers.push(gt),gt.addTo(v.scene)})}},{key:"getLeaves",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,u,v):null}},{key:"clusterMarker",value:function(o){var u=this.markerLayerOption.clusterOption,v=u,y=v.element,_=y===void 0?this.generateElement.bind(this):y,E=new V0({element:_(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(o){var u=o.properties.marker_id;return this.markers[u]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!xn(this.bbox,u))&&(this.bbox=Tn(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var u=za("div","l7-marker-cluster"),v=za("div","",u),y=za("span","",v),_=this.markerLayerOption.clusterOption,E=_.field,P=_.method;o.properties.point_count=o.properties.point_count||1;var I=E&&P?o.properties["point_"+P]||o.properties[E]:o.properties.point_count;return y.textContent=I,u}}]),r}(xa.EventEmitter);function H0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function W0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?H0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ab(e){var n=Tb();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function Tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X0=function(e){(0,Hr.Z)(r,e);var n=Ab(r);function r(i){var o;return(0,_t.Z)(this,r),o=n.call(this),(0,C.Z)((0,ye.Z)(o),"popupOption",void 0),(0,C.Z)((0,ye.Z)(o),"mapsService",void 0),(0,C.Z)((0,ye.Z)(o),"sceneSerive",void 0),(0,C.Z)((0,ye.Z)(o),"lngLat",void 0),(0,C.Z)((0,ye.Z)(o),"content",void 0),(0,C.Z)((0,ye.Z)(o),"closeButton",void 0),(0,C.Z)((0,ye.Z)(o),"timeoutInstance",void 0),(0,C.Z)((0,ye.Z)(o),"container",void 0),(0,C.Z)((0,ye.Z)(o),"tip",void 0),(0,C.Z)((0,ye.Z)(o),"scene",void 0),o.popupOption=W0(W0({},o.getdefault()),i),ns(["update","onClickClose","remove"],(0,ye.Z)(o)),o}return(0,jt.Z)(r,[{key:"addTo",value:function(o){var u=this;return this.mapsService=o.get(Gt.IMapService),this.sceneSerive=o.get(Gt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){u.mapsService.on("click",u.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var u=window.document.createDocumentFragment(),v=window.document.createElement("body"),y;for(v.innerHTML=o;y=v.firstChild,!!y;)u.appendChild(y);return this.setDOMContent(u)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ic(this.content),this.content=za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,u,v){var y=window.document.createElement(o);return u!==void 0&&(y.className=u),v&&v.appendChild(y),y}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:_a.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,u=this.lngLat,v=this.popupOption,y=v.className,_=v.maxWidth,E=v.anchor;if(!(!this.mapsService||!u||!this.content)){var P=this.mapsService.getMarkerContainer();if(!this.container&&P){this.container=this.creatDom("div","l7-popup",P),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),y&&y.split(" ").forEach(function(k){return o.container.classList.add(k)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){o.container.addEventListener(k,function(B){B.stopPropagation()})})}_&&this.container.style.maxWidth!==_&&(this.container.style.maxWidth=_),this.updatePosition(),fo(this.container,"".concat(sc[E])),fl(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,u=o.lng,v=o.lat,y=this.popupOption.offsets,_=this.mapsService.lngLatToContainer([u,v]);this.container.style.left=_.x+y[0]+"px",this.container.style.top=_.y-y[1]+"px"}}}]),r}(xa.EventEmitter);function Mb(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var v=n.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=e:v.appendChild(n.createTextNode(e)),o.appendChild(v),v}}Mb(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Pb=$(81242),Ib=$.n(Pb),Ob=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"attribute",void 0),(0,C.Z)(this,"buffer",void 0);var i=r.buffer,o=r.offset,u=r.stride,v=r.normalized,y=r.size,_=r.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:u||0,normalized:v||!1,divisor:_||0},y&&(this.attribute.size=y)}return(0,jt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),gh,Gd,yh,bc,Hd,Hh,Wd,Ov,Of,Tp,Su,Rf,Lf,Rv,Rb=(gh={},(0,C.Z)(gh,p.POINTS,"points"),(0,C.Z)(gh,p.LINES,"lines"),(0,C.Z)(gh,p.LINE_LOOP,"line loop"),(0,C.Z)(gh,p.LINE_STRIP,"line strip"),(0,C.Z)(gh,p.TRIANGLES,"triangles"),(0,C.Z)(gh,p.TRIANGLE_FAN,"triangle fan"),(0,C.Z)(gh,p.TRIANGLE_STRIP,"triangle strip"),gh),Y0=(Gd={},(0,C.Z)(Gd,p.STATIC_DRAW,"static"),(0,C.Z)(Gd,p.DYNAMIC_DRAW,"dynamic"),(0,C.Z)(Gd,p.STREAM_DRAW,"stream"),Gd),Cm=(yh={},(0,C.Z)(yh,p.BYTE,"int8"),(0,C.Z)(yh,p.UNSIGNED_INT,"int16"),(0,C.Z)(yh,p.INT,"int32"),(0,C.Z)(yh,p.UNSIGNED_BYTE,"uint8"),(0,C.Z)(yh,p.UNSIGNED_SHORT,"uint16"),(0,C.Z)(yh,p.UNSIGNED_INT,"uint32"),(0,C.Z)(yh,p.FLOAT,"float"),yh),Lb=(bc={},(0,C.Z)(bc,p.ALPHA,"alpha"),(0,C.Z)(bc,p.LUMINANCE,"luminance"),(0,C.Z)(bc,p.LUMINANCE_ALPHA,"luminance alpha"),(0,C.Z)(bc,p.RGB,"rgb"),(0,C.Z)(bc,p.RGBA,"rgba"),(0,C.Z)(bc,p.RGBA4,"rgba4"),(0,C.Z)(bc,p.RGB5_A1,"rgb5 a1"),(0,C.Z)(bc,p.RGB565,"rgb565"),(0,C.Z)(bc,p.DEPTH_COMPONENT,"depth"),(0,C.Z)(bc,p.DEPTH_STENCIL,"depth stencil"),bc),kb=(Hd={},(0,C.Z)(Hd,p.DONT_CARE,"dont care"),(0,C.Z)(Hd,p.NICEST,"nice"),(0,C.Z)(Hd,p.FASTEST,"fast"),Hd),q0=(Hh={},(0,C.Z)(Hh,p.NEAREST,"nearest"),(0,C.Z)(Hh,p.LINEAR,"linear"),(0,C.Z)(Hh,p.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,C.Z)(Hh,p.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,C.Z)(Hh,p.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,C.Z)(Hh,p.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Hh),K0=(Wd={},(0,C.Z)(Wd,p.REPEAT,"repeat"),(0,C.Z)(Wd,p.CLAMP_TO_EDGE,"clamp"),(0,C.Z)(Wd,p.MIRRORED_REPEAT,"mirror"),Wd),Db=(Ov={},(0,C.Z)(Ov,p.NONE,"none"),(0,C.Z)(Ov,p.BROWSER_DEFAULT_WEBGL,"browser"),Ov),Fb=(Of={},(0,C.Z)(Of,p.NEVER,"never"),(0,C.Z)(Of,p.ALWAYS,"always"),(0,C.Z)(Of,p.LESS,"less"),(0,C.Z)(Of,p.LEQUAL,"lequal"),(0,C.Z)(Of,p.GREATER,"greater"),(0,C.Z)(Of,p.GEQUAL,"gequal"),(0,C.Z)(Of,p.EQUAL,"equal"),(0,C.Z)(Of,p.NOTEQUAL,"notequal"),Of),$0=(Tp={},(0,C.Z)(Tp,p.FUNC_ADD,"add"),(0,C.Z)(Tp,p.MIN_EXT,"min"),(0,C.Z)(Tp,p.MAX_EXT,"max"),(0,C.Z)(Tp,p.FUNC_SUBTRACT,"subtract"),(0,C.Z)(Tp,p.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Tp),Lv=(Su={},(0,C.Z)(Su,p.ZERO,"zero"),(0,C.Z)(Su,p.ONE,"one"),(0,C.Z)(Su,p.SRC_COLOR,"src color"),(0,C.Z)(Su,p.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,C.Z)(Su,p.SRC_ALPHA,"src alpha"),(0,C.Z)(Su,p.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,C.Z)(Su,p.DST_COLOR,"dst color"),(0,C.Z)(Su,p.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,C.Z)(Su,p.DST_ALPHA,"dst alpha"),(0,C.Z)(Su,p.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,C.Z)(Su,p.CONSTANT_COLOR,"constant color"),(0,C.Z)(Su,p.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,C.Z)(Su,p.CONSTANT_ALPHA,"constant alpha"),(0,C.Z)(Su,p.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,C.Z)(Su,p.SRC_ALPHA_SATURATE,"src alpha saturate"),Su),Nb=(Rf={},(0,C.Z)(Rf,p.NEVER,"never"),(0,C.Z)(Rf,p.ALWAYS,"always"),(0,C.Z)(Rf,p.LESS,"less"),(0,C.Z)(Rf,p.LEQUAL,"lequal"),(0,C.Z)(Rf,p.GREATER,"greater"),(0,C.Z)(Rf,p.GEQUAL,"gequal"),(0,C.Z)(Rf,p.EQUAL,"equal"),(0,C.Z)(Rf,p.NOTEQUAL,"notequal"),Rf),sd=(Lf={},(0,C.Z)(Lf,p.ZERO,"zero"),(0,C.Z)(Lf,p.KEEP,"keep"),(0,C.Z)(Lf,p.REPLACE,"replace"),(0,C.Z)(Lf,p.INVERT,"invert"),(0,C.Z)(Lf,p.INCR,"increment"),(0,C.Z)(Lf,p.DECR,"decrement"),(0,C.Z)(Lf,p.INCR_WRAP,"increment wrap"),(0,C.Z)(Lf,p.DECR_WRAP,"decrement wrap"),Lf),Bb=(Rv={},(0,C.Z)(Rv,p.FRONT,"front"),(0,C.Z)(Rv,p.BACK,"back"),Rv),zb=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"buffer",void 0);var i=r.data,o=r.usage,u=r.type;this.buffer=n.buffer({data:i,usage:Y0[o||p.STATIC_DRAW],type:Cm[u||p.UNSIGNED_BYTE]})}return(0,jt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var i=r.data,o=r.offset;this.buffer.subdata(i,o)}}]),e}(),Ub=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"elements",void 0);var i=r.data,o=r.usage,u=r.type,v=r.count;this.elements=n.elements({data:i,usage:Y0[o||p.STATIC_DRAW],type:Cm[u||p.UNSIGNED_BYTE],count:v})}return(0,jt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var i=r.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),Zb=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"framebuffer",void 0);var i=r.width,o=r.height,u=r.color,v=r.colors,y=r.depth,_=r.stencil,E={width:i,height:o};Array.isArray(v)&&(E.colors=v.map(function(P){return P.get()})),u&&typeof u!="boolean"&&(E.color=u.get()),this.framebuffer=n.framebuffer(E)}return(0,jt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.framebuffer.resize(i,o)}}]),e}(),Vb=$(18397),jb=$.n(Vb),Gb=$(19308),Hb=$.n(Gb);function Q0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ud(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Q0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Wb=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"reGl",void 0),(0,C.Z)(this,"destroyed",!1),(0,C.Z)(this,"drawCommand",void 0),(0,C.Z)(this,"drawParams",void 0),(0,C.Z)(this,"options",void 0),(0,C.Z)(this,"uniforms",{}),this.reGl=n;var i=r.vs,o=r.fs,u=r.attributes,v=r.uniforms,y=r.primitive,_=r.count,E=r.elements,P=r.depth,I=r.blend,k=r.stencil,B=r.cull,q=r.instances,ee={};this.options=r,v&&(this.uniforms=this.extractUniforms(v),Object.keys(v).forEach(function(Je){ee[Je]=n.prop(Je)}));var se={};Object.keys(u).forEach(function(Je){se[Je]=u[Je].get()});var De={attributes:se,frag:o,uniforms:ee,vert:i,primitive:Rb[y===void 0?p.TRIANGLES:y]};q&&(De.instances=q),_&&(De.count=_),E&&(De.elements=E.get()),this.initDepthDrawParams({depth:P},De),this.initBlendDrawParams({blend:I},De),this.initStencilDrawParams({stencil:k},De),this.initCullDrawParams({cull:B},De),this.drawCommand=n(De),this.drawParams=De}return(0,jt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=ud(ud({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=ud(ud({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(i).forEach(function(u){var v=(0,je.Z)(i[u]);v==="boolean"||v==="number"||Array.isArray(i[u])||i[u].BYTES_PER_ELEMENT?o[u]=i[u]:o[u]=i[u].get()}),this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,i){var o=r.depth;o&&(i.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:Fb[o.func||p.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,i){var o=r.blend;if(o){var u=o.enable,v=o.func,y=o.equation,_=o.color,E=_===void 0?[0,0,0,0]:_;i.blend={enable:!!u,func:{srcRGB:Lv[v&&v.srcRGB||p.SRC_ALPHA],srcAlpha:Lv[v&&v.srcAlpha||p.SRC_ALPHA],dstRGB:Lv[v&&v.dstRGB||p.ONE_MINUS_SRC_ALPHA],dstAlpha:Lv[v&&v.dstAlpha||p.ONE_MINUS_SRC_ALPHA]},equation:{rgb:$0[y&&y.rgb||p.FUNC_ADD],alpha:$0[y&&y.alpha||p.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,i){var o=r.stencil;if(o){var u=o.enable,v=o.mask,y=v===void 0?-1:v,_=o.func,E=_===void 0?{cmp:p.ALWAYS,ref:0,mask:-1}:_,P=o.opFront,I=P===void 0?{fail:p.KEEP,zfail:p.KEEP,zpass:p.KEEP}:P,k=o.opBack,B=k===void 0?{fail:p.KEEP,zfail:p.KEEP,zpass:p.KEEP}:k;i.stencil={enable:!!u,mask:y,func:ud(ud({},E),{},{cmp:Nb[E.cmp]}),opFront:{fail:sd[I.fail],zfail:sd[I.zfail],zpass:sd[I.zpass]},opBack:{fail:sd[B.fail],zfail:sd[B.zfail],zpass:sd[B.zpass]}}}}},{key:"initCullDrawParams",value:function(r,i){var o=r.cull;if(o){var u=o.enable,v=o.face,y=v===void 0?p.BACK:v;i.cull={enable:!!u,face:Bb[y]}}}},{key:"extractUniforms",value:function(r){var i=this,o={};return Object.keys(r).forEach(function(u){i.extractUniformsRecursively(u,r[u],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,i,o,u){var v=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||jb()(i)||i===""||"resize"in i){o["".concat(u&&u+".").concat(r)]=i;return}Hb()(i)&&Object.keys(i).forEach(function(y){v.extractUniformsRecursively(y,i[y],o,"".concat(u&&u+".").concat(r))}),Array.isArray(i)&&i.forEach(function(y,_){Object.keys(y).forEach(function(E){v.extractUniformsRecursively(E,y[E],o,"".concat(u&&u+".").concat(r,"[").concat(_,"]"))})})}}]),e}(),Xb=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"texture",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0);var i=r.data,o=r.type,u=o===void 0?p.UNSIGNED_BYTE:o,v=r.width,y=r.height,_=r.flipY,E=_===void 0?!1:_,P=r.format,I=P===void 0?p.RGBA:P,k=r.mipmap,B=k===void 0?!1:k,q=r.wrapS,ee=q===void 0?p.CLAMP_TO_EDGE:q,se=r.wrapT,De=se===void 0?p.CLAMP_TO_EDGE:se,Je=r.aniso,ht=Je===void 0?0:Je,gt=r.alignment,Nt=gt===void 0?1:gt,Vt=r.premultiplyAlpha,nr=Vt===void 0?!1:Vt,dr=r.mag,Jr=dr===void 0?p.NEAREST:dr,ln=r.min,Er=ln===void 0?p.NEAREST:ln,In=r.colorSpace,Vn=In===void 0?p.BROWSER_DEFAULT_WEBGL:In;this.width=v,this.height=y;var pi={width:v,height:y,type:Cm[u],format:Lb[I],wrapS:K0[ee],wrapT:K0[De],mag:q0[Jr],min:q0[Er],alignment:Nt,flipY:E,colorSpace:Db[Vn],premultiplyAlpha:nr,aniso:ht};i&&(pi.data=i),typeof B=="number"?pi.mipmap=kb[B]:typeof B=="boolean"&&(pi.mipmap=B),this.texture=n.texture(pi)}return(0,jt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.texture.resize(i,o),this.width=i,this.height=o}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),J0,eg,Yb=(J0=(0,Rr.b2)(),J0(eg=function(){function e(){var n=this;(0,_t.Z)(this,e),(0,C.Z)(this,"extensionObject",void 0),(0,C.Z)(this,"gl",void 0),(0,C.Z)(this,"$container",void 0),(0,C.Z)(this,"canvas",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDirty",void 0),(0,C.Z)(this,"createModel",function(r){return new Wb(n.gl,r)}),(0,C.Z)(this,"createAttribute",function(r){return new Ob(n.gl,r)}),(0,C.Z)(this,"createBuffer",function(r){return new zb(n.gl,r)}),(0,C.Z)(this,"createElements",function(r){return new Ub(n.gl,r)}),(0,C.Z)(this,"createTexture2D",function(r){return new Xb(n.gl,r)}),(0,C.Z)(this,"createFramebuffer",function(r){return new Zb(n.gl,r)}),(0,C.Z)(this,"useFramebuffer",function(r,i){n.gl({framebuffer:r?r.get():null})(i)}),(0,C.Z)(this,"clear",function(r){var i=r.color,o=r.depth,u=r.stencil,v=r.framebuffer,y=v===void 0?null:v,_={color:i,depth:o,stencil:u};_.framebuffer=y===null?y:y.get(),n.gl.clear(_)}),(0,C.Z)(this,"viewport",function(r){var i=r.x,o=r.y,u=r.width,v=r.height;n.gl._gl.viewport(i,o,u,v),n.width=u,n.height=v,n.gl._refresh()}),(0,C.Z)(this,"readPixels",function(r){var i=r.framebuffer,o=r.x,u=r.y,v=r.width,y=r.height,_={x:o,y:u,width:v,height:y};return i&&(_.framebuffer=i.get()),n.gl.read(_)}),(0,C.Z)(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),(0,C.Z)(this,"getContainer",function(){if(Wi)return n.canvas;var r;return(r=n.canvas)===null||r===void 0?void 0:r.parentElement}),(0,C.Z)(this,"getCanvas",function(){return n.canvas}),(0,C.Z)(this,"getGLContext",function(){return n.gl._gl}),(0,C.Z)(this,"destroy",function(){n.gl.destroy()})}return(0,jt.Z)(e,[{key:"init",value:function(){var n=(0,Ls.Z)(t().mark(function i(o,u){var v=this;return t().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.canvas=o,_.next=3,new Promise(function(E,P){Ib()({canvas:v.canvas,attributes:{alpha:!0,antialias:u.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:u.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(k,B){(k||!B)&&P(k),E(B)}})});case 3:this.gl=_.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return _.stop()}},i,this)}));function r(i,o){return n.apply(this,arguments)}return r}()},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||eg);function tg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function rg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?tg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var qb=function(){function e(n){(0,_t.Z)(this,e),(0,C.Z)(this,"sceneService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"controlService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"markerService",void 0),(0,C.Z)(this,"popupService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"container",void 0);var r=n.id,i=n.map,o=n.canvas,u=n.hasBaseMap,v=Kx();this.container=v,i.setContainer(v,r,o,u),v.bind(Gt.IRendererService).to(Yb).inSingletonScope(),this.sceneService=v.get(Gt.ISceneService),this.mapService=v.get(Gt.IMapService),this.iconService=v.get(Gt.IIconService),this.fontService=v.get(Gt.IFontService),this.controlService=v.get(Gt.IControlService),this.layerService=v.get(Gt.ILayerService),this.markerService=v.get(Gt.IMarkerService),this.interactionService=v.get(Gt.IInteractionService),this.popupService=v.get(Gt.IPopupService),Wi?this.sceneService.initMiniScene(n):(this.initComponent(r),this.sceneService.init(n),this.initControl())}return(0,jt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var i=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var u=new r(i);u.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var i=$x(this.container);r.setContainer(i,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,i){this.layerService.remove(r,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(r,i){this.fontService.addIconFont(r,i)}},{key:"addIconFonts",value:function(r){var i=this;r.forEach(function(o){var u=(0,Pn.Z)(o,2),v=u[0],y=u[1];i.fontService.addIconFont(v,y)})}},{key:"addFontFace",value:function(r,i){this.sceneService.addFontFace(r,i)}},{key:"addImage",value:function(r,i){Wi?this.iconService.addImageMini(r,i,this.sceneService):this.iconService.addImage(r,i)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,i){wm.indexOf(r)===-1?this.mapService.on(r,i):this.sceneService.on(r,i)}},{key:"once",value:function(r,i){wm.indexOf(r)===-1?this.mapService.once(r,i):this.sceneService.once(r,i)}},{key:"off",value:function(r,i){wm.indexOf(r)===-1?this.mapService.off(r,i):this.sceneService.off(r,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,i){return this.mapService.setCenter(r,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,i){this.mapService.panBy(r,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,i){var o=this.sceneService.getSceneConfig(),u=o.fitBoundsOptions,v=o.animate;this.mapService.fitBounds(r,i||rg(rg({},u),{},{animate:v}))}},{key:"setZoomAndCenter",value:function(r,i){this.mapService.setZoomAndCenter(r,i)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,i){this.container.bind(Gt.IPostProcessingPass).to(r).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ma(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),i=r.logoVisible,o=r.logoPosition;i&&this.addControl(new gb({position:o}))}}]),e}(),Kb=$(20816),Ec=$.n(Kb),ng,ig,ag,Am,og;function $b(e){return e.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}var Qb=(ng=(0,Rr.b2)(),ig=(0,Rr.f3)(Gt.IGlobalConfigService),ng(ag=(Am=function(){function e(){(0,_t.Z)(this,e),Rn(this,"configService",og,this),(0,C.Z)(this,"enabled",void 0)}return(0,jt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.rendererService,v=i.postProcessingPassFactory,y=i.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var _=r.getLayerConfig(),E=_.enableMultiPassRenderer,P=_.passes,I=P===void 0?[]:P;o.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,I,v,y),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,i,o,u){var v=r.multiPassRenderer,y=r.getLayerConfig(),_=y.enablePicking,E=y.enableTAA;return _&&v.add(u("pixelPicking")),v}}]),e}(),og=kn(Am.prototype,"configService",[ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am))||ag),Wh,sg=(Wh={},(0,C.Z)(Wh,$c.additive,{enable:!0,func:{srcRGB:p.ONE,dstRGB:p.ONE,srcAlpha:1,dstAlpha:1}}),(0,C.Z)(Wh,$c.none,{enable:!1}),(0,C.Z)(Wh,$c.normal,{enable:!0,func:{srcRGB:p.SRC_ALPHA,dstRGB:p.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,C.Z)(Wh,$c.subtractive,{enable:!0,func:{srcRGB:p.ONE,dstRGB:p.ONE,srcAlpha:p.ZERO,dstAlpha:p.ONE_MINUS_SRC_COLOR},equation:{rgb:p.FUNC_SUBTRACT,alpha:p.FUNC_SUBTRACT}}),(0,C.Z)(Wh,$c.max,{enable:!0,func:{srcRGB:p.ONE,dstRGB:p.ONE},equation:{rgb:p.MAX_EXT}}),(0,C.Z)(Wh,$c.min,{enable:!0,func:{srcRGB:p.ONE,dstRGB:p.ONE},equation:{rgb:p.MIN_EXT}}),Wh),Jb=$(68868),vo=$.n(Jb),eE=$(80744),Mp=$.n(eE),iP=1024;function tl(e,n,r,i,o){n.updateStyleAttribute(e,r,i,o)}function tE(e,n){e.opacity&&Tm("opacity",n,e.opacity),e.strokeWidth&&Tm("strokeWidth",n,e.strokeWidth),e.strokeOpacity&&Tm("strokeOpacity",n,e.strokeOpacity),e.stroke&&rE("stroke",n,e.stroke),e.offsets&&ug("offsets",n,e.offsets),e.textOffset&&ug("textOffset",n,e.textOffset)}function Tm(e,n,r){Bs()(r)?tl(e,n,r,function(i){return i}):vo()(r)?tl(e,n,[r],void 0):Mp()(r)&&r.length===2?Bs()(r[0])&&Go()(r[1])||Bs()(r[0])&&Mp()(r[1])&&vo()(r[1][0])&&vo()(r[1][1])?tl(e,n,r[0],r[1]):tl(e,n,[1],void 0):tl(e,n,[1],void 0)}function ug(e,n,r){Bs()(r)?tl(e,n,r,function(i){return i}):Mp()(r)&&r.length===2&&Bs()(r[0])&&Go()(r[1])?tl(e,n,r[0],r[1]):Mp()(r)&&r.length===2&&vo()(r[0])&&vo()(r[1])?tl(e,n,r,void 0):tl(e,n,[0,0],void 0)}function rE(e,n,r){Bs()(r)?tl(e,n,r,void 0):Mp()(r)&&r.length===2&&(Bs()(r[0])&&Go()(r[1])||Bs()(r[0])&&Mp()(r[1])&&r[1].length>0)?tl(e,n,r[0],r[1]):tl(e,n,"#fff",void 0)}var nE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function iE(e,n,r){typeof n=="string"&&typeof r=="string"&&n!==r&&nE.map(function(i){i.includes(n)&&i.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var aE=["passes"],oE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],lg,cg,kv,fg,hg;function sE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=uE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function uE(e,n){if(!!e){if(typeof e=="string")return pg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pg(e,n)}}function pg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function dg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Nu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?dg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function lE(e){var n=cE();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function cE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vg=0,Pp=(lg=jd(Gt.IGlobalConfigService),cg=jd(Gt.IShaderModuleService),kv=function(e){(0,Hr.Z)(r,e);var n=lE(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,_t.Z)(this,r),i=n.call(this),(0,C.Z)((0,ye.Z)(i),"id","".concat(vg++)),(0,C.Z)((0,ye.Z)(i),"name","".concat(vg)),(0,C.Z)((0,ye.Z)(i),"type",void 0),(0,C.Z)((0,ye.Z)(i),"visible",!0),(0,C.Z)((0,ye.Z)(i),"zIndex",0),(0,C.Z)((0,ye.Z)(i),"minZoom",void 0),(0,C.Z)((0,ye.Z)(i),"maxZoom",void 0),(0,C.Z)((0,ye.Z)(i),"inited",!1),(0,C.Z)((0,ye.Z)(i),"layerModelNeedUpdate",!1),(0,C.Z)((0,ye.Z)(i),"pickedFeatureID",null),(0,C.Z)((0,ye.Z)(i),"selectedFeatureID",null),(0,C.Z)((0,ye.Z)(i),"styleNeedUpdate",!1),(0,C.Z)((0,ye.Z)(i),"rendering",void 0),(0,C.Z)((0,ye.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,C.Z)((0,ye.Z)(i),"hooks",{init:new Zn,afterInit:new Zn,beforeRender:new Zn,beforeRenderData:new Xn,afterRender:new ui,beforePickingEncode:new ui,afterPickingEncode:new ui,beforeHighlight:new ui(["pickedColor"]),afterHighlight:new ui,beforeSelect:new ui(["pickedColor"]),afterSelect:new ui,beforeDestroy:new ui,afterDestroy:new ui}),(0,C.Z)((0,ye.Z)(i),"models",[]),(0,C.Z)((0,ye.Z)(i),"multiPassRenderer",void 0),(0,C.Z)((0,ye.Z)(i),"plugins",void 0),(0,C.Z)((0,ye.Z)(i),"sourceOption",void 0),(0,C.Z)((0,ye.Z)(i),"layerModel",void 0),(0,C.Z)((0,ye.Z)(i),"sceneContainer",void 0),(0,C.Z)((0,ye.Z)(i),"layerChildren",[]),Rn((0,ye.Z)(i),"configService",fg,(0,ye.Z)(i)),Rn((0,ye.Z)(i),"shaderModuleService",hg,(0,ye.Z)(i)),(0,C.Z)((0,ye.Z)(i),"cameraService",void 0),(0,C.Z)((0,ye.Z)(i),"coordinateService",void 0),(0,C.Z)((0,ye.Z)(i),"iconService",void 0),(0,C.Z)((0,ye.Z)(i),"fontService",void 0),(0,C.Z)((0,ye.Z)(i),"pickingService",void 0),(0,C.Z)((0,ye.Z)(i),"rendererService",void 0),(0,C.Z)((0,ye.Z)(i),"layerService",void 0),(0,C.Z)((0,ye.Z)(i),"interactionService",void 0),(0,C.Z)((0,ye.Z)(i),"mapService",void 0),(0,C.Z)((0,ye.Z)(i),"styleAttributeService",void 0),(0,C.Z)((0,ye.Z)(i),"layerSource",void 0),(0,C.Z)((0,ye.Z)(i),"postProcessingPassFactory",void 0),(0,C.Z)((0,ye.Z)(i),"normalPassFactory",void 0),(0,C.Z)((0,ye.Z)(i),"animateOptions",{enable:!1}),(0,C.Z)((0,ye.Z)(i),"container",void 0),(0,C.Z)((0,ye.Z)(i),"encodedData",void 0),(0,C.Z)((0,ye.Z)(i),"configSchema",void 0),(0,C.Z)((0,ye.Z)(i),"currentPickId",null),(0,C.Z)((0,ye.Z)(i),"rawConfig",void 0),(0,C.Z)((0,ye.Z)(i),"needUpdateConfig",void 0),(0,C.Z)((0,ye.Z)(i),"pendingStyleAttributes",[]),(0,C.Z)((0,ye.Z)(i),"scaleOptions",{}),(0,C.Z)((0,ye.Z)(i),"animateStartTime",void 0),(0,C.Z)((0,ye.Z)(i),"aniamateStatus",!1),(0,C.Z)((0,ye.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var u=i.getLayerConfig(),v=u.autoFit,y=u.fitBoundsOptions;v&&i.fitBounds(y),i.emit("dataUpdate"),i.reRender()}),i.name=o.name||i.id,i.zIndex=o.zIndex||0,i.rawConfig=o,i}return(0,jt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Nu(Nu({},this.needUpdateConfig),o);else{var u=this.container.get(Gt.SceneID);tE(o,this),this.configService.setLayerConfig(u,this.id,Nu(Nu(Nu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,u){this.container=o,this.sceneContainer=u}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,u=this.container.get(Gt.SceneID),v=this.rawConfig.enableMultiPassRenderer,y=v===void 0?!1:v;this.configService.setLayerConfig(u,this.id,{enableMultiPassRenderer:y}),this.iconService=this.container.get(Gt.IIconService),this.fontService=this.container.get(Gt.IFontService),this.rendererService=this.container.get(Gt.IRendererService),this.layerService=this.container.get(Gt.ILayerService),this.interactionService=this.container.get(Gt.IInteractionService),this.pickingService=this.container.get(Gt.IPickingService),this.mapService=this.container.get(Gt.IMapService),this.cameraService=this.container.get(Gt.ICameraService),this.coordinateService=this.container.get(Gt.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(Gt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Gt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Gt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Gt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var k=I.attributeName,B=I.attributeField,q=I.attributeValues,ee=I.updateOptions;o.styleAttributeService.updateStyleAttribute(k,{scale:Nu({field:B},o.splitValuesAndCallbackInAttribute(q,o.getLayerConfig()[k]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Gt.ILayerPlugin);var _=sE(this.plugins),E;try{for(_.s();!(E=_.n()).done;){var P=E.value;P.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){_.e(I)}finally{_.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Nu(Nu({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),u=o.animateOption;u!=null&&u.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,u,v){return this.updateStyleAttribute("color",o,u,v),this}},{key:"texture",value:function(o,u,v){return this.updateStyleAttribute("texture",o,u,v),this}},{key:"rotate",value:function(o,u,v){return this.updateStyleAttribute("rotate",o,u,v),this}},{key:"size",value:function(o,u,v){return this.updateStyleAttribute("size",o,u,v),this}},{key:"filter",value:function(o,u,v){return this.updateStyleAttribute("filter",o,u,v),this}},{key:"shape",value:function(o,u,v){var y,_,E,P=(y=this.styleAttributeService)===null||y===void 0||(_=y.getLayerStyleAttribute("shape"))===null||_===void 0||(E=_.scale)===null||E===void 0?void 0:E.field,I=o;return this.updateStyleAttribute("shape",o,u,v),iE(this,P,I),this}},{key:"label",value:function(o,u,v){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:u,updateOptions:v}),this}},{key:"animate",value:function(o){var u={};return Ec()(o)?(u.enable=!0,u=Nu(Nu({},u),o)):u.enable=o,this.updateLayerConfig({animateOption:u}),this}},{key:"source",value:function(o,u){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:u},this)}},{key:"setData",value:function(o,u){var v=this;return this.inited?this.layerSource.setData(o,u):this.on("inited",function(){v.layerSource.setData(o,u)}),this}},{key:"style",value:function(o){var u=this,v=o.passes,y=(0,Wn.Z)(o,aE);return v&&$b(v).forEach(function(_){var E=u.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(_[0]);E&&E.updateOptions(_[1])}),this.rawConfig=Nu(Nu({},this.rawConfig),y),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,u){return Ec()(o)?this.scaleOptions=Nu(Nu({},this.scaleOptions),o):this.scaleOptions[o]=u,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var u={};return u.enableHighlight=Ec()(o)?!0:o,Ec()(o)?(u.enableHighlight=!0,o.color&&(u.highlightColor=o.color)):u.enableHighlight=!!o,this.updateLayerConfig(u),this}},{key:"setActive",value:function(o,u){var v=this;if(Ec()(o)){var y=o.x,_=y===void 0?0:y,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({highlightColor:Ec()(u)?u.color:this.getLayerConfig().highlightColor}),this.pick({x:_,y:P})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Ec()(u)?u.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(Wu(o)).then(function(){setTimeout(function(){v.reRender()},1)})}},{key:"select",value:function(o){var u={};return u.enableSelect=Ec()(o)?!0:o,Ec()(o)?(u.enableSelect=!0,o.color&&(u.selectColor=o.color)):u.enableSelect=!!o,this.updateLayerConfig(u),this}},{key:"setSelect",value:function(o,u){var v=this;if(Ec()(o)){var y=o.x,_=y===void 0?0:y,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({selectColor:Ec()(u)?u.color:this.getLayerConfig().selectColor}),this.pick({x:_,y:P})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Ec()(u)?u.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(Wu(o)).then(function(){setTimeout(function(){v.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),u=this.getLayerConfig(),v=u.visible,y=u.minZoom,_=y===void 0?-Infinity:y,E=u.maxZoom,P=E===void 0?Infinity:E;return!!v&&o>=_&&o<=P}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),u=o.minZoom;return u}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),u=o.maxZoom;return u}},{key:"get",value:function(o){var u=this.getLayerConfig();return u[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var u=this.getSource(),v=u.extent,y=v.some(function(_){return Math.abs(_)===Infinity});return y?this:(this.mapService.fitBounds([[v[0],v[1]],[v[2],v[3]]],o),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var u=this.styleAttributeService.getLayerAttributeScale(o);if(u){if(u.ticks){var v=u.ticks().map(function(_){return(0,C.Z)({value:_},o,u(_))});return v}else if(u.invertExtent){var y=u.range().map(function(_){return(0,C.Z)({value:u.invertExtent(_)},o,_)});return y}}else return[]}},{key:"pick",value:function(o){var u=o.x,v=o.y;this.interactionService.triggerHover({x:u,y:v})}},{key:"boxSelect",value:function(o,u){this.pickingService.boxPickLayer(this,o,u)}},{key:"buildLayerModel",value:function(o){var u=o.moduleName,v=o.vertexShader,y=o.fragmentShader,_=o.triangulation,E=o.segmentNumber,P=(0,Wn.Z)(o,oE);this.shaderModuleService.registerModule(u,{vs:v,fs:y});var I=this.shaderModuleService.getModule(u),k=I.vs,B=I.fs,q=I.uniforms,ee=this.rendererService.createModel,se=this.styleAttributeService.createAttributesAndIndices(this.encodedData,_,E),De=se.attributes,Je=se.elements;return ee(Nu({attributes:De,uniforms:q,fs:B,vs:k,elements:Je,blend:sg[$c.normal]},P))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var u=this.getLayerConfig(),v=u.enableHighlight,y=v===void 0?!0:v,_=u.enableSelect,E=_===void 0?!0:_,P=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&E&&(P=!0),o==="mousemove"&&(y||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(P=!0),this.isVisible()&&P}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var o=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(o,u,v,y){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Nu({field:u},this.splitValuesAndCallbackInAttribute(v,this.getLayerConfig()[u]))},y):this.pendingStyleAttributes.push({attributeName:o,attributeField:u,attributeValues:v,updateOptions:y})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,u){return{values:Go()(o)?void 0:o||u,callback:Go()(o)?o:void 0}}}]),r}(xa.EventEmitter),fg=kn(kv.prototype,"configService",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hg=kn(kv.prototype,"shaderModuleService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kv),fE=$(98621),Xd=$.n(fE),mg,gg,Dv,yg,_g;function hE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=pE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function pE(e,n){if(!!e){if(typeof e=="string")return xg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xg(e,n)}}function xg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var js=(mg=jd(Gt.IGlobalConfigService),gg=jd(Gt.IShaderModuleService),Dv=function(){function e(n){(0,_t.Z)(this,e),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"createTexture2D",void 0),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"dataTexture",void 0),(0,C.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,C.Z)(this,"rowCount",void 0),(0,C.Z)(this,"cacheStyleProperties",void 0),(0,C.Z)(this,"cellLength",void 0),(0,C.Z)(this,"cellProperties",void 0),(0,C.Z)(this,"cellTypeLayout",void 0),(0,C.Z)(this,"stylePropertyesExist",void 0),(0,C.Z)(this,"dataTextureTest",void 0),Rn(this,"configService",yg,this),Rn(this,"shaderModuleService",_g,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"styleAttributeService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(Gt.IRendererService),this.styleAttributeService=n.getContainer().get(Gt.IStyleAttributeService),this.mapService=n.getContainer().get(Gt.IMapService),this.iconService=n.getContainer().get(Gt.IIconService),this.fontService=n.getContainer().get(Gt.IFontService),this.cameraService=n.getContainer().get(Gt.ICameraService),this.layerService=n.getContainer().get(Gt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:p.NEAREST,min:p.NEAREST,width:1,height:1}))}return(0,jt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var i=!1;return Xd()(r.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=r.opacity),Xd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Xd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Xd()(r.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=r.stroke),Xd()(r.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!vo()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!vo()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!vo()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(r){return Bs()(r)?!!(0,Fo.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var i=wa(r);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Mp()(r)&&r.length===2&&vo()(r[0])&&vo()(r[1]))}},{key:"patchMod",value:function(r,i){for(var o=0;o<i;o++)r.push(-1)}},{key:"patchData",value:function(r,i,o){var u=hE(o),v;try{for(u.s();!(v=u.n()).done;){var y=v.value,_=y.attr,E=y.count,P=i[_];P?_==="stroke"?r.push.apply(r,(0,Ee.Z)(wa(P))):_==="offsets"?this.isOffsetStatic(P)?r.push(-P[0],P[1]):r.push(0,0):r.push(vo()(P)?P:1):this.patchMod(r,E)}}catch(I){u.e(I)}finally{u.f()}}},{key:"calDataFrame",value:function(r,i,o){for(var u=i.length,v=Math.ceil(u*r/this.DATA_TEXTURE_WIDTH),y=v*this.DATA_TEXTURE_WIDTH,_=[],E=0;E<u;E++){var P=i[E];this.patchData(_,P,o)}for(var I=_.length;I<y;I++)_.push(-1);return{data:_,width:this.DATA_TEXTURE_WIDTH,height:v}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),i=r.blend,o=i===void 0?"normal":i;return sg[$c[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),i=r.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),yg=kn(Dv.prototype,"configService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=kn(Dv.prototype,"shaderModuleService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv),dE=$(83628),kf=$.n(dE),bg=100,aP=36,oP=40;function Eg(e){return e/180*Math.acos(-1)}function Sg(e){var n=Eg(e[0])+Math.PI/2,r=Eg(e[1]),i=bg+Math.random()*.4,o=i*Math.cos(r)*Math.cos(n),u=i*Math.cos(r)*Math.sin(n),v=i*Math.sin(r);return[u,v,o]}function sP(e,n){var r=mat4.create(),i=mat4.create(),o=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);n=n||{},e=typeof e!="undefined"?e:1;for(var v=typeof n.segments!="undefined"?n.segments:32,y=2+v,_=2*y,E=[],P=[],I=[],k=[],B=[],q=[],ee=0;ee<=y;ee++){for(var se=ee/y,De=se*Math.PI,Je=0;Je<=_;Je++){var ht=Je/_,gt=ht*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-De),mat4.identity(r),mat4.rotateY(r,r,gt),vec3.transformMat4(u,o,i),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),I.push(u.slice()),k.push.apply(k,_toConsumableArray(u.slice())),vec3.normalize(u,u),B.push.apply(B,_toConsumableArray(u.slice())),q.push([ht,1-se]),k.push(ht,1-se)}if(ee>0)for(var Nt=I.length,Vt=Nt-2*(_+1);Vt+_+2<Nt;Vt++)E.push([Vt,Vt+1,Vt+_+1]),P.push(Vt,Vt+1,Vt+_+1),E.push([Vt+_+1,Vt+1,Vt+_+2]),P.push(Vt+_+1,Vt+1,Vt+_+2)}return{cells:E,positions:I,uvs:q,positionsArr:k,indicesArr:P,normalArr:B}}var ki=$(7124),Fv=ki.create(),uP=ki.create(),Bu=ki.create(),ld=ki.create(),Nv=ki.create();function wg(e,n,r,i,o){ki.add(e,r,i),ki.normalize(e,e),n=ki.fromValues(-e[1],e[0]);var u=ki.fromValues(-r[1],r[0]);return[o/ki.dot(n,u),n]}function cd(e,n){return ki.set(e,-n[1],n[0])}function Bv(e,n,r){return ki.sub(e,n,r),ki.normalize(e,e),e}function Cg(e,n){return e[0]===n[0]&&e[1]===n[1]}function lP(e){for(var n=new Map,r=0;r<e.length;r++){var i=e[0].toString()+"-"+e[1].toString();n.get(i)?(e.splice(r,1),r++):n.set(i,i)}return e}var vE=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,_t.Z)(this,e),(0,C.Z)(this,"complex",void 0),(0,C.Z)(this,"join",void 0),(0,C.Z)(this,"cap",void 0),(0,C.Z)(this,"miterLimit",void 0),(0,C.Z)(this,"thickness",void 0),(0,C.Z)(this,"normal",void 0),(0,C.Z)(this,"lastFlip",-1),(0,C.Z)(this,"miter",ki.fromValues(0,0)),(0,C.Z)(this,"started",!1),(0,C.Z)(this,"dash",!1),(0,C.Z)(this,"totalDistance",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,jt.Z)(e,[{key:"extrude_gaode2",value:function(r,i){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var u=r.length,v=o.startIndex,y=1;y<u;y++){var _=r[y-1],E=i[y-1],P=r[y],I=i[y],k=y<r.length-1?r[y+1]:null,B=y<i.length-1?i[y+1]:null,q=this.segment_gaode2(o,v,_,P,k,E,I,B);v+=q}if(this.dash)for(var ee=0;ee<o.positions.length/6;ee++)o.positions[ee*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=i.startIndex,v=1;v<o;v++){var y=r[v-1],_=r[v],E=v<r.length-1?r[v+1]:null,P=this.segment(i,u,y,_,E);u+=P}if(this.dash)for(var I=0;I<i.positions.length/6;I++)i.positions[I*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(r,i,o,u,v,y,_,E){var P=0,I=r.indices,k=r.positions,B=r.normals,q=this.cap==="square",ee=this.join==="bevel",se=Ns([_[0],_[1]]),De=Ns([y[0],y[1]]);Bv(Bu,u,o);var Je=0;if(this.dash&&(Je=this.lineSegmentDistance(se,De),this.totalDistance+=Je),this.normal||(this.normal=ki.create(),cd(this.normal,Bu)),!this.started)if(this.started=!0,q){var ht=ki.create(),gt=ki.create();ki.add(ht,this.normal,Bu),ki.add(gt,this.normal,Bu),B.push(gt[0],gt[1],0),B.push(ht[0],ht[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance-Je,-this.thickness,o[2]|0),k.push(o[0],o[1],o[2]|0,this.totalDistance-Je,this.thickness,o[2]|0)}else this.extrusions(k,B,o,this.normal,this.thickness,this.totalDistance-Je);if(I.push(i+0,i+1,i+2),v){Cg(u,v)&&ki.add(v,u,ki.normalize(v,ki.subtract(v,u,o))),Bv(ld,v,u);var nr=wg(Nv,ki.create(),Bu,ld,this.thickness),dr=(0,Pn.Z)(nr,2),Jr=dr[0],ln=dr[1],Er=ki.dot(Nv,this.normal)<0?-1:1,In=ee;if(!In&&this.join==="miter"){var Vn=Jr;Vn>this.miterLimit&&(In=!0)}In?(B.push(this.normal[0],this.normal[1],0),B.push(ln[0],ln[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Er,u[2]|0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*Er,u[2]|0),I.push.apply(I,(0,Ee.Z)(this.lastFlip!==-Er?[i,i+2,i+3]:[i+2,i+1,i+3])),I.push(i+2,i+3,i+4),cd(Fv,ld),ki.copy(this.normal,Fv),B.push(this.normal[0],this.normal[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Er,u[2]|0),P+=3):(this.extrusions(k,B,u,ln,Jr,this.totalDistance),I.push.apply(I,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Er=-1,ki.copy(this.normal,ln),P+=2),this.lastFlip=Er}else{if(cd(this.normal,Bu),q){var Nt=ki.create(),Vt=ki.create();ki.sub(Vt,Bu,this.normal),ki.add(Nt,Bu,this.normal),B.push(Vt[0],Vt[1],0),B.push(Nt[0],Nt[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(k,B,u,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),P+=2}return P}},{key:"segment",value:function(r,i,o,u,v){var y=0,_=r.indices,E=r.positions,P=r.normals,I=this.cap==="square",k=this.join==="bevel",B=Ns([u[0],u[1]]),q=Ns([o[0],o[1]]);Bv(Bu,B,q);var ee=0;if(this.dash&&(ee=this.lineSegmentDistance(B,q),this.totalDistance+=ee),this.normal||(this.normal=ki.create(),cd(this.normal,Bu)),!this.started)if(this.started=!0,I){var se=ki.create(),De=ki.create();ki.add(se,this.normal,Bu),ki.add(De,this.normal,Bu),P.push(De[0],De[1],0),P.push(se[0],se[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance-ee,-this.thickness,o[2]|0),E.push(o[0],o[1],o[2]|0,this.totalDistance-ee,this.thickness,o[2]|0)}else this.extrusions(E,P,o,this.normal,this.thickness,this.totalDistance-ee);if(_.push(i+0,i+1,i+2),v){var gt=Ns([v[0],v[1]]);Cg(B,gt)&&ki.add(gt,B,ki.normalize(gt,ki.subtract(gt,B,q))),Bv(ld,gt,B);var Nt=wg(Nv,ki.create(),Bu,ld,this.thickness),Vt=(0,Pn.Z)(Nt,2),nr=Vt[0],dr=Vt[1],Jr=ki.dot(Nv,this.normal)<0?-1:1,ln=k;if(!ln&&this.join==="miter"){var Er=nr;Er>this.miterLimit&&(ln=!0)}ln?(P.push(this.normal[0],this.normal[1],0),P.push(dr[0],dr[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Jr,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*Jr,u[2]|0),_.push.apply(_,(0,Ee.Z)(this.lastFlip!==-Jr?[i,i+2,i+3]:[i+2,i+1,i+3])),_.push(i+2,i+3,i+4),cd(Fv,ld),ki.copy(this.normal,Fv),P.push(this.normal[0],this.normal[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Jr,u[2]|0),y+=3):(this.extrusions(E,P,u,dr,nr,this.totalDistance),_.push.apply(_,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Jr=-1,ki.copy(this.normal,dr),y+=2),this.lastFlip=Jr}else{if(cd(this.normal,Bu),I){var Je=ki.create(),ht=ki.create();ki.sub(ht,Bu,this.normal),ki.add(Je,Bu,this.normal),P.push(ht[0],ht[1],0),P.push(Je[0],Je[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(E,P,u,this.normal,this.thickness,this.totalDistance);_.push.apply(_,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),y+=2}return y}},{key:"extrusions",value:function(r,i,o,u,v,y){i.push(u[0],u[1],0),i.push(u[0],u[1],0),r.push(o[0],o[1],o[2]|0,y,-v,o[2]|0),r.push(o[0],o[1],o[2]|0,y,v,o[2]|0)}},{key:"lineSegmentDistance",value:function(r,i){var o=i[0]-r[0],u=i[1]-r[1];return Math.sqrt(o*o+u*u)}}]),e}();function Ip(e){if(vo()(e[0]))return e;if(vo()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(vo()(e[0][0][0])){var n=e,r=0,i=0,o=0;return n.forEach(function(u){u.forEach(function(v){r+=v[0],i+=v[1],o++})}),[r/o,i/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function mE(e){for(var n=e[0],r=e[1],i=e[0],o=e[1],u=0,v=0,y=0,_=0;_<e.length;_+=2){var E=e[_],P=e[_+1];E&&P&&(n=Math.max(E,n),r=Math.max(P,r),i=Math.min(E,i),o=Math.min(P,o),u+=E,v+=P,y++)}return{center:[u/y,v/y],radius:Math.sqrt(Math.pow(n-i,2)+Math.pow(r-o,2))/2}}var ja=$(92541);function gE(e){var n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=kf().flatten(e),u=o.vertices,v=o.dimensions,y=[],_=[],E=0;E<u.length/v;E++)v===2?y.push(u[E*2],u[E*2+1],1):y.push(u[E*3],u[E*3+1],1);var P=kf()(o.vertices,o.holes,o.dimensions);_.push.apply(_,(0,Ee.Z)(P));for(var I=function(q){var ee=o.vertices.slice(q*v,(q+1)*v),se=o.vertices.slice((q+1)*v,(q+2)*v);se.length===0&&(se=o.vertices.slice(0,v));var De=y.length/3;y.push(ee[0],ee[1],1,se[0],se[1],1,ee[0],ee[1],0,se[0],se[1],0),_.push.apply(_,(0,Ee.Z)([0,2,1,2,3,1].map(function(Je){return Je+De})))},k=0;k<i;k++)I(k);return{positions:y,index:_}}function yE(e){var n=kf().flatten(e),r=kf()(n.vertices,n.holes,n.dimensions);return{positions:n.vertices,index:r}}function Ag(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,u=kf().flatten(e),v=u.vertices,y=u.dimensions,_=[],E=[],P=[],I=0;I<v.length/y;I++)y===2?_.push(v[I*2],v[I*2+1],1,-1,-1):_.push(v[I*3],v[I*3+1],1,-1,-1),P.push(0,0,1);var k=kf()(u.vertices,u.holes,u.dimensions);E.push.apply(E,(0,Ee.Z)(k));for(var B=function(se){var De=u.vertices.slice(se*y,(se+1)*y),Je=u.vertices.slice((se+1)*y,(se+2)*y);Je.length===0&&(Je=u.vertices.slice(0,y));var ht=_.length/5;_.push(De[0],De[1],1,0,0,Je[0],Je[1],1,.1,0,De[0],De[1],0,0,.8,Je[0],Je[1],0,.1,.8);var gt=_E([Je[0],Je[1],1],[De[0],De[1],0],[De[0],De[1],1],n);P.push.apply(P,(0,Ee.Z)(gt).concat((0,Ee.Z)(gt),(0,Ee.Z)(gt),(0,Ee.Z)(gt))),E.push.apply(E,(0,Ee.Z)([1,2,0,3,2,1].map(function(Nt){return Nt+ht})))},q=0;q<o;q++)B(q);return{positions:_,index:E,normals:P}}function _E(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=ja.create(),u=ja.create(),v=ja.create();i&&(e=Ei(e),n=Ei(n),r=Ei(r));var y=ja.fromValues.apply(ja,(0,Ee.Z)(e)),_=ja.fromValues.apply(ja,(0,Ee.Z)(n)),E=ja.fromValues.apply(ja,(0,Ee.Z)(r));ja.sub(o,E,_),ja.sub(u,y,_),ja.cross(v,o,u);var P=ja.create();return ja.normalize(P,v),P}var Sc,Op;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Op||(Op={}));var Rp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Rp||(Rp={}));function Yd(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,i=[],o=0;o<e;o++)i.push(r*o+n*Math.PI/12);var u=i.map(function(v){var y=Math.sin(v+Math.PI/4),_=Math.cos(v+Math.PI/4);return[y,_,0]});return u}function Tg(){return Yd(30)}function Mg(){return Yd(4)}function Pg(){return Yd(3)}function Ig(){return Yd(6,1)}function Og(){return Yd(5)}var fd=(Sc={},(0,C.Z)(Sc,Rp.CIRCLE,Tg),(0,C.Z)(Sc,Rp.HEXAGON,Ig),(0,C.Z)(Sc,Rp.TRIANGLE,Pg),(0,C.Z)(Sc,Rp.SQUARE,Mg),(0,C.Z)(Sc,Rp.PENTAGON,Og),(0,C.Z)(Sc,Op.CYLINDER,Tg),(0,C.Z)(Sc,Op.HEXAGONCOLUMN,Ig),(0,C.Z)(Sc,Op.TRIANGLECOLUMN,Pg),(0,C.Z)(Sc,Op.SQUARECOLUMN,Mg),(0,C.Z)(Sc,Op.PENTAGONCOLUMN,Og),Sc),zv={};function Rg(e){var n=Ip(e.coordinates);return{vertices:[].concat((0,Ee.Z)(n),(0,Ee.Z)(n),(0,Ee.Z)(n),(0,Ee.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function xE(e){var n=Ip(e.coordinates),r=Sg(n);return{vertices:[].concat((0,Ee.Z)(r),(0,Ee.Z)(r),(0,Ee.Z)(r),(0,Ee.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Lg(e){var n=e.shape,r=AE(n,!1),i=r.positions,o=r.index,u=r.normals;return{vertices:i,indices:o,normals:u,size:5}}function kg(e){var n=Ip(e.coordinates);return{vertices:(0,Ee.Z)(n),indices:[0],size:n.length}}function bE(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,o=new vE({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var u=n;Array.isArray(u[0][0])||(u=[n]);var v=r;Array.isArray(v[0][0])||(v=[r]);for(var y=0;y<u.length;y++){var _=u[y],E=v[y];o.extrude_gaode2(_,E)}}else{var P=n;Array.isArray(P[0][0])||(P=[n]),P.forEach(function(k){o.extrude(k)})}var I=o.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function EE(e){var n=e.coordinates,r=kf().flatten(n),i=r.vertices,o=r.dimensions,u=r.holes;return{indices:kf()(i,u,o),vertices:i,size:o}}function SE(e){var n=e.coordinates,r=kf().flatten(n),i=r.vertices,o=r.dimensions,u=r.holes;return{indices:kf()(i,u,o),vertices:wE(i),size:o+4}}function wE(e){for(var n=[],r=mE(e),i=r.center,o=r.radius,u=0;u<e.length;u+=2){var v=e[u],y=e[u+1];n.push.apply(n,[v,y,0].concat((0,Ee.Z)(i),[o]))}return n}function Dg(e){var n=e.coordinates,r=Ag(n,!0),i=r.positions,o=r.index,u=r.normals;return{vertices:i,indices:o,normals:u,size:5}}function Fg(e){var n=e.shape,r=ME(n),i=r.positions,o=r.index;return{vertices:i,indices:o,size:3}}function Ng(e){var n=e.coordinates,r=[].concat((0,Ee.Z)(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],(0,Ee.Z)(n[1]),[0,1,0],(0,Ee.Z)(n[0]),[0,0,1],(0,Ee.Z)(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:r,indices:i,size:5}}function Uv(e,n){for(var r=n||30,i=e.coordinates,o=[],u=[],v=function(E){o.push(E,1,E,i[0][0],i[0][1],i[1][0],i[1][1],E,-1,E,i[0][0],i[0][1],i[1][0],i[1][1]),E!==r-1&&u.push.apply(u,(0,Ee.Z)([0,1,2,1,3,2].map(function(P){return E*2+P})))},y=0;y<r;y++)v(y);return{vertices:o,indices:u,size:7}}function CE(e){var n=e.coordinates;n.length===2&&n.push(0);var r=e.size,i=Zv(-1,1),o=Zv(1,1),u=Zv(-1,-1),v=Zv(1,-1),y=[].concat((0,Ee.Z)(n),(0,Ee.Z)(i),(0,Ee.Z)(n),(0,Ee.Z)(u),(0,Ee.Z)(n),(0,Ee.Z)(v),(0,Ee.Z)(n),(0,Ee.Z)(o)),_=[0,1,2,3,0,2];return{vertices:y,indices:_,size:5}}function AE(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zv&&zv[e])return zv[e];var r=fd[e]?fd[e]():fd.cylinder(),i=Ag([r],n);return zv[e]=i,i}function cP(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),u,v,y,_=vec3.create(),E=vec3.create(),P=vec3.create(),I=0,k=n.length;I<k;I+=3){u=n[I+0]*3,v=n[I+1]*3,y=n[I+2]*3;var B=[e[u],e[u+1]],q=[e[v],e[v+1]],ee=[e[y],e[y+1]];i&&(B=lngLatToMeters(B),q=lngLatToMeters(q),ee=lngLatToMeters(ee));var se=B,De=_slicedToArray(se,2),Je=De[0],ht=De[1],gt=vec3.fromValues(Je,ht,e[u+2]),Nt=q,Vt=_slicedToArray(Nt,2),nr=Vt[0],dr=Vt[1],Jr=vec3.fromValues(nr,dr,e[v+2]),ln=ee,Er=_slicedToArray(ln,2),In=Er[0],Vn=Er[1],pi=vec3.fromValues(In,Vn,e[y+2]);vec3.sub(_,pi,Jr),vec3.sub(E,gt,Jr),vec3.cross(P,_,E),o[u]+=_[0],o[u+1]+=_[1],o[u+2]+=_[2],o[v]+=_[0],o[v+1]+=_[1],o[v+2]+=_[2],o[y]+=_[0],o[y+1]+=_[1],o[y+2]+=_[2]}return TE(o),o}function TE(e){for(var n=0,r=e.length;n<r;n+=3){var i=vec3.fromValues(e[n],e[n+1],e[n+2]),o=vec3.create();vec3.normalize(o,i),e.set(o,n)}}function fP(e){var n=e[0][0],r=e[0][e[0].length-1];return n[0]===r[0]&&n[1]===r[1]}function ME(e){var n=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=fd[e]?fd[e]():fd.circle(),i=n.indexOf(e)===-1?yE([r]):gE([r]);return i}function Zv(e,n){var r=(e+1)/2,i=(n+1)/2;return[r,i]}function hP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function pP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function PE(e){var n=IE();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,RE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,LE=function(e){(0,Hr.Z)(r,e);var n=PE(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.baseColor,_=y===void 0?"rgb(16,16,16)":y,E=o.brightColor,P=E===void 0?"rgb(255,176,38)":E,I=o.windowColor,k=I===void 0?"rgb(30,60,89)":I,B=o.time,q=B===void 0?0:B;return{u_opacity:v,u_baseColor:wa(_),u_brightColor:wa(P),u_windowColor:wa(k),u_time:this.layer.getLayerAnimateTime()||q}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:RE,fragmentShader:OE,triangulation:Dg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(u,v,y,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(u,v,y,_){var E=u.size;return[y[3],y[4]]}}})}}]),r}(js);function kE(e){var n=DE();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function DE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FE=function(e){(0,Hr.Z)(r,e);var n=kE(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","PolygonLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new LE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Pp);function NE(e){var n=BE();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function BE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,UE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZE=function(e){(0,Hr.Z)(r,e);var n=NE(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.coverage,y=o.angle;return{u_opacity:u||1,u_coverage:v||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:zE,fragmentShader:UE,triangulation:Fg,depth:{enable:!1},primitive:p.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(u,v){var y=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[y[0],y[1],0]}}})}}]),r}(js);function VE(e){var n=jE();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,HE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,WE=function(e){(0,Hr.Z)(r,e);var n=VE(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.coverage,y=o.angle;return{u_opacity:u||1,u_coverage:v||1,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:GE,fragmentShader:HE,triangulation:Lg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(u,v,y,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(u,v){var y=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[y[0],y[1],0]}}})}}]),r}(js);function XE(e,n){for(var r=[],i=[],o=[],u=e+1,v=n+1,y=e/2,_=n/2,E=0;E<v;E++)for(var P=E-_,I=0;I<u;I++){var k=I-y;i.push(k/y,-P/_,0),o.push(I/e),o.push(1-E/n)}for(var B=0;B<n;B++)for(var q=0;q<e;q++){var ee=q+u*B,se=q+u*(B+1),De=q+1+u*(B+1),Je=q+1+u*B;r.push(ee,se,Je),r.push(se,De,Je)}return{vertices:i,indices:r,uvs:o}}var Bg,zg;function Ug(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Zg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ug(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ug(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function YE(e){var n=qE();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,$E=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,QE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,JE=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,e2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,t2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Vg=(Bg=(0,Rr.b2)(),Bg(zg=function(e){(0,Hr.Z)(r,e);var n=YE(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"colorTexture",void 0),(0,C.Z)((0,ye.Z)(i),"heatmapFramerBuffer",void 0),(0,C.Z)((0,ye.Z)(i),"intensityModel",void 0),(0,C.Z)((0,ye.Z)(i),"colorModel",void 0),(0,C.Z)((0,ye.Z)(i),"shapeType",void 0),i}return(0,jt.Z)(r,[{key:"render",value:function(){var o=this,u=this.rendererService,v=u.clear,y=u.useFramebuffer;y(this.heatmapFramerBuffer,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,u=this.rendererService,v=u.createFramebuffer,y=u.clear,_=u.getViewportSize,E=u.createTexture2D,P=u.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),k=(I==null||(o=I.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=k,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=k==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var B=_(),q=B.width,ee=B.height;return this.heatmapFramerBuffer=v({color:E({width:Math.floor(q/4),height:Math.floor(ee/4),wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE,min:p.LINEAR,mag:p.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:wi.Attribute,descriptor:{name:"a_Dir",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(u,v,y,_){return[y[3],y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size,P=E===void 0?1:E;return[P]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:e2,fragmentShader:JE,triangulation:CE,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:p.ONE,srcAlpha:1,dstRGB:p.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:t2,fs:QE});var o=this.shaderModuleService.getModule("heatmapColor"),u=o.vs,v=o.fs,y=o.uniforms,_=this.rendererService,E=_.createAttribute,P=_.createElements,I=_.createBuffer,k=_.createModel;return k({vs:u,fs:v,attributes:{a_Position:E({buffer:I({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:p.FLOAT}),size:3}),a_Uv:E({buffer:I({data:[0,1,1,1,0,0,1,0],type:p.FLOAT}),size:2})},uniforms:Zg({},y),depth:{enable:!1},blend:this.getBlend(),count:6,elements:P({data:[0,2,1,2,3,1],type:p.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.intensity,y=v===void 0?10:v,_=o.radius,E=_===void 0?5:_;this.intensityModel.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:y}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=_u();Qu(v,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ee.Z)(v)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,u=o(),v=u.width,y=u.height,_=XE(v/4,y/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:$E,fs:KE});var E=this.shaderModuleService.getModule("heatmap3dColor"),P=E.vs,I=E.fs,k=E.uniforms,B=this.rendererService,q=B.createAttribute,ee=B.createElements,se=B.createBuffer,De=B.createModel;return De({vs:P,fs:I,attributes:{a_Position:q({buffer:se({data:_.vertices,type:p.FLOAT}),size:3}),a_Uv:q({buffer:se({data:_.uvs,type:p.FLOAT}),size:2})},primitive:p.TRIANGLES,uniforms:Zg({},k),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:p.SRC_ALPHA,srcAlpha:1,dstRGB:p.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ee({data:_.indices,type:p.UNSIGNED_INT,count:_.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var u=this.layer.getLayerConfig(),v=u.rampColors,y=na(v);this.colorTexture=o({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:p.CLAMP_TO_EDGE,wrapT:p.CLAMP_TO_EDGE,min:p.NEAREST,mag:p.NEAREST,flipY:!1})}}]),r}(js))||zg);function r2(e){var n=n2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,a2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,o2=function(e){(0,Hr.Z)(r,e);var n=r2(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.coverage,y=o.angle;return{u_opacity:u||1,u_coverage:v||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:a2,fragmentShader:i2,triangulation:Fg,depth:{enable:!1},primitive:p.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(u,v){var y=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[y[0],y[1],0]}}})}}]),r}(js),s2={heatmap:Vg,heatmap3d:Vg,grid:ZE,grid3d:WE,hexagon:o2},u2=s2;function l2(e){var n=c2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function c2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f2=function(e){(0,Hr.Z)(r,e);var n=l2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","HeatMapLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new u2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(v){return v.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),v=this.getLayerConfig(),y=v.shape3d,_=this.getSource(),E=_.data.type,P=(u==null||(o=u.scale)===null||o===void 0?void 0:o.field)||"heatmap";return P==="heatmap"||P==="heatmap3d"?"heatmap":E==="hexagon"?(y==null?void 0:y.indexOf(P))===-1?"hexagon":"grid3d":E==="grid"?(y==null?void 0:y.indexOf(P))===-1?"grid":"grid3d":"heatmap"}}]),r}(Pp);function h2(e){var n=p2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,v2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,m2=function(e){(0,Hr.Z)(r,e);var n=h2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,u=this.layer.getSource(),v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),Wi){var y=this.layerService.sceneService.getSceneConfig().canvas,_=y.createImage();_.crossOrigin="anonymous",_.src=u.data.originData,_.onload=function(){o.texture=v({data:_,width:_.width,height:_.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else u.data.images.then(function(E){o.texture=v({data:E[0],width:E[0].width,height:E[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:v2,fragmentShader:d2,triangulation:Ng,primitive:p.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(u,v,y,_){return[y[3],y[4]]}}})}}]),r}(js),g2={image:m2},y2=g2;function _2(e){var n=x2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function x2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b2=function(e){(0,Hr.Z)(r,e);var n=_2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","ImageLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new y2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={image:{}};return u[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Pp);function E2(e){var n=S2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,C2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,A2={solid:0,dash:1},T2=function(e){(0,Hr.Z)(r,e);var n=E2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:p.NEAREST,min:p.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5]:k,q=o.forward,ee=q===void 0?!0:q,se=o.lineTexture,De=se===void 0?!1:se,Je=o.iconStep,ht=Je===void 0?100:Je,gt=o.segmentNumber,Nt=gt===void 0?30:gt,Vt=o.thetaOffset,nr=Vt===void 0?.314:Vt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var dr=this.layer.getEncodedData(),Jr=this.calDataFrame(this.cellLength,dr,this.cellProperties),ln=Jr.data,Er=Jr.width,In=Jr.height;this.rowCount=In,this.dataTexture=this.cellLength>0&&ln.length>0?this.createTexture2D({flipY:!0,data:ln,format:p.LUMINANCE,type:p.FLOAT,width:Er,height:In}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}B.length===2&&B.push(0,0);var Vn=0,pi=[0,0,0,0],Ro=[0,0,0,0];return v&&y&&(pi=wa(v),Ro=wa(y),Vn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:nr,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Nt,u_line_type:A2[I||"solid"],u_dash_array:B,u_blur:.9,u_lineDir:ee?1:-1,u_texture:this.texture,u_line_texture:De?1:0,u_icon_step:ht,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vn,u_sourceColor:pi,u_targetColor:Ro}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,v=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:C2,fragmentShader:w2,triangulation:Uv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(v,y,_,E){var P=v.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:4,update:function(v,y,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(v,y,_,E){var P=o.iconService.getIconMap(),I=v.texture,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(js);function M2(e){var n=P2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function P2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,O2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,R2={solid:0,dash:1},L2=function(e){(0,Hr.Z)(r,e);var n=M2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:p.NEAREST,min:p.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5]:k,q=o.lineTexture,ee=q===void 0?!1:q,se=o.iconStep,De=se===void 0?100:se,Je=o.segmentNumber,ht=Je===void 0?30:Je,gt=o.globalArcHeight,Nt=gt===void 0?10:gt;B.length===2&&B.push(0,0);var Vt=0,nr=[0,0,0,0],dr=[0,0,0,0];if(v&&y&&(nr=wa(v),dr=wa(y),Vt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Jr=this.layer.getEncodedData(),ln=this.calDataFrame(this.cellLength,Jr,this.cellProperties),Er=ln.data,In=ln.width,Vn=ln.height;this.rowCount=Vn,this.dataTexture=this.cellLength>0&&Er.length>0?this.createTexture2D({flipY:!0,data:Er,format:p.LUMINANCE,type:p.FLOAT,width:In,height:Vn}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:bg,u_global_height:Nt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:ht,u_line_type:R2[I]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:ee?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vt,u_sourceColor:nr,u_targetColor:dr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,v=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:O2,fragmentShader:I2,triangulation:Uv,blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(v,y,_,E){var P=v.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:4,update:function(v,y,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(v,y,_,E){var P=o.iconService.getIconMap(),I=v.texture,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(js);function k2(e){var n=D2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F2=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,N2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,B2=function(e){(0,Hr.Z)(r,e);var n=k2(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,_=o.forward,E=_===void 0?!0:_,P=o.segmentNumber,I=P===void 0?30:P,k=o.thetaOffset,B=k===void 0?.314:k,q=0,ee=[0,0,0,0],se=[0,0,0,0];return v&&y&&(ee=wa(v),se=wa(y),q=1),{u_thetaOffset:B,u_opacity:vo()(u)?u:1,segmentNumber:I,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:q,u_sourceColor:ee,u_targetColor:se}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,v=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:N2,fragmentShader:F2,triangulation:Uv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:4,update:function(u,v,y,_){return[y[3],y[4],y[5],y[6]]}}})}}]),r}(js);function z2(e){var n=U2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,V2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,j2={solid:0,dash:1},G2=function(e){(0,Hr.Z)(r,e);var n=z2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:p.NEAREST,min:p.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5]:k,q=o.lineTexture,ee=q===void 0?!1:q,se=o.iconStep,De=se===void 0?100:se,Je=o.segmentNumber,ht=Je===void 0?30:Je;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gt=0,Nt=[0,0,0,0],Vt=[0,0,0,0];if(v&&y&&(Nt=wa(v),Vt=wa(y),gt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var nr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,nr,this.cellProperties),Jr=dr.data,ln=dr.width,Er=dr.height;this.rowCount=Er,this.dataTexture=this.cellLength>0&&Jr.length>0?this.createTexture2D({flipY:!0,data:Jr,format:p.LUMINANCE,type:p.FLOAT,width:ln,height:Er}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:ht,u_line_type:j2[I]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:ee?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:gt,u_sourceColor:Nt,u_targetColor:Vt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:V2,fragmentShader:Z2,triangulation:Uv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(v,y,_,E){var P=v.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:4,update:function(v,y,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(v,y,_,E){var P=o.iconService.getIconMap(),I=v.texture,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(js);function H2(e){var n=W2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function W2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
// varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = (vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
    // gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Y2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float((a_Position.z)) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,q2={solid:0,dash:1},jg=function(e){(0,Hr.Z)(r,e);var n=H2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:p.NEAREST,min:p.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5,0,0]:k,q=o.lineTexture,ee=q===void 0?!1:q,se=o.iconStep,De=se===void 0?100:se,Je=o.vertexHeightScale,ht=Je===void 0?20:Je;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gt=0,Nt=[0,0,0,0],Vt=[0,0,0,0];if(v&&y&&(Nt=wa(v),Vt=wa(y),gt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var nr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,nr,this.cellProperties),Jr=dr.data,ln=dr.width,Er=dr.height;this.rowCount=Er,this.dataTexture=this.cellLength>0&&Jr.length>0?this.createTexture2D({flipY:!0,data:Jr,format:p.LUMINANCE,type:p.FLOAT,width:ln,height:Er}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(u)?u:1,u_textureBlend:E==="normal"?0:1,u_line_type:q2[I],u_dash_array:B,u_texture:this.texture,u_line_texture:ee?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:gt,u_sourceColor:Nt,u_targetColor:Vt,u_vertexScale:ht}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Y2,fragmentShader:X2,triangulation:bE,primitive:p.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),v=u.lineType,y=v===void 0?"solid":v;this.styleAttributeService.registerStyleAttribute({name:"distance",type:wi.Attribute,descriptor:{name:"a_Distance",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(E,P,I,k){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wi.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(E,P,I,k){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(E,P,I,k){var B=E.size,q=B===void 0?1:B;return Array.isArray(q)?[q[0],q[1]]:[q,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(E,P,I,k,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wi.Attribute,descriptor:{name:"a_Miter",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(E,P,I,k){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(E,P,I,k){var B=o.iconService.getIconMap(),q=E.texture,ee=B[q]||{x:0,y:0},se=ee.x,De=ee.y;return[se,De]}}})}},{key:"loadImage",value:function(o){return new Promise(function(u,v){if(o instanceof HTMLImageElement){u(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){u(y)},y.onerror=function(){v(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(js),K2={arc:T2,arcmini:B2,arc3d:L2,greatcircle:G2,line:jg},$2=K2;function Q2(e){var n=J2();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function J2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eS=function(e){(0,Hr.Z)(r,e);var n=Q2(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","LineLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new $2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return u[o]}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),v=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return v||"line"}}]),r}(Pp);function tS(e){var n=rS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,iS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Gg=function(e){(0,Hr.Z)(r,e);var n=tS(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.sourceColor,_=o.targetColor,E=o.opacityLinear,P=E===void 0?{enable:!1,dir:"up"}:E,I=o.lightEnable,k=I===void 0?!0:I;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var B=this.layer.getEncodedData(),q=this.calDataFrame(this.cellLength,B,this.cellProperties),ee=q.data,se=q.width,De=q.height;this.rowCount=De,this.dataTexture=this.cellLength>0&&ee.length>0?this.createTexture2D({flipY:!0,data:ee,format:p.LUMINANCE,type:p.FLOAT,width:se,height:De}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}var Je=0,ht=[0,0,0,0],gt=[0,0,0,0];return y&&_&&(ht=wa(y),gt=wa(_),Je=1),{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(v)?v:1,u_linearColor:Je,u_sourceColor:ht,u_targetColor:gt,u_opacitylinear:Number(P.enable),u_opacitylinear_dir:P.dir==="up"?1:0,u_lightEnable:Number(k)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.depth,v=u===void 0?!0:u;return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:iS,fragmentShader:nS,triangulation:Lg,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?p.FRONT:p.BACK},depth:{enable:v}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(v,y,_,E){var P=v.size;if(P){var I=[];return Array.isArray(P)&&(I=P.length===2?[P[0],P[0],P[1]]:P),Array.isArray(P)||(I=[P,P,P]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(v,y,_,E,P){return P}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(v,y){var _=Ip(v.coordinates);return o?Sg([_[0],_[1]]):[_[0],_[1],0]}}})}}]),r}(js);function aS(e){var n=oS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function oS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sS=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }
  }
  
  gl_FragColor = filterColor(gl_FragColor);
  gl_FragColor.rgb *= gl_FragColor.a;
  
}
`,uS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Hg=function(e){(0,Hr.Z)(r,e);var n=aS(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.strokeOpacity,_=y===void 0?1:y,E=o.strokeWidth,P=E===void 0?0:E,I=o.stroke,k=I===void 0?"rgba(0,0,0,0)":I,B=o.offsets,q=B===void 0?[0,0]:B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeOpacity:_,strokeWidth:P,stroke:k,offsets:q})){this.judgeStyleAttributes({opacity:v,strokeOpacity:_,strokeWidth:P,stroke:k,offsets:q});var ee=this.layer.getEncodedData(),se=this.calDataFrame(this.cellLength,ee,this.cellProperties),De=se.data,Je=se.width,ht=se.height;this.rowCount=ht,this.dataTexture=this.cellLength>0&&De.length>0?this.createTexture2D({flipY:!0,data:De,format:p.LUMINANCE,type:p.FLOAT,width:Je,height:ht}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(v)?v:1,u_stroke_opacity:vo()(_)?_:1,u_stroke_width:vo()(P)?P:0,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(q)?q:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Rg)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:uS,fragmentShader:sS,triangulation:o?xE:Rg,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wi.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(y,_,E,P){var I;if(u){var k=(0,Pn.Z)(E,3),B=k[0],q=k[1],ee=k[2],se=ja.fromValues(0,0,1),De=ja.fromValues(B,0,ee),Je=B>=0?ja.angle(se,De):Math.PI*2-ja.angle(se,De),ht=Math.PI*2-Math.asin(q/100),gt=_u();Os(gt,gt,Je),so(gt,gt,ht);var Nt=ja.fromValues(1,1,0);ja.transformMat4(Nt,Nt,gt),ja.normalize(Nt,Nt);var Vt=ja.fromValues(-1,1,0);ja.transformMat4(Vt,Vt,gt),ja.normalize(Vt,Vt);var nr=ja.fromValues(-1,-1,0);ja.transformMat4(nr,nr,gt),ja.normalize(nr,nr);var dr=ja.fromValues(1,-1,0);ja.transformMat4(dr,dr,gt),ja.normalize(dr,dr),I=[].concat((0,Ee.Z)(Nt),(0,Ee.Z)(Vt),(0,Ee.Z)(nr),(0,Ee.Z)(dr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Jr=P%4*3;return[I[Jr],I[Jr+1],I[Jr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(y,_,E,P){var I=y.size,k=I===void 0?5:I;return Array.isArray(k)?[k[0]]:[k]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:wi.Attribute,descriptor:{name:"a_Shape",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(y,_,E,P){var I=y.shape,k=I===void 0?2:I,B=o.layer.getLayerConfig().shape2d,q=B.indexOf(k);return[q]}}})}}]),r}(js);function lS(e){var n=cS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function cS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,hS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,pS=function(e){(0,Hr.Z)(r,e);var n=lS(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:hS,fragmentShader:fS,triangulation:kg,primitive:p.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(v,y,_,E){var P=v.size;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(v,y,_,E){var P=o.fontService.mapping,I=v.shape,k=o.fontService.getGlyph(I),B=P[k],q=B.x,ee=B.y;return[q,ee]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.texture=o({data:u,mag:p.LINEAR,min:p.LINEAR,width:u.width,height:u.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),v=u.fontWeight,y=v===void 0?"normal":v,_=u.fontFamily,E=_===void 0?"sans-serif":_,P=this.layer.getEncodedData(),I=[];P.forEach(function(k){var B=k.shape,q=B===void 0?"":B;q=q.toString();var ee=o.fontService.getGlyph(q);I.indexOf(ee)===-1&&I.push(ee)}),this.fontService.setFontOptions({characterSet:I,fontWeight:y,fontFamily:E,fontSize:48})}}]),r}(js);function dS(e){var n=vS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,gS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Wg=function(e){(0,Hr.Z)(r,e);var n=dS(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.renderLayers();return}i.texture=y({data:i.iconService.getCanvas(),mag:p.LINEAR,min:p.LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.offsets,y=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:y})){this.judgeStyleAttributes({opacity:u,offsets:y});var _=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,_,this.cellProperties),P=E.data,I=E.width,k=E.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:p.LUMINANCE,type:p.FLOAT,width:I,height:k}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:vo()(u)?u:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:gS,fragmentShader:mS,triangulation:kg,primitive:p.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(v,y,_,E){var P=v.size,I=P===void 0?5:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(v,y,_,E){var P=o.iconService.getIconMap(),I=v.shape,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(js);function yS(e){var n=_S();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,bS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function ES(e){var n=e.coordinates;return{vertices:(0,Ee.Z)(n),indices:[0],size:n.length}}var Xg=function(e){(0,Hr.Z)(r,e);var n=yS(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.offsets,_=y===void 0?[0,0]:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:_})){this.judgeStyleAttributes({opacity:v,offsets:_});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,k=P.width,B=P.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:p.LUMINANCE,type:p.FLOAT,width:k,height:B}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(v)?v:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:bS,fragmentShader:xS,triangulation:ES,depth:{enable:!1},primitive:p.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:$c.additive}}}]),r}(js);function SS(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function wS(e,n){if(!!e){if(typeof e=="string")return Yg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yg(e,n)}}function Yg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var CS=function(){function e(n,r,i){(0,_t.Z)(this,e),(0,C.Z)(this,"boxCells",[]),(0,C.Z)(this,"xCellCount",void 0),(0,C.Z)(this,"yCellCount",void 0),(0,C.Z)(this,"boxKeys",void 0),(0,C.Z)(this,"bboxes",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"xScale",void 0),(0,C.Z)(this,"yScale",void 0),(0,C.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(r/i);for(var u=0;u<this.xCellCount*this.yCellCount;u++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=r,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,jt.Z)(e,[{key:"insert",value:function(r,i,o,u,v){this.forEachCell(i,o,u,v,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(v)}},{key:"query",value:function(r,i,o,u,v){return this.queryHitTest(r,i,o,u,!1,v)}},{key:"hitTest",value:function(r,i,o,u,v){return this.queryHitTest(r,i,o,u,!0,v)}},{key:"insertBoxCell",value:function(r,i,o,u,v,y){this.boxCells[v].push(y)}},{key:"queryHitTest",value:function(r,i,o,u,v,y){if(o<0||r>this.width||u<0||i>this.height)return v?!1:[];var _=[];if(r<=0&&i<=0&&this.width<=o&&this.height<=u){if(v)return!0;for(var E=0;E<this.boxKeys.length;E++)_.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return y?_.filter(y):_}var P={hitTest:v,seenUids:{box:{},circle:{}}};return this.forEachCell(r,i,o,u,this.queryCell,_,P,y),v?_.length>0:_}},{key:"queryCell",value:function(r,i,o,u,v,y,_,E){var P=_.seenUids,I=this.boxCells[v];if(I!==null){var k=this.bboxes,B=SS(I),q;try{for(B.s();!(q=B.n()).done;){var ee=q.value;if(!P.box[ee]){P.box[ee]=!0;var se=ee*4;if(r<=k[se+2]&&i<=k[se+3]&&o>=k[se+0]&&u>=k[se+1]&&(!E||E(this.boxKeys[ee]))){if(_.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[ee],x1:k[se],y1:k[se+1],x2:k[se+2],y2:k[se+3]})}}}}catch(De){B.e(De)}finally{B.f()}}return!1}},{key:"forEachCell",value:function(r,i,o,u,v,y,_,E){for(var P=this.convertToXCellCoord(r),I=this.convertToYCellCoord(i),k=this.convertToXCellCoord(o),B=this.convertToYCellCoord(u),q=P;q<=k;q++)for(var ee=I;ee<=B;ee++){var se=this.xCellCount*ee+q;if(v.call(this,r,i,o,u,se,y,_,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),AS=CS,TS=function(){function e(n,r){(0,_t.Z)(this,e),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"grid",void 0),(0,C.Z)(this,"viewportPadding",100),(0,C.Z)(this,"screenRightBoundary",void 0),(0,C.Z)(this,"screenBottomBoundary",void 0),(0,C.Z)(this,"gridRightBoundary",void 0),(0,C.Z)(this,"gridBottomBoundary",void 0),this.width=n,this.height=r,this.viewportPadding=Math.max(n,r),this.grid=new AS(n+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,jt.Z)(e,[{key:"placeCollisionBox",value:function(r){var i=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,u=r.x2+r.anchorPointX+this.viewportPadding,v=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,o,u,v)||this.grid.hitTest(i,o,u,v)?{box:[]}:{box:[i,o,u,v]}}},{key:"insertCollisionBox",value:function(r,i){var o={featureIndex:i};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,i,o){var u=uo(i,o,0,1),v=Co(),y=Wp.apply(Pe,(0,Ee.Z)(r));return xe(v,u,y),{x:(v[0]/v[3]+1)/2*this.width+this.viewportPadding,y:(-v[1]/v[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,i,o,u){return o>=0&&r<this.gridRightBoundary&&u>=0&&i<this.gridBottomBoundary}}]),e}();function qg(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=MS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function MS(e,n){if(!!e){if(typeof e=="string")return Kg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,n)}}function Kg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function $g(e){var n=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:n,verticalAlign:r}}function Qg(e,n,r,i,o){if(!!o){var u=e[i],v=u.glyph;if(v)for(var y=n[v].advance*u.scale,_=(e[i].x+y)*o,E=r;E<=i;E++)e[E].x-=_}}function Jg(e,n,r,i,o,u,v){var y=(n-r)*o,_=(-i*v+.5)*u,E=qg(e),P;try{for(E.s();!(P=E.n()).done;){var I=P.value;I.x+=y,I.y+=_}}catch(k){E.e(k)}finally{E.f()}}function PS(e,n,r,i,o,u,v){var y=-8,_=0,E=y,P=0,I=e.positionedGlyphs,k=u==="right"?1:u==="left"?0:.5,B=I.length;r.forEach(function(Je){if(Je.split("").forEach(function(gt){var Nt=n[gt],Vt=0;Nt&&(I.push({glyph:gt,x:_,y:E+Vt,vertical:!1,scale:1,metrics:Nt}),_+=Nt.advance+v)}),I.length!==B){var ht=_-v;P=Math.max(ht,P),Qg(I,n,B,I.length-1,k)}_=0,E-=i+5});var q=$g(o),ee=q.horizontalAlign,se=q.verticalAlign;Jg(I,k,ee,se,P,i,r.length);var De=E-y;e.top+=-se*De,e.bottom=e.top-De,e.left+=-ee*P,e.right=e.left+P}function IS(e,n,r,i,o,u,v){var y=-8,_=0,E=y,P=0,I=e.positionedGlyphs,k=u==="right"?1:u==="left"?0:.5,B=I.length;r.forEach(function(Je){var ht=n[Je],gt=0;if(ht&&(I.push({glyph:Je,x:_,y:E+gt,vertical:!1,scale:1,metrics:ht}),_+=ht.advance+v),I.length!==B){var Nt=_-v;P=Math.max(Nt,P),Qg(I,n,B,I.length-1,k)}_=0,E-=i+5});var q=$g(o),ee=q.horizontalAlign,se=q.verticalAlign;Jg(I,k,ee,se,P,i,r.length);var De=E-y;e.top+=-se*De,e.bottom=e.top-De,e.left+=-ee*P,e.right=e.left+P}function OS(e,n,r,i,o,u){var v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],y=arguments.length>7?arguments[7]:void 0,_=e.split(`
`),E=[],P={positionedGlyphs:E,top:v[1],bottom:v[1],left:v[0],right:v[0],lineCount:_.length,text:e};return y?IS(P,n,_,r,i,o,u):PS(P,n,_,r,i,o,u),E.length?P:!1}function RS(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=i===void 0?[]:i,u=[],v=qg(o),y;try{for(v.s();!(y=v.n()).done;){var _=y.value,E=_.metrics,P=4,I=E.advance*_.scale/2,k=r?[_.x+I,_.y]:[0,0],B=r?[0,0]:[_.x+I+n[0],_.y+n[1]],q=(0-P)*_.scale-I+B[0],ee=(0-P)*_.scale+B[1],se=q+E.width*_.scale,De=ee+E.height*_.scale,Je={x:q,y:ee},ht={x:se,y:ee},gt={x:q,y:De},Nt={x:se,y:De};u.push({tl:Je,tr:ht,bl:gt,br:Nt,tex:E,glyphOffset:k})}}catch(Vt){v.e(Vt)}finally{v.f()}return u}function LS(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function kS(e,n){if(!!e){if(typeof e=="string")return ey(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,n)}}function ey(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function DS(e){var n=FS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ty=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ry=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ny(e){var n=this,r=e.id,i=[],o=[];if(!n.glyphInfoMap||!n.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var u=n.glyphInfoMap[r].centroid,v=u.length===2?[u[0],u[1],0]:u;return n.glyphInfoMap[r].glyphQuads.forEach(function(y,_){i.push.apply(i,(0,Ee.Z)(v).concat([y.tex.x,y.tex.y+y.tex.height,y.tl.x,y.tl.y],(0,Ee.Z)(v),[y.tex.x+y.tex.width,y.tex.y+y.tex.height,y.tr.x,y.tr.y],(0,Ee.Z)(v),[y.tex.x+y.tex.width,y.tex.y,y.br.x,y.br.y],(0,Ee.Z)(v),[y.tex.x,y.tex.y,y.bl.x,y.bl.y])),o.push(0+_*4,1+_*4,2+_*4,2+_*4,3+_*4,0+_*4)}),{vertices:i,indices:o,size:7}}var iy=function(e){(0,Hr.Z)(r,e);var n=DS(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"glyphInfo",void 0),(0,C.Z)((0,ye.Z)(i),"glyphInfoMap",{}),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"currentZoom",-1),(0,C.Z)((0,ye.Z)(i),"extent",void 0),(0,C.Z)((0,ye.Z)(i),"textureHeight",0),(0,C.Z)((0,ye.Z)(i),"textCount",0),(0,C.Z)((0,ye.Z)(i),"preTextStyle",{}),(0,C.Z)((0,ye.Z)(i),"buildModels",function(){return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind((0,ye.Z)(i)),depth:{enable:!1},blend:i.getBlend()})]}),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.stroke,_=y===void 0?"#fff":y,E=o.strokeWidth,P=E===void 0?0:E,I=o.textAnchor,k=I===void 0?"center":I,B=o.textAllowOverlap,q=B===void 0?!1:B,ee=o.halo,se=ee===void 0?.5:ee,De=o.gamma,Je=De===void 0?2:De,ht=this.fontService,gt=ht.canvas,Nt=ht.mapping;if(Object.keys(Nt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Nt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:q},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeWidth:P,stroke:_})){this.judgeStyleAttributes({opacity:v,strokeWidth:P,stroke:_});var Vt=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,Vt,this.cellProperties),dr=nr.data,Jr=nr.width,ln=nr.height;this.rowCount=ln,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:p.LUMINANCE,type:p.FLOAT,width:Jr,height:ln}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(v)?v:1,u_stroke_width:vo()(P)?P:0,u_stroke_color:this.getStrokeColor(_),u_sdf_map:this.texture,u_halo_blur:se,u_gamma_scale:Je,u_sdf_map_size:[gt.width,gt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,v=u===void 0?"center":u,y=o.textAllowOverlap,_=y===void 0?!0:y;return this.preTextStyle={textAnchor:v,textAllowOverlap:_},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),u=o.textAllowOverlap,v=u===void 0?!1:u,y=this.mapService.getZoom(),_=this.mapService.getBounds(),E=xn(this.extent,_);return!v&&(Math.abs(this.currentZoom-y)>1||!E)||v!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:wi.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.rotate,P=E===void 0?0:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:wi.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(u,v,y,_){return[y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size,P=E===void 0?12:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:wi.Attribute,descriptor:{name:"a_tex",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(u,v,y,_){return[y[3],y[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Tn(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,v=u===void 0?"400":u,y=o.fontFamily,_=y===void 0?"sans-serif":y,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var k=I.shape,B=k===void 0?"":k;B=B.toString();var q=LS(B),ee;try{for(q.s();!(ee=q.n()).done;){var se=ee.value;P.indexOf(se)===-1&&P.push(se)}}catch(De){q.e(De)}finally{q.f()}}),this.fontService.setFontOptions({characterSet:P,fontWeight:v,fontFamily:_,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,v=u===void 0?"400":u,y=o.fontFamily,_=y===void 0?"sans-serif":y,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var k=I.shape,B=k===void 0?"":k;B="".concat(B),P.indexOf(B)===-1&&P.push(B)}),this.fontService.setFontOptions({characterSet:P,fontWeight:v,fontFamily:_,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var u=this,v=this.fontService.mapping,y=this.layer.getLayerConfig(),_=y.spacing,E=_===void 0?2:_,P=y.textAnchor,I=P===void 0?"center":P,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(B){var q=B.shape,ee=q===void 0?"":q,se=B.id,De=B.size,Je=De===void 0?1:De,ht=B.textOffset,gt=ht===void 0?[0,0]:ht,Nt=OS(ee.toString(),v,Je,I,"left",E,gt,o),Vt=RS(Nt,gt,!1);return B.shaping=Nt,B.glyphQuads=Vt,B.centroid=Ip(B.coordinates),B.originCentroid=B.version==="GAODE2.x"?Ip(B.originCoordinates):B.originCentroid=B.centroid,u.glyphInfoMap[se]={shaping:Nt,glyphQuads:Vt,centroid:Ip(B.coordinates)},B})}},{key:"filterGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),v=u.padding,y=v===void 0?[4,4]:v,_=u.textAllowOverlap,E=_===void 0?!1:_;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var P=this.rendererService.getViewportSize(),I=P.width,k=P.height,B=new TS(I,k),q=this.glyphInfo.filter(function(ee){var se=ee.shaping,De=ee.id,Je=De===void 0?0:De,ht=ee.version==="GAODE2.x"?ee.originCentroid:ee.centroid,gt=ee.size,Nt=gt/24,Vt=o.mapService.lngLatToContainer(ht),nr=B.placeCollisionBox({x1:se.left*Nt-y[0],x2:se.right*Nt+y[0],y1:se.top*Nt-y[1],y2:se.bottom*Nt+y[1],anchorPointX:Vt.x,anchorPointY:Vt.y}),dr=nr.box;return dr&&dr.length?(B.insertCollisionBox(dr,Je),!0):!1});q.forEach(function(ee){o.glyphInfoMap[ee.id]=ee})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),u=o.iconfont,v=u===void 0?!1:u;v?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(v)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.textureHeight=u.height,this.texture&&this.texture.destroy(),this.texture=o({data:u,mag:p.LINEAR,min:p.LINEAR,width:u.width,height:u.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(js),NS={fill:Hg,image:Wg,normal:Xg,extrude:Gg,text:iy,icon:pS},BS=NS;function zS(e){var n=US();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZS=function(e){(0,Hr.Z)(r,e);var n=zS(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","PointLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new BS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return u[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),v=u.shape2d,y=u.shape3d,_=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"normal":(v==null?void 0:v.indexOf(P))!==-1?"fill":(y==null?void 0:y.indexOf(P))!==-1?"extrude":_.hasOwnProperty(P)?"image":this.fontService.getGlyph(P)!==""?"icon":"text"}else return"normal"}}]),r}(Pp);function VS(e){var n=jS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function jS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,HS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,WS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,XS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,YS=function(e){(0,Hr.Z)(r,e);var n=VS(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),E=_.data,P=_.width,I=_.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:p.LUMINANCE,type:p.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(v)?v:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.pickLight,v=u===void 0?!1:u;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:v?WS:XS,fragmentShader:v?HS:GS,triangulation:Dg})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(u,v,y,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(u,v,y,_){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}})}}]),r}(js);function qS(e){var n=KS();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,QS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JS=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,ew=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,tw=function(e){(0,Hr.Z)(r,e);var n=qS(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.opacityLinear,_=y===void 0?{enable:!1,dir:"in"}:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,k=P.width,B=P.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:p.LUMINANCE,type:p.FLOAT,width:k,height:B}):this.createTexture2D({flipY:!0,data:[1],format:p.LUMINANCE,type:p.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:vo()(v)?v:1,u_opacitylinear:Number(_.enable),u_dir:_.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,v=u===void 0?{enable:!1,dir:"in"}:u;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:v.enable?JS:ew,fragmentShader:v.enable?QS:$S,triangulation:v.enable?SE:EE,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,v=u===void 0?{enable:!1,dir:"in"}:u;v.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:wi.Attribute,descriptor:{name:"a_linear",buffer:{usage:p.STATIC_DRAW,data:[],type:p.FLOAT},size:3,update:function(_,E,P,I,k){return[P[3],P[4],P[5]]}}})}}]),r}(js),rw={fill:tw,line:jg,extrude:YS,text:iy,point_fill:Hg,point_image:Wg,point_normal:Xg,point_extrude:Gg},nw=rw;function iw(e){var n=aw();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ay=function(e){(0,Hr.Z)(r,e);var n=iw(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","PolygonLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new nw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),v=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return v==="fill"?"fill":v==="extrude"?"extrude":v==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),v=u.shape2d,y=u.shape3d,_=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"point_normal":(v==null?void 0:v.indexOf(P))!==-1?"point_fill":(y==null?void 0:y.indexOf(P))!==-1?"point_extrude":_.hasOwnProperty(P)?"point_image":"text"}else return"fill"}}]),r}(Pp);function ow(e){var n=sw();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,lw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oy=function(e){(0,Hr.Z)(r,e);var n=ow(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"texture",void 0),(0,C.Z)((0,ye.Z)(i),"colorTexture",void 0),i}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.clampLow,_=y===void 0?!0:y,E=o.clampHigh,P=E===void 0?!0:E,I=o.noDataValue,k=I===void 0?-9999999:I,B=o.domain,q=B===void 0?[0,1]:B;return this.updateColorTexure(),{u_opacity:v||1,u_texture:this.texture,u_domain:q,u_clampLow:_,u_clampHigh:typeof P!="undefined"?P:_,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),u=this.rendererService.createTexture2D,v=o.data.dataArray[0];this.texture=u({data:v.data,width:v.width,height:v.height,format:p.LUMINANCE,type:p.FLOAT});var y=this.layer.getLayerConfig(),_=y.rampColors,E=na(_);return this.colorTexture=u({data:E.data,width:E.width,height:E.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:lw,fragmentShader:uw,triangulation:Ng,primitive:p.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:2,update:function(u,v,y,_){return[y[3],y[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),v=u.rampColors,y=na(v);this.colorTexture=o({data:y.data,width:y.width,height:y.height,flipY:!1})}}]),r}(js),cw={raster:oy,raster3d:oy},fw=cw;function hw(e){var n=pw();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dw=function(e){(0,Hr.Z)(r,e);var n=hw(r);function r(){var i;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ye.Z)(i),"type","RasterLayer"),i}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new fw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={raster:{},raster3d:{}};return u[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Pp),sy,uy,ly,cy,fy,qd,hy,py,dy;function vy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function vw(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vy(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var mw=(sy=(0,Rr.b2)(),uy=(0,Rr.f3)(Gt.IGlobalConfigService),ly=(0,Rr.f3)(Gt.IMapService),cy=(0,Rr.f3)(Gt.IFontService),sy(fy=(qd=function(){function e(){(0,_t.Z)(this,e),Rn(this,"configService",hy,this),Rn(this,"mapService",py,this),Rn(this,"fontService",dy,this)}return(0,jt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:u})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:u}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var v=u.getLayerStyleAttributes()||[],y=u.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,E=v.filter(function(I){return I.needRemapping}),P=_;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(P=_.filter(function(I){return o.applyAttributeMapping(y,I)[0]})),E.length&&(y!=null&&y.needRemapping?(r.setEncodedData(o.mapping(v,P)),y.needRemapping=!1):r.setEncodedData(o.mapping(E,P,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,i){var o=this,u=i.styleAttributeService,v=u.getLayerStyleAttributes()||[],y=u.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,E=_;y!=null&&y.scale&&(E=_.filter(function(P){return o.applyAttributeMapping(y,P)[0]})),r.setEncodedData(this.mapping(v,E))}},{key:"mapping",value:function(r,i,o){var u=this,v=i.map(function(y,_){var E=o?o[_]:{},P=vw({id:y._id,coordinates:y.coordinates},E);return r.filter(function(I){return I.scale!==void 0}).forEach(function(I){var k=u.applyAttributeMapping(I,y);I.needRemapping=!1,I.name==="color"&&(k=k.map(function(B){return wa(B)})),P[I.name]=Array.isArray(k)&&k.length===1?k[0]:k,I.name==="shape"&&(P.shape=u.fontService.getIconFontKey(P[I.name]))}),P});return v.length>0&&this.mapService.version==="GAODE2.x"&&(typeof v[0].coordinates[0]=="number"?v.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=Nl()(y.coordinates),y.coordinates=u.mapService.lngLatToCoord(y.coordinates)}):v.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=Nl()(y.coordinates),y.coordinates=u.mapService.lngLatToCoords(y.coordinates)})),v}},{key:"applyAttributeMapping",value:function(r,i){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],v=[];return u.forEach(function(y){var _,E=y.field;(i.hasOwnProperty(E)||((_=r.scale)===null||_===void 0?void 0:_.type)==="variable")&&v.push(i[E])}),r.mapping?r.mapping(v):[]}}]),e}(),hy=kn(qd.prototype,"configService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=kn(qd.prototype,"mapService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=kn(qd.prototype,"fontService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd))||fy),gy,yy,gw=(gy=(0,Rr.b2)(),gy(yy=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"mapService",void 0)}return(0,jt.Z)(e,[{key:"apply",value:function(r){var i=this;this.mapService=r.getContainer().get(Gt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var u=r.sourceOption||{data:gf,options:Ch},v=u.data,y=u.options;r.setSource(new dc(v,y))}i.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=i.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||u})}},{key:"updateClusterData",value:function(r){var i=r.getSource(),o=i.cluster,u=i.clusterOptions,v=u.zoom,y=v===void 0?0:v,_=u.maxZoom,E=_===void 0?16:_,P=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return o&&(I||Math.abs(y-P)>1)&&E>y?(i.updateClusterData(Math.floor(P)),!0):!1}}]),e}())||yy);function Mm(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function _y(e){return e.length===1&&(e=yw(e)),{left:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var u=i+o>>>1;e(n[u],r)<0?i=u+1:o=u}return i},right:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var u=i+o>>>1;e(n[u],r)>0?o=u:i=u+1}return i}}}function yw(e){return function(n,r){return Mm(e(n),r)}}var xy=_y(Mm),_w=xy.right,dP=xy.left,Vv=_w;function xw(e,n){var r=e.length,i=-1,o,u,v;if(n==null){for(;++i<r;)if((o=e[i])!=null&&o>=o)for(u=v=o;++i<r;)(o=e[i])!=null&&(u>o&&(u=o),v<o&&(v=o))}else for(;++i<r;)if((o=n(e[i],i,e))!=null&&o>=o)for(u=v=o;++i<r;)(o=n(e[i],i,e))!=null&&(u>o&&(u=o),v<o&&(v=o));return[u,v]}var by=Array.prototype,vP=by.slice,mP=by.map,Pm=Math.sqrt(50),Im=Math.sqrt(10),Om=Math.sqrt(2);function Ey(e,n,r){var i,o=-1,u,v,y;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((i=n<e)&&(u=e,e=n,n=u),(y=jv(e,n,r))===0||!isFinite(y))return[];if(y>0)for(e=Math.ceil(e/y),n=Math.floor(n/y),v=new Array(u=Math.ceil(n-e+1));++o<u;)v[o]=(e+o)*y;else for(e=Math.floor(e*y),n=Math.ceil(n*y),v=new Array(u=Math.ceil(e-n+1));++o<u;)v[o]=(e-o)/y;return i&&v.reverse(),v}function jv(e,n,r){var i=(n-e)/Math.max(0,r),o=Math.floor(Math.log(i)/Math.LN10),u=i/Math.pow(10,o);return o>=0?(u>=Pm?10:u>=Im?5:u>=Om?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=Pm?10:u>=Im?5:u>=Om?2:1)}function Rm(e,n,r){var i=Math.abs(n-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),u=i/o;return u>=Pm?o*=10:u>=Im?o*=5:u>=Om&&(o*=2),n<e?-o:o}function gP(){var e=identity,n=extent,r=sturges;function i(o){var u,v=o.length,y,_=new Array(v);for(u=0;u<v;++u)_[u]=e(o[u],u,o);var E=n(_),P=E[0],I=E[1],k=r(_,P,I);Array.isArray(k)||(k=tickStep(P,I,k),k=range(Math.ceil(P/k)*k,I,k));for(var B=k.length;k[0]<=P;)k.shift(),--B;for(;k[B-1]>I;)k.pop(),--B;var q=new Array(B+1),ee;for(u=0;u<=B;++u)ee=q[u]=[],ee.x0=u>0?k[u-1]:P,ee.x1=u<B?k[u]:I;for(u=0;u<v;++u)y=_[u],P<=y&&y<=I&&q[bisect(k,y,0,B)].push(o[u]);return q}return i.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),i):e},i.domain=function(o){return arguments.length?(n=typeof o=="function"?o:constant([o[0],o[1]]),i):n},i.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),i):r},i}function yP(e,n,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-n)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function bw(e){return e===null?NaN:+e}function Ew(e,n,r){if(r==null&&(r=bw),!!(i=e.length)){if((n=+n)<=0||i<2)return+r(e[0],0,e);if(n>=1)return+r(e[i-1],i-1,e);var i,o=(i-1)*n,u=Math.floor(o),v=+r(e[u],u,e),y=+r(e[u+1],u+1,e);return v+(y-v)*(o-u)}}var wc="$";function Gv(){}Gv.prototype=Sy.prototype={constructor:Gv,has:function(e){return wc+e in this},get:function(e){return this[wc+e]},set:function(e,n){return this[wc+e]=n,this},remove:function(e){var n=wc+e;return n in this&&delete this[n]},clear:function(){for(var e in this)e[0]===wc&&delete this[e]},keys:function(){var e=[];for(var n in this)n[0]===wc&&e.push(n.slice(1));return e},values:function(){var e=[];for(var n in this)n[0]===wc&&e.push(this[n]);return e},entries:function(){var e=[];for(var n in this)n[0]===wc&&e.push({key:n.slice(1),value:this[n]});return e},size:function(){var e=0;for(var n in this)n[0]===wc&&++e;return e},empty:function(){for(var e in this)if(e[0]===wc)return!1;return!0},each:function(e){for(var n in this)n[0]===wc&&e(this[n],n.slice(1),this)}};function Sy(e,n){var r=new Gv;if(e instanceof Gv)e.each(function(y,_){r.set(_,y)});else if(Array.isArray(e)){var i=-1,o=e.length,u;if(n==null)for(;++i<o;)r.set(i,e[i]);else for(;++i<o;)r.set(n(u=e[i],i,e),u)}else if(e)for(var v in e)r.set(v,e[v]);return r}var Lm=Sy;function _P(){var e=[],n=[],r,i,o;function u(y,_,E,P){if(_>=e.length)return r!=null&&y.sort(r),i!=null?i(y):y;for(var I=-1,k=y.length,B=e[_++],q,ee,se=map(),De,Je=E();++I<k;)(De=se.get(q=B(ee=y[I])+""))?De.push(ee):se.set(q,[ee]);return se.each(function(ht,gt){P(Je,gt,u(ht,_,E,P))}),Je}function v(y,_){if(++_>e.length)return y;var E,P=n[_-1];return i!=null&&_>=e.length?E=y.entries():(E=[],y.each(function(I,k){E.push({key:k,values:v(I,_)})})),P!=null?E.sort(function(I,k){return P(I.key,k.key)}):E}return o={object:function(y){return u(y,0,Sw,ww)},map:function(y){return u(y,0,wy,Cy)},entries:function(y){return v(u(y,0,wy,Cy),0)},key:function(y){return e.push(y),o},sortKeys:function(y){return n[e.length-1]=y,o},sortValues:function(y){return r=y,o},rollup:function(y){return i=y,o}}}function Sw(){return{}}function ww(e,n,r){e[n]=r}function wy(){return map()}function Cy(e,n,r){e.set(n,r)}function Hv(){}var Lp=Lm.prototype;Hv.prototype=Cw.prototype={constructor:Hv,has:Lp.has,add:function(e){return e+="",this[wc+e]=e,this},remove:Lp.remove,clear:Lp.clear,values:Lp.keys,size:Lp.size,empty:Lp.empty,each:Lp.each};function Cw(e,n){var r=new Hv;if(e instanceof Hv)e.each(function(u){r.add(u)});else if(e){var i=-1,o=e.length;if(n==null)for(;++i<o;)r.add(e[i]);else for(;++i<o;)r.add(n(e[i],i,e))}return r}var xP=null,Ay=Array.prototype,Wv=Ay.map,kp=Ay.slice;function Xh(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function bP(e,n){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(n).domain(e);break}return this}var Ty={name:"implicit"};function Xv(){var e=Lm(),n=[],r=[],i=Ty;function o(u){var v=u+"",y=e.get(v);if(!y){if(i!==Ty)return i;e.set(v,y=n.push(u))}return r[(y-1)%r.length]}return o.domain=function(u){if(!arguments.length)return n.slice();n=[],e=Lm();for(var v=-1,y=u.length,_,E;++v<y;)e.has(E=(_=u[v])+"")||e.set(E,n.push(_));return o},o.range=function(u){return arguments.length?(r=kp.call(u),o):r.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.copy=function(){return Xv(n,r).unknown(i)},Xh.apply(o,arguments),o}function My(){var e=ordinal().unknown(void 0),n=e.domain,r=e.range,i=[0,1],o,u,v=!1,y=0,_=0,E=.5;delete e.unknown;function P(){var I=n().length,k=i[1]<i[0],B=i[k-0],q=i[1-k];o=(q-B)/Math.max(1,I-y+_*2),v&&(o=Math.floor(o)),B+=(q-B-o*(I-y))*E,u=o*(1-y),v&&(B=Math.round(B),u=Math.round(u));var ee=sequence(I).map(function(se){return B+o*se});return r(k?ee.reverse():ee)}return e.domain=function(I){return arguments.length?(n(I),P()):n()},e.range=function(I){return arguments.length?(i=[+I[0],+I[1]],P()):i.slice()},e.rangeRound=function(I){return i=[+I[0],+I[1]],v=!0,P()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(I){return arguments.length?(v=!!I,P()):v},e.padding=function(I){return arguments.length?(y=Math.min(1,_=+I),P()):y},e.paddingInner=function(I){return arguments.length?(y=Math.min(1,I),P()):y},e.paddingOuter=function(I){return arguments.length?(_=+I,P()):_},e.align=function(I){return arguments.length?(E=Math.max(0,Math.min(1,I)),P()):E},e.copy=function(){return My(n(),i).round(v).paddingInner(y).paddingOuter(_).align(E)},initRange.apply(P(),arguments)}function Py(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Py(n())},e}function EP(){return Py(My.apply(null,arguments).paddingInner(1))}var Aw=$(45257),Tw=$(53254);function Mw(e,n){return e=+e,n=+n,function(r){return Math.round(e*(1-r)+n*r)}}function Pw(e){return function(){return e}}function km(e){return+e}var Iy=[0,1];function Cc(e){return e}function Dm(e,n){return(n-=e=+e)?function(r){return(r-e)/n}:Pw(isNaN(n)?NaN:.5)}function Oy(e){var n=e[0],r=e[e.length-1],i;return n>r&&(i=n,n=r,r=i),function(o){return Math.max(n,Math.min(r,o))}}function Iw(e,n,r){var i=e[0],o=e[1],u=n[0],v=n[1];return o<i?(i=Dm(o,i),u=r(v,u)):(i=Dm(i,o),u=r(u,v)),function(y){return u(i(y))}}function Ow(e,n,r){var i=Math.min(e.length,n.length)-1,o=new Array(i),u=new Array(i),v=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++v<i;)o[v]=Dm(e[v],e[v+1]),u[v]=r(n[v],n[v+1]);return function(y){var _=Vv(e,y,1,i)-1;return u[_](o[_](y))}}function Yv(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Fm(){var e=Iy,n=Iy,r=Aw.Z,i,o,u,v=Cc,y,_,E;function P(){return y=Math.min(e.length,n.length)>2?Ow:Iw,_=E=null,I}function I(k){return isNaN(k=+k)?u:(_||(_=y(e.map(i),n,r)))(i(v(k)))}return I.invert=function(k){return v(o((E||(E=y(n,e.map(i),Tw.Z)))(k)))},I.domain=function(k){return arguments.length?(e=Wv.call(k,km),v===Cc||(v=Oy(e)),P()):e.slice()},I.range=function(k){return arguments.length?(n=kp.call(k),P()):n.slice()},I.rangeRound=function(k){return n=kp.call(k),r=Mw,P()},I.clamp=function(k){return arguments.length?(v=k?Oy(e):Cc,I):v!==Cc},I.interpolate=function(k){return arguments.length?(r=k,P()):r},I.unknown=function(k){return arguments.length?(u=k,I):u},function(k,B){return i=k,o=B,P()}}function Ry(e,n){return Fm()(e,n)}var Rw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function qv(e){if(!(n=Rw.exec(e)))throw new Error("invalid format: "+e);var n;return new Nm({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}qv.prototype=Nm.prototype;function Nm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Nm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Lw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Kv(e,n){if((r=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function hd(e){return e=Kv(Math.abs(e)),e?e[1]:NaN}function kw(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(hd(n)/3)))*3-hd(Math.abs(e)))}function Dw(e,n){return function(r,i){for(var o=r.length,u=[],v=0,y=e[0],_=0;o>0&&y>0&&(_+y+1>i&&(y=Math.max(1,i-_)),u.push(r.substring(o-=y,o+y)),!((_+=y+1)>i));)y=e[v=(v+1)%e.length];return u.reverse().join(n)}}function Fw(e){return function(n){return n.replace(/[0-9]/g,function(r){return e[+r]})}}function Nw(e){e:for(var n=e.length,r=1,i=-1,o;r<n;++r)switch(e[r]){case".":i=o=r;break;case"0":i===0&&(i=r),o=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(o+1):e}var Ly;function Bw(e,n){var r=Kv(e,n);if(!r)return e+"";var i=r[0],o=r[1],u=o-(Ly=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,v=i.length;return u===v?i:u>v?i+new Array(u-v+1).join("0"):u>0?i.slice(0,u)+"."+i.slice(u):"0."+new Array(1-u).join("0")+Kv(e,Math.max(0,n+u-1))[0]}function ky(e,n){var r=Kv(e,n);if(!r)return e+"";var i=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}var Dy={"%":function(e,n){return(e*100).toFixed(n)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Lw,e:function(e,n){return e.toExponential(n)},f:function(e,n){return e.toFixed(n)},g:function(e,n){return e.toPrecision(n)},o:function(e){return Math.round(e).toString(8)},p:function(e,n){return ky(e*100,n)},r:ky,s:Bw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Fy(e){return e}var Ny=Array.prototype.map,By=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function zw(e){var n=e.grouping===void 0||e.thousands===void 0?Fy:Dw(Ny.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?Fy:Fw(Ny.call(e.numerals,String)),v=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"-":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function E(I){I=qv(I);var k=I.fill,B=I.align,q=I.sign,ee=I.symbol,se=I.zero,De=I.width,Je=I.comma,ht=I.precision,gt=I.trim,Nt=I.type;Nt==="n"?(Je=!0,Nt="g"):Dy[Nt]||(ht===void 0&&(ht=12),gt=!0,Nt="g"),(se||k==="0"&&B==="=")&&(se=!0,k="0",B="=");var Vt=ee==="$"?r:ee==="#"&&/[boxX]/.test(Nt)?"0"+Nt.toLowerCase():"",nr=ee==="$"?i:/[%p]/.test(Nt)?v:"",dr=Dy[Nt],Jr=/[defgprs%]/.test(Nt);ht=ht===void 0?6:/[gprs]/.test(Nt)?Math.max(1,Math.min(21,ht)):Math.max(0,Math.min(20,ht));function ln(Er){var In=Vt,Vn=nr,pi,Ro,ws;if(Nt==="c")Vn=dr(Er)+Vn,Er="";else{Er=+Er;var nl=Er<0||1/Er<0;if(Er=isNaN(Er)?_:dr(Math.abs(Er),ht),gt&&(Er=Nw(Er)),nl&&+Er==0&&q!=="+"&&(nl=!1),In=(nl?q==="("?q:y:q==="-"||q==="("?"":q)+In,Vn=(Nt==="s"?By[8+Ly/3]:"")+Vn+(nl&&q==="("?")":""),Jr){for(pi=-1,Ro=Er.length;++pi<Ro;)if(ws=Er.charCodeAt(pi),48>ws||ws>57){Vn=(ws===46?o+Er.slice(pi+1):Er.slice(pi))+Vn,Er=Er.slice(0,pi);break}}}Je&&!se&&(Er=n(Er,Infinity));var Ac=In.length+Er.length+Vn.length,bl=Ac<De?new Array(De-Ac+1).join(k):"";switch(Je&&se&&(Er=n(bl+Er,bl.length?De-Vn.length:Infinity),bl=""),B){case"<":Er=In+Er+Vn+bl;break;case"=":Er=In+bl+Er+Vn;break;case"^":Er=bl.slice(0,Ac=bl.length>>1)+In+Er+Vn+bl.slice(Ac);break;default:Er=bl+In+Er+Vn;break}return u(Er)}return ln.toString=function(){return I+""},ln}function P(I,k){var B=E((I=qv(I),I.type="f",I)),q=Math.max(-8,Math.min(8,Math.floor(hd(k)/3)))*3,ee=Math.pow(10,-q),se=By[8+q/3];return function(De){return B(ee*De)+se}}return{format:E,formatPrefix:P}}var $v,Bm,zy;Uw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Uw(e){return $v=zw(e),Bm=$v.format,zy=$v.formatPrefix,$v}function Zw(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,hd(n)-hd(e))+1}function Vw(e){return Math.max(0,-hd(Math.abs(e)))}function jw(e,n,r,i){var o=Rm(e,n,r),u;switch(i=qv(i==null?",f":i),i.type){case"s":{var v=Math.max(Math.abs(e),Math.abs(n));return i.precision==null&&!isNaN(u=kw(o,v))&&(i.precision=u),zy(i,v)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(u=Zw(o,Math.max(Math.abs(e),Math.abs(n))))&&(i.precision=u-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(u=Vw(o))&&(i.precision=u-(i.type==="%")*2);break}}return Bm(i)}function Qv(e){var n=e.domain;return e.ticks=function(r){var i=n();return Ey(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var o=n();return jw(o[0],o[o.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=n(),o=0,u=i.length-1,v=i[o],y=i[u],_;return y<v&&(_=v,v=y,y=_,_=o,o=u,u=_),_=jv(v,y,r),_>0?(v=Math.floor(v/_)*_,y=Math.ceil(y/_)*_,_=jv(v,y,r)):_<0&&(v=Math.ceil(v*_)/_,y=Math.floor(y*_)/_,_=jv(v,y,r)),_>0?(i[o]=Math.floor(v/_)*_,i[u]=Math.ceil(y/_)*_,n(i)):_<0&&(i[o]=Math.ceil(v*_)/_,i[u]=Math.floor(y*_)/_,n(i)),e},e}function Uy(){var e=Ry(Cc,Cc);return e.copy=function(){return Yv(e,Uy())},Xh.apply(e,arguments),Qv(e)}function Zy(e){var n;function r(i){return isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=Wv.call(i,km),r):e.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return Zy(e).unknown(n)},e=arguments.length?Wv.call(e,km):[0,1],Qv(r)}function Vy(e,n){e=e.slice();var r=0,i=e.length-1,o=e[r],u=e[i],v;return u<o&&(v=r,r=i,i=v,v=o,o=u,u=v),e[r]=n.floor(o),e[i]=n.ceil(u),e}function jy(e){return Math.log(e)}function Gy(e){return Math.exp(e)}function Gw(e){return-Math.log(-e)}function Hw(e){return-Math.exp(-e)}function Ww(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Xw(e){return e===10?Ww:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function Yw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function Hy(e){return function(n){return-e(-n)}}function qw(e){var n=e(jy,Gy),r=n.domain,i=10,o,u;function v(){return o=Yw(i),u=Xw(i),r()[0]<0?(o=Hy(o),u=Hy(u),e(Gw,Hw)):e(jy,Gy),n}return n.base=function(y){return arguments.length?(i=+y,v()):i},n.domain=function(y){return arguments.length?(r(y),v()):r()},n.ticks=function(y){var _=r(),E=_[0],P=_[_.length-1],I;(I=P<E)&&(k=E,E=P,P=k);var k=o(E),B=o(P),q,ee,se,De=y==null?10:+y,Je=[];if(!(i%1)&&B-k<De){if(k=Math.round(k)-1,B=Math.round(B)+1,E>0){for(;k<B;++k)for(ee=1,q=u(k);ee<i;++ee)if(se=q*ee,!(se<E)){if(se>P)break;Je.push(se)}}else for(;k<B;++k)for(ee=i-1,q=u(k);ee>=1;--ee)if(se=q*ee,!(se<E)){if(se>P)break;Je.push(se)}}else Je=Ey(k,B,Math.min(B-k,De)).map(u);return I?Je.reverse():Je},n.tickFormat=function(y,_){if(_==null&&(_=i===10?".0e":","),typeof _!="function"&&(_=Bm(_)),y===Infinity)return _;y==null&&(y=10);var E=Math.max(1,i*y/n.ticks().length);return function(P){var I=P/u(Math.round(o(P)));return I*i<i-.5&&(I*=i),I<=E?_(P):""}},n.nice=function(){return r(Vy(r(),{floor:function(y){return u(Math.floor(o(y)))},ceil:function(y){return u(Math.ceil(o(y)))}}))},n}function Wy(){var e=qw(Fm()).domain([1,10]);return e.copy=function(){return Yv(e,Wy()).base(e.base())},Xh.apply(e,arguments),e}function Xy(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function Yy(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function Kw(e){var n=1,r=e(Xy(n),Yy(n));return r.constant=function(i){return arguments.length?e(Xy(n=+i),Yy(n)):n},linearish(r)}function $w(){var e=Kw(transformer());return e.copy=function(){return copy(e,$w()).constant(e.constant())},initRange.apply(e,arguments)}function qy(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function Qw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Jw(e){return e<0?-e*e:e*e}function eC(e){var n=e(Cc,Cc),r=1;function i(){return r===1?e(Cc,Cc):r===.5?e(Qw,Jw):e(qy(r),qy(1/r))}return n.exponent=function(o){return arguments.length?(r=+o,i()):r},Qv(n)}function zm(){var e=eC(Fm());return e.copy=function(){return Yv(e,zm()).exponent(e.exponent())},Xh.apply(e,arguments),e}function SP(){return zm.apply(null,arguments).exponent(.5)}function Ky(){var e=[],n=[],r=[],i;function o(){var v=0,y=Math.max(1,n.length);for(r=new Array(y-1);++v<y;)r[v-1]=Ew(e,v/y);return u}function u(v){return isNaN(v=+v)?i:n[Vv(r,v)]}return u.invertExtent=function(v){var y=n.indexOf(v);return y<0?[NaN,NaN]:[y>0?r[y-1]:e[0],y<r.length?r[y]:e[e.length-1]]},u.domain=function(v){if(!arguments.length)return e.slice();e=[];for(var y=0,_=v.length,E;y<_;++y)E=v[y],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(Mm),o()},u.range=function(v){return arguments.length?(n=kp.call(v),o()):n.slice()},u.unknown=function(v){return arguments.length?(i=v,u):i},u.quantiles=function(){return r.slice()},u.copy=function(){return Ky().domain(e).range(n).unknown(i)},Xh.apply(u,arguments)}function $y(){var e=0,n=1,r=1,i=[.5],o=[0,1],u;function v(_){return _<=_?o[Vv(i,_,0,r)]:u}function y(){var _=-1;for(i=new Array(r);++_<r;)i[_]=((_+1)*n-(_-r)*e)/(r+1);return v}return v.domain=function(_){return arguments.length?(e=+_[0],n=+_[1],y()):[e,n]},v.range=function(_){return arguments.length?(r=(o=kp.call(_)).length-1,y()):o.slice()},v.invertExtent=function(_){var E=o.indexOf(_);return E<0?[NaN,NaN]:E<1?[e,i[0]]:E>=r?[i[r-1],n]:[i[E-1],i[E]]},v.unknown=function(_){return arguments.length&&(u=_),v},v.thresholds=function(){return i.slice()},v.copy=function(){return $y().domain([e,n]).range(o).unknown(u)},Xh.apply(Qv(v),arguments)}function Qy(){var e=[.5],n=[0,1],r,i=1;function o(u){return u<=u?n[Vv(e,u,0,i)]:r}return o.domain=function(u){return arguments.length?(e=kp.call(u),i=Math.min(e.length,n.length-1),o):e.slice()},o.range=function(u){return arguments.length?(n=kp.call(u),i=Math.min(e.length,n.length-1),o):n.slice()},o.invertExtent=function(u){var v=n.indexOf(u);return[e[v-1],e[v]]},o.unknown=function(u){return arguments.length?(r=u,o):r},o.copy=function(){return Qy().domain(e).range(n).unknown(r)},Xh.apply(o,arguments)}var Um=new Date,Zm=new Date;function rl(e,n,r,i){function o(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return o.floor=function(u){return e(u=new Date(+u)),u},o.ceil=function(u){return e(u=new Date(u-1)),n(u,1),e(u),u},o.round=function(u){var v=o(u),y=o.ceil(u);return u-v<y-u?v:y},o.offset=function(u,v){return n(u=new Date(+u),v==null?1:Math.floor(v)),u},o.range=function(u,v,y){var _=[],E;if(u=o.ceil(u),y=y==null?1:Math.floor(y),!(u<v)||!(y>0))return _;do _.push(E=new Date(+u)),n(u,y),e(u);while(E<u&&u<v);return _},o.filter=function(u){return rl(function(v){if(v>=v)for(;e(v),!u(v);)v.setTime(v-1)},function(v,y){if(v>=v)if(y<0)for(;++y<=0;)for(;n(v,-1),!u(v););else for(;--y>=0;)for(;n(v,1),!u(v););})},r&&(o.count=function(u,v){return Um.setTime(+u),Zm.setTime(+v),e(Um),e(Zm),Math.floor(r(Um,Zm))},o.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?o.filter(i?function(v){return i(v)%u==0}:function(v){return o.count(0,v)%u==0}):o}),o}var Vm=rl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Vm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rl(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,r){n.setFullYear(n.getFullYear()+r*e)})};var pd=Vm,wP=Vm.range,Jy=rl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),tC=Jy,CP=Jy.range,Jv=1e3,Kd=6e4,e_=36e5,t_=864e5,r_=6048e5;function Dp(e){return rl(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,r){n.setDate(n.getDate()+r*7)},function(n,r){return(r-n-(r.getTimezoneOffset()-n.getTimezoneOffset())*Kd)/r_})}var jm=Dp(0),em=Dp(1),rC=Dp(2),nC=Dp(3),dd=Dp(4),iC=Dp(5),aC=Dp(6),AP=jm.range,TP=em.range,MP=rC.range,PP=nC.range,IP=dd.range,OP=iC.range,RP=aC.range,n_=rl(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Kd)/t_},function(e){return e.getDate()-1}),Gm=n_,LP=n_.range,i_=rl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv-e.getMinutes()*Kd)},function(e,n){e.setTime(+e+n*e_)},function(e,n){return(n-e)/e_},function(e){return e.getHours()}),oC=i_,kP=i_.range,a_=rl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv)},function(e,n){e.setTime(+e+n*Kd)},function(e,n){return(n-e)/Kd},function(e){return e.getMinutes()}),sC=a_,DP=a_.range,o_=rl(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*Jv)},function(e,n){return(n-e)/Jv},function(e){return e.getUTCSeconds()}),uC=o_,FP=o_.range,tm=rl(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});tm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?rl(function(n){n.setTime(Math.floor(n/e)*e)},function(n,r){n.setTime(+n+r*e)},function(n,r){return(r-n)/e}):tm};var lC=tm,NP=tm.range;function Fp(e){return rl(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCDate(n.getUTCDate()+r*7)},function(n,r){return(r-n)/r_})}var s_=Fp(0),rm=Fp(1),cC=Fp(2),fC=Fp(3),vd=Fp(4),hC=Fp(5),pC=Fp(6),BP=s_.range,zP=rm.range,UP=cC.range,ZP=fC.range,VP=vd.range,jP=hC.range,GP=pC.range,u_=rl(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/t_},function(e){return e.getUTCDate()-1}),l_=u_,HP=u_.range,Hm=rl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Hm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rl(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCFullYear(n.getUTCFullYear()+r*e)})};var $d=Hm,WP=Hm.range;function Wm(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Xm(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Qd(e,n,r){return{y:e,m:n,d:r,H:0,M:0,S:0,L:0}}function dC(e){var n=e.dateTime,r=e.date,i=e.time,o=e.periods,u=e.days,v=e.shortDays,y=e.months,_=e.shortMonths,E=Jd(o),P=ev(o),I=Jd(u),k=ev(u),B=Jd(v),q=ev(v),ee=Jd(y),se=ev(y),De=Jd(_),Je=ev(_),ht={a:nl,A:Ac,b:bl,B:RM,c:null,d:v_,e:v_,f:NC,g:XC,G:qC,H:kC,I:DC,j:FC,L:m_,m:BC,M:zC,p:LM,q:kM,Q:E_,s:S_,S:UC,u:ZC,U:VC,V:jC,w:GC,W:HC,x:null,X:null,y:WC,Y:YC,Z:KC,"%":b_},gt={a:DM,A:FM,b:NM,B:BM,c:null,d:y_,e:y_,f:eA,g:cA,G:hA,H:$C,I:QC,j:JC,L:__,m:tA,M:rA,p:zM,q:UM,Q:E_,s:S_,S:nA,u:iA,U:aA,V:oA,w:sA,W:uA,x:null,X:null,y:lA,Y:fA,Z:pA,"%":b_},Nt={a:ln,A:Er,b:In,B:Vn,c:pi,d:p_,e:p_,f:IC,g:h_,G:f_,H:d_,I:d_,j:AC,L:PC,m:CC,M:TC,p:Jr,q:wC,Q:RC,s:LC,S:MC,u:_C,U:xC,V:bC,w:yC,W:EC,x:Ro,X:ws,y:h_,Y:f_,Z:SC,"%":OC};ht.x=Vt(r,ht),ht.X=Vt(i,ht),ht.c=Vt(n,ht),gt.x=Vt(r,gt),gt.X=Vt(i,gt),gt.c=Vt(n,gt);function Vt(ri,Ra){return function(Qa){var pn=[],El=-1,zo=0,Kl=ri.length,$l,Bp,ax;for(Qa instanceof Date||(Qa=new Date(+Qa));++El<Kl;)ri.charCodeAt(El)===37&&(pn.push(ri.slice(zo,El)),(Bp=c_[$l=ri.charAt(++El)])!=null?$l=ri.charAt(++El):Bp=$l==="e"?" ":"0",(ax=Ra[$l])&&($l=ax(Qa,Bp)),pn.push($l),zo=El+1);return pn.push(ri.slice(zo,El)),pn.join("")}}function nr(ri,Ra){return function(Qa){var pn=Qd(1900,void 0,1),El=dr(pn,ri,Qa+="",0),zo,Kl;if(El!=Qa.length)return null;if("Q"in pn)return new Date(pn.Q);if("s"in pn)return new Date(pn.s*1e3+("L"in pn?pn.L:0));if(Ra&&!("Z"in pn)&&(pn.Z=0),"p"in pn&&(pn.H=pn.H%12+pn.p*12),pn.m===void 0&&(pn.m="q"in pn?pn.q:0),"V"in pn){if(pn.V<1||pn.V>53)return null;"w"in pn||(pn.w=1),"Z"in pn?(zo=Xm(Qd(pn.y,0,1)),Kl=zo.getUTCDay(),zo=Kl>4||Kl===0?rm.ceil(zo):rm(zo),zo=l_.offset(zo,(pn.V-1)*7),pn.y=zo.getUTCFullYear(),pn.m=zo.getUTCMonth(),pn.d=zo.getUTCDate()+(pn.w+6)%7):(zo=Wm(Qd(pn.y,0,1)),Kl=zo.getDay(),zo=Kl>4||Kl===0?em.ceil(zo):em(zo),zo=Gm.offset(zo,(pn.V-1)*7),pn.y=zo.getFullYear(),pn.m=zo.getMonth(),pn.d=zo.getDate()+(pn.w+6)%7)}else("W"in pn||"U"in pn)&&("w"in pn||(pn.w="u"in pn?pn.u%7:"W"in pn?1:0),Kl="Z"in pn?Xm(Qd(pn.y,0,1)).getUTCDay():Wm(Qd(pn.y,0,1)).getDay(),pn.m=0,pn.d="W"in pn?(pn.w+6)%7+pn.W*7-(Kl+5)%7:pn.w+pn.U*7-(Kl+6)%7);return"Z"in pn?(pn.H+=pn.Z/100|0,pn.M+=pn.Z%100,Xm(pn)):Wm(pn)}}function dr(ri,Ra,Qa,pn){for(var El=0,zo=Ra.length,Kl=Qa.length,$l,Bp;El<zo;){if(pn>=Kl)return-1;if($l=Ra.charCodeAt(El++),$l===37){if($l=Ra.charAt(El++),Bp=Nt[$l in c_?Ra.charAt(El++):$l],!Bp||(pn=Bp(ri,Qa,pn))<0)return-1}else if($l!=Qa.charCodeAt(pn++))return-1}return pn}function Jr(ri,Ra,Qa){var pn=E.exec(Ra.slice(Qa));return pn?(ri.p=P[pn[0].toLowerCase()],Qa+pn[0].length):-1}function ln(ri,Ra,Qa){var pn=B.exec(Ra.slice(Qa));return pn?(ri.w=q[pn[0].toLowerCase()],Qa+pn[0].length):-1}function Er(ri,Ra,Qa){var pn=I.exec(Ra.slice(Qa));return pn?(ri.w=k[pn[0].toLowerCase()],Qa+pn[0].length):-1}function In(ri,Ra,Qa){var pn=De.exec(Ra.slice(Qa));return pn?(ri.m=Je[pn[0].toLowerCase()],Qa+pn[0].length):-1}function Vn(ri,Ra,Qa){var pn=ee.exec(Ra.slice(Qa));return pn?(ri.m=se[pn[0].toLowerCase()],Qa+pn[0].length):-1}function pi(ri,Ra,Qa){return dr(ri,n,Ra,Qa)}function Ro(ri,Ra,Qa){return dr(ri,r,Ra,Qa)}function ws(ri,Ra,Qa){return dr(ri,i,Ra,Qa)}function nl(ri){return v[ri.getDay()]}function Ac(ri){return u[ri.getDay()]}function bl(ri){return _[ri.getMonth()]}function RM(ri){return y[ri.getMonth()]}function LM(ri){return o[+(ri.getHours()>=12)]}function kM(ri){return 1+~~(ri.getMonth()/3)}function DM(ri){return v[ri.getUTCDay()]}function FM(ri){return u[ri.getUTCDay()]}function NM(ri){return _[ri.getUTCMonth()]}function BM(ri){return y[ri.getUTCMonth()]}function zM(ri){return o[+(ri.getUTCHours()>=12)]}function UM(ri){return 1+~~(ri.getUTCMonth()/3)}return{format:function(ri){var Ra=Vt(ri+="",ht);return Ra.toString=function(){return ri},Ra},parse:function(ri){var Ra=nr(ri+="",!1);return Ra.toString=function(){return ri},Ra},utcFormat:function(ri){var Ra=Vt(ri+="",gt);return Ra.toString=function(){return ri},Ra},utcParse:function(ri){var Ra=nr(ri+="",!0);return Ra.toString=function(){return ri},Ra}}}var c_={"-":"",_:" ","0":"0"},cu=/^\s*\d+/,vC=/^%/,mC=/[\\^$*+?|[\]().{}]/g;function $a(e,n,r){var i=e<0?"-":"",o=(i?-e:e)+"",u=o.length;return i+(u<r?new Array(r-u+1).join(n)+o:o)}function gC(e){return e.replace(mC,"\\$&")}function Jd(e){return new RegExp("^(?:"+e.map(gC).join("|")+")","i")}function ev(e){for(var n={},r=-1,i=e.length;++r<i;)n[e[r].toLowerCase()]=r;return n}function yC(e,n,r){var i=cu.exec(n.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function _C(e,n,r){var i=cu.exec(n.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function xC(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function bC(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function EC(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function f_(e,n,r){var i=cu.exec(n.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function h_(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function SC(e,n,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function wC(e,n,r){var i=cu.exec(n.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function CC(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function p_(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function AC(e,n,r){var i=cu.exec(n.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function d_(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function TC(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function MC(e,n,r){var i=cu.exec(n.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function PC(e,n,r){var i=cu.exec(n.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function IC(e,n,r){var i=cu.exec(n.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function OC(e,n,r){var i=vC.exec(n.slice(r,r+1));return i?r+i[0].length:-1}function RC(e,n,r){var i=cu.exec(n.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function LC(e,n,r){var i=cu.exec(n.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function v_(e,n){return $a(e.getDate(),n,2)}function kC(e,n){return $a(e.getHours(),n,2)}function DC(e,n){return $a(e.getHours()%12||12,n,2)}function FC(e,n){return $a(1+Gm.count(pd(e),e),n,3)}function m_(e,n){return $a(e.getMilliseconds(),n,3)}function NC(e,n){return m_(e,n)+"000"}function BC(e,n){return $a(e.getMonth()+1,n,2)}function zC(e,n){return $a(e.getMinutes(),n,2)}function UC(e,n){return $a(e.getSeconds(),n,2)}function ZC(e){var n=e.getDay();return n===0?7:n}function VC(e,n){return $a(jm.count(pd(e)-1,e),n,2)}function g_(e){var n=e.getDay();return n>=4||n===0?dd(e):dd.ceil(e)}function jC(e,n){return e=g_(e),$a(dd.count(pd(e),e)+(pd(e).getDay()===4),n,2)}function GC(e){return e.getDay()}function HC(e,n){return $a(em.count(pd(e)-1,e),n,2)}function WC(e,n){return $a(e.getFullYear()%100,n,2)}function XC(e,n){return e=g_(e),$a(e.getFullYear()%100,n,2)}function YC(e,n){return $a(e.getFullYear()%1e4,n,4)}function qC(e,n){var r=e.getDay();return e=r>=4||r===0?dd(e):dd.ceil(e),$a(e.getFullYear()%1e4,n,4)}function KC(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+$a(n/60|0,"0",2)+$a(n%60,"0",2)}function y_(e,n){return $a(e.getUTCDate(),n,2)}function $C(e,n){return $a(e.getUTCHours(),n,2)}function QC(e,n){return $a(e.getUTCHours()%12||12,n,2)}function JC(e,n){return $a(1+l_.count($d(e),e),n,3)}function __(e,n){return $a(e.getUTCMilliseconds(),n,3)}function eA(e,n){return __(e,n)+"000"}function tA(e,n){return $a(e.getUTCMonth()+1,n,2)}function rA(e,n){return $a(e.getUTCMinutes(),n,2)}function nA(e,n){return $a(e.getUTCSeconds(),n,2)}function iA(e){var n=e.getUTCDay();return n===0?7:n}function aA(e,n){return $a(s_.count($d(e)-1,e),n,2)}function x_(e){var n=e.getUTCDay();return n>=4||n===0?vd(e):vd.ceil(e)}function oA(e,n){return e=x_(e),$a(vd.count($d(e),e)+($d(e).getUTCDay()===4),n,2)}function sA(e){return e.getUTCDay()}function uA(e,n){return $a(rm.count($d(e)-1,e),n,2)}function lA(e,n){return $a(e.getUTCFullYear()%100,n,2)}function cA(e,n){return e=x_(e),$a(e.getUTCFullYear()%100,n,2)}function fA(e,n){return $a(e.getUTCFullYear()%1e4,n,4)}function hA(e,n){var r=e.getUTCDay();return e=r>=4||r===0?vd(e):vd.ceil(e),$a(e.getUTCFullYear()%1e4,n,4)}function pA(){return"+0000"}function b_(){return"%"}function E_(e){return+e}function S_(e){return Math.floor(+e/1e3)}var md,w_,dA,vA,mA;gA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function gA(e){return md=dC(e),w_=md.format,dA=md.parse,vA=md.utcFormat,mA=md.utcParse,md}var tv=1e3,rv=tv*60,nv=rv*60,iv=nv*24,yA=iv*7,C_=iv*30,Ym=iv*365;function _A(e){return new Date(e)}function xA(e){return e instanceof Date?+e:+new Date(+e)}function A_(e,n,r,i,o,u,v,y,_){var E=Ry(Cc,Cc),P=E.invert,I=E.domain,k=_(".%L"),B=_(":%S"),q=_("%I:%M"),ee=_("%I %p"),se=_("%a %d"),De=_("%b %d"),Je=_("%B"),ht=_("%Y"),gt=[[v,1,tv],[v,5,5*tv],[v,15,15*tv],[v,30,30*tv],[u,1,rv],[u,5,5*rv],[u,15,15*rv],[u,30,30*rv],[o,1,nv],[o,3,3*nv],[o,6,6*nv],[o,12,12*nv],[i,1,iv],[i,2,2*iv],[r,1,yA],[n,1,C_],[n,3,3*C_],[e,1,Ym]];function Nt(nr){return(v(nr)<nr?k:u(nr)<nr?B:o(nr)<nr?q:i(nr)<nr?ee:n(nr)<nr?r(nr)<nr?se:De:e(nr)<nr?Je:ht)(nr)}function Vt(nr,dr,Jr,ln){if(nr==null&&(nr=10),typeof nr=="number"){var Er=Math.abs(Jr-dr)/nr,In=_y(function(Vn){return Vn[2]}).right(gt,Er);In===gt.length?(ln=Rm(dr/Ym,Jr/Ym,nr),nr=e):In?(In=gt[Er/gt[In-1][2]<gt[In][2]/Er?In-1:In],ln=In[1],nr=In[0]):(ln=Math.max(Rm(dr,Jr,nr),1),nr=y)}return ln==null?nr:nr.every(ln)}return E.invert=function(nr){return new Date(P(nr))},E.domain=function(nr){return arguments.length?I(Wv.call(nr,xA)):I().map(_A)},E.ticks=function(nr,dr){var Jr=I(),ln=Jr[0],Er=Jr[Jr.length-1],In=Er<ln,Vn;return In&&(Vn=ln,ln=Er,Er=Vn),Vn=Vt(nr,ln,Er,dr),Vn=Vn?Vn.range(ln,Er+1):[],In?Vn.reverse():Vn},E.tickFormat=function(nr,dr){return dr==null?Nt:_(dr)},E.nice=function(nr,dr){var Jr=I();return(nr=Vt(nr,Jr[0],Jr[Jr.length-1],dr))?I(Vy(Jr,nr)):E},E.copy=function(){return Yv(E,A_(e,n,r,i,o,u,v,y,_))},E}function bA(){return Xh.apply(A_(pd,tC,jm,Gm,oC,sC,uC,lC,w_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function XP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function nm(){var e=0,n=1,r,i,o,u,v=identity,y=!1,_;function E(P){return isNaN(P=+P)?_:v(o===0?.5:(P=(u(P)-r)*o,y?Math.max(0,Math.min(1,P)):P))}return E.domain=function(P){return arguments.length?(r=u(e=+P[0]),i=u(n=+P[1]),o=r===i?0:1/(i-r),E):[e,n]},E.clamp=function(P){return arguments.length?(y=!!P,E):y},E.interpolator=function(P){return arguments.length?(v=P,E):v},E.unknown=function(P){return arguments.length?(_=P,E):_},function(P){return u=P,r=P(e),i=P(n),o=r===i?0:1/(i-r),E}}function im(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function EA(){var e=linearish(nm()(identity));return e.copy=function(){return im(e,EA())},initInterpolator.apply(e,arguments)}function SA(){var e=loggish(nm()).domain([1,10]);return e.copy=function(){return im(e,SA()).base(e.base())},initInterpolator.apply(e,arguments)}function wA(){var e=symlogish(nm());return e.copy=function(){return im(e,wA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function T_(){var e=powish(nm());return e.copy=function(){return im(e,T_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function YP(){return T_.apply(null,arguments).exponent(.5)}function CA(){var e=[],n=identity;function r(i){if(!isNaN(i=+i))return n((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var o=0,u=i.length,v;o<u;++o)v=i[o],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return CA(n).domain(e)},initInterpolator.apply(r,arguments)}function am(){var e=0,n=.5,r=1,i,o,u,v,y,_=identity,E,P=!1,I;function k(B){return isNaN(B=+B)?I:(B=.5+((B=+E(B))-o)*(B<o?v:y),_(P?Math.max(0,Math.min(1,B)):B))}return k.domain=function(B){return arguments.length?(i=E(e=+B[0]),o=E(n=+B[1]),u=E(r=+B[2]),v=i===o?0:.5/(o-i),y=o===u?0:.5/(u-o),k):[e,n,r]},k.clamp=function(B){return arguments.length?(P=!!B,k):P},k.interpolator=function(B){return arguments.length?(_=B,k):_},k.unknown=function(B){return arguments.length?(I=B,k):I},function(B){return E=B,i=B(e),o=B(n),u=B(r),v=i===o?0:.5/(o-i),y=o===u?0:.5/(u-o),k}}function AA(){var e=linearish(am()(identity));return e.copy=function(){return copy(e,AA())},initInterpolator.apply(e,arguments)}function TA(){var e=loggish(am()).domain([.1,1,10]);return e.copy=function(){return copy(e,TA()).base(e.base())},initInterpolator.apply(e,arguments)}function MA(){var e=symlogish(am());return e.copy=function(){return copy(e,MA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function M_(){var e=powish(am());return e.copy=function(){return copy(e,M_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function qP(){return M_.apply(null,arguments).exponent(.5)}var Qc,P_,I_,O_,qm,R_,PA=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,IA=(Qc={},(0,C.Z)(Qc,Qs.LINEAR,Uy),(0,C.Z)(Qc,Qs.POWER,zm),(0,C.Z)(Qc,Qs.LOG,Wy),(0,C.Z)(Qc,Qs.IDENTITY,Zy),(0,C.Z)(Qc,Qs.TIME,bA),(0,C.Z)(Qc,Qs.QUANTILE,Ky),(0,C.Z)(Qc,Qs.QUANTIZE,$y),(0,C.Z)(Qc,Qs.THRESHOLD,Qy),(0,C.Z)(Qc,Qs.CAT,Xv),Qc),OA=(P_=(0,Rr.b2)(),I_=(0,Rr.f3)(Gt.IGlobalConfigService),P_(O_=(qm=function(){function e(){(0,_t.Z)(this,e),Rn(this,"configService",R_,this),(0,C.Z)(this,"scaleCache",{}),(0,C.Z)(this,"scaleOptions",{})}return(0,jt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var v=u.getLayerStyleAttributes(),y=r.getSource().data.dataArray;y.length!==0&&o.caculateScalesForAttributes(v||[],y)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var v=u.getLayerStyleAttributes(),y=r.getSource().data.dataArray;return o.caculateScalesForAttributes(v||[],y),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var v=u.getLayerStyleAttributes();if(v){var y=r.getSource().data.dataArray;if(y.length===0)return;var _=v.filter(function(E){return E.needRescale});_.length&&o.caculateScalesForAttributes(_,y)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,i){var o=this;this.scaleCache={},r.forEach(function(u){if(u.scale){var v=u.scale,y=u.name;v.names=o.parseFields(u.scale.field||[]);var _=[];v.names.forEach(function(E){_.push(o.getOrCreateScale(E,u,i))}),_.some(function(E){return E.type===jh.VARIABLE})?(v.type=jh.VARIABLE,_.forEach(function(E){if(!v.callback){var P;if(v.values&&v.values!=="text"){var I;if(((I=E.option)===null||I===void 0?void 0:I.type)==="linear"&&v.values.length>2){var k=E.scale.ticks(v.values.length);y==="color"&&E.scale.domain(k)}E.scale.range(v.values)}else((P=E.option)===null||P===void 0?void 0:P.type)==="cat"&&E.scale.range(E.option.domain)}})):(v.type=jh.CONSTANT,v.defaultValues=_.map(function(E,P){return E.scale(v.names[P])})),v.scalers=_.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),u.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,i,o){var u,v=[r,i.name].join("_"),y=(u=i.scale)===null||u===void 0?void 0:u.values,_=this.createScale(r,i.name,y,o);return _}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Bs()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,i,o,u){var v,y,_=this.scaleOptions[i]&&((v=this.scaleOptions[i])===null||v===void 0?void 0:v.field)===r?this.scaleOptions[i]:this.scaleOptions[r],E={field:r,scale:void 0,type:jh.VARIABLE,option:_};if(!u||!u.length)return _&&_.type?E.scale=this.createDefaultScale(_):(E.scale=Xv([r]),E.type=jh.CONSTANT),E;var P=(y=u.find(function(B){return!Si()(B[r])}))===null||y===void 0?void 0:y[r];if(this.isNumber(r)||Si()(P)&&!_)E.scale=Xv([r]),E.type=jh.CONSTANT;else{var I=_&&_.type||this.getDefaultType(P);o==="text"&&(I=Qs.CAT);var k=this.createDefaultScaleConfig(I,r,u);Object.assign(k,_),E.scale=this.createDefaultScale(k),E.option=k}return E}},{key:"getDefaultType",value:function(r){var i=Qs.LINEAR;return typeof r=="string"&&(i=PA.test(r)?Qs.TIME:Qs.CAT),i}},{key:"createDefaultScaleConfig",value:function(r,i,o){var u={type:r},v=(o==null?void 0:o.map(function(y){return y[i]}))||[];return r!==Qs.CAT&&r!==Qs.QUANTILE?u.domain=xw(v):r===Qs.CAT?u.domain=Bh()(v):r===Qs.QUANTILE&&(u.domain=v),u}},{key:"createDefaultScale",value:function(r){var i=r.type,o=r.domain,u=IA[i]();return o&&u.domain(o),u}}]),e}(),R_=kn(qm.prototype,"configService",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm))||O_),L_,k_,D_,F_,om,N_,B_;function z_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function RA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?z_(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var LA=(L_=(0,Rr.b2)(),k_=(0,Rr.f3)(Gt.ICameraService),D_=(0,Rr.f3)(Gt.IRendererService),L_(F_=(om=function(){function e(){(0,_t.Z)(this,e),Rn(this,"cameraService",N_,this),Rn(this,"rendererService",B_,this)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(i){i.addUniforms(RA({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),N_=kn(om.prototype,"cameraService",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=kn(om.prototype,"rendererService",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om))||F_),U_,Z_,kA=(U_=(0,Rr.b2)(),U_(Z_=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||Z_),V_,j_,DA=(V_=(0,Rr.b2)(),V_(j_=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var i=r.getLayerConfig(),o=i.autoFit,u=i.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(u)},100)})}}]),e}())||j_),G_,H_,FA=["type"];function W_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function av(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?W_(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var X_={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},NA={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},BA={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},zA={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},KP=null;function UA(e){var n={u_DirectionalLights:new Array(3).fill(av({},BA)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(av({},zA)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[NA]),e.forEach(function(r,i){var o=r.type,u=o===void 0?"directional":o,v=(0,Wn.Z)(r,FA),y=X_[u].lights,_=X_[u].num,E=n[_];n[y][E]=av(av({},n[y][E]),v),n[_]++}),n}var ZA=(G_=(0,Rr.b2)(),G_(H_=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var i=r.getLayerConfig(),o=i.enableLighting;o&&r.models.forEach(function(u){return u.addUniforms(av({},UA()))})})}}]),e}())||H_),Y_,q_,sm={NONE:0,ENCODE:1,HIGHLIGHT:2},VA=(Y_=(0,Rr.b2)(),Y_(q_=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r,i){var o=i.rendererService,u=i.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var v=r.getLayerConfig(),y=v.enablePicking;u.registerStyleAttribute({name:"pickingColor",type:wi.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:p.FLOAT},size:3,update:function(E,P){var I=E.id;return y?Wu(I):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var v=r.getLayerConfig(),y=v.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:sm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var v=r.getLayerConfig(),y=v.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:sm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(v){var y=r.getLayerConfig(),_=y.highlightColor,E=typeof _=="string"?wa(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Hu(new Uint8Array(v))}),r.models.forEach(function(P){return P.addUniforms({u_PickingStage:sm.HIGHLIGHT,u_PickingColor:v,u_HighlightColor:E.map(function(I){return I*255})})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(v){var y=r.getLayerConfig(),_=y.selectColor,E=typeof _=="string"?wa(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Hu(new Uint8Array(v))}),r.models.forEach(function(P){return P.addUniforms({u_PickingStage:sm.HIGHLIGHT,u_PickingColor:v,u_HighlightColor:E.map(function(I){return I*255})})})})}}]),e}())||q_),K_,$_,jA=(K_=(0,Rr.b2)(),K_($_=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(u)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:wi.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:p.FLOAT},size:3,update:function(o,u,v){return v.length===2?[v[0],v[1],0]:[v[0],v[1],v[2]]}}}),r.registerStyleAttribute({name:"filter",type:wi.Attribute,descriptor:{name:"filter",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(o,u){var v=o.filter;return v?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:wi.Attribute,descriptor:{name:"a_Color",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:4,update:function(o,u){var v=o.color;return!v||!v.length?[1,1,1,1]:v}}}),r.registerStyleAttribute({name:"vertexId",type:wi.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:p.DYNAMIC_DRAW,data:[],type:p.FLOAT},size:1,update:function(o,u,v,y){return[u]}}})}}]),e}())||$_),Q_,J_,e1,t1,r1,n1,gd,i1,a1,o1,s1,GA=(Q_=(0,Rr.b2)(),J_=(0,Rr.f3)(Gt.ICameraService),e1=(0,Rr.f3)(Gt.ICoordinateSystemService),t1=(0,Rr.f3)(Gt.IRendererService),r1=(0,Rr.f3)(Gt.IMapService),Q_(n1=(gd=function(){function e(){(0,_t.Z)(this,e),Rn(this,"cameraService",i1,this),Rn(this,"coordinateSystemService",a1,this),Rn(this,"rendererService",o1,this),Rn(this,"mapService",s1,this)}return(0,jt.Z)(e,[{key:"apply",value:function(r){var i=this,o=this.mapService.version,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){i.coordinateSystemService.refresh(),o==="GAODE2.x"&&(u=i.mapService.map.customCoords.getMVPMatrix(),v=i.mapService.getCustomCoordCenter());var y=i.rendererService.getViewportSize(),_=y.width,E=y.height;r.models.forEach(function(P){var I;P.addUniforms((I={},(0,C.Z)(I,Ap.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,C.Z)(I,Ap.ViewMatrix,i.cameraService.getViewMatrix()),(0,C.Z)(I,Ap.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,C.Z)(I,Ap.Zoom,i.cameraService.getZoom()),(0,C.Z)(I,Ap.ZoomScale,i.cameraService.getZoomScale()),(0,C.Z)(I,Ap.FocalDistance,i.cameraService.getFocalDistance()),(0,C.Z)(I,Ap.CameraPosition,i.cameraService.getCameraPosition()),(0,C.Z)(I,To.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,C.Z)(I,To.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,C.Z)(I,To.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,C.Z)(I,To.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,C.Z)(I,To.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,C.Z)(I,To.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,C.Z)(I,To.Mvp,u),(0,C.Z)(I,"u_SceneCenterMKT",v),(0,C.Z)(I,"u_ViewportSize",[_,E]),(0,C.Z)(I,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,C.Z)(I,"u_DevicePixelRatio",oa.devicePixelRatio),(0,C.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,C.Z)(I,"u_shaderPick",Number(r.getShaderPickStat())),I))})})}}]),e}(),i1=kn(gd.prototype,"cameraService",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=kn(gd.prototype,"coordinateSystemService",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=kn(gd.prototype,"rendererService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=kn(gd.prototype,"mapService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||n1),u1,l1,HA=(u1=(0,Rr.b2)(),u1(l1=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||l1),c1,f1,WA=(c1=(0,Rr.b2)(),c1(f1=function(){function e(){(0,_t.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:u})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:u})})}},{key:"updateStyleAtrribute",value:function(r,i){var o=i.styleAttributeService,u=o.getLayerStyleAttributes()||[],v=o.getLayerStyleAttribute("filter"),y=o.getLayerStyleAttribute("shape");if(v&&v.needRegenerateVertices||y&&y.needRegenerateVertices){r.layerModelNeedUpdate=!0,u.forEach(function(_){return _.needRegenerateVertices=!1});return}u.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){o.updateAttributeByFeatureRange(_.name,r.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,i){var o=i.styleAttributeService,u=o.getLayerStyleAttributes()||[];u.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){o.updateAttributeByFeatureRange(v.name,r.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}}]),e}())||f1);ql.bind(Gt.ILayerPlugin).to(gw).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(jA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(OA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(mw).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(DA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(WA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(HA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(Qb).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(GA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(LA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(ZA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(VA).inRequestScope(),ql.bind(Gt.ILayerPlugin).to(kA).inRequestScope();var $P="2.6.6";function h1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function QP(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?h1(Object(r),!0).forEach(function(i){XA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function XA(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function JP(e,n){return $A(e)||KA(e,n)||qA(e,n)||YA()}function YA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qA(e,n){if(!!e){if(typeof e=="string")return p1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p1(e,n)}}function p1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function KA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function $A(e){if(Array.isArray(e))return e}var eI=null,tI=null,d1,Km,v1;function m1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function g1(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?m1(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var QA=(d1=jd(Gt.IGlobalConfigService),Km=function(){function e(n){(0,_t.Z)(this,e),Rn(this,"configService",v1,this),(0,C.Z)(this,"config",void 0),this.config=n}return(0,jt.Z)(e,[{key:"setContainer",value:function(r,i,o,u){r.bind(Gt.MapConfig).toConstantValue(g1(g1({},this.config),{},{id:i,canvas:o,hasBaseMap:u})),r.bind(Gt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),v1=kn(Km.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km),JA=$(84105),eT=$.n(JA),$m;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})($m||($m={}));function ov(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function um(e,n){var r=xe([],n,e);return dt(r,r,1/r[3]),r}function rI(e,n){var r=e%n;return r<0?n+r:r}function nI(e,n,r){return r*n+(1-r)*e}function Np(e,n){if(!e)throw new Error(n||"viewport-mercator-project: assertion failed.")}var Jc=Math.PI,y1=Jc/4,_h=Jc/180,_1=180/Jc,Qm=512,Jm=4003e4,tT=1.5;function x1(e){return Math.pow(2,e)}function rT(e){return Math.log2(e)}function lm(e,n){var r=(0,Pn.Z)(e,2),i=r[0],o=r[1];Np(Number.isFinite(i)&&Number.isFinite(n)),Np(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),n*=Qm;var u=i*_h,v=o*_h,y=n*(u+Jc)/(2*Jc),_=n*(Jc-Math.log(Math.tan(y1+v*.5)))/(2*Jc);return[y,_]}function e0(e,n){var r=(0,Pn.Z)(e,2),i=r[0],o=r[1];n*=Qm;var u=i/n*(2*Jc)-Jc,v=2*(Math.atan(Math.exp(Jc-o/n*(2*Jc)))-y1);return[u*_1,v*_1]}function iI(e){var n=e.latitude;assert(Number.isFinite(n));var r=Math.cos(n*_h);return rT(Jm*r)-9}function b1(e){var n=e.latitude,r=e.longitude,i=e.zoom,o=e.scale,u=e.highPrecision,v=u===void 0?!1:u;o=o!==void 0?o:x1(i),Np(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o));var y={},_=Qm*o,E=Math.cos(n*_h),P=_/360,I=P/E,k=_/Jm/E;if(y.pixelsPerMeter=[k,-k,k],y.metersPerPixel=[1/k,-1/k,1/k],y.pixelsPerDegree=[P,-I,k],y.degreesPerPixel=[1/P,-1/I,1/k],v){var B=_h*Math.tan(n*_h)/E,q=P*B/2,ee=_/Jm*B,se=ee/I*k;y.pixelsPerDegree2=[0,-q,ee],y.pixelsPerMeter2=[se,0,se]}return y}function aI(e,n){var r=_slicedToArray(e,3),i=r[0],o=r[1],u=r[2],v=_slicedToArray(n,3),y=v[0],_=v[1],E=v[2],P=1,I=b1({longitude:i,latitude:o,scale:P,highPrecision:!0}),k=I.pixelsPerMeter,B=I.pixelsPerMeter2,q=lm(e,P);q[0]+=y*(k[0]+B[0]*_),q[1]+=_*(k[1]+B[1]*_);var ee=e0(q,P),se=(u||0)+(E||0);return Number.isFinite(u)||Number.isFinite(E)?[ee[0],ee[1],se]:ee}function nT(e){var n=e.height,r=e.pitch,i=e.bearing,o=e.altitude,u=e.center,v=u===void 0?null:u,y=e.flipY,_=y===void 0?!1:y,E=ov();return Hc(E,E,[0,0,-o]),qi(E,E,[1,1,1/n]),so(E,E,-r*_h),Lh(E,E,i*_h),_&&qi(E,E,[1,-1,1]),v&&Hc(E,E,ja.negate([],v)),E}function iT(e){var n=e.width,r=e.height,i=e.altitude,o=i===void 0?tT:i,u=e.pitch,v=u===void 0?0:u,y=e.nearZMultiplier,_=y===void 0?1:y,E=e.farZMultiplier,P=E===void 0?1:E,I=v*_h,k=Math.atan(.5/o),B=Math.sin(k)*o/Math.sin(Math.PI/2-I-k),q=Math.cos(Math.PI/2-I)*B+o;return{fov:2*Math.atan(r/2/o),aspect:n/r,focalDistance:o,near:_,far:q*P}}function aT(e){var n=e.width,r=e.height,i=e.pitch,o=e.altitude,u=e.nearZMultiplier,v=e.farZMultiplier,y=iT({width:n,height:r,altitude:o,pitch:i,nearZMultiplier:u,farZMultiplier:v}),_=y.fov,E=y.aspect,P=y.near,I=y.far,k=Kp([],_,E,P,I);return k}function oT(e,n){var r=(0,Pn.Z)(e,3),i=r[0],o=r[1],u=r[2],v=u===void 0?0:u;return Np(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(v)),um(n,[i,o,v,1])}function E1(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Pn.Z)(e,3),o=i[0],u=i[1],v=i[2];if(Np(Number.isFinite(o)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(v)){var y=um(n,[o,u,v,1]);return y}var _=um(n,[o,u,0,1]),E=um(n,[o,u,1,1]),P=_[2],I=E[2],k=P===I?0:((r||0)-P)/(I-P);return ki.lerp([],_,E,k)}var S1=ov(),sT=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,o=n.viewMatrix,u=o===void 0?S1:o,v=n.projectionMatrix,y=v===void 0?S1:v;(0,_t.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=y;var _=ov();xu(_,_,this.projectionMatrix),xu(_,_,this.viewMatrix),this.viewProjectionMatrix=_;var E=ov();qi(E,E,[this.width/2,-this.height/2,1]),Hc(E,E,[1,-1,0]),xu(E,E,this.viewProjectionMatrix);var P=Qu(ov(),E);if(!P)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=P,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,jt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&_r(r.projectionMatrix,this.projectionMatrix)&&_r(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,u=o===void 0?!0:o,v=this.projectPosition(r),y=oT(v,this.pixelProjectionMatrix),_=(0,Pn.Z)(y,2),E=_[0],P=_[1],I=u?P:this.height-P;return r.length===2?[E,I]:[E,I,y[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,u=o===void 0?!0:o,v=i.targetZ,y=(0,Pn.Z)(r,3),_=y[0],E=y[1],P=y[2],I=u?E:this.height-E,k=v&&v*this.pixelsPerMeter,B=E1([_,I,P],this.pixelUnprojectionMatrix,k),q=this.unprojectPosition(B),ee=(0,Pn.Z)(q,3),se=ee[0],De=ee[1],Je=ee[2];return Number.isFinite(P)?[se,De,Je]:Number.isFinite(v)?[se,De,v]:[se,De]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),o=(0,Pn.Z)(i,2),u=o[0],v=o[1],y=(r[2]||0)*this.pixelsPerMeter;return[u,v,y]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),o=(0,Pn.Z)(i,2),u=o[0],v=o[1],y=(r[2]||0)/this.pixelsPerMeter;return[u,v,y]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function uT(e){var n=e.width,r=e.height,i=e.bounds,o=e.minExtent,u=o===void 0?0:o,v=e.maxZoom,y=v===void 0?24:v,_=e.padding,E=_===void 0?0:_,P=e.offset,I=P===void 0?[0,0]:P,k=(0,Pn.Z)(i,2),B=(0,Pn.Z)(k[0],2),q=B[0],ee=B[1],se=(0,Pn.Z)(k[1],2),De=se[0],Je=se[1];if(Number.isFinite(E)){var ht=E;E={top:ht,bottom:ht,left:ht,right:ht}}else Np(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var gt=new w1({width:n,height:r,longitude:0,latitude:0,zoom:0}),Nt=gt.project([q,Je]),Vt=gt.project([De,ee]),nr=[Math.max(Math.abs(Vt[0]-Nt[0]),u),Math.max(Math.abs(Vt[1]-Nt[1]),u)],dr=[n-E.left-E.right-Math.abs(I[0])*2,r-E.top-E.bottom-Math.abs(I[1])*2];Np(dr[0]>0&&dr[1]>0);var Jr=dr[0]/nr[0],ln=dr[1]/nr[1],Er=(E.right-E.left)/2/Jr,In=(E.bottom-E.top)/2/ln,Vn=[(Vt[0]+Nt[0])/2+Er,(Vt[1]+Nt[1])/2+In],pi=gt.unproject(Vn),Ro=gt.zoom+Math.log2(Math.abs(Math.min(Jr,ln)));return{longitude:pi[0],latitude:pi[1],zoom:Math.min(Ro,y)}}var w1=function(e){(0,Hr.Z)(n,e);function n(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=i.width,u=i.height,v=i.latitude,y=v===void 0?0:v,_=i.longitude,E=_===void 0?0:_,P=i.zoom,I=P===void 0?0:P,k=i.pitch,B=k===void 0?0:k,q=i.bearing,ee=q===void 0?0:q,se=i.altitude,De=se===void 0?1.5:se,Je=i.nearZMultiplier,ht=i.farZMultiplier;(0,_t.Z)(this,n),o=o||1,u=u||1;var gt=x1(I);De=Math.max(.75,De);var Nt=lm([E,y],gt);Nt[2]=0;var Vt=aT({width:o,height:u,pitch:B,bearing:ee,altitude:De,nearZMultiplier:Je||1/u,farZMultiplier:ht||1.01}),nr=nT({height:u,center:Nt,pitch:B,bearing:ee,altitude:De,flipY:!0});return r=(0,En.Z)(this,(0,Dt.Z)(n).call(this,{width:o,height:u,viewMatrix:nr,projectionMatrix:Vt})),r.latitude=y,r.longitude=E,r.zoom=I,r.pitch=B,r.bearing=ee,r.altitude=De,r.scale=gt,r.center=Nt,r.pixelsPerMeter=b1((0,ye.Z)((0,ye.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ye.Z)((0,ye.Z)(r))),r}return(0,jt.Z)(n,[{key:"projectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return lm(i,o)}},{key:"unprojectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return e0(i,o)}},{key:"getMapCenterByLngLatPosition",value:function(i){var o=i.lngLat,u=i.pos,v=E1(u,this.pixelUnprojectionMatrix),y=lm(o,this.scale),_=ki.add([],y,ki.negate([],v)),E=ki.add([],this.center,_);return e0(E,this.scale)}},{key:"getLocationAtPoint",value:function(i){var o=i.lngLat,u=i.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:u})}},{key:"fitBounds",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,v=this.height,y=uT(Object.assign({width:u,height:v,bounds:i},o)),_=y.longitude,E=y.latitude,P=y.zoom;return new n({width:u,height:v,longitude:_,latitude:E,zoom:P})}}]),n}(sT),lT=function(){function e(){(0,_t.Z)(this,e),(0,C.Z)(this,"viewport",void 0)}return(0,jt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var i=r.center,o=r.zoom,u=r.pitch,v=r.bearing,y=r.viewportHeight,_=r.viewportWidth;this.viewport=new w1({width:_,height:y,longitude:i&&i[0],latitude:i&&i[1],zoom:o,pitch:u,bearing:v})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}}]),e}(),C1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},cT=["id","attributionControl","style","token","rotation","mapInstance"],A1,T1,M1,P1,I1,O1,yd,R1,L1,k1,D1;function F1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function fT(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?F1(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function hT(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var v=n.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=e:v.appendChild(n.createTextNode(e)),o.appendChild(v),v}}hT(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=eT();var N1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},pT=0,dT=12,B1="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",vT=(A1=(0,Rr.b2)(),T1=(0,Rr.f3)(Gt.MapConfig),M1=(0,Rr.f3)(Gt.IGlobalConfigService),P1=(0,Rr.f3)(Gt.ICoordinateSystemService),I1=(0,Rr.f3)(Gt.IEventEmitter),A1(O1=(yd=function(){function e(){var n=this;(0,_t.Z)(this,e),(0,C.Z)(this,"version",$m.MAPBOX),(0,C.Z)(this,"map",void 0),(0,C.Z)(this,"dragging",!1),(0,C.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Rn(this,"config",R1,this),Rn(this,"configService",L1,this),Rn(this,"coordinateSystemService",k1,this),Rn(this,"eventEmitter",D1,this),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"markerContainer",void 0),(0,C.Z)(this,"cameraChangedCallback",void 0),(0,C.Z)(this,"$mapContainer",void 0),(0,C.Z)(this,"handleCameraChanged",function(){var r=n.map.getCenter().wrap(),i=r.lat,o=r.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[o,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var u=n.config.offsetZoom,v=u===void 0?dT:u;n.viewport.getZoom()>v?n.coordinateSystemService.setCoordinateSystem(Rs.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(Rs.LNGLAT),n.cameraChangedCallback(n.viewport)})}return(0,jt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=za("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,i){lb.indexOf(r)!==-1?this.eventEmitter.on(r,i):this.map.on(N1[r]||r,i)}},{key:"off",value:function(r,i){this.map.off(N1[r]||r,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,i){this.map.zoomIn(r,i)}},{key:"zoomOut",value:function(r,i){this.map.zoomOut(r,i)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,i){this.panTo([r,i])}},{key:"fitBounds",value:function(r,i){this.map.fitBounds(r,i)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,i){this.map.flyTo({zoom:r,center:i})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),u=o.x,v=o.y;return[u-i.x,v-i.y]}},{key:"lngLatToMercator",value:function(r,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),u=o.x,v=u===void 0?0:u,y=o.y,_=y===void 0?0:y,E=o.z,P=E===void 0?0:E;return{x:v,y:_,z:P}}},{key:"getModelMatrix",value:function(r,i,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},y=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),_=y.meterInMercatorCoordinateUnits(),E=_u();return Hc(E,E,ja.fromValues(y.x-v.x,y.y-v.y,y.z||0-v.z)),qi(E,E,ja.fromValues(_*u[0],-_*u[1],_*u[2])),so(E,E,o[0]),Os(E,E,o[1]),Lh(E,E,o[2]),E}},{key:"init",value:function(){var n=(0,Ls.Z)(t().mark(function i(){var o=this,u,v,y,_,E,P,I,k,B,q,ee,se,De;return t().wrap(function(ht){for(;;)switch(ht.prev=ht.next){case 0:u=this.config,v=u.id,y=v===void 0?"map":v,_=u.attributionControl,E=_===void 0?!1:_,P=u.style,I=P===void 0?"light":P,k=u.token,B=k===void 0?B1:k,q=u.rotation,ee=q===void 0?0:q,se=u.mapInstance,De=(0,Wn.Z)(u,cT),this.viewport=new lT,!se&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),B===B1&&I!=="blank"&&!window.mapboxgl.accessToken&&!se&&console.warn(this.configService.getSceneWarninfo("MapToken")),!se&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=B),se?(this.map=se,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(fT({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:E,bearing:ee},De))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return ht.stop()}},i,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,i;(r=this.$mapContainer)===null||r===void 0||(i=r.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),v=1;v<o;v++)u[v-1]=arguments[v];(i=this.eventEmitter).emit.apply(i,[r].concat(u))}},{key:"once",value:function(r){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),v=1;v<o;v++)u[v-1]=arguments[v];(i=this.eventEmitter).once.apply(i,[r].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var i=this.map.getCanvas(),o=r==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var i=r;typeof r=="string"&&(i=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+pT++,i.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:C1[r]?C1[r]:r}}]),e}(),R1=kn(yd.prototype,"config",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L1=kn(yd.prototype,"configService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=kn(yd.prototype,"coordinateSystemService",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=kn(yd.prototype,"eventEmitter",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||O1);function mT(e){var n=gT();return function(){var i=(0,Dt.Z)(e),o;if(n){var u=(0,Dt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,En.Z)(this,o)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function yT(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var v=n.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=e:v.appendChild(n.createTextNode(e)),o.appendChild(v),v}}yT(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var _T=function(e){(0,Hr.Z)(r,e);var n=mT(r);function r(){return(0,_t.Z)(this,r),n.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getServiceConstructor",value:function(){return vT}}]),r}(QA);function z1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function U1(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?z1(Object(r),!0).forEach(function(i){xT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function bT(e,n){return CT(e)||wT(e,n)||ST(e,n)||ET()}function ET(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ST(e,n){if(!!e){if(typeof e=="string")return Z1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z1(e,n)}}function Z1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function wT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function CT(e){if(Array.isArray(e))return e}var AT=me.memo(function(e){var n=e.style,r=e.className,i=e.map,o=e.option,u=e.onSceneLoaded,v=(0,me.createRef)(),y=(0,me.useState)(),_=bT(y,2),E=_[0],P=_[1];return(0,me.useEffect)(function(){var I=new qb(U1(U1({id:v.current},o),{},{map:new _T(i)}));return I.on("loaded",function(){P(I),u&&u(I)}),function(){I.destroy()}},[]),(0,me.useEffect)(function(){E&&i.style&&E.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,me.useEffect)(function(){E&&i.zoom&&E.setZoom(i.zoom)},[i.zoom]),(0,me.useEffect)(function(){E&&i.center&&E.setCenter(i.center)},[JSON.stringify(i.center)]),(0,me.useEffect)(function(){E&&i.pitch!==void 0&&E.setPitch(i.pitch||0)},[i.pitch]),(0,me.useEffect)(function(){E&&i.rotation&&E.setRotation(i.rotation)},[i.rotation]),me.createElement(m.Provider,{value:E},(0,me.createElement)("div",{ref:v,style:n,className:r},E&&e.children))}),TT=AT;function V1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function oI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?V1(Object(r),!0).forEach(function(i){MT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function MT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function sI(e,n){return RT(e)||OT(e,n)||IT(e,n)||PT()}function PT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IT(e,n){if(!!e){if(typeof e=="string")return j1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j1(e,n)}}function j1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function OT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function RT(e){if(Array.isArray(e))return e}var uI=null,lI=null;function G1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function cI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?G1(Object(r),!0).forEach(function(i){LT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function LT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function fI(e,n){return NT(e)||FT(e,n)||DT(e,n)||kT()}function kT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DT(e,n){if(!!e){if(typeof e=="string")return H1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H1(e,n)}}function H1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function FT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function NT(e){if(Array.isArray(e))return e}var hI=null,pI=null;function dI(e,n){return ZT(e)||UT(e,n)||zT(e,n)||BT()}function BT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zT(e,n){if(!!e){if(typeof e=="string")return W1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W1(e,n)}}function W1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function UT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function ZT(e){if(Array.isArray(e))return e}var vI=null,mI=null;function X1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function gI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?X1(Object(r),!0).forEach(function(i){VT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function VT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function yI(e,n){if(e==null)return{};var r=jT(e,n),i,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)i=u[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function jT(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,u;for(u=0;u<i.length;u++)o=i[u],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var _I=null,Y1=$(5672);function q1(e,n){return XT(e)||WT(e,n)||HT(e,n)||GT()}function GT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HT(e,n){if(!!e){if(typeof e=="string")return K1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K1(e,n)}}function K1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function WT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function XT(e){if(Array.isArray(e))return e}var $1=me.useEffect,Q1=me.useState,YT=/\B([A-Z])/g,qT=function(n){return n.replace(YT,"-$1").toLowerCase()};function xI(e){var n=e.className,r=e.style,i=e.children,o=e.position,u=Q1(),v=q1(u,2),y=v[0],_=v[1],E=useSceneValue(),P=Q1(function(){return document.createElement("div")}),I=q1(P,1),k=I[0];return $1(function(){var B=new Control({position:o});return B.onAdd=function(){if(n&&(k.className=n),r){var q=Object.keys(r).map(function(ee){return"".concat(qT(ee),":").concat(r[ee])}).join(";");k.style.cssText=q}return k},B.onRemove=function(){},_(B),E.addControl(B),function(){E.removeControl(B)}},[]),$1(function(){y&&y.setPosition(o||"bottomleft")},[o]),createPortal(i,k)}var J1=(0,me.createContext)({});function bI(){return useContext(J1)}var Df=$(89392),EI=me.useEffect,KT=me.memo(function(n){var r=n.layer,i=n.active;return r.active(i.option),null},Df.isEqual),SI=me.useEffect,$T=me.memo(function(n){var r=n.layer,i=n.animate;return r.animate(i),null},Df.isEqual),wI=me.useEffect,QT=me.memo(function(n){var r=n.layer,i=n.color;return i.field?r.color(i.field,i.values):r.color(i.values),null},Df.isEqual),JT=me.memo(function(n){var r=n.layer,i=n.filter;return i.field&&r.filter(i.field,i.values),null},Df.isEqual),eM=me.memo(function(n){var r=n.layer,i=n.scale;return r.scale(i.values),null},Df.isEqual),CI=me.useEffect,tM=me.memo(function(n){var r=n.layer,i=n.select;return r.select(i.option),null},Df.isEqual),rM=me.memo(function(n){var r=n.layer,i=n.shape;return i.field?r.shape(i.field,i.values):r.shape(i.values),null},Df.isEqual),nM=me.memo(function(n){var r=n.layer,i=n.size;return i.field?r.size(i.field,i.values):r.size(i.values),null},Df.isEqual),iM=["data"];function aM(e,n){if(e==null)return{};var r=oM(e,n),i,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)i=u[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function oM(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,u;for(u=0;u<i.length;u++)o=i[u],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var sM=me.memo(function(n){var r=n.layer,i=n.source,o=i.data,u=aM(i,iM);return r.inited?r.setData(o,u):r.source(o,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},Df.isEqual),AI=me.useEffect,uM=me.memo(function(n){var r=n.layer,i=n.style;return r.style(i),null},Df.isEqual);function lM(e,n){return pM(e)||hM(e,n)||fM(e,n)||cM()}function cM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fM(e,n){if(!!e){if(typeof e=="string")return ex(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ex(e,n)}}function ex(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function hM(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(i.push(v.value),!(n&&i.length===n));o=!0);}catch(_){u=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return i}}function pM(e){if(Array.isArray(e))return e}var sv=me.useEffect,dM=me.useState;function tx(e,n){var r=n.source,i=n.color,o=n.shape,u=n.style,v=n.size,y=n.scale,_=n.active,E=n.select,P=n.filter,I=n.animate,k=n.options,B=n.onLayerLoaded,q=Ie(),ee=dM(function(){var Je;switch(e){case"polygonLayer":Je=new ay(k);break;case"lineLayer":Je=new eS(k);break;case"pointLayer":Je=new ZS(k);break;case"heatmapLayer":Je=new f2(k);break;case"rasterLayer":Je=new dw(k);break;case"imageLayer":Je=new b2(k);break;case"citybuildingLayer":Je=new FE(k);break;default:Je=new ay(k)}return Je.on("inited",function(){B&&B(Je,q)}),Je}),se=lM(ee,1),De=se[0];return sv(function(){return q.addLayer(De),function(){q.removeLayer(De)}},[]),sv(function(){De.inited&&k&&De.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),sv(function(){De.inited&&(k==null?void 0:k.zIndex)&&De.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),sv(function(){De.inited&&(k==null?void 0:k.blend)&&De.setBlend(k.blend)},[k==null?void 0:k.blend]),sv(function(){q.render()}),me.createElement(J1.Provider,{value:De},me.createElement(sM,{layer:De,source:r}),y&&me.createElement(eM,{layer:De,scale:y}),i&&me.createElement(QT,{layer:De,color:i}),v&&me.createElement(nM,{layer:De,size:v}),o&&me.createElement(rM,{layer:De,shape:o}),u&&me.createElement(uM,{layer:De,style:u}),_&&me.createElement(KT,{layer:De,active:_}),E&&me.createElement(tM,{layer:De,select:E}),P&&me.createElement(JT,{layer:De,filter:P}),I&&me.createElement($T,{layer:De,animate:I}),n.children)}var TI=null,MI=null,vM=me.memo(function(n){return tx("pointLayer",n)}),mM=me.memo(function(n){return tx("heatmapLayer",n)}),PI=null,II=null,OI=null,RI=me.useEffect,LI=null,kI=null;function cm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?cm=function(r){return typeof r}:cm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},cm(e)}function rx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function fm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?rx(Object(r),!0).forEach(function(i){gM(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function gM(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function yM(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function nx(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _M(e,n,r){return n&&nx(e.prototype,n),r&&nx(e,r),e}function xM(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t0(e,n)}function t0(e,n){return t0=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},t0(e,n)}function bM(e){var n=wM();return function(){var i=hm(e),o;if(n){var u=hm(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return EM(this,o)}}function EM(e,n){if(n&&(cm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SM(e)}function SM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function hm(e){return hm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},hm(e)}var DI=function(e){xM(r,e);var n=bM(r);function r(i){var o;return yM(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return _M(r,[{key:"componentDidMount",value:function(){var o,u=this.props,v=u.lnglat,y=u.children,_=u.option,E=u.lngLat,P=new X0(fm(fm({},_),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));v&&P.setLnglat(v),E&&P.setLnglat(E),y&&P.setDOMContent(this.el),this.popup=P,this.scene.addPopup(P)}},{key:"componentDidUpdate",value:function(o){var u,v,y,_,E,P,I=Array.isArray(o.lnglat)?o.lnglat:[o==null||(u=o.lnglat)===null||u===void 0?void 0:u.lng,o==null||(v=o.lnglat)===null||v===void 0?void 0:v.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(y=this.props)===null||y===void 0||(_=y.lnglat)===null||_===void 0?void 0:_.lng,(E=this.props)===null||E===void 0||(P=E.lnglat)===null||P===void 0?void 0:P.lat],B=I.toString()!==k.toString();if(B){var q;this.popup.remove(),this.popup=new X0(fm(fm({},this.props.option),{},{stopPropagation:(q=this.props.option)===null||q===void 0?void 0:q.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return me.createElement(m.Consumer,{},function(u){return u&&(o.scene=u),(0,Y1.createPortal)(o.props.children,o.el)})}}]),r}(me.PureComponent);function pm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pm=function(r){return typeof r}:pm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pm(e)}function CM(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ix(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function AM(e,n,r){return n&&ix(e.prototype,n),r&&ix(e,r),e}function TM(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&r0(e,n)}function r0(e,n){return r0=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},r0(e,n)}function MM(e){var n=OM();return function(){var i=dm(e),o;if(n){var u=dm(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return PM(this,o)}}function PM(e,n){if(n&&(pm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return IM(e)}function IM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function OM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dm(e){return dm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},dm(e)}var FI=function(e){TM(r,e);var n=MM(r);function r(i){var o;return CM(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return AM(r,[{key:"componentDidMount",value:function(){var o=this.props,u=o.lnglat,v=o.children,y=o.option,_=o.onMarkerLoaded,E=new V0(y);u&&E.setLnglat(u),v&&E.setElement(this.el),this.marker=E,_&&_(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(o){var u,v=(o==null?void 0:o.lnglat.toString())!==((u=this.props)===null||u===void 0?void 0:u.lnglat.toString());v&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return me.createElement(m.Consumer,{},function(u){return u&&(o.scene=u),(0,Y1.createPortal)(o.props.children,o.el)})}}]),r}(me.PureComponent),NI=me.useEffect,BI=null,zI=null,UI=me.useEffect,ZI=null},59424:function(Cr,te,$){"use strict";$.d(te,{Z:function(){return m}});var Pe=$(78473);function me(Ie,G){for(;!Object.prototype.hasOwnProperty.call(Ie,G)&&(Ie=(0,Pe.Z)(Ie),Ie!==null););return Ie}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(G,ce,he){var Fe=me(G,ce);if(!!Fe){var ge=Object.getOwnPropertyDescriptor(Fe,ce);return ge.get?ge.get.call(arguments.length<3?G:he):ge.value}},m.apply(this,arguments)}},42512:function(Cr,te,$){var Pe=$(48027);Cr.exports.geometry=me,Cr.exports.ring=Ie;function me(ce){var he=0,Fe;switch(ce.type){case"Polygon":return m(ce.coordinates);case"MultiPolygon":for(Fe=0;Fe<ce.coordinates.length;Fe++)he+=m(ce.coordinates[Fe]);return he;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Fe=0;Fe<ce.geometries.length;Fe++)he+=me(ce.geometries[Fe]);return he}}function m(ce){var he=0;if(ce&&ce.length>0){he+=Math.abs(Ie(ce[0]));for(var Fe=1;Fe<ce.length;Fe++)he-=Math.abs(Ie(ce[Fe]))}return he}function Ie(ce){var he,Fe,ge,Qe,ct,xt,Qt,ur=0,Mt=ce.length;if(Mt>2){for(Qt=0;Qt<Mt;Qt++)Qt===Mt-2?(Qe=Mt-2,ct=Mt-1,xt=0):Qt===Mt-1?(Qe=Mt-1,ct=0,xt=1):(Qe=Qt,ct=Qt+1,xt=Qt+2),he=ce[Qe],Fe=ce[ct],ge=ce[xt],ur+=(G(ge[0])-G(he[0]))*Math.sin(G(Fe[1]));ur=ur*Pe.RADIUS*Pe.RADIUS/2}return ur}function G(ce){return ce*Math.PI/180}},56928:function(Cr,te,$){var Pe=$(42512);Cr.exports=me;function me(Fe,ge){switch(Fe&&Fe.type||null){case"FeatureCollection":return Fe.features=Fe.features.map(m(me,ge)),Fe;case"GeometryCollection":return Fe.geometries=Fe.geometries.map(m(me,ge)),Fe;case"Feature":return Fe.geometry=me(Fe.geometry,ge),Fe;case"Polygon":case"MultiPolygon":return Ie(Fe,ge);default:return Fe}}function m(Fe,ge){return function(Qe){return Fe(Qe,ge)}}function Ie(Fe,ge){return Fe.type==="Polygon"?Fe.coordinates=G(Fe.coordinates,ge):Fe.type==="MultiPolygon"&&(Fe.coordinates=Fe.coordinates.map(m(G,ge))),Fe}function G(Fe,ge){ge=!!ge,Fe[0]=ce(Fe[0],ge);for(var Qe=1;Qe<Fe.length;Qe++)Fe[Qe]=ce(Fe[Qe],!ge);return Fe}function ce(Fe,ge){return he(Fe)===ge?Fe:Fe.reverse()}function he(Fe){return Pe.ring(Fe)>=0}},11549:function(){},83628:function(Cr){"use strict";Cr.exports=te,Cr.exports.default=te;function te(C,Ee,Re){Re=Re||2;var yt=Ee&&Ee.length,ft=yt?Ee[0]*Re:C.length,It=$(C,0,ft,Re,!0),Ht=[];if(!It||It.next===It.prev)return Ht;var xr,Kn,dn,di,jn,ni,vi;if(yt&&(It=he(C,Ee,It,Re)),C.length>80*Re){xr=dn=C[0],Kn=di=C[1];for(var Hn=Re;Hn<ft;Hn+=Re)jn=C[Hn],ni=C[Hn+1],jn<xr&&(xr=jn),ni<Kn&&(Kn=ni),jn>dn&&(dn=jn),ni>di&&(di=ni);vi=Math.max(dn-xr,di-Kn),vi=vi!==0?1/vi:0}return me(It,Ht,Re,xr,Kn,vi),Ht}function $(C,Ee,Re,yt,ft){var It,Ht;if(ft===en(C,Ee,Re,yt)>0)for(It=Ee;It<Re;It+=yt)Ht=Xt(It,C[It],C[It+1],Ht);else for(It=Re-yt;It>=Ee;It-=yt)Ht=Xt(It,C[It],C[It+1],Ht);return Ht&&pt(Ht,Ht.next)&&(Sr(Ht),Ht=Ht.next),Ht}function Pe(C,Ee){if(!C)return C;Ee||(Ee=C);var Re=C,yt;do if(yt=!1,!Re.steiner&&(pt(Re,Re.next)||lt(Re.prev,Re,Re.next)===0)){if(Sr(Re),Re=Ee=Re.prev,Re===Re.next)break;yt=!0}else Re=Re.next;while(yt||Re!==Ee);return Ee}function me(C,Ee,Re,yt,ft,It,Ht){if(!!C){!Ht&&It&&xt(C,yt,ft,It);for(var xr=C,Kn,dn;C.prev!==C.next;){if(Kn=C.prev,dn=C.next,It?Ie(C,yt,ft,It):m(C)){Ee.push(Kn.i/Re),Ee.push(C.i/Re),Ee.push(dn.i/Re),Sr(C),C=dn.next,xr=dn.next;continue}if(C=dn,C===xr){Ht?Ht===1?(C=G(Pe(C),Ee,Re),me(C,Ee,Re,yt,ft,It,2)):Ht===2&&ce(C,Ee,Re,yt,ft,It):me(Pe(C),Ee,Re,yt,ft,It,1);break}}}}function m(C){var Ee=C.prev,Re=C,yt=C.next;if(lt(Ee,Re,yt)>=0)return!1;for(var ft=C.next.next;ft!==C.prev;){if(Jt(Ee.x,Ee.y,Re.x,Re.y,yt.x,yt.y,ft.x,ft.y)&&lt(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0}function Ie(C,Ee,Re,yt){var ft=C.prev,It=C,Ht=C.next;if(lt(ft,It,Ht)>=0)return!1;for(var xr=ft.x<It.x?ft.x<Ht.x?ft.x:Ht.x:It.x<Ht.x?It.x:Ht.x,Kn=ft.y<It.y?ft.y<Ht.y?ft.y:Ht.y:It.y<Ht.y?It.y:Ht.y,dn=ft.x>It.x?ft.x>Ht.x?ft.x:Ht.x:It.x>Ht.x?It.x:Ht.x,di=ft.y>It.y?ft.y>Ht.y?ft.y:Ht.y:It.y>Ht.y?It.y:Ht.y,jn=ur(xr,Kn,Ee,Re,yt),ni=ur(dn,di,Ee,Re,yt),vi=C.prevZ,Hn=C.nextZ;vi&&vi.z>=jn&&Hn&&Hn.z<=ni;){if(vi!==C.prev&&vi!==C.next&&Jt(ft.x,ft.y,It.x,It.y,Ht.x,Ht.y,vi.x,vi.y)&&lt(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,Hn!==C.prev&&Hn!==C.next&&Jt(ft.x,ft.y,It.x,It.y,Ht.x,Ht.y,Hn.x,Hn.y)&&lt(Hn.prev,Hn,Hn.next)>=0))return!1;Hn=Hn.nextZ}for(;vi&&vi.z>=jn;){if(vi!==C.prev&&vi!==C.next&&Jt(ft.x,ft.y,It.x,It.y,Ht.x,Ht.y,vi.x,vi.y)&&lt(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;Hn&&Hn.z<=ni;){if(Hn!==C.prev&&Hn!==C.next&&Jt(ft.x,ft.y,It.x,It.y,Ht.x,Ht.y,Hn.x,Hn.y)&&lt(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.nextZ}return!0}function G(C,Ee,Re){var yt=C;do{var ft=yt.prev,It=yt.next.next;!pt(ft,It)&&ir(ft,yt,yt.next,It)&&Ye(ft,It)&&Ye(It,ft)&&(Ee.push(ft.i/Re),Ee.push(yt.i/Re),Ee.push(It.i/Re),Sr(yt),Sr(yt.next),yt=C=It),yt=yt.next}while(yt!==C);return Pe(yt)}function ce(C,Ee,Re,yt,ft,It){var Ht=C;do{for(var xr=Ht.next.next;xr!==Ht.prev;){if(Ht.i!==xr.i&&zt(Ht,xr)){var Kn=Ke(Ht,xr);Ht=Pe(Ht,Ht.next),Kn=Pe(Kn,Kn.next),me(Ht,Ee,Re,yt,ft,It),me(Kn,Ee,Re,yt,ft,It);return}xr=xr.next}Ht=Ht.next}while(Ht!==C)}function he(C,Ee,Re,yt){var ft=[],It,Ht,xr,Kn,dn;for(It=0,Ht=Ee.length;It<Ht;It++)xr=Ee[It]*yt,Kn=It<Ht-1?Ee[It+1]*yt:C.length,dn=$(C,xr,Kn,yt,!1),dn===dn.next&&(dn.steiner=!0),ft.push(Mt(dn));for(ft.sort(Fe),It=0;It<ft.length;It++)Re=ge(ft[It],Re),Re=Pe(Re,Re.next);return Re}function Fe(C,Ee){return C.x-Ee.x}function ge(C,Ee){var Re=Qe(C,Ee);if(!Re)return Ee;var yt=Ke(Re,C),ft=Pe(Re,Re.next);return Pe(yt,yt.next),Ee===Re?ft:Ee}function Qe(C,Ee){var Re=Ee,yt=C.x,ft=C.y,It=-Infinity,Ht;do{if(ft<=Re.y&&ft>=Re.next.y&&Re.next.y!==Re.y){var xr=Re.x+(ft-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(xr<=yt&&xr>It){if(It=xr,xr===yt){if(ft===Re.y)return Re;if(ft===Re.next.y)return Re.next}Ht=Re.x<Re.next.x?Re:Re.next}}Re=Re.next}while(Re!==Ee);if(!Ht)return null;if(yt===It)return Ht;var Kn=Ht,dn=Ht.x,di=Ht.y,jn=Infinity,ni;Re=Ht;do yt>=Re.x&&Re.x>=dn&&yt!==Re.x&&Jt(ft<di?yt:It,ft,dn,di,ft<di?It:yt,ft,Re.x,Re.y)&&(ni=Math.abs(ft-Re.y)/(yt-Re.x),Ye(Re,C)&&(ni<jn||ni===jn&&(Re.x>Ht.x||Re.x===Ht.x&&ct(Ht,Re)))&&(Ht=Re,jn=ni)),Re=Re.next;while(Re!==Kn);return Ht}function ct(C,Ee){return lt(C.prev,C,Ee.prev)<0&&lt(Ee.next,C,C.next)<0}function xt(C,Ee,Re,yt){var ft=C;do ft.z===null&&(ft.z=ur(ft.x,ft.y,Ee,Re,yt)),ft.prevZ=ft.prev,ft.nextZ=ft.next,ft=ft.next;while(ft!==C);ft.prevZ.nextZ=null,ft.prevZ=null,Qt(ft)}function Qt(C){var Ee,Re,yt,ft,It,Ht,xr,Kn,dn=1;do{for(Re=C,C=null,It=null,Ht=0;Re;){for(Ht++,yt=Re,xr=0,Ee=0;Ee<dn&&(xr++,yt=yt.nextZ,!!yt);Ee++);for(Kn=dn;xr>0||Kn>0&&yt;)xr!==0&&(Kn===0||!yt||Re.z<=yt.z)?(ft=Re,Re=Re.nextZ,xr--):(ft=yt,yt=yt.nextZ,Kn--),It?It.nextZ=ft:C=ft,ft.prevZ=It,It=ft;Re=yt}It.nextZ=null,dn*=2}while(Ht>1);return C}function ur(C,Ee,Re,yt,ft){return C=32767*(C-Re)*ft,Ee=32767*(Ee-yt)*ft,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,C|Ee<<1}function Mt(C){var Ee=C,Re=C;do(Ee.x<Re.x||Ee.x===Re.x&&Ee.y<Re.y)&&(Re=Ee),Ee=Ee.next;while(Ee!==C);return Re}function Jt(C,Ee,Re,yt,ft,It,Ht,xr){return(ft-Ht)*(Ee-xr)-(C-Ht)*(It-xr)>=0&&(C-Ht)*(yt-xr)-(Re-Ht)*(Ee-xr)>=0&&(Re-Ht)*(It-xr)-(ft-Ht)*(yt-xr)>=0}function zt(C,Ee){return C.next.i!==Ee.i&&C.prev.i!==Ee.i&&!ot(C,Ee)&&(Ye(C,Ee)&&Ye(Ee,C)&&bt(C,Ee)&&(lt(C.prev,C,Ee.prev)||lt(C,Ee.prev,Ee))||pt(C,Ee)&&lt(C.prev,C,C.next)>0&&lt(Ee.prev,Ee,Ee.next)>0)}function lt(C,Ee,Re){return(Ee.y-C.y)*(Re.x-Ee.x)-(Ee.x-C.x)*(Re.y-Ee.y)}function pt(C,Ee){return C.x===Ee.x&&C.y===Ee.y}function ir(C,Ee,Re,yt){var ft=Wt(lt(C,Ee,Re)),It=Wt(lt(C,Ee,yt)),Ht=Wt(lt(Re,yt,C)),xr=Wt(lt(Re,yt,Ee));return!!(ft!==It&&Ht!==xr||ft===0&&W(C,Re,Ee)||It===0&&W(C,yt,Ee)||Ht===0&&W(Re,C,yt)||xr===0&&W(Re,Ee,yt))}function W(C,Ee,Re){return Ee.x<=Math.max(C.x,Re.x)&&Ee.x>=Math.min(C.x,Re.x)&&Ee.y<=Math.max(C.y,Re.y)&&Ee.y>=Math.min(C.y,Re.y)}function Wt(C){return C>0?1:C<0?-1:0}function ot(C,Ee){var Re=C;do{if(Re.i!==C.i&&Re.next.i!==C.i&&Re.i!==Ee.i&&Re.next.i!==Ee.i&&ir(Re,Re.next,C,Ee))return!0;Re=Re.next}while(Re!==C);return!1}function Ye(C,Ee){return lt(C.prev,C,C.next)<0?lt(C,Ee,C.next)>=0&&lt(C,C.prev,Ee)>=0:lt(C,Ee,C.prev)<0||lt(C,C.next,Ee)<0}function bt(C,Ee){var Re=C,yt=!1,ft=(C.x+Ee.x)/2,It=(C.y+Ee.y)/2;do Re.y>It!=Re.next.y>It&&Re.next.y!==Re.y&&ft<(Re.next.x-Re.x)*(It-Re.y)/(Re.next.y-Re.y)+Re.x&&(yt=!yt),Re=Re.next;while(Re!==C);return yt}function Ke(C,Ee){var Re=new Vr(C.i,C.x,C.y),yt=new Vr(Ee.i,Ee.x,Ee.y),ft=C.next,It=Ee.prev;return C.next=Ee,Ee.prev=C,Re.next=ft,ft.prev=Re,yt.next=Re,Re.prev=yt,It.next=yt,yt.prev=It,yt}function Xt(C,Ee,Re,yt){var ft=new Vr(C,Ee,Re);return yt?(ft.next=yt.next,ft.prev=yt,yt.next.prev=ft,yt.next=ft):(ft.prev=ft,ft.next=ft),ft}function Sr(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Vr(C,Ee,Re){this.i=C,this.x=Ee,this.y=Re,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}te.deviation=function(C,Ee,Re,yt){var ft=Ee&&Ee.length,It=ft?Ee[0]*Re:C.length,Ht=Math.abs(en(C,0,It,Re));if(ft)for(var xr=0,Kn=Ee.length;xr<Kn;xr++){var dn=Ee[xr]*Re,di=xr<Kn-1?Ee[xr+1]*Re:C.length;Ht-=Math.abs(en(C,dn,di,Re))}var jn=0;for(xr=0;xr<yt.length;xr+=3){var ni=yt[xr]*Re,vi=yt[xr+1]*Re,Hn=yt[xr+2]*Re;jn+=Math.abs((C[ni]-C[Hn])*(C[vi+1]-C[ni+1])-(C[ni]-C[vi])*(C[Hn+1]-C[ni+1]))}return Ht===0&&jn===0?0:Math.abs((jn-Ht)/Ht)};function en(C,Ee,Re,yt){for(var ft=0,It=Ee,Ht=Re-yt;It<Re;It+=yt)ft+=(C[Ht]-C[It])*(C[It+1]+C[Ht+1]),Ht=It;return ft}te.flatten=function(C){for(var Ee=C[0][0].length,Re={vertices:[],holes:[],dimensions:Ee},yt=0,ft=0;ft<C.length;ft++){for(var It=0;It<C[ft].length;It++)for(var Ht=0;Ht<Ee;Ht++)Re.vertices.push(C[ft][It][Ht]);ft>0&&(yt+=C[ft-1].length,Re.holes.push(yt))}return Re}},67499:function(Cr){function te(Pe){var me=Pe.target||Pe.srcElement;me.__resizeRAF__&&cancelAnimationFrame(me.__resizeRAF__),me.__resizeRAF__=requestAnimationFrame(function(){var m=me.__resizeTrigger__,Ie=m&&m.__resizeListeners__;Ie&&Ie.forEach(function(G){G.call(m,Pe)})})}var $=function(me,m){var Ie=this,G=Ie.document,ce,he=G.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Fe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",te)}if(!me.__resizeListeners__)if(me.__resizeListeners__=[],he)me.__resizeTrigger__=me,me.attachEvent("onresize",te);else{getComputedStyle(me).position==="static"&&(me.style.position="relative");var ge=me.__resizeTrigger__=G.createElement("object");ge.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ge.setAttribute("class","resize-sensor"),ge.setAttribute("tabindex","-1"),ge.setAttribute("title",""),ge.__resizeElement__=me,ge.onload=Fe,ge.type="text/html",ce&&me.appendChild(ge),ge.data="about:blank",ce||me.appendChild(ge)}me.__resizeListeners__.push(m)};Cr.exports=typeof window=="undefined"?$:$.bind(window),Cr.exports.unbind=function(Pe,me){var m=document.attachEvent,Ie=Pe.__resizeListeners__||[];if(me){var G=Ie.indexOf(me);G!==-1&&Ie.splice(G,1)}else Ie=Pe.__resizeListeners__=[];if(!Ie.length){if(m)Pe.detachEvent("onresize",te);else if(Pe.__resizeTrigger__){var ce=Pe.__resizeTrigger__.contentDocument,he=ce&&ce.defaultView;he&&(he.removeEventListener("resize",te),delete he.__resizeTrigger__),Pe.__resizeTrigger__=!Pe.removeChild(Pe.__resizeTrigger__)}delete Pe.__resizeListeners__}}},40666:function(Cr){"use strict";var te=Object.prototype.hasOwnProperty,$="~";function Pe(){}Object.create&&(Pe.prototype=Object.create(null),new Pe().__proto__||($=!1));function me(ce,he,Fe){this.fn=ce,this.context=he,this.once=Fe||!1}function m(ce,he,Fe,ge,Qe){if(typeof Fe!="function")throw new TypeError("The listener must be a function");var ct=new me(Fe,ge||ce,Qe),xt=$?$+he:he;return ce._events[xt]?ce._events[xt].fn?ce._events[xt]=[ce._events[xt],ct]:ce._events[xt].push(ct):(ce._events[xt]=ct,ce._eventsCount++),ce}function Ie(ce,he){--ce._eventsCount==0?ce._events=new Pe:delete ce._events[he]}function G(){this._events=new Pe,this._eventsCount=0}G.prototype.eventNames=function(){var he=[],Fe,ge;if(this._eventsCount===0)return he;for(ge in Fe=this._events)te.call(Fe,ge)&&he.push($?ge.slice(1):ge);return Object.getOwnPropertySymbols?he.concat(Object.getOwnPropertySymbols(Fe)):he},G.prototype.listeners=function(he){var Fe=$?$+he:he,ge=this._events[Fe];if(!ge)return[];if(ge.fn)return[ge.fn];for(var Qe=0,ct=ge.length,xt=new Array(ct);Qe<ct;Qe++)xt[Qe]=ge[Qe].fn;return xt},G.prototype.listenerCount=function(he){var Fe=$?$+he:he,ge=this._events[Fe];return ge?ge.fn?1:ge.length:0},G.prototype.emit=function(he,Fe,ge,Qe,ct,xt){var Qt=$?$+he:he;if(!this._events[Qt])return!1;var ur=this._events[Qt],Mt=arguments.length,Jt,zt;if(ur.fn){switch(ur.once&&this.removeListener(he,ur.fn,void 0,!0),Mt){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Fe),!0;case 3:return ur.fn.call(ur.context,Fe,ge),!0;case 4:return ur.fn.call(ur.context,Fe,ge,Qe),!0;case 5:return ur.fn.call(ur.context,Fe,ge,Qe,ct),!0;case 6:return ur.fn.call(ur.context,Fe,ge,Qe,ct,xt),!0}for(zt=1,Jt=new Array(Mt-1);zt<Mt;zt++)Jt[zt-1]=arguments[zt];ur.fn.apply(ur.context,Jt)}else{var lt=ur.length,pt;for(zt=0;zt<lt;zt++)switch(ur[zt].once&&this.removeListener(he,ur[zt].fn,void 0,!0),Mt){case 1:ur[zt].fn.call(ur[zt].context);break;case 2:ur[zt].fn.call(ur[zt].context,Fe);break;case 3:ur[zt].fn.call(ur[zt].context,Fe,ge);break;case 4:ur[zt].fn.call(ur[zt].context,Fe,ge,Qe);break;default:if(!Jt)for(pt=1,Jt=new Array(Mt-1);pt<Mt;pt++)Jt[pt-1]=arguments[pt];ur[zt].fn.apply(ur[zt].context,Jt)}}return!0},G.prototype.on=function(he,Fe,ge){return m(this,he,Fe,ge,!1)},G.prototype.once=function(he,Fe,ge){return m(this,he,Fe,ge,!0)},G.prototype.removeListener=function(he,Fe,ge,Qe){var ct=$?$+he:he;if(!this._events[ct])return this;if(!Fe)return Ie(this,ct),this;var xt=this._events[ct];if(xt.fn)xt.fn===Fe&&(!Qe||xt.once)&&(!ge||xt.context===ge)&&Ie(this,ct);else{for(var Qt=0,ur=[],Mt=xt.length;Qt<Mt;Qt++)(xt[Qt].fn!==Fe||Qe&&!xt[Qt].once||ge&&xt[Qt].context!==ge)&&ur.push(xt[Qt]);ur.length?this._events[ct]=ur.length===1?ur[0]:ur:Ie(this,ct)}return this},G.prototype.removeAllListeners=function(he){var Fe;return he?(Fe=$?$+he:he,this._events[Fe]&&Ie(this,Fe)):(this._events=new Pe,this._eventsCount=0),this},G.prototype.off=G.prototype.removeListener,G.prototype.addListener=G.prototype.on,G.prefixed=$,G.EventEmitter=G,Cr.exports=G},3039:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0});var $=Symbol.for("INJECTION");function Pe(ce,he,Fe,ge){function Qe(){return ge&&!Reflect.hasMetadata($,this,he)&&Reflect.defineMetadata($,Fe(),this,he),Reflect.hasMetadata($,this,he)?Reflect.getMetadata($,this,he):Fe()}function ct(xt){Reflect.defineMetadata($,xt,this,he)}Object.defineProperty(ce,he,{configurable:!0,enumerable:!0,get:Qe,set:ct})}function me(ce,he){return function(Fe){return function(ge,Qe){var ct=function(){return ce.get(Fe)};Pe(ge,Qe,ct,he)}}}te.makePropertyInjectDecorator=me;function m(ce,he){return function(Fe,ge){return function(Qe,ct){var xt=function(){return ce.getNamed(Fe,ge)};Pe(Qe,ct,xt,he)}}}te.makePropertyInjectNamedDecorator=m;function Ie(ce,he){return function(Fe,ge,Qe){return function(ct,xt){var Qt=function(){return ce.getTagged(Fe,ge,Qe)};Pe(ct,xt,Qt,he)}}}te.makePropertyInjectTaggedDecorator=Ie;function G(ce,he){return function(Fe){return function(ge,Qe){var ct=function(){return ce.getAll(Fe)};Pe(ge,Qe,ct,he)}}}te.makePropertyMultiInjectDecorator=G},11922:function(Cr,te,$){"use strict";var Pe;Pe={value:!0};var me=$(3039);function m(Ie,G){G===void 0&&(G=!0);var ce=me.makePropertyInjectDecorator(Ie,G),he=me.makePropertyInjectNamedDecorator(Ie,G),Fe=me.makePropertyInjectTaggedDecorator(Ie,G),ge=me.makePropertyMultiInjectDecorator(Ie,G);return{lazyInject:ce,lazyInjectNamed:he,lazyInjectTagged:Fe,lazyMultiInject:ge}}te.Z=m},80626:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagProperty=te.tagParameter=te.decorate=void 0;var Pe=$(36078),me=$(50295);function m(ge,Qe,ct,xt){var Qt=me.TAGGED;G(Qt,ge,Qe,xt,ct)}te.tagParameter=m;function Ie(ge,Qe,ct){var xt=me.TAGGED_PROP;G(xt,ge.constructor,Qe,ct)}te.tagProperty=Ie;function G(ge,Qe,ct,xt,Qt){var ur={},Mt=typeof Qt=="number",Jt=Qt!==void 0&&Mt?Qt.toString():ct;if(Mt&&ct!==void 0)throw new Error(Pe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ge,Qe)&&(ur=Reflect.getMetadata(ge,Qe));var zt=ur[Jt];if(!Array.isArray(zt))zt=[];else for(var lt=0,pt=zt;lt<pt.length;lt++){var ir=pt[lt];if(ir.key===xt.key)throw new Error(Pe.DUPLICATED_METADATA+" "+ir.key.toString())}zt.push(xt),ur[Jt]=zt,Reflect.defineMetadata(ge,ur,Qe)}function ce(ge,Qe){Reflect.decorate(ge,Qe)}function he(ge,Qe){return function(ct,xt){Qe(ct,xt,ge)}}function Fe(ge,Qe,ct){typeof ct=="number"?ce([he(ct,ge)],Qe):typeof ct=="string"?Reflect.decorate([ge],Qe,ct):ce([ge],Qe)}te.decorate=Fe},76213:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.inject=te.LazyServiceIdentifer=void 0;var Pe=$(36078),me=$(50295),m=$(25092),Ie=$(80626),G=function(){function he(Fe){this._cb=Fe}return he.prototype.unwrap=function(){return this._cb()},he}();te.LazyServiceIdentifer=G;function ce(he){return function(Fe,ge,Qe){if(he===void 0)throw new Error(Pe.UNDEFINED_INJECT_ANNOTATION(Fe.name));var ct=new m.Metadata(me.INJECT_TAG,he);typeof Qe=="number"?Ie.tagParameter(Fe,ge,Qe,ct):Ie.tagProperty(Fe,ge,ct)}}te.inject=ce},91773:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.injectable=void 0;var Pe=$(36078),me=$(50295);function m(){return function(Ie){if(Reflect.hasOwnMetadata(me.PARAM_TYPES,Ie))throw new Error(Pe.DUPLICATED_INJECTABLE_DECORATOR);var G=Reflect.getMetadata(me.DESIGN_PARAM_TYPES,Ie)||[];return Reflect.defineMetadata(me.PARAM_TYPES,G,Ie),Ie}}te.injectable=m},41528:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiInject=void 0;var Pe=$(50295),me=$(25092),m=$(80626);function Ie(G){return function(ce,he,Fe){var ge=new me.Metadata(Pe.MULTI_INJECT_TAG,G);typeof Fe=="number"?m.tagParameter(ce,he,Fe,ge):m.tagProperty(ce,he,ge)}}te.multiInject=Ie},79817:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.named=void 0;var Pe=$(50295),me=$(25092),m=$(80626);function Ie(G){return function(ce,he,Fe){var ge=new me.Metadata(Pe.NAMED_TAG,G);typeof Fe=="number"?m.tagParameter(ce,he,Fe,ge):m.tagProperty(ce,he,ge)}}te.named=Ie},71316:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.optional=void 0;var Pe=$(50295),me=$(25092),m=$(80626);function Ie(){return function(G,ce,he){var Fe=new me.Metadata(Pe.OPTIONAL_TAG,!0);typeof he=="number"?m.tagParameter(G,ce,he,Fe):m.tagProperty(G,ce,Fe)}}te.optional=Ie},71971:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.postConstruct=void 0;var Pe=$(36078),me=$(50295),m=$(25092);function Ie(){return function(G,ce,he){var Fe=new m.Metadata(me.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(me.POST_CONSTRUCT,G.constructor))throw new Error(Pe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(me.POST_CONSTRUCT,Fe,G.constructor)}}te.postConstruct=Ie},79189:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagged=void 0;var Pe=$(25092),me=$(80626);function m(Ie,G){return function(ce,he,Fe){var ge=new Pe.Metadata(Ie,G);typeof Fe=="number"?me.tagParameter(ce,he,Fe,ge):me.tagProperty(ce,he,ge)}}te.tagged=m},8245:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.targetName=void 0;var Pe=$(50295),me=$(25092),m=$(80626);function Ie(G){return function(ce,he,Fe){var ge=new me.Metadata(Pe.NAME_TAG,G);m.tagParameter(ce,he,Fe,ge)}}te.targetName=Ie},19235:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.unmanaged=void 0;var Pe=$(50295),me=$(25092),m=$(80626);function Ie(){return function(G,ce,he){var Fe=new me.Metadata(Pe.UNMANAGED_TAG,!0);m.tagParameter(G,ce,he,Fe)}}te.unmanaged=Ie},30683:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Binding=void 0;var Pe=$(77690),me=$(70023),m=function(){function Ie(G,ce){this.id=me.id(),this.activated=!1,this.serviceIdentifier=G,this.scope=ce,this.type=Pe.BindingTypeEnum.Invalid,this.constraint=function(he){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ie.prototype.clone=function(){var G=new Ie(this.serviceIdentifier,this.scope);return G.activated=G.scope===Pe.BindingScopeEnum.Singleton?this.activated:!1,G.implementationType=this.implementationType,G.dynamicValue=this.dynamicValue,G.scope=this.scope,G.type=this.type,G.factory=this.factory,G.provider=this.provider,G.constraint=this.constraint,G.onActivation=this.onActivation,G.cache=this.cache,G},Ie}();te.Binding=m},13497:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingCount=void 0;var $={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};te.BindingCount=$},36078:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.STACK_OVERFLOW=te.CIRCULAR_DEPENDENCY_IN_FACTORY=te.POST_CONSTRUCT_ERROR=te.MULTIPLE_POST_CONSTRUCT_METHODS=te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=te.ARGUMENTS_LENGTH_MISMATCH=te.INVALID_DECORATOR_OPERATION=te.INVALID_TO_SELF_VALUE=te.INVALID_FUNCTION_BINDING=te.INVALID_MIDDLEWARE_RETURN=te.NO_MORE_SNAPSHOTS_AVAILABLE=te.INVALID_BINDING_TYPE=te.NOT_IMPLEMENTED=te.CIRCULAR_DEPENDENCY=te.UNDEFINED_INJECT_ANNOTATION=te.MISSING_INJECT_ANNOTATION=te.MISSING_INJECTABLE_ANNOTATION=te.NOT_REGISTERED=te.CANNOT_UNBIND=te.AMBIGUOUS_MATCH=te.KEY_NOT_FOUND=te.NULL_ARGUMENT=te.DUPLICATED_METADATA=te.DUPLICATED_INJECTABLE_DECORATOR=void 0,te.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",te.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",te.NULL_ARGUMENT="NULL argument",te.KEY_NOT_FOUND="Key Not Found",te.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",te.CANNOT_UNBIND="Could not unbind serviceIdentifier:",te.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",te.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",te.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var $=function(Ie){return"@inject called with undefined this could mean that the class "+Ie+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};te.UNDEFINED_INJECT_ANNOTATION=$,te.CIRCULAR_DEPENDENCY="Circular dependency found:",te.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",te.INVALID_BINDING_TYPE="Invalid binding type:",te.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",te.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",te.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",te.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",te.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Pe=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"The number of constructor arguments in the derived class "+(Ie[0]+" must be >= than the number of constructor arguments of its base class.")};te.ARGUMENTS_LENGTH_MISMATCH=Pe,te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",te.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var me=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"@postConstruct error in class "+Ie[0]+": "+Ie[1]};te.POST_CONSTRUCT_ERROR=me;var m=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"It looks like there is a circular dependency "+("in one of the '"+Ie[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ie[1]+"'.")};te.CIRCULAR_DEPENDENCY_IN_FACTORY=m,te.STACK_OVERFLOW="Maximum call stack size exceeded"},77690:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.TargetTypeEnum=te.BindingTypeEnum=te.BindingScopeEnum=void 0;var $={Request:"Request",Singleton:"Singleton",Transient:"Transient"};te.BindingScopeEnum=$;var Pe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};te.BindingTypeEnum=Pe;var me={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};te.TargetTypeEnum=me},50295:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.NON_CUSTOM_TAG_KEYS=te.POST_CONSTRUCT=te.DESIGN_PARAM_TYPES=te.PARAM_TYPES=te.TAGGED_PROP=te.TAGGED=te.MULTI_INJECT_TAG=te.INJECT_TAG=te.OPTIONAL_TAG=te.UNMANAGED_TAG=te.NAME_TAG=te.NAMED_TAG=void 0,te.NAMED_TAG="named",te.NAME_TAG="name",te.UNMANAGED_TAG="unmanaged",te.OPTIONAL_TAG="optional",te.INJECT_TAG="inject",te.MULTI_INJECT_TAG="multi_inject",te.TAGGED="inversify:tagged",te.TAGGED_PROP="inversify:tagged_props",te.PARAM_TYPES="inversify:paramtypes",te.DESIGN_PARAM_TYPES="design:paramtypes",te.POST_CONSTRUCT="post_construct";function $(){return[te.INJECT_TAG,te.MULTI_INJECT_TAG,te.NAME_TAG,te.UNMANAGED_TAG,te.NAMED_TAG,te.OPTIONAL_TAG]}te.NON_CUSTOM_TAG_KEYS=$()},70596:function(Cr,te,$){"use strict";var Pe=this&&this.__awaiter||function(zt,lt,pt,ir){function W(Wt){return Wt instanceof pt?Wt:new pt(function(ot){ot(Wt)})}return new(pt||(pt=Promise))(function(Wt,ot){function Ye(Xt){try{Ke(ir.next(Xt))}catch(Sr){ot(Sr)}}function bt(Xt){try{Ke(ir.throw(Xt))}catch(Sr){ot(Sr)}}function Ke(Xt){Xt.done?Wt(Xt.value):W(Xt.value).then(Ye,bt)}Ke((ir=ir.apply(zt,lt||[])).next())})},me=this&&this.__generator||function(zt,lt){var pt={label:0,sent:function(){if(Wt[0]&1)throw Wt[1];return Wt[1]},trys:[],ops:[]},ir,W,Wt,ot;return ot={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(ot[Symbol.iterator]=function(){return this}),ot;function Ye(Ke){return function(Xt){return bt([Ke,Xt])}}function bt(Ke){if(ir)throw new TypeError("Generator is already executing.");for(;pt;)try{if(ir=1,W&&(Wt=Ke[0]&2?W.return:Ke[0]?W.throw||((Wt=W.return)&&Wt.call(W),0):W.next)&&!(Wt=Wt.call(W,Ke[1])).done)return Wt;switch(W=0,Wt&&(Ke=[Ke[0]&2,Wt.value]),Ke[0]){case 0:case 1:Wt=Ke;break;case 4:return pt.label++,{value:Ke[1],done:!1};case 5:pt.label++,W=Ke[1],Ke=[0];continue;case 7:Ke=pt.ops.pop(),pt.trys.pop();continue;default:if(Wt=pt.trys,!(Wt=Wt.length>0&&Wt[Wt.length-1])&&(Ke[0]===6||Ke[0]===2)){pt=0;continue}if(Ke[0]===3&&(!Wt||Ke[1]>Wt[0]&&Ke[1]<Wt[3])){pt.label=Ke[1];break}if(Ke[0]===6&&pt.label<Wt[1]){pt.label=Wt[1],Wt=Ke;break}if(Wt&&pt.label<Wt[2]){pt.label=Wt[2],pt.ops.push(Ke);break}Wt[2]&&pt.ops.pop(),pt.trys.pop();continue}Ke=lt.call(zt,pt)}catch(Xt){Ke=[6,Xt],W=0}finally{ir=Wt=0}if(Ke[0]&5)throw Ke[1];return{value:Ke[0]?Ke[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(zt,lt){for(var pt=0,ir=lt.length,W=zt.length;pt<ir;pt++,W++)zt[W]=lt[pt];return zt};Object.defineProperty(te,"__esModule",{value:!0}),te.Container=void 0;var Ie=$(30683),G=$(36078),ce=$(77690),he=$(50295),Fe=$(43870),ge=$(54142),Qe=$(9386),ct=$(43313),xt=$(70023),Qt=$(29552),ur=$(71878),Mt=$(82543),Jt=function(){function zt(lt){this._appliedMiddleware=[];var pt=lt||{};if(typeof pt!="object")throw new Error(""+G.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=ce.BindingScopeEnum.Transient;else if(pt.defaultScope!==ce.BindingScopeEnum.Singleton&&pt.defaultScope!==ce.BindingScopeEnum.Transient&&pt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+G.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+G.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+G.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=xt.id(),this._bindingDictionary=new Mt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Fe.MetadataReader}return zt.merge=function(lt,pt){for(var ir=[],W=2;W<arguments.length;W++)ir[W-2]=arguments[W];var Wt=new zt,ot=m([lt,pt],ir).map(function(Ke){return ge.getBindingDictionary(Ke)}),Ye=ge.getBindingDictionary(Wt);function bt(Ke,Xt){Ke.traverse(function(Sr,Vr){Vr.forEach(function(en){Xt.add(en.serviceIdentifier,en.clone())})})}return ot.forEach(function(Ke){bt(Ke,Ye)}),Wt},zt.prototype.load=function(){for(var lt=[],pt=0;pt<arguments.length;pt++)lt[pt]=arguments[pt];for(var ir=this._getContainerModuleHelpersFactory(),W=0,Wt=lt;W<Wt.length;W++){var ot=Wt[W],Ye=ir(ot.id);ot.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},zt.prototype.loadAsync=function(){for(var lt=[],pt=0;pt<arguments.length;pt++)lt[pt]=arguments[pt];return Pe(this,void 0,void 0,function(){var ir,W,Wt,ot,Ye;return me(this,function(bt){switch(bt.label){case 0:ir=this._getContainerModuleHelpersFactory(),W=0,Wt=lt,bt.label=1;case 1:return W<Wt.length?(ot=Wt[W],Ye=ir(ot.id),[4,ot.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:bt.sent(),bt.label=3;case 3:return W++,[3,1];case 4:return[2]}})})},zt.prototype.unload=function(){for(var lt=this,pt=[],ir=0;ir<arguments.length;ir++)pt[ir]=arguments[ir];var W=function(Wt){return function(ot){return ot.moduleId===Wt}};pt.forEach(function(Wt){var ot=W(Wt.id);lt._bindingDictionary.removeByCondition(ot)})},zt.prototype.bind=function(lt){var pt=this.options.defaultScope||ce.BindingScopeEnum.Transient,ir=new Ie.Binding(lt,pt);return this._bindingDictionary.add(lt,ir),new ct.BindingToSyntax(ir)},zt.prototype.rebind=function(lt){return this.unbind(lt),this.bind(lt)},zt.prototype.unbind=function(lt){try{this._bindingDictionary.remove(lt)}catch(pt){throw new Error(G.CANNOT_UNBIND+" "+Qt.getServiceIdentifierAsString(lt))}},zt.prototype.unbindAll=function(){this._bindingDictionary=new Mt.Lookup},zt.prototype.isBound=function(lt){var pt=this._bindingDictionary.hasKey(lt);return!pt&&this.parent&&(pt=this.parent.isBound(lt)),pt},zt.prototype.isBoundNamed=function(lt,pt){return this.isBoundTagged(lt,he.NAMED_TAG,pt)},zt.prototype.isBoundTagged=function(lt,pt,ir){var W=!1;if(this._bindingDictionary.hasKey(lt)){var Wt=this._bindingDictionary.get(lt),ot=ge.createMockRequest(this,lt,pt,ir);W=Wt.some(function(Ye){return Ye.constraint(ot)})}return!W&&this.parent&&(W=this.parent.isBoundTagged(lt,pt,ir)),W},zt.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},zt.prototype.restore=function(){var lt=this._snapshots.pop();if(lt===void 0)throw new Error(G.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=lt.bindings,this._middleware=lt.middleware},zt.prototype.createChild=function(lt){var pt=new zt(lt||this.options);return pt.parent=this,pt},zt.prototype.applyMiddleware=function(){for(var lt=[],pt=0;pt<arguments.length;pt++)lt[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(lt);var ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=lt.reduce(function(W,Wt){return Wt(W)},ir)},zt.prototype.applyCustomMetadataReader=function(lt){this._metadataReader=lt},zt.prototype.get=function(lt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,lt)},zt.prototype.getTagged=function(lt,pt,ir){return this._get(!1,!1,ce.TargetTypeEnum.Variable,lt,pt,ir)},zt.prototype.getNamed=function(lt,pt){return this.getTagged(lt,he.NAMED_TAG,pt)},zt.prototype.getAll=function(lt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,lt)},zt.prototype.getAllTagged=function(lt,pt,ir){return this._get(!1,!0,ce.TargetTypeEnum.Variable,lt,pt,ir)},zt.prototype.getAllNamed=function(lt,pt){return this.getAllTagged(lt,he.NAMED_TAG,pt)},zt.prototype.resolve=function(lt){var pt=this.createChild();return pt.bind(lt).toSelf(),this._appliedMiddleware.forEach(function(ir){pt.applyMiddleware(ir)}),pt.get(lt)},zt.prototype._getContainerModuleHelpersFactory=function(){var lt=this,pt=function(Ye,bt){Ye._binding.moduleId=bt},ir=function(Ye){return function(bt){var Ke=lt.bind.bind(lt),Xt=Ke(bt);return pt(Xt,Ye),Xt}},W=function(Ye){return function(bt){var Ke=lt.unbind.bind(lt);Ke(bt)}},Wt=function(Ye){return function(bt){var Ke=lt.isBound.bind(lt);return Ke(bt)}},ot=function(Ye){return function(bt){var Ke=lt.rebind.bind(lt),Xt=Ke(bt);return pt(Xt,Ye),Xt}};return function(Ye){return{bindFunction:ir(Ye),isboundFunction:Wt(Ye),rebindFunction:ot(Ye),unbindFunction:W(Ye)}}},zt.prototype._get=function(lt,pt,ir,W,Wt,ot){var Ye=null,bt={avoidConstraints:lt,contextInterceptor:function(Ke){return Ke},isMultiInject:pt,key:Wt,serviceIdentifier:W,targetType:ir,value:ot};if(this._middleware){if(Ye=this._middleware(bt),Ye==null)throw new Error(G.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(bt);return Ye},zt.prototype._planAndResolve=function(){var lt=this;return function(pt){var ir=ge.plan(lt._metadataReader,lt,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);ir=pt.contextInterceptor(ir);var W=Qe.resolve(ir);return W}},zt}();te.Container=Jt},55607:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.AsyncContainerModule=te.ContainerModule=void 0;var Pe=$(70023),me=function(){function Ie(G){this.id=Pe.id(),this.registry=G}return Ie}();te.ContainerModule=me;var m=function(){function Ie(G){this.id=Pe.id(),this.registry=G}return Ie}();te.AsyncContainerModule=m},71878:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.ContainerSnapshot=void 0;var $=function(){function Pe(){}return Pe.of=function(me,m){var Ie=new Pe;return Ie.bindings=me,Ie.middleware=m,Ie},Pe}();te.ContainerSnapshot=$},82543:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Lookup=void 0;var Pe=$(36078),me=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(Ie,G){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);if(G==null)throw new Error(Pe.NULL_ARGUMENT);var ce=this._map.get(Ie);ce!==void 0?(ce.push(G),this._map.set(Ie,ce)):this._map.set(Ie,[G])},m.prototype.get=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);var G=this._map.get(Ie);if(G!==void 0)return G;throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.remove=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);if(!this._map.delete(Ie))throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(Ie){var G=this;this._map.forEach(function(ce,he){var Fe=ce.filter(function(ge){return!Ie(ge)});Fe.length>0?G._map.set(he,Fe):G._map.delete(he)})},m.prototype.hasKey=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);return this._map.has(Ie)},m.prototype.clone=function(){var Ie=new m;return this._map.forEach(function(G,ce){G.forEach(function(he){return Ie.add(ce,he.clone())})}),Ie},m.prototype.traverse=function(Ie){this._map.forEach(function(G,ce){Ie(ce,G)})},m}();te.Lookup=me},99311:function(Cr,te,$){"use strict";var Pe;Pe={value:!0},Pe=Pe=Pe=Pe=Pe=Pe=te.GW=Pe=Pe=te.zY=Pe=Pe=Pe=Pe=Pe=te.f3=Pe=Pe=te.b2=Pe=Pe=Pe=Pe=Pe=te.W2=Pe=void 0;var me=$(50295);Pe=me;var m=$(70596);Object.defineProperty(te,"W2",{enumerable:!0,get:function(){return m.Container}});var Ie=$(77690);Pe={enumerable:!0,get:function(){return Ie.BindingScopeEnum}},Pe={enumerable:!0,get:function(){return Ie.BindingTypeEnum}},Pe={enumerable:!0,get:function(){return Ie.TargetTypeEnum}};var G=$(55607);Pe={enumerable:!0,get:function(){return G.AsyncContainerModule}},Pe={enumerable:!0,get:function(){return G.ContainerModule}};var ce=$(91773);Object.defineProperty(te,"b2",{enumerable:!0,get:function(){return ce.injectable}});var he=$(79189);Pe={enumerable:!0,get:function(){return he.tagged}};var Fe=$(79817);Pe={enumerable:!0,get:function(){return Fe.named}};var ge=$(76213);Object.defineProperty(te,"f3",{enumerable:!0,get:function(){return ge.inject}}),Pe={enumerable:!0,get:function(){return ge.LazyServiceIdentifer}};var Qe=$(71316);Pe={enumerable:!0,get:function(){return Qe.optional}};var ct=$(19235);Pe={enumerable:!0,get:function(){return ct.unmanaged}};var xt=$(41528);Pe={enumerable:!0,get:function(){return xt.multiInject}};var Qt=$(8245);Pe={enumerable:!0,get:function(){return Qt.targetName}};var ur=$(71971);Object.defineProperty(te,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var Mt=$(43870);Pe={enumerable:!0,get:function(){return Mt.MetadataReader}};var Jt=$(70023);Pe={enumerable:!0,get:function(){return Jt.id}};var zt=$(80626);Object.defineProperty(te,"GW",{enumerable:!0,get:function(){return zt.decorate}});var lt=$(83140);Pe={enumerable:!0,get:function(){return lt.traverseAncerstors}},Pe={enumerable:!0,get:function(){return lt.taggedConstraint}},Pe={enumerable:!0,get:function(){return lt.namedConstraint}},Pe={enumerable:!0,get:function(){return lt.typeConstraint}};var pt=$(29552);Pe={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var ir=$(34384);Pe={enumerable:!0,get:function(){return ir.multiBindToService}}},91519:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Context=void 0;var Pe=$(70023),me=function(){function m(Ie){this.id=Pe.id(),this.container=Ie}return m.prototype.addPlan=function(Ie){this.plan=Ie},m.prototype.setCurrentRequest=function(Ie){this.currentRequest=Ie},m}();te.Context=me},25092:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Metadata=void 0;var Pe=$(50295),me=function(){function m(Ie,G){this.key=Ie,this.value=G}return m.prototype.toString=function(){return this.key===Pe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();te.Metadata=me},43870:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.MetadataReader=void 0;var Pe=$(50295),me=function(){function m(){}return m.prototype.getConstructorMetadata=function(Ie){var G=Reflect.getMetadata(Pe.PARAM_TYPES,Ie),ce=Reflect.getMetadata(Pe.TAGGED,Ie);return{compilerGeneratedMetadata:G,userGeneratedMetadata:ce||{}}},m.prototype.getPropertiesMetadata=function(Ie){var G=Reflect.getMetadata(Pe.TAGGED_PROP,Ie)||[];return G},m}();te.MetadataReader=me},6335:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Plan=void 0;var $=function(){function Pe(me,m){this.parentContext=me,this.rootRequest=m}return Pe}();te.Plan=$},54142:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.getBindingDictionary=te.createMockRequest=te.plan=void 0;var Pe=$(13497),me=$(36078),m=$(77690),Ie=$(50295),G=$(92542),ce=$(29552),he=$(91519),Fe=$(25092),ge=$(6335),Qe=$(16664),ct=$(14810),xt=$(69660);function Qt(W){return W._bindingDictionary}te.getBindingDictionary=Qt;function ur(W,Wt,ot,Ye,bt,Ke){var Xt=W?Ie.MULTI_INJECT_TAG:Ie.INJECT_TAG,Sr=new Fe.Metadata(Xt,ot),Vr=new xt.Target(Wt,Ye,ot,Sr);if(bt!==void 0){var en=new Fe.Metadata(bt,Ke);Vr.metadata.push(en)}return Vr}function Mt(W,Wt,ot,Ye,bt){var Ke=lt(ot.container,bt.serviceIdentifier),Xt=[];return Ke.length===Pe.BindingCount.NoBindingsAvailable&&ot.container.options.autoBindInjectable&&typeof bt.serviceIdentifier=="function"&&W.getConstructorMetadata(bt.serviceIdentifier).compilerGeneratedMetadata&&(ot.container.bind(bt.serviceIdentifier).toSelf(),Ke=lt(ot.container,bt.serviceIdentifier)),Wt?Xt=Ke:Xt=Ke.filter(function(Sr){var Vr=new ct.Request(Sr.serviceIdentifier,ot,Ye,Sr,bt);return Sr.constraint(Vr)}),Jt(bt.serviceIdentifier,Xt,bt,ot.container),Xt}function Jt(W,Wt,ot,Ye){switch(Wt.length){case Pe.BindingCount.NoBindingsAvailable:if(ot.isOptional())return Wt;var bt=ce.getServiceIdentifierAsString(W),Ke=me.NOT_REGISTERED;throw Ke+=ce.listMetadataForTarget(bt,ot),Ke+=ce.listRegisteredBindingsForServiceIdentifier(Ye,bt,lt),new Error(Ke);case Pe.BindingCount.OnlyOneBindingAvailable:if(!ot.isArray())return Wt;case Pe.BindingCount.MultipleBindingsAvailable:default:if(ot.isArray())return Wt;var bt=ce.getServiceIdentifierAsString(W),Ke=me.AMBIGUOUS_MATCH+" "+bt;throw Ke+=ce.listRegisteredBindingsForServiceIdentifier(Ye,bt,lt),new Error(Ke)}}function zt(W,Wt,ot,Ye,bt,Ke){var Xt,Sr;if(bt===null){Xt=Mt(W,Wt,Ye,null,Ke),Sr=new ct.Request(ot,Ye,null,Xt,Ke);var Vr=new ge.Plan(Ye,Sr);Ye.addPlan(Vr)}else Xt=Mt(W,Wt,Ye,bt,Ke),Sr=bt.addChildRequest(Ke.serviceIdentifier,Xt,Ke);Xt.forEach(function(en){var C=null;if(Ke.isArray())C=Sr.addChildRequest(en.serviceIdentifier,en,Ke);else{if(en.cache)return;C=Sr}if(en.type===m.BindingTypeEnum.Instance&&en.implementationType!==null){var Ee=Qe.getDependencies(W,en.implementationType);if(!Ye.container.options.skipBaseClassChecks){var Re=Qe.getBaseClassDependencyCount(W,en.implementationType);if(Ee.length<Re){var yt=me.ARGUMENTS_LENGTH_MISMATCH(Qe.getFunctionName(en.implementationType));throw new Error(yt)}}Ee.forEach(function(ft){zt(W,!1,ft.serviceIdentifier,Ye,C,ft)})}})}function lt(W,Wt){var ot=[],Ye=Qt(W);return Ye.hasKey(Wt)?ot=Ye.get(Wt):W.parent!==null&&(ot=lt(W.parent,Wt)),ot}function pt(W,Wt,ot,Ye,bt,Ke,Xt,Sr){Sr===void 0&&(Sr=!1);var Vr=new he.Context(Wt),en=ur(ot,Ye,bt,"",Ke,Xt);try{return zt(W,Sr,bt,Vr,null,en),Vr}catch(C){throw G.isStackOverflowExeption(C)&&Vr.plan&&ce.circularDependencyToException(Vr.plan.rootRequest),C}}te.plan=pt;function ir(W,Wt,ot,Ye){var bt=new xt.Target(m.TargetTypeEnum.Variable,"",Wt,new Fe.Metadata(ot,Ye)),Ke=new he.Context(W),Xt=new ct.Request(Wt,Ke,null,[],bt);return Xt}te.createMockRequest=ir},68634:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.QueryableString=void 0;var $=function(){function Pe(me){this.str=me}return Pe.prototype.startsWith=function(me){return this.str.indexOf(me)===0},Pe.prototype.endsWith=function(me){var m="",Ie=me.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},Ie)},Pe.prototype.contains=function(me){return this.str.indexOf(me)!==-1},Pe.prototype.equals=function(me){return this.str===me},Pe.prototype.value=function(){return this.str},Pe}();te.QueryableString=$},16664:function(Cr,te,$){"use strict";var Pe=this&&this.__spreadArray||function(Mt,Jt){for(var zt=0,lt=Jt.length,pt=Mt.length;zt<lt;zt++,pt++)Mt[pt]=Jt[zt];return Mt};Object.defineProperty(te,"__esModule",{value:!0}),te.getFunctionName=te.getBaseClassDependencyCount=te.getDependencies=void 0;var me=$(76213),m=$(36078),Ie=$(77690),G=$(50295),ce=$(29552);Object.defineProperty(te,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var he=$(69660);function Fe(Mt,Jt){var zt=ce.getFunctionName(Jt),lt=ge(Mt,zt,Jt,!1);return lt}te.getDependencies=Fe;function ge(Mt,Jt,zt,lt){var pt=Mt.getConstructorMetadata(zt),ir=pt.compilerGeneratedMetadata;if(ir===void 0){var W=m.MISSING_INJECTABLE_ANNOTATION+" "+Jt+".";throw new Error(W)}var Wt=pt.userGeneratedMetadata,ot=Object.keys(Wt),Ye=zt.length===0&&ot.length>0,bt=ot.length>zt.length,Ke=Ye||bt?ot.length:zt.length,Xt=ct(lt,Jt,ir,Wt,Ke),Sr=xt(Mt,zt),Vr=Pe(Pe([],Xt),Sr);return Vr}function Qe(Mt,Jt,zt,lt,pt){var ir=pt[Mt.toString()]||[],W=ur(ir),Wt=W.unmanaged!==!0,ot=lt[Mt],Ye=W.inject||W.multiInject;if(ot=Ye||ot,ot instanceof me.LazyServiceIdentifer&&(ot=ot.unwrap()),Wt){var bt=ot===Object,Ke=ot===Function,Xt=ot===void 0,Sr=bt||Ke||Xt;if(!Jt&&Sr){var Vr=m.MISSING_INJECT_ANNOTATION+" argument "+Mt+" in class "+zt+".";throw new Error(Vr)}var en=new he.Target(Ie.TargetTypeEnum.ConstructorArgument,W.targetName,ot);return en.metadata=ir,en}return null}function ct(Mt,Jt,zt,lt,pt){for(var ir=[],W=0;W<pt;W++){var Wt=W,ot=Qe(Wt,Mt,Jt,zt,lt);ot!==null&&ir.push(ot)}return ir}function xt(Mt,Jt){for(var zt=Mt.getPropertiesMetadata(Jt),lt=[],pt=Object.keys(zt),ir=0,W=pt;ir<W.length;ir++){var Wt=W[ir],ot=zt[Wt],Ye=ur(zt[Wt]),bt=Ye.targetName||Wt,Ke=Ye.inject||Ye.multiInject,Xt=new he.Target(Ie.TargetTypeEnum.ClassProperty,bt,Ke);Xt.metadata=ot,lt.push(Xt)}var Sr=Object.getPrototypeOf(Jt.prototype).constructor;if(Sr!==Object){var Vr=xt(Mt,Sr);lt=Pe(Pe([],lt),Vr)}return lt}function Qt(Mt,Jt){var zt=Object.getPrototypeOf(Jt.prototype).constructor;if(zt!==Object){var lt=ce.getFunctionName(zt),pt=ge(Mt,lt,zt,!0),ir=pt.map(function(ot){return ot.metadata.filter(function(Ye){return Ye.key===G.UNMANAGED_TAG})}),W=[].concat.apply([],ir).length,Wt=pt.length-W;return Wt>0?Wt:Qt(Mt,zt)}else return 0}te.getBaseClassDependencyCount=Qt;function ur(Mt){var Jt={};return Mt.forEach(function(zt){Jt[zt.key.toString()]=zt.value}),{inject:Jt[G.INJECT_TAG],multiInject:Jt[G.MULTI_INJECT_TAG],targetName:Jt[G.NAME_TAG],unmanaged:Jt[G.UNMANAGED_TAG]}}},14810:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Request=void 0;var Pe=$(70023),me=function(){function m(Ie,G,ce,he,Fe){this.id=Pe.id(),this.serviceIdentifier=Ie,this.parentContext=G,this.parentRequest=ce,this.target=Fe,this.childRequests=[],this.bindings=Array.isArray(he)?he:[he],this.requestScope=ce===null?new Map:null}return m.prototype.addChildRequest=function(Ie,G,ce){var he=new m(Ie,this.parentContext,this,G,ce);return this.childRequests.push(he),he},m}();te.Request=me},69660:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Target=void 0;var Pe=$(50295),me=$(70023),m=$(25092),Ie=$(68634),G=function(){function ce(he,Fe,ge,Qe){this.id=me.id(),this.type=he,this.serviceIdentifier=ge,this.name=new Ie.QueryableString(Fe||""),this.metadata=new Array;var ct=null;typeof Qe=="string"?ct=new m.Metadata(Pe.NAMED_TAG,Qe):Qe instanceof m.Metadata&&(ct=Qe),ct!==null&&this.metadata.push(ct)}return ce.prototype.hasTag=function(he){for(var Fe=0,ge=this.metadata;Fe<ge.length;Fe++){var Qe=ge[Fe];if(Qe.key===he)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(Pe.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(he){return this.matchesTag(Pe.MULTI_INJECT_TAG)(he)},ce.prototype.isNamed=function(){return this.hasTag(Pe.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(he){return Pe.NON_CUSTOM_TAG_KEYS.every(function(Fe){return he.key!==Fe})})},ce.prototype.isOptional=function(){return this.matchesTag(Pe.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(he){return he.key===Pe.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(he){return Pe.NON_CUSTOM_TAG_KEYS.every(function(Fe){return he.key!==Fe})}):null},ce.prototype.matchesNamedTag=function(he){return this.matchesTag(Pe.NAMED_TAG)(he)},ce.prototype.matchesTag=function(he){var Fe=this;return function(ge){for(var Qe=0,ct=Fe.metadata;Qe<ct.length;Qe++){var xt=ct[Qe];if(xt.key===he&&xt.value===ge)return!0}return!1}},ce}();te.Target=G},74962:function(Cr,te,$){"use strict";var Pe=this&&this.__spreadArray||function(ge,Qe){for(var ct=0,xt=Qe.length,Qt=ge.length;ct<xt;ct++,Qt++)ge[Qt]=Qe[ct];return ge};Object.defineProperty(te,"__esModule",{value:!0}),te.resolveInstance=void 0;var me=$(36078),m=$(77690),Ie=$(50295);function G(ge,Qe,ct){var xt=Qe.filter(function(ur){return ur.target!==null&&ur.target.type===m.TargetTypeEnum.ClassProperty}),Qt=xt.map(ct);return xt.forEach(function(ur,Mt){var Jt="";Jt=ur.target.name.value();var zt=Qt[Mt];ge[Jt]=zt}),ge}function ce(ge,Qe){return new(ge.bind.apply(ge,Pe([void 0],Qe)))}function he(ge,Qe){if(Reflect.hasMetadata(Ie.POST_CONSTRUCT,ge)){var ct=Reflect.getMetadata(Ie.POST_CONSTRUCT,ge);try{Qe[ct.value]()}catch(xt){throw new Error(me.POST_CONSTRUCT_ERROR(ge.name,xt.message))}}}function Fe(ge,Qe,ct){var xt=null;if(Qe.length>0){var Qt=Qe.filter(function(Mt){return Mt.target!==null&&Mt.target.type===m.TargetTypeEnum.ConstructorArgument}),ur=Qt.map(ct);xt=ce(ge,ur),xt=G(xt,Qe,ct)}else xt=new ge;return he(ge,xt),xt}te.resolveInstance=Fe},9386:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.resolve=void 0;var Pe=$(36078),me=$(77690),m=$(92542),Ie=$(29552),G=$(74962),ce=function(ge,Qe,ct){try{return ct()}catch(xt){throw m.isStackOverflowExeption(xt)?new Error(Pe.CIRCULAR_DEPENDENCY_IN_FACTORY(ge,Qe.toString())):xt}},he=function(ge){return function(Qe){Qe.parentContext.setCurrentRequest(Qe);var ct=Qe.bindings,xt=Qe.childRequests,Qt=Qe.target&&Qe.target.isArray(),ur=!Qe.parentRequest||!Qe.parentRequest.target||!Qe.target||!Qe.parentRequest.target.matchesArray(Qe.target.serviceIdentifier);if(Qt&&ur)return xt.map(function(ir){var W=he(ge);return W(ir)});var Mt=null;if(Qe.target.isOptional()&&ct.length===0)return;var Jt=ct[0],zt=Jt.scope===me.BindingScopeEnum.Singleton,lt=Jt.scope===me.BindingScopeEnum.Request;if(zt&&Jt.activated)return Jt.cache;if(lt&&ge!==null&&ge.has(Jt.id))return ge.get(Jt.id);if(Jt.type===me.BindingTypeEnum.ConstantValue)Mt=Jt.cache,Jt.activated=!0;else if(Jt.type===me.BindingTypeEnum.Function)Mt=Jt.cache,Jt.activated=!0;else if(Jt.type===me.BindingTypeEnum.Constructor)Mt=Jt.implementationType;else if(Jt.type===me.BindingTypeEnum.DynamicValue&&Jt.dynamicValue!==null)Mt=ce("toDynamicValue",Jt.serviceIdentifier,function(){return Jt.dynamicValue(Qe.parentContext)});else if(Jt.type===me.BindingTypeEnum.Factory&&Jt.factory!==null)Mt=ce("toFactory",Jt.serviceIdentifier,function(){return Jt.factory(Qe.parentContext)});else if(Jt.type===me.BindingTypeEnum.Provider&&Jt.provider!==null)Mt=ce("toProvider",Jt.serviceIdentifier,function(){return Jt.provider(Qe.parentContext)});else if(Jt.type===me.BindingTypeEnum.Instance&&Jt.implementationType!==null)Mt=G.resolveInstance(Jt.implementationType,xt,he(ge));else{var pt=Ie.getServiceIdentifierAsString(Qe.serviceIdentifier);throw new Error(Pe.INVALID_BINDING_TYPE+" "+pt)}return typeof Jt.onActivation=="function"&&(Mt=Jt.onActivation(Qe.parentContext,Mt)),zt&&(Jt.cache=Mt,Jt.activated=!0),lt&&ge!==null&&!ge.has(Jt.id)&&ge.set(Jt.id,Mt),Mt}};function Fe(ge){var Qe=he(ge.plan.rootRequest.requestScope);return Qe(ge.plan.rootRequest)}te.resolve=Fe},91640:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInSyntax=void 0;var Pe=$(77690),me=$(46890),m=function(){function Ie(G){this._binding=G}return Ie.prototype.inRequestScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Request,new me.BindingWhenOnSyntax(this._binding)},Ie.prototype.inSingletonScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},Ie.prototype.inTransientScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Transient,new me.BindingWhenOnSyntax(this._binding)},Ie}();te.BindingInSyntax=m},82386:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInWhenOnSyntax=void 0;var Pe=$(91640),me=$(8926),m=$(36890),Ie=function(){function G(ce){this._binding=ce,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new me.BindingOnSyntax(this._binding),this._bindingInSyntax=new Pe.BindingInSyntax(ce)}return G.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},G.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},G.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},G.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},G.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},G.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},G.prototype.whenTargetTagged=function(ce,he){return this._bindingWhenSyntax.whenTargetTagged(ce,he)},G.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},G.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},G.prototype.whenParentTagged=function(ce,he){return this._bindingWhenSyntax.whenParentTagged(ce,he)},G.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},G.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},G.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},G.prototype.whenAnyAncestorTagged=function(ce,he){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,he)},G.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},G.prototype.whenNoAncestorTagged=function(ce,he){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,he)},G.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},G.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},G.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},G}();te.BindingInWhenOnSyntax=Ie},8926:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingOnSyntax=void 0;var Pe=$(36890),me=function(){function m(Ie){this._binding=Ie}return m.prototype.onActivation=function(Ie){return this._binding.onActivation=Ie,new Pe.BindingWhenSyntax(this._binding)},m}();te.BindingOnSyntax=me},43313:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingToSyntax=void 0;var Pe=$(36078),me=$(77690),m=$(82386),Ie=$(46890),G=function(){function ce(he){this._binding=he}return ce.prototype.to=function(he){return this._binding.type=me.BindingTypeEnum.Instance,this._binding.implementationType=he,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Pe.INVALID_TO_SELF_VALUE);var he=this._binding.serviceIdentifier;return this.to(he)},ce.prototype.toConstantValue=function(he){return this._binding.type=me.BindingTypeEnum.ConstantValue,this._binding.cache=he,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(he){return this._binding.type=me.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=he,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(he){return this._binding.type=me.BindingTypeEnum.Constructor,this._binding.implementationType=he,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(he){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=he,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(he){if(typeof he!="function")throw new Error(Pe.INVALID_FUNCTION_BINDING);var Fe=this.toConstantValue(he);return this._binding.type=me.BindingTypeEnum.Function,this._binding.scope=me.BindingScopeEnum.Singleton,Fe},ce.prototype.toAutoFactory=function(he){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=function(Fe){var ge=function(){return Fe.container.get(he)};return ge},this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(he){return this._binding.type=me.BindingTypeEnum.Provider,this._binding.provider=he,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(he){this.toDynamicValue(function(Fe){return Fe.container.get(he)})},ce}();te.BindingToSyntax=G},46890:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenOnSyntax=void 0;var Pe=$(8926),me=$(36890),m=function(){function Ie(G){this._binding=G,this._bindingWhenSyntax=new me.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Pe.BindingOnSyntax(this._binding)}return Ie.prototype.when=function(G){return this._bindingWhenSyntax.when(G)},Ie.prototype.whenTargetNamed=function(G){return this._bindingWhenSyntax.whenTargetNamed(G)},Ie.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ie.prototype.whenTargetTagged=function(G,ce){return this._bindingWhenSyntax.whenTargetTagged(G,ce)},Ie.prototype.whenInjectedInto=function(G){return this._bindingWhenSyntax.whenInjectedInto(G)},Ie.prototype.whenParentNamed=function(G){return this._bindingWhenSyntax.whenParentNamed(G)},Ie.prototype.whenParentTagged=function(G,ce){return this._bindingWhenSyntax.whenParentTagged(G,ce)},Ie.prototype.whenAnyAncestorIs=function(G){return this._bindingWhenSyntax.whenAnyAncestorIs(G)},Ie.prototype.whenNoAncestorIs=function(G){return this._bindingWhenSyntax.whenNoAncestorIs(G)},Ie.prototype.whenAnyAncestorNamed=function(G){return this._bindingWhenSyntax.whenAnyAncestorNamed(G)},Ie.prototype.whenAnyAncestorTagged=function(G,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(G,ce)},Ie.prototype.whenNoAncestorNamed=function(G){return this._bindingWhenSyntax.whenNoAncestorNamed(G)},Ie.prototype.whenNoAncestorTagged=function(G,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(G,ce)},Ie.prototype.whenAnyAncestorMatches=function(G){return this._bindingWhenSyntax.whenAnyAncestorMatches(G)},Ie.prototype.whenNoAncestorMatches=function(G){return this._bindingWhenSyntax.whenNoAncestorMatches(G)},Ie.prototype.onActivation=function(G){return this._bindingOnSyntax.onActivation(G)},Ie}();te.BindingWhenOnSyntax=m},36890:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenSyntax=void 0;var Pe=$(8926),me=$(83140),m=function(){function Ie(G){this._binding=G}return Ie.prototype.when=function(G){return this._binding.constraint=G,new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetNamed=function(G){return this._binding.constraint=me.namedConstraint(G),new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(G){var ce=G.target!==null&&!G.target.isNamed()&&!G.target.isTagged();return ce},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetTagged=function(G,ce){return this._binding.constraint=me.taggedConstraint(G)(ce),new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenInjectedInto=function(G){return this._binding.constraint=function(ce){return me.typeConstraint(G)(ce.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenParentNamed=function(G){return this._binding.constraint=function(ce){return me.namedConstraint(G)(ce.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenParentTagged=function(G,ce){return this._binding.constraint=function(he){return me.taggedConstraint(G)(ce)(he.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorIs=function(G){return this._binding.constraint=function(ce){return me.traverseAncerstors(ce,me.typeConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorIs=function(G){return this._binding.constraint=function(ce){return!me.traverseAncerstors(ce,me.typeConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorNamed=function(G){return this._binding.constraint=function(ce){return me.traverseAncerstors(ce,me.namedConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorNamed=function(G){return this._binding.constraint=function(ce){return!me.traverseAncerstors(ce,me.namedConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorTagged=function(G,ce){return this._binding.constraint=function(he){return me.traverseAncerstors(he,me.taggedConstraint(G)(ce))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorTagged=function(G,ce){return this._binding.constraint=function(he){return!me.traverseAncerstors(he,me.taggedConstraint(G)(ce))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorMatches=function(G){return this._binding.constraint=function(ce){return me.traverseAncerstors(ce,G)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorMatches=function(G){return this._binding.constraint=function(ce){return!me.traverseAncerstors(ce,G)},new Pe.BindingOnSyntax(this._binding)},Ie}();te.BindingWhenSyntax=m},83140:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.typeConstraint=te.namedConstraint=te.taggedConstraint=te.traverseAncerstors=void 0;var Pe=$(50295),me=$(25092),m=function(he,Fe){var ge=he.parentRequest;return ge!==null?Fe(ge)?!0:m(ge,Fe):!1};te.traverseAncerstors=m;var Ie=function(he){return function(Fe){var ge=function(Qe){return Qe!==null&&Qe.target!==null&&Qe.target.matchesTag(he)(Fe)};return ge.metaData=new me.Metadata(he,Fe),ge}};te.taggedConstraint=Ie;var G=Ie(Pe.NAMED_TAG);te.namedConstraint=G;var ce=function(he){return function(Fe){var ge=null;if(Fe!==null)if(ge=Fe.bindings[0],typeof he=="string"){var Qe=ge.serviceIdentifier;return Qe===he}else{var ct=Fe.bindings[0].implementationType;return he===ct}return!1}};te.typeConstraint=ce},34384:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiBindToService=void 0;var $=function(Pe){return function(me){return function(){for(var m=[],Ie=0;Ie<arguments.length;Ie++)m[Ie]=arguments[Ie];return m.forEach(function(G){return Pe.bind(G).toService(me)})}}};te.multiBindToService=$},92542:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.isStackOverflowExeption=void 0;var Pe=$(36078);function me(m){return m instanceof RangeError||m.message===Pe.STACK_OVERFLOW}te.isStackOverflowExeption=me},70023:function(Cr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.id=void 0;var $=0;function Pe(){return $++}te.id=Pe},29552:function(Cr,te,$){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.circularDependencyToException=te.listMetadataForTarget=te.listRegisteredBindingsForServiceIdentifier=te.getServiceIdentifierAsString=te.getFunctionName=void 0;var Pe=$(36078);function me(ge){if(typeof ge=="function"){var Qe=ge;return Qe.name}else{if(typeof ge=="symbol")return ge.toString();var Qe=ge;return Qe}}te.getServiceIdentifierAsString=me;function m(ge,Qe,ct){var xt="",Qt=ct(ge,Qe);return Qt.length!==0&&(xt=`
Registered bindings:`,Qt.forEach(function(ur){var Mt="Object";ur.implementationType!==null&&(Mt=Fe(ur.implementationType)),xt=xt+`
 `+Mt,ur.constraint.metaData&&(xt=xt+" - "+ur.constraint.metaData)})),xt}te.listRegisteredBindingsForServiceIdentifier=m;function Ie(ge,Qe){return ge.parentRequest===null?!1:ge.parentRequest.serviceIdentifier===Qe?!0:Ie(ge.parentRequest,Qe)}function G(ge){function Qe(xt,Qt){Qt===void 0&&(Qt=[]);var ur=me(xt.serviceIdentifier);return Qt.push(ur),xt.parentRequest!==null?Qe(xt.parentRequest,Qt):Qt}var ct=Qe(ge);return ct.reverse().join(" --> ")}function ce(ge){ge.childRequests.forEach(function(Qe){if(Ie(Qe,Qe.serviceIdentifier)){var ct=G(Qe);throw new Error(Pe.CIRCULAR_DEPENDENCY+" "+ct)}else ce(Qe)})}te.circularDependencyToException=ce;function he(ge,Qe){if(Qe.isTagged()||Qe.isNamed()){var ct="",xt=Qe.getNamedTag(),Qt=Qe.getCustomTags();return xt!==null&&(ct+=xt.toString()+`
`),Qt!==null&&Qt.forEach(function(ur){ct+=ur.toString()+`
`})," "+ge+`
 `+ge+" - "+ct}else return" "+ge}te.listMetadataForTarget=he;function Fe(ge){if(ge.name)return ge.name;var Qe=ge.toString(),ct=Qe.match(/^function\s*([^\s(]+)/);return ct?ct[1]:"Anonymous function: "+Qe}te.getFunctionName=Fe},38419:function(Cr){"use strict";Cr.exports=$,Cr.exports.default=$;var te=1e20;function $(G,ce,he,Fe,ge,Qe){this.fontSize=G||24,this.buffer=ce===void 0?3:ce,this.cutoff=Fe||.25,this.fontFamily=ge||"sans-serif",this.fontWeight=Qe||"normal",this.radius=he||8;var ct=this.size=this.fontSize+this.buffer*2,xt=ct+this.buffer*2,Qt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Qt?this.canvas=my.createOffscreenCanvas(ct,ct,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ct),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(xt*xt),this.gridInner=new Float64Array(xt*xt),this.f=new Float64Array(xt),this.z=new Float64Array(xt+1),this.v=new Uint16Array(xt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Qt?this.middle=Math.round(ct/2*1):this.middle=Math.round(ct/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pe(G,ce,he,Fe,ge,Qe,ct){Qe.fill(te,0,ce*he),ct.fill(0,0,ce*he);for(var xt=(ce-Fe)/2,Qt=0;Qt<ge;Qt++)for(var ur=0;ur<Fe;ur++){var Mt=(Qt+xt)*ce+ur+xt,Jt=G.data[4*(Qt*Fe+ur)+3]/255;if(Jt===1)Qe[Mt]=0,ct[Mt]=te;else if(Jt===0)Qe[Mt]=te,ct[Mt]=0;else{var zt=Math.max(0,.5-Jt),lt=Math.max(0,Jt-.5);Qe[Mt]=zt*zt,ct[Mt]=lt*lt}}}function me(G,ce,he,Fe,ge,Qe,ct){for(var xt=0;xt<ce*he;xt++){var Qt=Math.sqrt(Fe[xt])-Math.sqrt(ge[xt]);G[xt]=Math.round(255-255*(Qt/Qe+ct))}}$.prototype._draw=function(G,ce){var he=this.ctx.measureText(G),Fe=he.width,ge=2*this.buffer,Qe,ct,xt,Qt,ur,Mt,Jt,zt;ce&&this.useMetrics?(ur=Math.floor(he.actualBoundingBoxAscent),zt=this.buffer+Math.ceil(he.actualBoundingBoxAscent),Mt=this.buffer,Jt=this.buffer,ct=Math.min(this.size,Math.ceil(he.actualBoundingBoxRight-he.actualBoundingBoxLeft)),Qt=Math.min(this.size-Mt,Math.ceil(he.actualBoundingBoxAscent+he.actualBoundingBoxDescent)),Qe=ct+ge,xt=Qt+ge,this.ctx.textBaseline="alphabetic"):(Qe=ct=this.size,xt=Qt=this.size,ur=19*this.fontSize/24,Mt=Jt=0,zt=this.middle,this.ctx.textBaseline="middle");var lt;ct&&Qt&&(this.ctx.clearRect(Jt,Mt,ct,Qt),this.ctx.fillText(G,this.buffer,zt),lt=this.ctx.getImageData(Jt,Mt,ct,Qt));var pt=new Uint8ClampedArray(Qe*xt);return Pe(lt,Qe,xt,ct,Qt,this.gridOuter,this.gridInner),m(this.gridOuter,Qe,xt,this.f,this.v,this.z),m(this.gridInner,Qe,xt,this.f,this.v,this.z),me(pt,Qe,xt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:ct,height:Qt,sdfWidth:Qe,sdfHeight:xt,top:ur,left:0,advance:Fe}}},$.prototype.draw=function(G){return this._draw(G,!1).data},$.prototype.drawWithMetrics=function(G){return this._draw(G,!0)};function m(G,ce,he,Fe,ge,Qe){for(var ct=0;ct<ce;ct++)Ie(G,ct,ce,he,Fe,ge,Qe);for(var xt=0;xt<he;xt++)Ie(G,xt*ce,1,ce,Fe,ge,Qe)}function Ie(G,ce,he,Fe,ge,Qe,ct){var xt,Qt,ur,Mt;for(Qe[0]=0,ct[0]=-te,ct[1]=te,xt=0;xt<Fe;xt++)ge[xt]=G[ce+xt*he];for(xt=1,Qt=0,ur=0;xt<Fe;xt++){do Mt=Qe[Qt],ur=(ge[xt]-ge[Mt]+xt*xt-Mt*Mt)/(xt-Mt)/2;while(ur<=ct[Qt]&&--Qt>-1);Qt++,Qe[Qt]=xt,ct[Qt]=ur,ct[Qt+1]=te}for(xt=0,Qt=0;xt<Fe;xt++){for(;ct[Qt+1]<xt;)Qt++;Mt=Qe[Qt],G[ce+xt*he]=ge[Mt]+(xt-Mt)*(xt-Mt)}}},9180:function(Cr,te,$){"use strict";$.r(te),$.d(te,{Function:function(){return Hs},Interpreter:function(){return ma},default:function(){return il},evaluate:function(){return zu},vm:function(){return Pe}});var Pe={};$.r(Pe),$.d(Pe,{Script:function(){return Ql},compileFunction:function(){return ef},createContext:function(){return ts},runInContext:function(){return wl},runInNewContext:function(){return Gs}});var me={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ie={5:m,"5module":m+" export import",6:m+" const class extends export import super"},G=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",he="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Fe=new RegExp("["+ce+"]"),ge=new RegExp("["+ce+he+"]");ce=he=null;var Qe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ct=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function xt(g,A){for(var D=65536,O=0;O<A.length;O+=2){if(D+=A[O],D>g)return!1;if(D+=A[O+1],D>=g)return!0}}function Qt(g,A){return g<65?g===36:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&Fe.test(String.fromCharCode(g)):A===!1?!1:xt(g,Qe)}function ur(g,A){return g<48?g===36:g<58?!0:g<65?!1:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&ge.test(String.fromCharCode(g)):A===!1?!1:xt(g,Qe)||xt(g,ct)}var Mt=function(A,D){D===void 0&&(D={}),this.label=A,this.keyword=D.keyword,this.beforeExpr=!!D.beforeExpr,this.startsExpr=!!D.startsExpr,this.isLoop=!!D.isLoop,this.isAssign=!!D.isAssign,this.prefix=!!D.prefix,this.postfix=!!D.postfix,this.binop=D.binop||null,this.updateContext=null};function Jt(g,A){return new Mt(g,{beforeExpr:!0,binop:A})}var zt={beforeExpr:!0},lt={startsExpr:!0},pt={};function ir(g,A){return A===void 0&&(A={}),A.keyword=g,pt[g]=new Mt(g,A)}var W={num:new Mt("num",lt),regexp:new Mt("regexp",lt),string:new Mt("string",lt),name:new Mt("name",lt),eof:new Mt("eof"),bracketL:new Mt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Mt("]"),braceL:new Mt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Mt("}"),parenL:new Mt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Mt(")"),comma:new Mt(",",zt),semi:new Mt(";",zt),colon:new Mt(":",zt),dot:new Mt("."),question:new Mt("?",zt),questionDot:new Mt("?."),arrow:new Mt("=>",zt),template:new Mt("template"),invalidTemplate:new Mt("invalidTemplate"),ellipsis:new Mt("...",zt),backQuote:new Mt("`",lt),dollarBraceL:new Mt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Mt("=",{beforeExpr:!0,isAssign:!0}),assign:new Mt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Mt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Mt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Jt("||",1),logicalAND:Jt("&&",2),bitwiseOR:Jt("|",3),bitwiseXOR:Jt("^",4),bitwiseAND:Jt("&",5),equality:Jt("==/!=/===/!==",6),relational:Jt("</>/<=/>=",7),bitShift:Jt("<</>>/>>>",8),plusMin:new Mt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Jt("%",10),star:Jt("*",10),slash:Jt("/",10),starstar:new Mt("**",{beforeExpr:!0}),coalesce:Jt("??",1),_break:ir("break"),_case:ir("case",zt),_catch:ir("catch"),_continue:ir("continue"),_debugger:ir("debugger"),_default:ir("default",zt),_do:ir("do",{isLoop:!0,beforeExpr:!0}),_else:ir("else",zt),_finally:ir("finally"),_for:ir("for",{isLoop:!0}),_function:ir("function",lt),_if:ir("if"),_return:ir("return",zt),_switch:ir("switch"),_throw:ir("throw",zt),_try:ir("try"),_var:ir("var"),_const:ir("const"),_while:ir("while",{isLoop:!0}),_with:ir("with"),_new:ir("new",{beforeExpr:!0,startsExpr:!0}),_this:ir("this",lt),_super:ir("super",lt),_class:ir("class",lt),_extends:ir("extends",zt),_export:ir("export"),_import:ir("import",lt),_null:ir("null",lt),_true:ir("true",lt),_false:ir("false",lt),_in:ir("in",{beforeExpr:!0,binop:7}),_instanceof:ir("instanceof",{beforeExpr:!0,binop:7}),_typeof:ir("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ir("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ir("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Wt=/\r\n?|\n|\u2028|\u2029/,ot=new RegExp(Wt.source,"g");function Ye(g,A){return g===10||g===13||!A&&(g===8232||g===8233)}var bt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ke=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Xt=Object.prototype,Sr=Xt.hasOwnProperty,Vr=Xt.toString;function en(g,A){return Sr.call(g,A)}var C=Array.isArray||function(g){return Vr.call(g)==="[object Array]"};function Ee(g){return new RegExp("^(?:"+g.replace(/ /g,"|")+")$")}var Re=function(A,D){this.line=A,this.column=D};Re.prototype.offset=function(A){return new Re(this.line,this.column+A)};var yt=function(A,D,O){this.start=D,this.end=O,A.sourceFile!==null&&(this.source=A.sourceFile)};function ft(g,A){for(var D=1,O=0;;){ot.lastIndex=O;var H=ot.exec(g);if(H&&H.index<A)++D,O=H.index+H[0].length;else return new Re(D,A-O)}}var It={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ht(g){var A={};for(var D in It)A[D]=g&&en(g,D)?g[D]:It[D];if(A.ecmaVersion>=2015&&(A.ecmaVersion-=2009),A.allowReserved==null&&(A.allowReserved=A.ecmaVersion<5),C(A.onToken)){var O=A.onToken;A.onToken=function(H){return O.push(H)}}return C(A.onComment)&&(A.onComment=xr(A,A.onComment)),A}function xr(g,A){return function(D,O,H,de,je,it){var at={type:D?"Block":"Line",value:O,start:H,end:de};g.locations&&(at.loc=new yt(this,je,it)),g.ranges&&(at.range=[H,de]),A.push(at)}}var Kn=1,dn=2,di=Kn|dn,jn=4,ni=8,vi=16,Hn=32,mi=64,ha=128;function Hi(g,A){return dn|(g?jn:0)|(A?ni:0)}var Di=0,Qi=1,pa=2,Lo=3,La=4,ga=5,Bi=function(A,D,O){this.options=A=Ht(A),this.sourceFile=A.sourceFile,this.keywords=Ee(Ie[A.ecmaVersion>=6?6:A.sourceType==="module"?"5module":5]);var H="";if(A.allowReserved!==!0){for(var de=A.ecmaVersion;!(H=me[de]);de--);A.sourceType==="module"&&(H+=" await")}this.reservedWords=Ee(H);var je=(H?H+" ":"")+me.strict;this.reservedWordsStrict=Ee(je),this.reservedWordsStrictBind=Ee(je+" "+me.strictBind),this.input=String(D),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Wt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=W.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=A.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&A.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Kn),this.regexpState=null},aa={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Bi.prototype.parse=function(){var A=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(A)},aa.inFunction.get=function(){return(this.currentVarScope().flags&dn)>0},aa.inGenerator.get=function(){return(this.currentVarScope().flags&ni)>0},aa.inAsync.get=function(){return(this.currentVarScope().flags&jn)>0},aa.allowSuper.get=function(){return(this.currentThisScope().flags&mi)>0},aa.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ha)>0},aa.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Bi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&dn)>0},Bi.extend=function(){for(var A=[],D=arguments.length;D--;)A[D]=arguments[D];for(var O=this,H=0;H<A.length;H++)O=A[H](O);return O},Bi.parse=function(A,D){return new this(D,A).parse()},Bi.parseExpressionAt=function(A,D,O){var H=new this(O,A,D);return H.nextToken(),H.parseExpression()},Bi.tokenizer=function(A,D){return new this(D,A)},Object.defineProperties(Bi.prototype,aa);var Ji=Bi.prototype,Cs=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Ji.strictDirective=function(g){for(;;){Ke.lastIndex=g,g+=Ke.exec(this.input)[0].length;var A=Cs.exec(this.input.slice(g));if(!A)return!1;if((A[1]||A[2])==="use strict"){Ke.lastIndex=g+A[0].length;var D=Ke.exec(this.input),O=D.index+D[0].length,H=this.input.charAt(O);return H===";"||H==="}"||Wt.test(D[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(H)||H==="!"&&this.input.charAt(O+1)==="=")}g+=A[0].length,Ke.lastIndex=g,g+=Ke.exec(this.input)[0].length,this.input[g]===";"&&g++}},Ji.eat=function(g){return this.type===g?(this.next(),!0):!1},Ji.isContextual=function(g){return this.type===W.name&&this.value===g&&!this.containsEsc},Ji.eatContextual=function(g){return this.isContextual(g)?(this.next(),!0):!1},Ji.expectContextual=function(g){this.eatContextual(g)||this.unexpected()},Ji.canInsertSemicolon=function(){return this.type===W.eof||this.type===W.braceR||Wt.test(this.input.slice(this.lastTokEnd,this.start))},Ji.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Ji.semicolon=function(){!this.eat(W.semi)&&!this.insertSemicolon()&&this.unexpected()},Ji.afterTrailingComma=function(g,A){if(this.type===g)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),A||this.next(),!0},Ji.expect=function(g){this.eat(g)||this.unexpected()},Ji.unexpected=function(g){this.raise(g!=null?g:this.start,"Unexpected token")};function le(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Ji.checkPatternErrors=function(g,A){if(!!g){g.trailingComma>-1&&this.raiseRecoverable(g.trailingComma,"Comma is not permitted after the rest element");var D=A?g.parenthesizedAssign:g.parenthesizedBind;D>-1&&this.raiseRecoverable(D,"Parenthesized pattern")}},Ji.checkExpressionErrors=function(g,A){if(!g)return!1;var D=g.shorthandAssign,O=g.doubleProto;if(!A)return D>=0||O>=0;D>=0&&this.raise(D,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Ji.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Ji.isSimpleAssignTarget=function(g){return g.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(g.expression):g.type==="Identifier"||g.type==="MemberExpression"};var ii=Bi.prototype;ii.parseTopLevel=function(g){var A={};for(g.body||(g.body=[]);this.type!==W.eof;){var D=this.parseStatement(null,!0,A);g.body.push(D)}if(this.inModule)for(var O=0,H=Object.keys(this.undefinedExports);O<H.length;O+=1){var de=H[O];this.raiseRecoverable(this.undefinedExports[de].start,"Export '"+de+"' is not defined")}return this.adaptDirectivePrologue(g.body),this.next(),g.sourceType=this.options.sourceType,this.finishNode(g,"Program")};var mo={kind:"loop"},Js={kind:"switch"};ii.isLet=function(g){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ke.lastIndex=this.pos;var A=Ke.exec(this.input),D=this.pos+A[0].length,O=this.input.charCodeAt(D);if(O===91)return!0;if(g)return!1;if(O===123)return!0;if(Qt(O,!0)){for(var H=D+1;ur(this.input.charCodeAt(H),!0);)++H;var de=this.input.slice(D,H);if(!G.test(de))return!0}return!1},ii.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ke.lastIndex=this.pos;var g=Ke.exec(this.input),A=this.pos+g[0].length;return!Wt.test(this.input.slice(this.pos,A))&&this.input.slice(A,A+8)==="function"&&(A+8===this.input.length||!ur(this.input.charAt(A+8)))},ii.parseStatement=function(g,A,D){var O=this.type,H=this.startNode(),de;switch(this.isLet(g)&&(O=W._var,de="let"),O){case W._break:case W._continue:return this.parseBreakContinueStatement(H,O.keyword);case W._debugger:return this.parseDebuggerStatement(H);case W._do:return this.parseDoStatement(H);case W._for:return this.parseForStatement(H);case W._function:return g&&(this.strict||g!=="if"&&g!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(H,!1,!g);case W._class:return g&&this.unexpected(),this.parseClass(H,!0);case W._if:return this.parseIfStatement(H);case W._return:return this.parseReturnStatement(H);case W._switch:return this.parseSwitchStatement(H);case W._throw:return this.parseThrowStatement(H);case W._try:return this.parseTryStatement(H);case W._const:case W._var:return de=de||this.value,g&&de!=="var"&&this.unexpected(),this.parseVarStatement(H,de);case W._while:return this.parseWhileStatement(H);case W._with:return this.parseWithStatement(H);case W.braceL:return this.parseBlock(!0,H);case W.semi:return this.parseEmptyStatement(H);case W._export:case W._import:if(this.options.ecmaVersion>10&&O===W._import){Ke.lastIndex=this.pos;var je=Ke.exec(this.input),it=this.pos+je[0].length,at=this.input.charCodeAt(it);if(at===40||at===46)return this.parseExpressionStatement(H,this.parseExpression())}return this.options.allowImportExportEverywhere||(A||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===W._import?this.parseImport(H):this.parseExport(H,D);default:if(this.isAsyncFunction())return g&&this.unexpected(),this.next(),this.parseFunctionStatement(H,!0,!g);var er=this.value,ar=this.parseExpression();return O===W.name&&ar.type==="Identifier"&&this.eat(W.colon)?this.parseLabeledStatement(H,er,ar,g):this.parseExpressionStatement(H,ar)}},ii.parseBreakContinueStatement=function(g,A){var D=A==="break";this.next(),this.eat(W.semi)||this.insertSemicolon()?g.label=null:this.type!==W.name?this.unexpected():(g.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var H=this.labels[O];if((g.label==null||H.name===g.label.name)&&(H.kind!=null&&(D||H.kind==="loop")||g.label&&D))break}return O===this.labels.length&&this.raise(g.start,"Unsyntactic "+A),this.finishNode(g,D?"BreakStatement":"ContinueStatement")},ii.parseDebuggerStatement=function(g){return this.next(),this.semicolon(),this.finishNode(g,"DebuggerStatement")},ii.parseDoStatement=function(g){return this.next(),this.labels.push(mo),g.body=this.parseStatement("do"),this.labels.pop(),this.expect(W._while),g.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(W.semi):this.semicolon(),this.finishNode(g,"DoWhileStatement")},ii.parseForStatement=function(g){this.next();var A=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(mo),this.enterScope(0),this.expect(W.parenL),this.type===W.semi)return A>-1&&this.unexpected(A),this.parseFor(g,null);var D=this.isLet();if(this.type===W._var||this.type===W._const||D){var O=this.startNode(),H=D?"let":this.value;return this.next(),this.parseVar(O,!0,H),this.finishNode(O,"VariableDeclaration"),(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===W._in?A>-1&&this.unexpected(A):g.await=A>-1),this.parseForIn(g,O)):(A>-1&&this.unexpected(A),this.parseFor(g,O))}var de=new le,je=this.parseExpression(!0,de);return this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===W._in?A>-1&&this.unexpected(A):g.await=A>-1),this.toAssignable(je,!1,de),this.checkLVal(je),this.parseForIn(g,je)):(this.checkExpressionErrors(de,!0),A>-1&&this.unexpected(A),this.parseFor(g,je))},ii.parseFunctionStatement=function(g,A,D){return this.next(),this.parseFunction(g,Kt|(D?0:Ir),!1,A)},ii.parseIfStatement=function(g){return this.next(),g.test=this.parseParenExpression(),g.consequent=this.parseStatement("if"),g.alternate=this.eat(W._else)?this.parseStatement("if"):null,this.finishNode(g,"IfStatement")},ii.parseReturnStatement=function(g){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(W.semi)||this.insertSemicolon()?g.argument=null:(g.argument=this.parseExpression(),this.semicolon()),this.finishNode(g,"ReturnStatement")},ii.parseSwitchStatement=function(g){this.next(),g.discriminant=this.parseParenExpression(),g.cases=[],this.expect(W.braceL),this.labels.push(Js),this.enterScope(0);for(var A,D=!1;this.type!==W.braceR;)if(this.type===W._case||this.type===W._default){var O=this.type===W._case;A&&this.finishNode(A,"SwitchCase"),g.cases.push(A=this.startNode()),A.consequent=[],this.next(),O?A.test=this.parseExpression():(D&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),D=!0,A.test=null),this.expect(W.colon)}else A||this.unexpected(),A.consequent.push(this.parseStatement(null));return this.exitScope(),A&&this.finishNode(A,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(g,"SwitchStatement")},ii.parseThrowStatement=function(g){return this.next(),Wt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),g.argument=this.parseExpression(),this.semicolon(),this.finishNode(g,"ThrowStatement")};var kt=[];ii.parseTryStatement=function(g){if(this.next(),g.block=this.parseBlock(),g.handler=null,this.type===W._catch){var A=this.startNode();if(this.next(),this.eat(W.parenL)){A.param=this.parseBindingAtom();var D=A.param.type==="Identifier";this.enterScope(D?Hn:0),this.checkLVal(A.param,D?La:pa),this.expect(W.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),A.param=null,this.enterScope(0);A.body=this.parseBlock(!1),this.exitScope(),g.handler=this.finishNode(A,"CatchClause")}return g.finalizer=this.eat(W._finally)?this.parseBlock():null,!g.handler&&!g.finalizer&&this.raise(g.start,"Missing catch or finally clause"),this.finishNode(g,"TryStatement")},ii.parseVarStatement=function(g,A){return this.next(),this.parseVar(g,!1,A),this.semicolon(),this.finishNode(g,"VariableDeclaration")},ii.parseWhileStatement=function(g){return this.next(),g.test=this.parseParenExpression(),this.labels.push(mo),g.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(g,"WhileStatement")},ii.parseWithStatement=function(g){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),g.object=this.parseParenExpression(),g.body=this.parseStatement("with"),this.finishNode(g,"WithStatement")},ii.parseEmptyStatement=function(g){return this.next(),this.finishNode(g,"EmptyStatement")},ii.parseLabeledStatement=function(g,A,D,O){for(var H=0,de=this.labels;H<de.length;H+=1){var je=de[H];je.name===A&&this.raise(D.start,"Label '"+A+"' is already declared")}for(var it=this.type.isLoop?"loop":this.type===W._switch?"switch":null,at=this.labels.length-1;at>=0;at--){var er=this.labels[at];if(er.statementStart===g.start)er.statementStart=this.start,er.kind=it;else break}return this.labels.push({name:A,kind:it,statementStart:this.start}),g.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),g.label=D,this.finishNode(g,"LabeledStatement")},ii.parseExpressionStatement=function(g,A){return g.expression=A,this.semicolon(),this.finishNode(g,"ExpressionStatement")},ii.parseBlock=function(g,A,D){for(g===void 0&&(g=!0),A===void 0&&(A=this.startNode()),A.body=[],this.expect(W.braceL),g&&this.enterScope(0);this.type!==W.braceR;){var O=this.parseStatement(null);A.body.push(O)}return D&&(this.strict=!1),this.next(),g&&this.exitScope(),this.finishNode(A,"BlockStatement")},ii.parseFor=function(g,A){return g.init=A,this.expect(W.semi),g.test=this.type===W.semi?null:this.parseExpression(),this.expect(W.semi),g.update=this.type===W.parenR?null:this.parseExpression(),this.expect(W.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,"ForStatement")},ii.parseForIn=function(g,A){var D=this.type===W._in;return this.next(),A.type==="VariableDeclaration"&&A.declarations[0].init!=null&&(!D||this.options.ecmaVersion<8||this.strict||A.kind!=="var"||A.declarations[0].id.type!=="Identifier")?this.raise(A.start,(D?"for-in":"for-of")+" loop variable declaration may not have an initializer"):A.type==="AssignmentPattern"&&this.raise(A.start,"Invalid left-hand side in for-loop"),g.left=A,g.right=D?this.parseExpression():this.parseMaybeAssign(),this.expect(W.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,D?"ForInStatement":"ForOfStatement")},ii.parseVar=function(g,A,D){for(g.declarations=[],g.kind=D;;){var O=this.startNode();if(this.parseVarId(O,D),this.eat(W.eq)?O.init=this.parseMaybeAssign(A):D==="const"&&!(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(A&&(this.type===W._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,g.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(W.comma))break}return g},ii.parseVarId=function(g,A){g.id=this.parseBindingAtom(),this.checkLVal(g.id,A==="var"?Qi:pa,!1)};var Kt=1,Ir=2,nn=4;ii.parseFunction=function(g,A,D,O){this.initFunction(g),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===W.star&&A&Ir&&this.unexpected(),g.generator=this.eat(W.star)),this.options.ecmaVersion>=8&&(g.async=!!O),A&Kt&&(g.id=A&nn&&this.type!==W.name?null:this.parseIdent(),g.id&&!(A&Ir)&&this.checkLVal(g.id,this.strict||g.generator||g.async?this.treatFunctionsAsVar?Qi:pa:Lo));var H=this.yieldPos,de=this.awaitPos,je=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Hi(g.async,g.generator)),A&Kt||(g.id=this.type===W.name?this.parseIdent():null),this.parseFunctionParams(g),this.parseFunctionBody(g,D,!1),this.yieldPos=H,this.awaitPos=de,this.awaitIdentPos=je,this.finishNode(g,A&Kt?"FunctionDeclaration":"FunctionExpression")},ii.parseFunctionParams=function(g){this.expect(W.parenL),g.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ii.parseClass=function(g,A){this.next();var D=this.strict;this.strict=!0,this.parseClassId(g,A),this.parseClassSuper(g);var O=this.startNode(),H=!1;for(O.body=[],this.expect(W.braceL);this.type!==W.braceR;){var de=this.parseClassElement(g.superClass!==null);de&&(O.body.push(de),de.type==="MethodDefinition"&&de.kind==="constructor"&&(H&&this.raise(de.start,"Duplicate constructor in the same class"),H=!0))}return this.strict=D,this.next(),g.body=this.finishNode(O,"ClassBody"),this.finishNode(g,A?"ClassDeclaration":"ClassExpression")},ii.parseClassElement=function(g){var A=this;if(this.eat(W.semi))return null;var D=this.startNode(),O=function(at,er){er===void 0&&(er=!1);var ar=A.start,wn=A.startLoc;return A.eatContextual(at)?A.type!==W.parenL&&(!er||!A.canInsertSemicolon())?!0:(D.key&&A.unexpected(),D.computed=!1,D.key=A.startNodeAt(ar,wn),D.key.name=at,A.finishNode(D.key,"Identifier"),!1):!1};D.kind="method",D.static=O("static");var H=this.eat(W.star),de=!1;H||(this.options.ecmaVersion>=8&&O("async",!0)?(de=!0,H=this.options.ecmaVersion>=9&&this.eat(W.star)):O("get")?D.kind="get":O("set")&&(D.kind="set")),D.key||this.parsePropertyName(D);var je=D.key,it=!1;return!D.computed&&!D.static&&(je.type==="Identifier"&&je.name==="constructor"||je.type==="Literal"&&je.value==="constructor")?(D.kind!=="method"&&this.raise(je.start,"Constructor can't have get/set modifier"),H&&this.raise(je.start,"Constructor can't be a generator"),de&&this.raise(je.start,"Constructor can't be an async method"),D.kind="constructor",it=g):D.static&&je.type==="Identifier"&&je.name==="prototype"&&this.raise(je.start,"Classes may not have a static property named prototype"),this.parseClassMethod(D,H,de,it),D.kind==="get"&&D.value.params.length!==0&&this.raiseRecoverable(D.value.start,"getter should have no params"),D.kind==="set"&&D.value.params.length!==1&&this.raiseRecoverable(D.value.start,"setter should have exactly one param"),D.kind==="set"&&D.value.params[0].type==="RestElement"&&this.raiseRecoverable(D.value.params[0].start,"Setter cannot use rest params"),D},ii.parseClassMethod=function(g,A,D,O){return g.value=this.parseMethod(A,D,O),this.finishNode(g,"MethodDefinition")},ii.parseClassId=function(g,A){this.type===W.name?(g.id=this.parseIdent(),A&&this.checkLVal(g.id,pa,!1)):(A===!0&&this.unexpected(),g.id=null)},ii.parseClassSuper=function(g){g.superClass=this.eat(W._extends)?this.parseExprSubscripts():null},ii.parseExport=function(g,A){if(this.next(),this.eat(W.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(g.exported=this.parseIdent(!0),this.checkExport(A,g.exported.name,this.lastTokStart)):g.exported=null),this.expectContextual("from"),this.type!==W.string&&this.unexpected(),g.source=this.parseExprAtom(),this.semicolon(),this.finishNode(g,"ExportAllDeclaration");if(this.eat(W._default)){this.checkExport(A,"default",this.lastTokStart);var D;if(this.type===W._function||(D=this.isAsyncFunction())){var O=this.startNode();this.next(),D&&this.next(),g.declaration=this.parseFunction(O,Kt|nn,!1,D)}else if(this.type===W._class){var H=this.startNode();g.declaration=this.parseClass(H,"nullableID")}else g.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(g,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())g.declaration=this.parseStatement(null),g.declaration.type==="VariableDeclaration"?this.checkVariableExport(A,g.declaration.declarations):this.checkExport(A,g.declaration.id.name,g.declaration.id.start),g.specifiers=[],g.source=null;else{if(g.declaration=null,g.specifiers=this.parseExportSpecifiers(A),this.eatContextual("from"))this.type!==W.string&&this.unexpected(),g.source=this.parseExprAtom();else{for(var de=0,je=g.specifiers;de<je.length;de+=1){var it=je[de];this.checkUnreserved(it.local),this.checkLocalExport(it.local)}g.source=null}this.semicolon()}return this.finishNode(g,"ExportNamedDeclaration")},ii.checkExport=function(g,A,D){!g||(en(g,A)&&this.raiseRecoverable(D,"Duplicate export '"+A+"'"),g[A]=!0)},ii.checkPatternExport=function(g,A){var D=A.type;if(D==="Identifier")this.checkExport(g,A.name,A.start);else if(D==="ObjectPattern")for(var O=0,H=A.properties;O<H.length;O+=1){var de=H[O];this.checkPatternExport(g,de)}else if(D==="ArrayPattern")for(var je=0,it=A.elements;je<it.length;je+=1){var at=it[je];at&&this.checkPatternExport(g,at)}else D==="Property"?this.checkPatternExport(g,A.value):D==="AssignmentPattern"?this.checkPatternExport(g,A.left):D==="RestElement"?this.checkPatternExport(g,A.argument):D==="ParenthesizedExpression"&&this.checkPatternExport(g,A.expression)},ii.checkVariableExport=function(g,A){if(!!g)for(var D=0,O=A;D<O.length;D+=1){var H=O[D];this.checkPatternExport(g,H.id)}},ii.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ii.parseExportSpecifiers=function(g){var A=[],D=!0;for(this.expect(W.braceL);!this.eat(W.braceR);){if(D)D=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(g,O.exported.name,O.exported.start),A.push(this.finishNode(O,"ExportSpecifier"))}return A},ii.parseImport=function(g){return this.next(),this.type===W.string?(g.specifiers=kt,g.source=this.parseExprAtom()):(g.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),g.source=this.type===W.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(g,"ImportDeclaration")},ii.parseImportSpecifiers=function(){var g=[],A=!0;if(this.type===W.name){var D=this.startNode();if(D.local=this.parseIdent(),this.checkLVal(D.local,pa),g.push(this.finishNode(D,"ImportDefaultSpecifier")),!this.eat(W.comma))return g}if(this.type===W.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,pa),g.push(this.finishNode(O,"ImportNamespaceSpecifier")),g}for(this.expect(W.braceL);!this.eat(W.braceR);){if(A)A=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;var H=this.startNode();H.imported=this.parseIdent(!0),this.eatContextual("as")?H.local=this.parseIdent():(this.checkUnreserved(H.imported),H.local=H.imported),this.checkLVal(H.local,pa),g.push(this.finishNode(H,"ImportSpecifier"))}return g},ii.adaptDirectivePrologue=function(g){for(var A=0;A<g.length&&this.isDirectiveCandidate(g[A]);++A)g[A].directive=g[A].expression.raw.slice(1,-1)},ii.isDirectiveCandidate=function(g){return g.type==="ExpressionStatement"&&g.expression.type==="Literal"&&typeof g.expression.value=="string"&&(this.input[g.start]==='"'||this.input[g.start]==="'")};var Sn=Bi.prototype;Sn.toAssignable=function(g,A,D){if(this.options.ecmaVersion>=6&&g)switch(g.type){case"Identifier":this.inAsync&&g.name==="await"&&this.raise(g.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":g.type="ObjectPattern",D&&this.checkPatternErrors(D,!0);for(var O=0,H=g.properties;O<H.length;O+=1){var de=H[O];this.toAssignable(de,A),de.type==="RestElement"&&(de.argument.type==="ArrayPattern"||de.argument.type==="ObjectPattern")&&this.raise(de.argument.start,"Unexpected token")}break;case"Property":g.kind!=="init"&&this.raise(g.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(g.value,A);break;case"ArrayExpression":g.type="ArrayPattern",D&&this.checkPatternErrors(D,!0),this.toAssignableList(g.elements,A);break;case"SpreadElement":g.type="RestElement",this.toAssignable(g.argument,A),g.argument.type==="AssignmentPattern"&&this.raise(g.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":g.operator!=="="&&this.raise(g.left.end,"Only '=' operator can be used for specifying default value."),g.type="AssignmentPattern",delete g.operator,this.toAssignable(g.left,A);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(g.expression,A,D);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!A)break;default:this.raise(g.start,"Assigning to rvalue")}else D&&this.checkPatternErrors(D,!0);return g},Sn.toAssignableList=function(g,A){for(var D=g.length,O=0;O<D;O++){var H=g[O];H&&this.toAssignable(H,A)}if(D){var de=g[D-1];this.options.ecmaVersion===6&&A&&de&&de.type==="RestElement"&&de.argument.type!=="Identifier"&&this.unexpected(de.argument.start)}return g},Sn.parseSpread=function(g){var A=this.startNode();return this.next(),A.argument=this.parseMaybeAssign(!1,g),this.finishNode(A,"SpreadElement")},Sn.parseRestBinding=function(){var g=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==W.name&&this.unexpected(),g.argument=this.parseBindingAtom(),this.finishNode(g,"RestElement")},Sn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case W.bracketL:var g=this.startNode();return this.next(),g.elements=this.parseBindingList(W.bracketR,!0,!0),this.finishNode(g,"ArrayPattern");case W.braceL:return this.parseObj(!0)}return this.parseIdent()},Sn.parseBindingList=function(g,A,D){for(var O=[],H=!0;!this.eat(g);)if(H?H=!1:this.expect(W.comma),A&&this.type===W.comma)O.push(null);else{if(D&&this.afterTrailingComma(g))break;if(this.type===W.ellipsis){var de=this.parseRestBinding();this.parseBindingListItem(de),O.push(de),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(g);break}else{var je=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(je),O.push(je)}}return O},Sn.parseBindingListItem=function(g){return g},Sn.parseMaybeDefault=function(g,A,D){if(D=D||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(W.eq))return D;var O=this.startNodeAt(g,A);return O.left=D,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Sn.checkLVal=function(g,A,D){switch(A===void 0&&(A=Di),g.type){case"Identifier":A===pa&&g.name==="let"&&this.raiseRecoverable(g.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(g.name)&&this.raiseRecoverable(g.start,(A?"Binding ":"Assigning to ")+g.name+" in strict mode"),D&&(en(D,g.name)&&this.raiseRecoverable(g.start,"Argument name clash"),D[g.name]=!0),A!==Di&&A!==ga&&this.declareName(g.name,A,g.start);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":A&&this.raiseRecoverable(g.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,H=g.properties;O<H.length;O+=1){var de=H[O];this.checkLVal(de,A,D)}break;case"Property":this.checkLVal(g.value,A,D);break;case"ArrayPattern":for(var je=0,it=g.elements;je<it.length;je+=1){var at=it[je];at&&this.checkLVal(at,A,D)}break;case"AssignmentPattern":this.checkLVal(g.left,A,D);break;case"RestElement":this.checkLVal(g.argument,A,D);break;case"ParenthesizedExpression":this.checkLVal(g.expression,A,D);break;default:this.raise(g.start,(A?"Binding":"Assigning to")+" rvalue")}};var Bn=Bi.prototype;Bn.checkPropClash=function(g,A,D){if(!(this.options.ecmaVersion>=9&&g.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(g.computed||g.method||g.shorthand))){var O=g.key,H;switch(O.type){case"Identifier":H=O.name;break;case"Literal":H=String(O.value);break;default:return}var de=g.kind;if(this.options.ecmaVersion>=6){H==="__proto__"&&de==="init"&&(A.proto&&(D?D.doubleProto<0&&(D.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),A.proto=!0);return}H="$"+H;var je=A[H];if(je){var it;de==="init"?it=this.strict&&je.init||je.get||je.set:it=je.init||je[de],it&&this.raiseRecoverable(O.start,"Redefinition of property")}else je=A[H]={init:!1,get:!1,set:!1};je[de]=!0}},Bn.parseExpression=function(g,A){var D=this.start,O=this.startLoc,H=this.parseMaybeAssign(g,A);if(this.type===W.comma){var de=this.startNodeAt(D,O);for(de.expressions=[H];this.eat(W.comma);)de.expressions.push(this.parseMaybeAssign(g,A));return this.finishNode(de,"SequenceExpression")}return H},Bn.parseMaybeAssign=function(g,A,D){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(g);this.exprAllowed=!1}var O=!1,H=-1,de=-1;A?(H=A.parenthesizedAssign,de=A.trailingComma,A.parenthesizedAssign=A.trailingComma=-1):(A=new le,O=!0);var je=this.start,it=this.startLoc;(this.type===W.parenL||this.type===W.name)&&(this.potentialArrowAt=this.start);var at=this.parseMaybeConditional(g,A);if(D&&(at=D.call(this,at,je,it)),this.type.isAssign){var er=this.startNodeAt(je,it);return er.operator=this.value,er.left=this.type===W.eq?this.toAssignable(at,!1,A):at,O||(A.parenthesizedAssign=A.trailingComma=A.doubleProto=-1),A.shorthandAssign>=er.left.start&&(A.shorthandAssign=-1),this.checkLVal(at),this.next(),er.right=this.parseMaybeAssign(g),this.finishNode(er,"AssignmentExpression")}else O&&this.checkExpressionErrors(A,!0);return H>-1&&(A.parenthesizedAssign=H),de>-1&&(A.trailingComma=de),at},Bn.parseMaybeConditional=function(g,A){var D=this.start,O=this.startLoc,H=this.parseExprOps(g,A);if(this.checkExpressionErrors(A))return H;if(this.eat(W.question)){var de=this.startNodeAt(D,O);return de.test=H,de.consequent=this.parseMaybeAssign(),this.expect(W.colon),de.alternate=this.parseMaybeAssign(g),this.finishNode(de,"ConditionalExpression")}return H},Bn.parseExprOps=function(g,A){var D=this.start,O=this.startLoc,H=this.parseMaybeUnary(A,!1);return this.checkExpressionErrors(A)||H.start===D&&H.type==="ArrowFunctionExpression"?H:this.parseExprOp(H,D,O,-1,g)},Bn.parseExprOp=function(g,A,D,O,H){var de=this.type.binop;if(de!=null&&(!H||this.type!==W._in)&&de>O){var je=this.type===W.logicalOR||this.type===W.logicalAND,it=this.type===W.coalesce;it&&(de=W.logicalAND.binop);var at=this.value;this.next();var er=this.start,ar=this.startLoc,wn=this.parseExprOp(this.parseMaybeUnary(null,!1),er,ar,de,H),Qn=this.buildBinary(A,D,g,wn,at,je||it);return(je&&this.type===W.coalesce||it&&(this.type===W.logicalOR||this.type===W.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Qn,A,D,O,H)}return g},Bn.buildBinary=function(g,A,D,O,H,de){var je=this.startNodeAt(g,A);return je.left=D,je.operator=H,je.right=O,this.finishNode(je,de?"LogicalExpression":"BinaryExpression")},Bn.parseMaybeUnary=function(g,A){var D=this.start,O=this.startLoc,H;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))H=this.parseAwait(),A=!0;else if(this.type.prefix){var de=this.startNode(),je=this.type===W.incDec;de.operator=this.value,de.prefix=!0,this.next(),de.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(g,!0),je?this.checkLVal(de.argument):this.strict&&de.operator==="delete"&&de.argument.type==="Identifier"?this.raiseRecoverable(de.start,"Deleting local variable in strict mode"):A=!0,H=this.finishNode(de,je?"UpdateExpression":"UnaryExpression")}else{if(H=this.parseExprSubscripts(g),this.checkExpressionErrors(g))return H;for(;this.type.postfix&&!this.canInsertSemicolon();){var it=this.startNodeAt(D,O);it.operator=this.value,it.prefix=!1,it.argument=H,this.checkLVal(H),this.next(),H=this.finishNode(it,"UpdateExpression")}}return!A&&this.eat(W.starstar)?this.buildBinary(D,O,H,this.parseMaybeUnary(null,!1),"**",!1):H},Bn.parseExprSubscripts=function(g){var A=this.start,D=this.startLoc,O=this.parseExprAtom(g);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var H=this.parseSubscripts(O,A,D);return g&&H.type==="MemberExpression"&&(g.parenthesizedAssign>=H.start&&(g.parenthesizedAssign=-1),g.parenthesizedBind>=H.start&&(g.parenthesizedBind=-1)),H},Bn.parseSubscripts=function(g,A,D,O){for(var H=this.options.ecmaVersion>=8&&g.type==="Identifier"&&g.name==="async"&&this.lastTokEnd===g.end&&!this.canInsertSemicolon()&&g.end-g.start==5&&this.potentialArrowAt===g.start,de=!1;;){var je=this.parseSubscript(g,A,D,O,H,de);if(je.optional&&(de=!0),je===g||je.type==="ArrowFunctionExpression"){if(de){var it=this.startNodeAt(A,D);it.expression=je,je=this.finishNode(it,"ChainExpression")}return je}g=je}},Bn.parseSubscript=function(g,A,D,O,H,de){var je=this.options.ecmaVersion>=11,it=je&&this.eat(W.questionDot);O&&it&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var at=this.eat(W.bracketL);if(at||it&&this.type!==W.parenL&&this.type!==W.backQuote||this.eat(W.dot)){var er=this.startNodeAt(A,D);er.object=g,er.property=at?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),er.computed=!!at,at&&this.expect(W.bracketR),je&&(er.optional=it),g=this.finishNode(er,"MemberExpression")}else if(!O&&this.eat(W.parenL)){var ar=new le,wn=this.yieldPos,Qn=this.awaitPos,On=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ji=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1,ar);if(H&&!it&&!this.canInsertSemicolon()&&this.eat(W.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=wn,this.awaitPos=Qn,this.awaitIdentPos=On,this.parseArrowExpression(this.startNodeAt(A,D),ji,!0);this.checkExpressionErrors(ar,!0),this.yieldPos=wn||this.yieldPos,this.awaitPos=Qn||this.awaitPos,this.awaitIdentPos=On||this.awaitIdentPos;var ca=this.startNodeAt(A,D);ca.callee=g,ca.arguments=ji,je&&(ca.optional=it),g=this.finishNode(ca,"CallExpression")}else if(this.type===W.backQuote){(it||de)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ea=this.startNodeAt(A,D);Ea.tag=g,Ea.quasi=this.parseTemplate({isTagged:!0}),g=this.finishNode(Ea,"TaggedTemplateExpression")}return g},Bn.parseExprAtom=function(g){this.type===W.slash&&this.readRegexp();var A,D=this.potentialArrowAt===this.start;switch(this.type){case W._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),A=this.startNode(),this.next(),this.type===W.parenL&&!this.allowDirectSuper&&this.raise(A.start,"super() call outside constructor of a subclass"),this.type!==W.dot&&this.type!==W.bracketL&&this.type!==W.parenL&&this.unexpected(),this.finishNode(A,"Super");case W._this:return A=this.startNode(),this.next(),this.finishNode(A,"ThisExpression");case W.name:var O=this.start,H=this.startLoc,de=this.containsEsc,je=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!de&&je.name==="async"&&!this.canInsertSemicolon()&&this.eat(W._function))return this.parseFunction(this.startNodeAt(O,H),0,!1,!0);if(D&&!this.canInsertSemicolon()){if(this.eat(W.arrow))return this.parseArrowExpression(this.startNodeAt(O,H),[je],!1);if(this.options.ecmaVersion>=8&&je.name==="async"&&this.type===W.name&&!de)return je=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(W.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,H),[je],!0)}return je;case W.regexp:var it=this.value;return A=this.parseLiteral(it.value),A.regex={pattern:it.pattern,flags:it.flags},A;case W.num:case W.string:return this.parseLiteral(this.value);case W._null:case W._true:case W._false:return A=this.startNode(),A.value=this.type===W._null?null:this.type===W._true,A.raw=this.type.keyword,this.next(),this.finishNode(A,"Literal");case W.parenL:var at=this.start,er=this.parseParenAndDistinguishExpression(D);return g&&(g.parenthesizedAssign<0&&!this.isSimpleAssignTarget(er)&&(g.parenthesizedAssign=at),g.parenthesizedBind<0&&(g.parenthesizedBind=at)),er;case W.bracketL:return A=this.startNode(),this.next(),A.elements=this.parseExprList(W.bracketR,!0,!0,g),this.finishNode(A,"ArrayExpression");case W.braceL:return this.parseObj(!1,g);case W._function:return A=this.startNode(),this.next(),this.parseFunction(A,0);case W._class:return this.parseClass(this.startNode(),!1);case W._new:return this.parseNew();case W.backQuote:return this.parseTemplate();case W._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Bn.parseExprImport=function(){var g=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var A=this.parseIdent(!0);switch(this.type){case W.parenL:return this.parseDynamicImport(g);case W.dot:return g.meta=A,this.parseImportMeta(g);default:this.unexpected()}},Bn.parseDynamicImport=function(g){if(this.next(),g.source=this.parseMaybeAssign(),!this.eat(W.parenR)){var A=this.start;this.eat(W.comma)&&this.eat(W.parenR)?this.raiseRecoverable(A,"Trailing comma is not allowed in import()"):this.unexpected(A)}return this.finishNode(g,"ImportExpression")},Bn.parseImportMeta=function(g){this.next();var A=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="meta"&&this.raiseRecoverable(g.property.start,"The only valid meta property for import is 'import.meta'"),A&&this.raiseRecoverable(g.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(g.start,"Cannot use 'import.meta' outside a module"),this.finishNode(g,"MetaProperty")},Bn.parseLiteral=function(g){var A=this.startNode();return A.value=g,A.raw=this.input.slice(this.start,this.end),A.raw.charCodeAt(A.raw.length-1)===110&&(A.bigint=A.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(A,"Literal")},Bn.parseParenExpression=function(){this.expect(W.parenL);var g=this.parseExpression();return this.expect(W.parenR),g},Bn.parseParenAndDistinguishExpression=function(g){var A=this.start,D=this.startLoc,O,H=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var de=this.start,je=this.startLoc,it=[],at=!0,er=!1,ar=new le,wn=this.yieldPos,Qn=this.awaitPos,On;for(this.yieldPos=0,this.awaitPos=0;this.type!==W.parenR;)if(at?at=!1:this.expect(W.comma),H&&this.afterTrailingComma(W.parenR,!0)){er=!0;break}else if(this.type===W.ellipsis){On=this.start,it.push(this.parseParenItem(this.parseRestBinding())),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else it.push(this.parseMaybeAssign(!1,ar,this.parseParenItem));var ji=this.start,ca=this.startLoc;if(this.expect(W.parenR),g&&!this.canInsertSemicolon()&&this.eat(W.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=wn,this.awaitPos=Qn,this.parseParenArrowList(A,D,it);(!it.length||er)&&this.unexpected(this.lastTokStart),On&&this.unexpected(On),this.checkExpressionErrors(ar,!0),this.yieldPos=wn||this.yieldPos,this.awaitPos=Qn||this.awaitPos,it.length>1?(O=this.startNodeAt(de,je),O.expressions=it,this.finishNodeAt(O,"SequenceExpression",ji,ca)):O=it[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Ea=this.startNodeAt(A,D);return Ea.expression=O,this.finishNode(Ea,"ParenthesizedExpression")}else return O},Bn.parseParenItem=function(g){return g},Bn.parseParenArrowList=function(g,A,D){return this.parseArrowExpression(this.startNodeAt(g,A),D)};var yi=[];Bn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var g=this.startNode(),A=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(W.dot)){g.meta=A;var D=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="target"&&this.raiseRecoverable(g.property.start,"The only valid meta property for new is 'new.target'"),D&&this.raiseRecoverable(g.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(g.start,"'new.target' can only be used in functions"),this.finishNode(g,"MetaProperty")}var O=this.start,H=this.startLoc,de=this.type===W._import;return g.callee=this.parseSubscripts(this.parseExprAtom(),O,H,!0),de&&g.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(W.parenL)?g.arguments=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1):g.arguments=yi,this.finishNode(g,"NewExpression")},Bn.parseTemplateElement=function(g){var A=g.isTagged,D=this.startNode();return this.type===W.invalidTemplate?(A||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),D.value={raw:this.value,cooked:null}):D.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),D.tail=this.type===W.backQuote,this.finishNode(D,"TemplateElement")},Bn.parseTemplate=function(g){g===void 0&&(g={});var A=g.isTagged;A===void 0&&(A=!1);var D=this.startNode();this.next(),D.expressions=[];var O=this.parseTemplateElement({isTagged:A});for(D.quasis=[O];!O.tail;)this.type===W.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(W.dollarBraceL),D.expressions.push(this.parseExpression()),this.expect(W.braceR),D.quasis.push(O=this.parseTemplateElement({isTagged:A}));return this.next(),this.finishNode(D,"TemplateLiteral")},Bn.isAsyncProp=function(g){return!g.computed&&g.key.type==="Identifier"&&g.key.name==="async"&&(this.type===W.name||this.type===W.num||this.type===W.string||this.type===W.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===W.star)&&!Wt.test(this.input.slice(this.lastTokEnd,this.start))},Bn.parseObj=function(g,A){var D=this.startNode(),O=!0,H={};for(D.properties=[],this.next();!this.eat(W.braceR);){if(O)O=!1;else if(this.expect(W.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(W.braceR))break;var de=this.parseProperty(g,A);g||this.checkPropClash(de,H,A),D.properties.push(de)}return this.finishNode(D,g?"ObjectPattern":"ObjectExpression")},Bn.parseProperty=function(g,A){var D=this.startNode(),O,H,de,je;if(this.options.ecmaVersion>=9&&this.eat(W.ellipsis))return g?(D.argument=this.parseIdent(!1),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(D,"RestElement")):(this.type===W.parenL&&A&&(A.parenthesizedAssign<0&&(A.parenthesizedAssign=this.start),A.parenthesizedBind<0&&(A.parenthesizedBind=this.start)),D.argument=this.parseMaybeAssign(!1,A),this.type===W.comma&&A&&A.trailingComma<0&&(A.trailingComma=this.start),this.finishNode(D,"SpreadElement"));this.options.ecmaVersion>=6&&(D.method=!1,D.shorthand=!1,(g||A)&&(de=this.start,je=this.startLoc),g||(O=this.eat(W.star)));var it=this.containsEsc;return this.parsePropertyName(D),!g&&!it&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(D)?(H=!0,O=this.options.ecmaVersion>=9&&this.eat(W.star),this.parsePropertyName(D,A)):H=!1,this.parsePropertyValue(D,g,O,H,de,je,A,it),this.finishNode(D,"Property")},Bn.parsePropertyValue=function(g,A,D,O,H,de,je,it){if((D||O)&&this.type===W.colon&&this.unexpected(),this.eat(W.colon))g.value=A?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,je),g.kind="init";else if(this.options.ecmaVersion>=6&&this.type===W.parenL)A&&this.unexpected(),g.kind="init",g.method=!0,g.value=this.parseMethod(D,O);else if(!A&&!it&&this.options.ecmaVersion>=5&&!g.computed&&g.key.type==="Identifier"&&(g.key.name==="get"||g.key.name==="set")&&this.type!==W.comma&&this.type!==W.braceR&&this.type!==W.eq){(D||O)&&this.unexpected(),g.kind=g.key.name,this.parsePropertyName(g),g.value=this.parseMethod(!1);var at=g.kind==="get"?0:1;if(g.value.params.length!==at){var er=g.value.start;g.kind==="get"?this.raiseRecoverable(er,"getter should have no params"):this.raiseRecoverable(er,"setter should have exactly one param")}else g.kind==="set"&&g.value.params[0].type==="RestElement"&&this.raiseRecoverable(g.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!g.computed&&g.key.type==="Identifier"?((D||O)&&this.unexpected(),this.checkUnreserved(g.key),g.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=H),g.kind="init",A?g.value=this.parseMaybeDefault(H,de,g.key):this.type===W.eq&&je?(je.shorthandAssign<0&&(je.shorthandAssign=this.start),g.value=this.parseMaybeDefault(H,de,g.key)):g.value=g.key,g.shorthand=!0):this.unexpected()},Bn.parsePropertyName=function(g){if(this.options.ecmaVersion>=6){if(this.eat(W.bracketL))return g.computed=!0,g.key=this.parseMaybeAssign(),this.expect(W.bracketR),g.key;g.computed=!1}return g.key=this.type===W.num||this.type===W.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Bn.initFunction=function(g){g.id=null,this.options.ecmaVersion>=6&&(g.generator=g.expression=!1),this.options.ecmaVersion>=8&&(g.async=!1)},Bn.parseMethod=function(g,A,D){var O=this.startNode(),H=this.yieldPos,de=this.awaitPos,je=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=g),this.options.ecmaVersion>=8&&(O.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Hi(A,O.generator)|mi|(D?ha:0)),this.expect(W.parenL),O.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=H,this.awaitPos=de,this.awaitIdentPos=je,this.finishNode(O,"FunctionExpression")},Bn.parseArrowExpression=function(g,A,D){var O=this.yieldPos,H=this.awaitPos,de=this.awaitIdentPos;return this.enterScope(Hi(D,!1)|vi),this.initFunction(g),this.options.ecmaVersion>=8&&(g.async=!!D),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,g.params=this.toAssignableList(A,!0),this.parseFunctionBody(g,!0,!1),this.yieldPos=O,this.awaitPos=H,this.awaitIdentPos=de,this.finishNode(g,"ArrowFunctionExpression")},Bn.parseFunctionBody=function(g,A,D){var O=A&&this.type!==W.braceL,H=this.strict,de=!1;if(O)g.body=this.parseMaybeAssign(),g.expression=!0,this.checkParams(g,!1);else{var je=this.options.ecmaVersion>=7&&!this.isSimpleParamList(g.params);(!H||je)&&(de=this.strictDirective(this.end),de&&je&&this.raiseRecoverable(g.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var it=this.labels;this.labels=[],de&&(this.strict=!0),this.checkParams(g,!H&&!de&&!A&&!D&&this.isSimpleParamList(g.params)),this.strict&&g.id&&this.checkLVal(g.id,ga),g.body=this.parseBlock(!1,void 0,de&&!H),g.expression=!1,this.adaptDirectivePrologue(g.body.body),this.labels=it}this.exitScope()},Bn.isSimpleParamList=function(g){for(var A=0,D=g;A<D.length;A+=1){var O=D[A];if(O.type!=="Identifier")return!1}return!0},Bn.checkParams=function(g,A){for(var D={},O=0,H=g.params;O<H.length;O+=1){var de=H[O];this.checkLVal(de,Qi,A?null:D)}},Bn.parseExprList=function(g,A,D,O){for(var H=[],de=!0;!this.eat(g);){if(de)de=!1;else if(this.expect(W.comma),A&&this.afterTrailingComma(g))break;var je=void 0;D&&this.type===W.comma?je=null:this.type===W.ellipsis?(je=this.parseSpread(O),O&&this.type===W.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):je=this.parseMaybeAssign(!1,O),H.push(je)}return H},Bn.checkUnreserved=function(g){var A=g.start,D=g.end,O=g.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(A,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(A,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(A,D).indexOf("\\")!==-1)){var H=this.strict?this.reservedWordsStrict:this.reservedWords;H.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(A,"The keyword '"+O+"' is reserved"))}},Bn.parseIdent=function(g,A){var D=this.startNode();return this.type===W.name?D.name=this.value:this.type.keyword?(D.name=this.type.keyword,(D.name==="class"||D.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!g),this.finishNode(D,"Identifier"),g||(this.checkUnreserved(D),D.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=D.start)),D},Bn.parseYield=function(g){this.yieldPos||(this.yieldPos=this.start);var A=this.startNode();return this.next(),this.type===W.semi||this.canInsertSemicolon()||this.type!==W.star&&!this.type.startsExpr?(A.delegate=!1,A.argument=null):(A.delegate=this.eat(W.star),A.argument=this.parseMaybeAssign(g)),this.finishNode(A,"YieldExpression")},Bn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var g=this.startNode();return this.next(),g.argument=this.parseMaybeUnary(null,!1),this.finishNode(g,"AwaitExpression")};var li=Bi.prototype;li.raise=function(g,A){var D=ft(this.input,g);A+=" ("+D.line+":"+D.column+")";var O=new SyntaxError(A);throw O.pos=g,O.loc=D,O.raisedAt=this.pos,O},li.raiseRecoverable=li.raise,li.curPosition=function(){if(this.options.locations)return new Re(this.curLine,this.pos-this.lineStart)};var _n=Bi.prototype,Oi=function(A){this.flags=A,this.var=[],this.lexical=[],this.functions=[]};_n.enterScope=function(g){this.scopeStack.push(new Oi(g))},_n.exitScope=function(){this.scopeStack.pop()},_n.treatFunctionsAsVarInScope=function(g){return g.flags&dn||!this.inModule&&g.flags&Kn},_n.declareName=function(g,A,D){var O=!1;if(A===pa){var H=this.currentScope();O=H.lexical.indexOf(g)>-1||H.functions.indexOf(g)>-1||H.var.indexOf(g)>-1,H.lexical.push(g),this.inModule&&H.flags&Kn&&delete this.undefinedExports[g]}else if(A===La){var de=this.currentScope();de.lexical.push(g)}else if(A===Lo){var je=this.currentScope();this.treatFunctionsAsVar?O=je.lexical.indexOf(g)>-1:O=je.lexical.indexOf(g)>-1||je.var.indexOf(g)>-1,je.functions.push(g)}else for(var it=this.scopeStack.length-1;it>=0;--it){var at=this.scopeStack[it];if(at.lexical.indexOf(g)>-1&&!(at.flags&Hn&&at.lexical[0]===g)||!this.treatFunctionsAsVarInScope(at)&&at.functions.indexOf(g)>-1){O=!0;break}if(at.var.push(g),this.inModule&&at.flags&Kn&&delete this.undefinedExports[g],at.flags&di)break}O&&this.raiseRecoverable(D,"Identifier '"+g+"' has already been declared")},_n.checkLocalExport=function(g){this.scopeStack[0].lexical.indexOf(g.name)===-1&&this.scopeStack[0].var.indexOf(g.name)===-1&&(this.undefinedExports[g.name]=g)},_n.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},_n.currentVarScope=function(){for(var g=this.scopeStack.length-1;;g--){var A=this.scopeStack[g];if(A.flags&di)return A}},_n.currentThisScope=function(){for(var g=this.scopeStack.length-1;;g--){var A=this.scopeStack[g];if(A.flags&di&&!(A.flags&vi))return A}};var Mi=function(A,D,O){this.type="",this.start=D,this.end=0,A.options.locations&&(this.loc=new yt(A,O)),A.options.directSourceFile&&(this.sourceFile=A.options.directSourceFile),A.options.ranges&&(this.range=[D,0])},Ja=Bi.prototype;Ja.startNode=function(){return new Mi(this,this.start,this.startLoc)},Ja.startNodeAt=function(g,A){return new Mi(this,g,A)};function fs(g,A,D,O){return g.type=A,g.end=D,this.options.locations&&(g.loc.end=O),this.options.ranges&&(g.range[1]=D),g}Ja.finishNode=function(g,A){return fs.call(this,g,A,this.lastTokEnd,this.lastTokEndLoc)},Ja.finishNodeAt=function(g,A,D,O){return fs.call(this,g,A,D,O)};var Uo=function(A,D,O,H,de){this.token=A,this.isExpr=!!D,this.preserveSpace=!!O,this.override=H,this.generator=!!de},Fa={b_stat:new Uo("{",!1),b_expr:new Uo("{",!0),b_tmpl:new Uo("${",!1),p_stat:new Uo("(",!1),p_expr:new Uo("(",!0),q_tmpl:new Uo("`",!0,!0,function(g){return g.tryReadTemplateToken()}),f_stat:new Uo("function",!1),f_expr:new Uo("function",!0),f_expr_gen:new Uo("function",!0,!1,null,!0),f_gen:new Uo("function",!1,!1,null,!0)},ya=Bi.prototype;ya.initialContext=function(){return[Fa.b_stat]},ya.braceIsBlock=function(g){var A=this.curContext();return A===Fa.f_expr||A===Fa.f_stat?!0:g===W.colon&&(A===Fa.b_stat||A===Fa.b_expr)?!A.isExpr:g===W._return||g===W.name&&this.exprAllowed?Wt.test(this.input.slice(this.lastTokEnd,this.start)):g===W._else||g===W.semi||g===W.eof||g===W.parenR||g===W.arrow?!0:g===W.braceL?A===Fa.b_stat:g===W._var||g===W._const||g===W.name?!1:!this.exprAllowed},ya.inGeneratorContext=function(){for(var g=this.context.length-1;g>=1;g--){var A=this.context[g];if(A.token==="function")return A.generator}return!1},ya.updateContext=function(g){var A,D=this.type;D.keyword&&g===W.dot?this.exprAllowed=!1:(A=D.updateContext)?A.call(this,g):this.exprAllowed=D.beforeExpr},W.parenR.updateContext=W.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var g=this.context.pop();g===Fa.b_stat&&this.curContext().token==="function"&&(g=this.context.pop()),this.exprAllowed=!g.isExpr},W.braceL.updateContext=function(g){this.context.push(this.braceIsBlock(g)?Fa.b_stat:Fa.b_expr),this.exprAllowed=!0},W.dollarBraceL.updateContext=function(){this.context.push(Fa.b_tmpl),this.exprAllowed=!0},W.parenL.updateContext=function(g){var A=g===W._if||g===W._for||g===W._with||g===W._while;this.context.push(A?Fa.p_stat:Fa.p_expr),this.exprAllowed=!0},W.incDec.updateContext=function(){},W._function.updateContext=W._class.updateContext=function(g){g.beforeExpr&&g!==W.semi&&g!==W._else&&!(g===W._return&&Wt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((g===W.colon||g===W.braceL)&&this.curContext()===Fa.b_stat)?this.context.push(Fa.f_expr):this.context.push(Fa.f_stat),this.exprAllowed=!1},W.backQuote.updateContext=function(){this.curContext()===Fa.q_tmpl?this.context.pop():this.context.push(Fa.q_tmpl),this.exprAllowed=!1},W.star.updateContext=function(g){if(g===W._function){var A=this.context.length-1;this.context[A]===Fa.f_expr?this.context[A]=Fa.f_expr_gen:this.context[A]=Fa.f_gen}this.exprAllowed=!0},W.name.updateContext=function(g){var A=!1;this.options.ecmaVersion>=6&&g!==W.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(A=!0),this.exprAllowed=A};var Z="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",X=Z+" Extended_Pictographic",Q=X,fe={9:Z,10:X,11:Q},Ae="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ze="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",qe=Ze+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ie=qe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Oe={9:Ze,10:qe,11:ie},st={};function fr(g){var A=st[g]={binary:Ee(fe[g]+" "+Ae),nonBinary:{General_Category:Ee(Ae),Script:Ee(Oe[g])}};A.nonBinary.Script_Extensions=A.nonBinary.Script,A.nonBinary.gc=A.nonBinary.General_Category,A.nonBinary.sc=A.nonBinary.Script,A.nonBinary.scx=A.nonBinary.Script_Extensions}fr(9),fr(10),fr(11);var At=Bi.prototype,Pt=function(A){this.parser=A,this.validFlags="gim"+(A.options.ecmaVersion>=6?"uy":"")+(A.options.ecmaVersion>=9?"s":""),this.unicodeProperties=st[A.options.ecmaVersion>=11?11:A.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Pt.prototype.reset=function(A,D,O){var H=O.indexOf("u")!==-1;this.start=A|0,this.source=D+"",this.flags=O,this.switchU=H&&this.parser.options.ecmaVersion>=6,this.switchN=H&&this.parser.options.ecmaVersion>=9},Pt.prototype.raise=function(A){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+A)},Pt.prototype.at=function(A,D){D===void 0&&(D=!1);var O=this.source,H=O.length;if(A>=H)return-1;var de=O.charCodeAt(A);if(!(D||this.switchU)||de<=55295||de>=57344||A+1>=H)return de;var je=O.charCodeAt(A+1);return je>=56320&&je<=57343?(de<<10)+je-56613888:de},Pt.prototype.nextIndex=function(A,D){D===void 0&&(D=!1);var O=this.source,H=O.length;if(A>=H)return H;var de=O.charCodeAt(A),je;return!(D||this.switchU)||de<=55295||de>=57344||A+1>=H||(je=O.charCodeAt(A+1))<56320||je>57343?A+1:A+2},Pt.prototype.current=function(A){return A===void 0&&(A=!1),this.at(this.pos,A)},Pt.prototype.lookahead=function(A){return A===void 0&&(A=!1),this.at(this.nextIndex(this.pos,A),A)},Pt.prototype.advance=function(A){A===void 0&&(A=!1),this.pos=this.nextIndex(this.pos,A)},Pt.prototype.eat=function(A,D){return D===void 0&&(D=!1),this.current(D)===A?(this.advance(D),!0):!1};function hr(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}At.validateRegExpFlags=function(g){for(var A=g.validFlags,D=g.flags,O=0;O<D.length;O++){var H=D.charAt(O);A.indexOf(H)===-1&&this.raise(g.start,"Invalid regular expression flag"),D.indexOf(H,O+1)>-1&&this.raise(g.start,"Duplicate regular expression flag")}},At.validateRegExpPattern=function(g){this.regexp_pattern(g),!g.switchN&&this.options.ecmaVersion>=9&&g.groupNames.length>0&&(g.switchN=!0,this.regexp_pattern(g))},At.regexp_pattern=function(g){g.pos=0,g.lastIntValue=0,g.lastStringValue="",g.lastAssertionIsQuantifiable=!1,g.numCapturingParens=0,g.maxBackReference=0,g.groupNames.length=0,g.backReferenceNames.length=0,this.regexp_disjunction(g),g.pos!==g.source.length&&(g.eat(41)&&g.raise("Unmatched ')'"),(g.eat(93)||g.eat(125))&&g.raise("Lone quantifier brackets")),g.maxBackReference>g.numCapturingParens&&g.raise("Invalid escape");for(var A=0,D=g.backReferenceNames;A<D.length;A+=1){var O=D[A];g.groupNames.indexOf(O)===-1&&g.raise("Invalid named capture referenced")}},At.regexp_disjunction=function(g){for(this.regexp_alternative(g);g.eat(124);)this.regexp_alternative(g);this.regexp_eatQuantifier(g,!0)&&g.raise("Nothing to repeat"),g.eat(123)&&g.raise("Lone quantifier brackets")},At.regexp_alternative=function(g){for(;g.pos<g.source.length&&this.regexp_eatTerm(g););},At.regexp_eatTerm=function(g){return this.regexp_eatAssertion(g)?(g.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(g)&&g.switchU&&g.raise("Invalid quantifier"),!0):(g.switchU?this.regexp_eatAtom(g):this.regexp_eatExtendedAtom(g))?(this.regexp_eatQuantifier(g),!0):!1},At.regexp_eatAssertion=function(g){var A=g.pos;if(g.lastAssertionIsQuantifiable=!1,g.eat(94)||g.eat(36))return!0;if(g.eat(92)){if(g.eat(66)||g.eat(98))return!0;g.pos=A}if(g.eat(40)&&g.eat(63)){var D=!1;if(this.options.ecmaVersion>=9&&(D=g.eat(60)),g.eat(61)||g.eat(33))return this.regexp_disjunction(g),g.eat(41)||g.raise("Unterminated group"),g.lastAssertionIsQuantifiable=!D,!0}return g.pos=A,!1},At.regexp_eatQuantifier=function(g,A){return A===void 0&&(A=!1),this.regexp_eatQuantifierPrefix(g,A)?(g.eat(63),!0):!1},At.regexp_eatQuantifierPrefix=function(g,A){return g.eat(42)||g.eat(43)||g.eat(63)||this.regexp_eatBracedQuantifier(g,A)},At.regexp_eatBracedQuantifier=function(g,A){var D=g.pos;if(g.eat(123)){var O=0,H=-1;if(this.regexp_eatDecimalDigits(g)&&(O=g.lastIntValue,g.eat(44)&&this.regexp_eatDecimalDigits(g)&&(H=g.lastIntValue),g.eat(125)))return H!==-1&&H<O&&!A&&g.raise("numbers out of order in {} quantifier"),!0;g.switchU&&!A&&g.raise("Incomplete quantifier"),g.pos=D}return!1},At.regexp_eatAtom=function(g){return this.regexp_eatPatternCharacters(g)||g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)},At.regexp_eatReverseSolidusAtomEscape=function(g){var A=g.pos;if(g.eat(92)){if(this.regexp_eatAtomEscape(g))return!0;g.pos=A}return!1},At.regexp_eatUncapturingGroup=function(g){var A=g.pos;if(g.eat(40)){if(g.eat(63)&&g.eat(58)){if(this.regexp_disjunction(g),g.eat(41))return!0;g.raise("Unterminated group")}g.pos=A}return!1},At.regexp_eatCapturingGroup=function(g){if(g.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(g):g.current()===63&&g.raise("Invalid group"),this.regexp_disjunction(g),g.eat(41))return g.numCapturingParens+=1,!0;g.raise("Unterminated group")}return!1},At.regexp_eatExtendedAtom=function(g){return g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)||this.regexp_eatInvalidBracedQuantifier(g)||this.regexp_eatExtendedPatternCharacter(g)},At.regexp_eatInvalidBracedQuantifier=function(g){return this.regexp_eatBracedQuantifier(g,!0)&&g.raise("Nothing to repeat"),!1},At.regexp_eatSyntaxCharacter=function(g){var A=g.current();return vn(A)?(g.lastIntValue=A,g.advance(),!0):!1};function vn(g){return g===36||g>=40&&g<=43||g===46||g===63||g>=91&&g<=94||g>=123&&g<=125}At.regexp_eatPatternCharacters=function(g){for(var A=g.pos,D=0;(D=g.current())!==-1&&!vn(D);)g.advance();return g.pos!==A},At.regexp_eatExtendedPatternCharacter=function(g){var A=g.current();return A!==-1&&A!==36&&!(A>=40&&A<=43)&&A!==46&&A!==63&&A!==91&&A!==94&&A!==124?(g.advance(),!0):!1},At.regexp_groupSpecifier=function(g){if(g.eat(63)){if(this.regexp_eatGroupName(g)){g.groupNames.indexOf(g.lastStringValue)!==-1&&g.raise("Duplicate capture group name"),g.groupNames.push(g.lastStringValue);return}g.raise("Invalid group")}},At.regexp_eatGroupName=function(g){if(g.lastStringValue="",g.eat(60)){if(this.regexp_eatRegExpIdentifierName(g)&&g.eat(62))return!0;g.raise("Invalid capture group name")}return!1},At.regexp_eatRegExpIdentifierName=function(g){if(g.lastStringValue="",this.regexp_eatRegExpIdentifierStart(g)){for(g.lastStringValue+=hr(g.lastIntValue);this.regexp_eatRegExpIdentifierPart(g);)g.lastStringValue+=hr(g.lastIntValue);return!0}return!1},At.regexp_eatRegExpIdentifierStart=function(g){var A=g.pos,D=this.options.ecmaVersion>=11,O=g.current(D);return g.advance(D),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,D)&&(O=g.lastIntValue),sn(O)?(g.lastIntValue=O,!0):(g.pos=A,!1)};function sn(g){return Qt(g,!0)||g===36||g===95}At.regexp_eatRegExpIdentifierPart=function(g){var A=g.pos,D=this.options.ecmaVersion>=11,O=g.current(D);return g.advance(D),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,D)&&(O=g.lastIntValue),Et(O)?(g.lastIntValue=O,!0):(g.pos=A,!1)};function Et(g){return ur(g,!0)||g===36||g===95||g===8204||g===8205}At.regexp_eatAtomEscape=function(g){return this.regexp_eatBackReference(g)||this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)||g.switchN&&this.regexp_eatKGroupName(g)?!0:(g.switchU&&(g.current()===99&&g.raise("Invalid unicode escape"),g.raise("Invalid escape")),!1)},At.regexp_eatBackReference=function(g){var A=g.pos;if(this.regexp_eatDecimalEscape(g)){var D=g.lastIntValue;if(g.switchU)return D>g.maxBackReference&&(g.maxBackReference=D),!0;if(D<=g.numCapturingParens)return!0;g.pos=A}return!1},At.regexp_eatKGroupName=function(g){if(g.eat(107)){if(this.regexp_eatGroupName(g))return g.backReferenceNames.push(g.lastStringValue),!0;g.raise("Invalid named reference")}return!1},At.regexp_eatCharacterEscape=function(g){return this.regexp_eatControlEscape(g)||this.regexp_eatCControlLetter(g)||this.regexp_eatZero(g)||this.regexp_eatHexEscapeSequence(g)||this.regexp_eatRegExpUnicodeEscapeSequence(g,!1)||!g.switchU&&this.regexp_eatLegacyOctalEscapeSequence(g)||this.regexp_eatIdentityEscape(g)},At.regexp_eatCControlLetter=function(g){var A=g.pos;if(g.eat(99)){if(this.regexp_eatControlLetter(g))return!0;g.pos=A}return!1},At.regexp_eatZero=function(g){return g.current()===48&&!Pn(g.lookahead())?(g.lastIntValue=0,g.advance(),!0):!1},At.regexp_eatControlEscape=function(g){var A=g.current();return A===116?(g.lastIntValue=9,g.advance(),!0):A===110?(g.lastIntValue=10,g.advance(),!0):A===118?(g.lastIntValue=11,g.advance(),!0):A===102?(g.lastIntValue=12,g.advance(),!0):A===114?(g.lastIntValue=13,g.advance(),!0):!1},At.regexp_eatControlLetter=function(g){var A=g.current();return qr(A)?(g.lastIntValue=A%32,g.advance(),!0):!1};function qr(g){return g>=65&&g<=90||g>=97&&g<=122}At.regexp_eatRegExpUnicodeEscapeSequence=function(g,A){A===void 0&&(A=!1);var D=g.pos,O=A||g.switchU;if(g.eat(117)){if(this.regexp_eatFixedHexDigits(g,4)){var H=g.lastIntValue;if(O&&H>=55296&&H<=56319){var de=g.pos;if(g.eat(92)&&g.eat(117)&&this.regexp_eatFixedHexDigits(g,4)){var je=g.lastIntValue;if(je>=56320&&je<=57343)return g.lastIntValue=(H-55296)*1024+(je-56320)+65536,!0}g.pos=de,g.lastIntValue=H}return!0}if(O&&g.eat(123)&&this.regexp_eatHexDigits(g)&&g.eat(125)&&Dr(g.lastIntValue))return!0;O&&g.raise("Invalid unicode escape"),g.pos=D}return!1};function Dr(g){return g>=0&&g<=1114111}At.regexp_eatIdentityEscape=function(g){if(g.switchU)return this.regexp_eatSyntaxCharacter(g)?!0:g.eat(47)?(g.lastIntValue=47,!0):!1;var A=g.current();return A!==99&&(!g.switchN||A!==107)?(g.lastIntValue=A,g.advance(),!0):!1},At.regexp_eatDecimalEscape=function(g){g.lastIntValue=0;var A=g.current();if(A>=49&&A<=57){do g.lastIntValue=10*g.lastIntValue+(A-48),g.advance();while((A=g.current())>=48&&A<=57);return!0}return!1},At.regexp_eatCharacterClassEscape=function(g){var A=g.current();if(jr(A))return g.lastIntValue=-1,g.advance(),!0;if(g.switchU&&this.options.ecmaVersion>=9&&(A===80||A===112)){if(g.lastIntValue=-1,g.advance(),g.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(g)&&g.eat(125))return!0;g.raise("Invalid property name")}return!1};function jr(g){return g===100||g===68||g===115||g===83||g===119||g===87}At.regexp_eatUnicodePropertyValueExpression=function(g){var A=g.pos;if(this.regexp_eatUnicodePropertyName(g)&&g.eat(61)){var D=g.lastStringValue;if(this.regexp_eatUnicodePropertyValue(g)){var O=g.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(g,D,O),!0}}if(g.pos=A,this.regexp_eatLoneUnicodePropertyNameOrValue(g)){var H=g.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(g,H),!0}return!1},At.regexp_validateUnicodePropertyNameAndValue=function(g,A,D){en(g.unicodeProperties.nonBinary,A)||g.raise("Invalid property name"),g.unicodeProperties.nonBinary[A].test(D)||g.raise("Invalid property value")},At.regexp_validateUnicodePropertyNameOrValue=function(g,A){g.unicodeProperties.binary.test(A)||g.raise("Invalid property name")},At.regexp_eatUnicodePropertyName=function(g){var A=0;for(g.lastStringValue="";ci(A=g.current());)g.lastStringValue+=hr(A),g.advance();return g.lastStringValue!==""};function ci(g){return qr(g)||g===95}At.regexp_eatUnicodePropertyValue=function(g){var A=0;for(g.lastStringValue="";Kr(A=g.current());)g.lastStringValue+=hr(A),g.advance();return g.lastStringValue!==""};function Kr(g){return ci(g)||Pn(g)}At.regexp_eatLoneUnicodePropertyNameOrValue=function(g){return this.regexp_eatUnicodePropertyValue(g)},At.regexp_eatCharacterClass=function(g){if(g.eat(91)){if(g.eat(94),this.regexp_classRanges(g),g.eat(93))return!0;g.raise("Unterminated character class")}return!1},At.regexp_classRanges=function(g){for(;this.regexp_eatClassAtom(g);){var A=g.lastIntValue;if(g.eat(45)&&this.regexp_eatClassAtom(g)){var D=g.lastIntValue;g.switchU&&(A===-1||D===-1)&&g.raise("Invalid character class"),A!==-1&&D!==-1&&A>D&&g.raise("Range out of order in character class")}}},At.regexp_eatClassAtom=function(g){var A=g.pos;if(g.eat(92)){if(this.regexp_eatClassEscape(g))return!0;if(g.switchU){var D=g.current();(D===99||Ci(D))&&g.raise("Invalid class escape"),g.raise("Invalid escape")}g.pos=A}var O=g.current();return O!==93?(g.lastIntValue=O,g.advance(),!0):!1},At.regexp_eatClassEscape=function(g){var A=g.pos;if(g.eat(98))return g.lastIntValue=8,!0;if(g.switchU&&g.eat(45))return g.lastIntValue=45,!0;if(!g.switchU&&g.eat(99)){if(this.regexp_eatClassControlLetter(g))return!0;g.pos=A}return this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)},At.regexp_eatClassControlLetter=function(g){var A=g.current();return Pn(A)||A===95?(g.lastIntValue=A%32,g.advance(),!0):!1},At.regexp_eatHexEscapeSequence=function(g){var A=g.pos;if(g.eat(120)){if(this.regexp_eatFixedHexDigits(g,2))return!0;g.switchU&&g.raise("Invalid escape"),g.pos=A}return!1},At.regexp_eatDecimalDigits=function(g){var A=g.pos,D=0;for(g.lastIntValue=0;Pn(D=g.current());)g.lastIntValue=10*g.lastIntValue+(D-48),g.advance();return g.pos!==A};function Pn(g){return g>=48&&g<=57}At.regexp_eatHexDigits=function(g){var A=g.pos,D=0;for(g.lastIntValue=0;Vi(D=g.current());)g.lastIntValue=16*g.lastIntValue+si(D),g.advance();return g.pos!==A};function Vi(g){return g>=48&&g<=57||g>=65&&g<=70||g>=97&&g<=102}function si(g){return g>=65&&g<=70?10+(g-65):g>=97&&g<=102?10+(g-97):g-48}At.regexp_eatLegacyOctalEscapeSequence=function(g){if(this.regexp_eatOctalDigit(g)){var A=g.lastIntValue;if(this.regexp_eatOctalDigit(g)){var D=g.lastIntValue;A<=3&&this.regexp_eatOctalDigit(g)?g.lastIntValue=A*64+D*8+g.lastIntValue:g.lastIntValue=A*8+D}else g.lastIntValue=A;return!0}return!1},At.regexp_eatOctalDigit=function(g){var A=g.current();return Ci(A)?(g.lastIntValue=A-48,g.advance(),!0):(g.lastIntValue=0,!1)};function Ci(g){return g>=48&&g<=55}At.regexp_eatFixedHexDigits=function(g,A){var D=g.pos;g.lastIntValue=0;for(var O=0;O<A;++O){var H=g.current();if(!Vi(H))return g.pos=D,!1;g.lastIntValue=16*g.lastIntValue+si(H),g.advance()}return!0};var gi=function(A){this.type=A.type,this.value=A.value,this.start=A.start,this.end=A.end,A.options.locations&&(this.loc=new yt(A,A.startLoc,A.endLoc)),A.options.ranges&&(this.range=[A.start,A.end])},_t=Bi.prototype;_t.next=function(g){!g&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new gi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},_t.getToken=function(){return this.next(),new gi(this)},typeof Symbol!="undefined"&&(_t[Symbol.iterator]=function(){var g=this;return{next:function(){var A=g.getToken();return{done:A.type===W.eof,value:A}}}}),_t.curContext=function(){return this.context[this.context.length-1]},_t.nextToken=function(){var g=this.curContext();if((!g||!g.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(W.eof);if(g.override)return g.override(this);this.readToken(this.fullCharCodeAtPos())},_t.readToken=function(g){return Qt(g,this.options.ecmaVersion>=6)||g===92?this.readWord():this.getTokenFromCode(g)},_t.fullCharCodeAtPos=function(){var g=this.input.charCodeAt(this.pos);if(g<=55295||g>=57344)return g;var A=this.input.charCodeAt(this.pos+1);return(g<<10)+A-56613888},_t.skipBlockComment=function(){var g=this.options.onComment&&this.curPosition(),A=this.pos,D=this.input.indexOf("*/",this.pos+=2);if(D===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=D+2,this.options.locations){ot.lastIndex=A;for(var O;(O=ot.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(A+2,D),A,this.pos,g,this.curPosition())},_t.skipLineComment=function(g){for(var A=this.pos,D=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=g);this.pos<this.input.length&&!Ye(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(A+g,this.pos),A,this.pos,D,this.curPosition())},_t.skipSpace=function(){e:for(;this.pos<this.input.length;){var g=this.input.charCodeAt(this.pos);switch(g){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(g>8&&g<14||g>=5760&&bt.test(String.fromCharCode(g)))++this.pos;else break e}}},_t.finishToken=function(g,A){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var D=this.type;this.type=g,this.value=A,this.updateContext(D)},_t.readToken_dot=function(){var g=this.input.charCodeAt(this.pos+1);if(g>=48&&g<=57)return this.readNumber(!0);var A=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&g===46&&A===46?(this.pos+=3,this.finishToken(W.ellipsis)):(++this.pos,this.finishToken(W.dot))},_t.readToken_slash=function(){var g=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):g===61?this.finishOp(W.assign,2):this.finishOp(W.slash,1)},_t.readToken_mult_modulo_exp=function(g){var A=this.input.charCodeAt(this.pos+1),D=1,O=g===42?W.star:W.modulo;return this.options.ecmaVersion>=7&&g===42&&A===42&&(++D,O=W.starstar,A=this.input.charCodeAt(this.pos+2)),A===61?this.finishOp(W.assign,D+1):this.finishOp(O,D)},_t.readToken_pipe_amp=function(g){var A=this.input.charCodeAt(this.pos+1);if(A===g){if(this.options.ecmaVersion>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(W.assign,3)}return this.finishOp(g===124?W.logicalOR:W.logicalAND,2)}return A===61?this.finishOp(W.assign,2):this.finishOp(g===124?W.bitwiseOR:W.bitwiseAND,1)},_t.readToken_caret=function(){var g=this.input.charCodeAt(this.pos+1);return g===61?this.finishOp(W.assign,2):this.finishOp(W.bitwiseXOR,1)},_t.readToken_plus_min=function(g){var A=this.input.charCodeAt(this.pos+1);return A===g?A===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Wt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(W.incDec,2):A===61?this.finishOp(W.assign,2):this.finishOp(W.plusMin,1)},_t.readToken_lt_gt=function(g){var A=this.input.charCodeAt(this.pos+1),D=1;return A===g?(D=g===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+D)===61?this.finishOp(W.assign,D+1):this.finishOp(W.bitShift,D)):A===33&&g===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(A===61&&(D=2),this.finishOp(W.relational,D))},_t.readToken_eq_excl=function(g){var A=this.input.charCodeAt(this.pos+1);return A===61?this.finishOp(W.equality,this.input.charCodeAt(this.pos+2)===61?3:2):g===61&&A===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(W.arrow)):this.finishOp(g===61?W.eq:W.prefix,1)},_t.readToken_question=function(){var g=this.options.ecmaVersion;if(g>=11){var A=this.input.charCodeAt(this.pos+1);if(A===46){var D=this.input.charCodeAt(this.pos+2);if(D<48||D>57)return this.finishOp(W.questionDot,2)}if(A===63){if(g>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(W.assign,3)}return this.finishOp(W.coalesce,2)}}return this.finishOp(W.question,1)},_t.getTokenFromCode=function(g){switch(g){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(W.parenL);case 41:return++this.pos,this.finishToken(W.parenR);case 59:return++this.pos,this.finishToken(W.semi);case 44:return++this.pos,this.finishToken(W.comma);case 91:return++this.pos,this.finishToken(W.bracketL);case 93:return++this.pos,this.finishToken(W.bracketR);case 123:return++this.pos,this.finishToken(W.braceL);case 125:return++this.pos,this.finishToken(W.braceR);case 58:return++this.pos,this.finishToken(W.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(W.backQuote);case 48:var A=this.input.charCodeAt(this.pos+1);if(A===120||A===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(A===111||A===79)return this.readRadixNumber(8);if(A===98||A===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(g);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(g);case 124:case 38:return this.readToken_pipe_amp(g);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(g);case 60:case 62:return this.readToken_lt_gt(g);case 61:case 33:return this.readToken_eq_excl(g);case 63:return this.readToken_question();case 126:return this.finishOp(W.prefix,1)}this.raise(this.pos,"Unexpected character '"+xi(g)+"'")},_t.finishOp=function(g,A){var D=this.input.slice(this.pos,this.pos+A);return this.pos+=A,this.finishToken(g,D)},_t.readRegexp=function(){for(var g,A,D=this.pos;;){this.pos>=this.input.length&&this.raise(D,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Wt.test(O)&&this.raise(D,"Unterminated regular expression"),g)g=!1;else{if(O==="[")A=!0;else if(O==="]"&&A)A=!1;else if(O==="/"&&!A)break;g=O==="\\"}++this.pos}var H=this.input.slice(D,this.pos);++this.pos;var de=this.pos,je=this.readWord1();this.containsEsc&&this.unexpected(de);var it=this.regexpState||(this.regexpState=new Pt(this));it.reset(D,H,je),this.validateRegExpFlags(it),this.validateRegExpPattern(it);var at=null;try{at=new RegExp(H,je)}catch(er){}return this.finishToken(W.regexp,{pattern:H,flags:je,value:at})},_t.readInt=function(g,A,D){for(var O=this.options.ecmaVersion>=12&&A===void 0,H=D&&this.input.charCodeAt(this.pos)===48,de=this.pos,je=0,it=0,at=0,er=A==null?Infinity:A;at<er;++at,++this.pos){var ar=this.input.charCodeAt(this.pos),wn=void 0;if(O&&ar===95){H&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),it===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),at===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),it=ar;continue}if(ar>=97?wn=ar-97+10:ar>=65?wn=ar-65+10:ar>=48&&ar<=57?wn=ar-48:wn=Infinity,wn>=g)break;it=ar,je=je*g+wn}return O&&it===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===de||A!=null&&this.pos-de!==A?null:je};function jt(g,A){return A?parseInt(g,8):parseFloat(g.replace(/_/g,""))}function Aa(g){return typeof BigInt!="function"?null:BigInt(g.replace(/_/g,""))}_t.readRadixNumber=function(g){var A=this.pos;this.pos+=2;var D=this.readInt(g);return D==null&&this.raise(this.start+2,"Expected number in radix "+g),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(D=Aa(this.input.slice(A,this.pos)),++this.pos):Qt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,D)},_t.readNumber=function(g){var A=this.pos;!g&&this.readInt(10,void 0,!0)===null&&this.raise(A,"Invalid number");var D=this.pos-A>=2&&this.input.charCodeAt(A)===48;D&&this.strict&&this.raise(A,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!D&&!g&&this.options.ecmaVersion>=11&&O===110){var H=Aa(this.input.slice(A,this.pos));return++this.pos,Qt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,H)}D&&/[89]/.test(this.input.slice(A,this.pos))&&(D=!1),O===46&&!D&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!D&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(A,"Invalid number")),Qt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var de=jt(this.input.slice(A,this.pos),D);return this.finishToken(W.num,de)},_t.readCodePoint=function(){var g=this.input.charCodeAt(this.pos),A;if(g===123){this.options.ecmaVersion<6&&this.unexpected();var D=++this.pos;A=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,A>1114111&&this.invalidStringToken(D,"Code point out of bounds")}else A=this.readHexChar(4);return A};function xi(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}_t.readString=function(g){for(var A="",D=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===g)break;O===92?(A+=this.input.slice(D,this.pos),A+=this.readEscapedChar(!1),D=this.pos):(Ye(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return A+=this.input.slice(D,this.pos++),this.finishToken(W.string,A)};var Ai={};_t.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(g){if(g===Ai)this.readInvalidTemplateToken();else throw g}this.inTemplateElement=!1},_t.invalidStringToken=function(g,A){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ai;this.raise(g,A)},_t.readTmplToken=function(){for(var g="",A=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var D=this.input.charCodeAt(this.pos);if(D===96||D===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===W.template||this.type===W.invalidTemplate)?D===36?(this.pos+=2,this.finishToken(W.dollarBraceL)):(++this.pos,this.finishToken(W.backQuote)):(g+=this.input.slice(A,this.pos),this.finishToken(W.template,g));if(D===92)g+=this.input.slice(A,this.pos),g+=this.readEscapedChar(!0),A=this.pos;else if(Ye(D)){switch(g+=this.input.slice(A,this.pos),++this.pos,D){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:g+=`
`;break;default:g+=String.fromCharCode(D);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),A=this.pos}else++this.pos}},_t.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(W.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},_t.readEscapedChar=function(g){var A=this.input.charCodeAt(++this.pos);switch(++this.pos,A){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return xi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(g){var D=this.pos-1;return this.invalidStringToken(D,"Invalid escape sequence in template string"),null}default:if(A>=48&&A<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],H=parseInt(O,8);return H>255&&(O=O.slice(0,-1),H=parseInt(O,8)),this.pos+=O.length-1,A=this.input.charCodeAt(this.pos),(O!=="0"||A===56||A===57)&&(this.strict||g)&&this.invalidStringToken(this.pos-1-O.length,g?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(H)}return Ye(A)?"":String.fromCharCode(A)}},_t.readHexChar=function(g){var A=this.pos,D=this.readInt(16,g);return D===null&&this.invalidStringToken(A,"Bad character escape sequence"),D},_t.readWord1=function(){this.containsEsc=!1;for(var g="",A=!0,D=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var H=this.fullCharCodeAtPos();if(ur(H,O))this.pos+=H<=65535?1:2;else if(H===92){this.containsEsc=!0,g+=this.input.slice(D,this.pos);var de=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var je=this.readCodePoint();(A?Qt:ur)(je,O)||this.invalidStringToken(de,"Invalid Unicode escape"),g+=xi(je),D=this.pos}else break;A=!1}return g+this.input.slice(D,this.pos)},_t.readWord=function(){var g=this.readWord1(),A=W.name;return this.keywords.test(g)&&(A=pt[g]),this.finishToken(A,g)};var Fi="7.4.1";Bi.acorn={Parser:Bi,version:Fi,defaultOptions:It,Position:Re,SourceLocation:yt,getLineInfo:ft,Node:Mi,TokenType:Mt,tokTypes:W,keywordTypes:pt,TokContext:Uo,tokContexts:Fa,isIdentifierChar:ur,isIdentifierStart:Qt,Token:gi,isNewLine:Ye,lineBreak:Wt,lineBreakG:ot,nonASCIIwhitespace:bt};function Hr(g,A){return Bi.parse(g,A)}function En(g,A,D){return Bi.parseExpressionAt(g,A,D)}function Dt(g,A){return Bi.tokenizer(g,A)}function ea(g,A){g.prototype=Object.create(A.prototype),g.prototype.constructor=g,g.__proto__=A}function ye(g){var A=typeof Map=="function"?new Map:void 0;return ye=function(O){if(O===null||!fu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(O))return A.get(O);A.set(O,H)}function H(){return Yi(O,arguments,Ta(this).constructor)}return H.prototype=Object.create(O.prototype,{constructor:{value:H,enumerable:!1,writable:!0,configurable:!0}}),Na(H,O)},ye(g)}function Yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function Yi(g,A,D){return Yo()?Yi=Reflect.construct:Yi=function(H,de,je){var it=[null];it.push.apply(it,de);var at=Function.bind.apply(H,it),er=new at;return je&&Na(er,je.prototype),er},Yi.apply(null,arguments)}function fu(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function Na(g,A){return Na=Object.setPrototypeOf||function(O,H){return O.__proto__=H,O},Na(g,A)}function Ta(g){return Ta=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},Ta(g)}var Ga=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(ye(Error)),ta=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(ye(SyntaxError)),xo=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(ye(ReferenceError)),Zo=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(ye(TypeError)),wu=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(Ga),lo=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(ta),ko=function(g){ea(A,g);function A(){return g.apply(this,arguments)||this}return A}(xo),ra={UnknownError:[3001,"%0",wu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",wu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",ko],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",ko],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",ko],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",ko],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",ko],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",ko],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",ko],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",ko],ParamTypeSyntaxError:[1009,"Unknown param type: %0",ko],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",ko],FunctionUndefinedReferenceError:[2001,"%0 is not a function",xo],VariableUndefinedReferenceError:[2002,"%0 is not defined",xo],IsNotConstructor:[2003,"%0 is not a constructor",Zo]};function Ha(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function Do(g,A,D){return Ha()?Do=Reflect.construct:Do=function(H,de,je){var it=[null];it.push.apply(it,de);var at=Function.bind.apply(H,it),er=new at;return je&&Wa(er,je.prototype),er},Do.apply(null,arguments)}function Wa(g,A){return Wa=Object.setPrototypeOf||function(O,H){return O.__proto__=H,O},Wa(g,A)}var As="0.0.3";function Sl(g,A){Object.defineProperty(g,"name",{value:A,writable:!1,enumerable:!1,configurable:!0})}var hs=Object.prototype.hasOwnProperty,K=Symbol("Break"),ve=Symbol("Continue"),He=Symbol("DefaultCase"),wt=Symbol("EmptyStatementReturn"),Mr=Symbol("WithScopeName"),Cn=Symbol("SuperScopeName"),Ti=Symbol("RootScopeName"),eo=Symbol("GlobalScopeName");function ka(g){return typeof g=="function"}var Ba=function(){function g(D){this.interpreter=D}var A=g.prototype;return A.generator=function(){var O=this.interpreter;function H(){return this.getCurrentScope()}function de(){return this.getGlobalScope()}function je(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:H.bind(O),getGlobalScope:de.bind(O),getCurrentContext:je.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},g}();function Vo(g,A,D){if(D===void 0&&(D=!0),!(g instanceof Ba))throw new Error("Illegal call");if(typeof A!="string")return A;if(!!A){var O=g.generator(),H=O.getOptions(),de={timeout:H.timeout,_initEnv:function(){D||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},je=D?O.getGlobalScope():O.getCurrentScope(),it=new ma(je,de);return it.evaluate(A)}}Object.defineProperty(Vo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ps(g){if(!(g instanceof Ba))throw new Error("Illegal call");for(var A=g.generator(),D=arguments.length,O=new Array(D>1?D-1:0),H=1;H<D;H++)O[H-1]=arguments[H];var de=O.pop(),je=new ma(A.getGlobalScope(),A.getOptions()),it=`
		    (function anonymous(`+O.join(",")+`){
		        `+de+`
		    });
		    `;return je.evaluate(it)}Object.defineProperty(ps,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var io=function(A){this.value=A},bo=function(A){this.value=A},ds=function(A){this.value=A},Ts=function(A,D,O){D===void 0&&(D=null),this.name=O,this.parent=D,this.data=A,this.labelStack=[]};function Ds(){}function eu(g,A){return g===void 0&&(g=null),new Ts(Object.create(null),g,A)}function vs(g){return Object.create(g)}var da={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Vo,Function:ps};typeof JSON!="undefined"&&(da.JSON=JSON),typeof Promise!="undefined"&&(da.Promise=Promise),typeof Set!="undefined"&&(da.Set=Set),typeof Map!="undefined"&&(da.Map=Map),typeof Symbol!="undefined"&&(da.Symbol=Symbol),typeof Proxy!="undefined"&&(da.Proxy=Proxy),typeof WeakMap!="undefined"&&(da.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(da.WeakSet=WeakSet),typeof Reflect!="undefined"&&(da.Reflect=Reflect);var ma=function(){function g(D,O){D===void 0&&(D=g.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||g.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?g.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=D||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var A=g.prototype;return A.initEnvironment=function(O){var H;if(O instanceof Ts)H=O;else{var de=null,je=this.createSuperScope(O);this.options.rootContext&&(de=new Ts(vs(this.options.rootContext),je,Ti)),H=new Ts(O,de||je,eo)}this.globalScope=H,this.currentScope=this.globalScope,this.globalContext=H.data,this.currentContext=H.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var it=this.options._initEnv;it&&it.call(this)},A.getExecStartTime=function(){return this.execStartTime},A.getExecutionTime=function(){return this.execEndTime-this.execStartTime},A.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},A.getOptions=function(){return this.options},A.getGlobalScope=function(){return this.globalScope},A.getCurrentScope=function(){return this.currentScope},A.getCurrentContext=function(){return this.currentContext},A.isInterruptThrow=function(O){return O instanceof wu||O instanceof ko||O instanceof lo},A.createSuperScope=function(O){var H=Object.assign({},da),de=Object.keys(H);return de.forEach(function(je){je in O&&delete H[je]}),new Ts(H,null,Cn)},A.setCurrentContext=function(O){this.currentContext=O},A.setCurrentScope=function(O){this.currentScope=O},A.evaluate=function(O){O===void 0&&(O="");var H;if(!!O)return H=Hr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||g.ecmaVersion}),this.evaluateNode(H,O)},A.appendCode=function(O){return this.evaluate(O)},A.evaluateNode=function(O,H){var de=this;H===void 0&&(H=""),this.value=void 0,this.source=H,this.sourceList.push(H),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var je=this.getCurrentScope(),it=this.getCurrentContext(),at=je.labelStack.concat([]),er=this.callStack.concat([]),ar=function(){de.setCurrentScope(je),de.setCurrentContext(it),je.labelStack=at,de.callStack=er};try{var wn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),wn()}catch(Qn){throw Qn}finally{ar(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},A.createErrorMessage=function(O,H,de){var je=O[1].replace("%0",String(H));return de!==null&&(je+=this.getNodePosition(de||this.lastExecNode)),je},A.createError=function(O,H){return new H(O)},A.createThrowError=function(O,H){return this.createError(O,H)},A.createInternalThrowError=function(O,H,de){return this.createError(this.createErrorMessage(O,H,de),O[2])},A.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,H=Date.now();return H-this.execStartTime>O},A.getNodePosition=function(O){if(O){var H="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+H:""}return""},A.createClosure=function(O){var H=this,de;switch(O.type){case"BinaryExpression":de=this.binaryExpressionHandler(O);break;case"LogicalExpression":de=this.logicalExpressionHandler(O);break;case"UnaryExpression":de=this.unaryExpressionHandler(O);break;case"UpdateExpression":de=this.updateExpressionHandler(O);break;case"ObjectExpression":de=this.objectExpressionHandler(O);break;case"ArrayExpression":de=this.arrayExpressionHandler(O);break;case"CallExpression":de=this.callExpressionHandler(O);break;case"NewExpression":de=this.newExpressionHandler(O);break;case"MemberExpression":de=this.memberExpressionHandler(O);break;case"ThisExpression":de=this.thisExpressionHandler(O);break;case"SequenceExpression":de=this.sequenceExpressionHandler(O);break;case"Literal":de=this.literalHandler(O);break;case"Identifier":de=this.identifierHandler(O);break;case"AssignmentExpression":de=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":de=this.functionDeclarationHandler(O);break;case"VariableDeclaration":de=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":de=this.programHandler(O);break;case"ExpressionStatement":de=this.expressionStatementHandler(O);break;case"EmptyStatement":de=this.emptyStatementHandler(O);break;case"ReturnStatement":de=this.returnStatementHandler(O);break;case"FunctionExpression":de=this.functionExpressionHandler(O);break;case"IfStatement":de=this.ifStatementHandler(O);break;case"ConditionalExpression":de=this.conditionalExpressionHandler(O);break;case"ForStatement":de=this.forStatementHandler(O);break;case"WhileStatement":de=this.whileStatementHandler(O);break;case"DoWhileStatement":de=this.doWhileStatementHandler(O);break;case"ForInStatement":de=this.forInStatementHandler(O);break;case"WithStatement":de=this.withStatementHandler(O);break;case"ThrowStatement":de=this.throwStatementHandler(O);break;case"TryStatement":de=this.tryStatementHandler(O);break;case"ContinueStatement":de=this.continueStatementHandler(O);break;case"BreakStatement":de=this.breakStatementHandler(O);break;case"SwitchStatement":de=this.switchStatementHandler(O);break;case"LabeledStatement":de=this.labeledStatementHandler(O);break;case"DebuggerStatement":de=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ra.NodeTypeSyntaxError,O.type,O)}return function(){var je=H.options.timeout;if(je&&je>0&&H.checkTimeout())throw H.createInternalThrowError(ra.ExecutionTimeOutError,je,null);return H.lastExecNode=O,de.apply(void 0,arguments)}},A.binaryExpressionHandler=function(O){var H=this,de=this.createClosure(O.left),je=this.createClosure(O.right);return function(){var it=de(),at=je();switch(O.operator){case"==":return it==at;case"!=":return it!=at;case"===":return it===at;case"!==":return it!==at;case"<":return it<at;case"<=":return it<=at;case">":return it>at;case">=":return it>=at;case"<<":return it<<at;case">>":return it>>at;case">>>":return it>>>at;case"+":return it+at;case"-":return it-at;case"*":return it*at;case"**":return Math.pow(it,at);case"/":return it/at;case"%":return it%at;case"|":return it|at;case"^":return it^at;case"&":return it&at;case"in":return it in at;case"instanceof":return it instanceof at;default:throw H.createInternalThrowError(ra.BinaryOperatorSyntaxError,O.operator,O)}}},A.logicalExpressionHandler=function(O){var H=this,de=this.createClosure(O.left),je=this.createClosure(O.right);return function(){switch(O.operator){case"||":return de()||je();case"&&":return de()&&je();default:throw H.createInternalThrowError(ra.LogicalOperatorSyntaxError,O.operator,O)}}},A.unaryExpressionHandler=function(O){var H=this;switch(O.operator){case"delete":var de=this.createObjectGetter(O.argument),je=this.createNameGetter(O.argument);return function(){var ar=de(),wn=je();return delete ar[wn]};default:var it;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var at=this.createObjectGetter(O.argument),er=this.createNameGetter(O.argument);it=function(){return at()[er()]}}else it=this.createClosure(O.argument);return function(){var ar=it();switch(O.operator){case"-":return-ar;case"+":return+ar;case"!":return!ar;case"~":return~ar;case"void":return;case"typeof":return typeof ar;default:throw H.createInternalThrowError(ra.UnaryOperatorSyntaxError,O.operator,O)}}}},A.updateExpressionHandler=function(O){var H=this,de=this.createObjectGetter(O.argument),je=this.createNameGetter(O.argument);return function(){var it=de(),at=je();switch(H.assertVariable(it,at,O),O.operator){case"++":return O.prefix?++it[at]:it[at]++;case"--":return O.prefix?--it[at]:it[at]--;default:throw H.createInternalThrowError(ra.UpdateOperatorSyntaxError,O.operator,O)}}},A.objectExpressionHandler=function(O){var H=this,de=[];function je(at){return at.type==="Identifier"?at.name:at.type==="Literal"?at.value:this.throwError(ra.ObjectStructureSyntaxError,at.type,at)}var it=Object.create(null);return O.properties.forEach(function(at){var er=at.kind,ar=je(at.key);(!it[ar]||er==="init")&&(it[ar]={}),it[ar][er]=H.createClosure(at.value),de.push({key:ar,property:at})}),function(){for(var at={},er=de.length,ar=0;ar<er;ar++){var wn=de[ar],Qn=wn.key,On=it[Qn],ji=On.init?On.init():void 0,ca=On.get?On.get():function(){},Ea=On.set?On.set():function(Uu){};if("set"in On||"get"in On){var zi={configurable:!0,enumerable:!0,get:ca,set:Ea};Object.defineProperty(at,Qn,zi)}else{var ms=wn.property,tu=ms.kind;ms.key.type==="Identifier"&&ms.value.type==="FunctionExpression"&&tu==="init"&&!ms.value.id&&Sl(ji,ms.key.name),at[Qn]=ji}}return at}},A.arrayExpressionHandler=function(O){var H=this,de=O.elements.map(function(je){return je&&H.createClosure(je)});return function(){for(var je=de.length,it=Array(je),at=0;at<je;at++){var er=de[at];er&&(it[at]=er())}return it}},A.safeObjectGet=function(O,H,de){return O[H]},A.createCallFunctionGetter=function(O){var H=this;switch(O.type){case"MemberExpression":var de=this.createClosure(O.object),je=this.createMemberKeyGetter(O),it=this.source;return function(){var er=de(),ar=je(),wn=H.safeObjectGet(er,ar,O);if(!wn||!ka(wn)){var Qn=it.slice(O.start,O.end);throw H.createInternalThrowError(ra.FunctionUndefinedReferenceError,Qn,O)}return wn.__IS_EVAL_FUNC?function(On){return wn(new Ba(H),On,!0)}:wn.__IS_FUNCTION_FUNC?function(){for(var On=arguments.length,ji=new Array(On),ca=0;ca<On;ca++)ji[ca]=arguments[ca];return wn.apply(void 0,[new Ba(H)].concat(ji))}:wn.bind(er)};default:var at=this.createClosure(O);return function(){var er="";O.type==="Identifier"&&(er=O.name);var ar=at();if(!ar||!ka(ar))throw H.createInternalThrowError(ra.FunctionUndefinedReferenceError,er,O);if(O.type==="Identifier"&&ar.__IS_EVAL_FUNC&&er==="eval")return function(On){var ji=H.getScopeFromName(er,H.getCurrentScope()),ca=ji.name===Cn||ji.name===eo||ji.name===Ti;return ar(new Ba(H),On,!ca)};if(ar.__IS_EVAL_FUNC)return function(On){return ar(new Ba(H),On,!0)};if(ar.__IS_FUNCTION_FUNC)return function(){for(var On=arguments.length,ji=new Array(On),ca=0;ca<On;ca++)ji[ca]=arguments[ca];return ar.apply(void 0,[new Ba(H)].concat(ji))};var wn=H.options.globalContextInFunction;if(O.type==="Identifier"){var Qn=H.getIdentifierScope(O);Qn.name===Mr&&(wn=Qn.data)}return ar.bind(wn)}}},A.callExpressionHandler=function(O){var H=this,de=this.createCallFunctionGetter(O.callee),je=O.arguments.map(function(it){return H.createClosure(it)});return function(){return de().apply(void 0,je.map(function(it){return it()}))}},A.functionExpressionHandler=function(O){var H=this,de=this,je=this.source,it=this.collectDeclVars,at=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var er=O.id?O.id.name:"",ar=O.params.length,wn=O.params.map(function(ca){return H.createParamNameGetter(ca)}),Qn=this.createClosure(O.body),On=this.collectDeclVars,ji=this.collectDeclFuncs;return this.collectDeclVars=it,this.collectDeclFuncs=at,function(){var ca=de.getCurrentScope(),Ea=function zi(){for(var ms=arguments.length,tu=new Array(ms),Uu=0;Uu<ms;Uu++)tu[Uu]=arguments[Uu];de.callStack.push(""+er);var tf=de.getCurrentScope(),al=eu(ca,"FunctionScope("+er+")");de.setCurrentScope(al),de.addDeclarationsToScope(On,ji,al),er&&(al.data[er]=zi),al.data.arguments=arguments,wn.forEach(function(Au,Tu){al.data[Au()]=tu[Tu]});var Tc=de.getCurrentContext();de.setCurrentContext(this);var Cu=Qn();if(de.setCurrentContext(Tc),de.setCurrentScope(tf),de.callStack.pop(),Cu instanceof io)return Cu.value};return Sl(Ea,er),Object.defineProperty(Ea,"length",{value:ar,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ea,"toString",{value:function(){return je.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ea,"valueOf",{value:function(){return je.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Ea}},A.newExpressionHandler=function(O){var H=this,de=this.source,je=this.createClosure(O.callee),it=O.arguments.map(function(at){return H.createClosure(at)});return function(){var at=je();if(!ka(at)||at.__IS_EVAL_FUNC){var er=O.callee,ar=de.slice(er.start,er.end);throw H.createInternalThrowError(ra.IsNotConstructor,ar,O)}return at.__IS_FUNCTION_FUNC?at.apply(void 0,[new Ba(H)].concat(it.map(function(wn){return wn()}))):Do(at,it.map(function(wn){return wn()}))}},A.memberExpressionHandler=function(O){var H=this.createClosure(O.object),de=this.createMemberKeyGetter(O);return function(){var je=H(),it=de();return je[it]}},A.thisExpressionHandler=function(O){var H=this;return function(){return H.getCurrentContext()}},A.sequenceExpressionHandler=function(O){var H=this,de=O.expressions.map(function(je){return H.createClosure(je)});return function(){for(var je,it=de.length,at=0;at<it;at++){var er=de[at];je=er()}return je}},A.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},A.identifierHandler=function(O){var H=this;return function(){var de=H.getCurrentScope(),je=H.getScopeDataFromName(O.name,de);return H.assertVariable(je,O.name,O),je[O.name]}},A.getIdentifierScope=function(O){var H=this.getCurrentScope(),de=this.getScopeFromName(O.name,H);return de},A.assignmentExpressionHandler=function(O){var H=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var de=this.createObjectGetter(O.left),je=this.createNameGetter(O.left),it=this.createClosure(O.right);return function(){var at=de(),er=je(),ar=it();switch(O.operator!=="="&&H.assertVariable(at,er,O),O.operator){case"=":return at[er]=ar;case"+=":return at[er]+=ar;case"-=":return at[er]-=ar;case"*=":return at[er]*=ar;case"**=":return at[er]=Math.pow(at[er],ar);case"/=":return at[er]/=ar;case"%=":return at[er]%=ar;case"<<=":return at[er]<<=ar;case">>=":return at[er]>>=ar;case">>>=":return at[er]>>>=ar;case"&=":return at[er]&=ar;case"^=":return at[er]^=ar;case"|=":return at[er]|=ar;default:throw H.createInternalThrowError(ra.AssignmentExpressionSyntaxError,O.type,O)}}},A.functionDeclarationHandler=function(O){if(O.id){var H=this.functionExpressionHandler(O);Object.defineProperty(H,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,H)}return function(){return wt}},A.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ra.VariableTypeSyntaxError,O.type,O)},A.variableDeclarationHandler=function(O){for(var H=this,de,je=[],it=0;it<O.declarations.length;it++){var at=O.declarations[it];this.varDeclaration(this.getVariableName(at.id)),at.init&&je.push({type:"AssignmentExpression",operator:"=",left:at.id,right:at.init})}return je.length&&(de=this.createClosure({type:"BlockStatement",body:je})),function(){if(de){var er=H.isVarDeclMode;H.isVarDeclMode=!0,de(),H.isVarDeclMode=er}return wt}},A.assertVariable=function(O,H,de){if(O===this.globalScope.data&&!(H in O))throw this.createInternalThrowError(ra.VariableUndefinedReferenceError,H,de)},A.programHandler=function(O){var H=this,de=O.body.map(function(je){return H.createClosure(je)});return function(){for(var je=wt,it=0;it<de.length;it++){var at=de[it],er=H.setValue(at());if(er!==wt&&(je=er,je instanceof io||je instanceof bo||je instanceof ds||je===K||je===ve))break}return je}},A.expressionStatementHandler=function(O){return this.createClosure(O.expression)},A.emptyStatementHandler=function(O){return function(){return wt}},A.returnStatementHandler=function(O){var H=O.argument?this.createClosure(O.argument):Ds;return function(){return new io(H())}},A.ifStatementHandler=function(O){var H=this.createClosure(O.test),de=this.createClosure(O.consequent),je=O.alternate?this.createClosure(O.alternate):function(){return wt};return function(){return H()?de():je()}},A.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},A.forStatementHandler=function(O){var H=this,de=Ds,je=O.test?this.createClosure(O.test):function(){return!0},it=Ds,at=this.createClosure(O.body);return O.type==="ForStatement"&&(de=O.init?this.createClosure(O.init):de,it=O.update?this.createClosure(O.update):Ds),function(er){var ar,wn=wt,Qn=O.type==="DoWhileStatement";for(er&&er.type==="LabeledStatement"&&(ar=er.label.name),de();Qn||je();it()){Qn=!1;var On=H.setValue(at());if(!(On===wt||On===ve)){if(On===K)break;if(wn=On,wn instanceof ds&&wn.value===ar){wn=wt;continue}if(wn instanceof io||wn instanceof bo||wn instanceof ds)break}}return wn}},A.whileStatementHandler=function(O){return this.forStatementHandler(O)},A.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},A.forInStatementHandler=function(O){var H=this,de=O.left,je=this.createClosure(O.right),it=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),de=O.left.declarations[0].id),function(at){var er,ar=wt,wn;at&&at.type==="LabeledStatement"&&(er=at.label.name);var Qn=je();for(wn in Qn){H.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:de,right:{type:"Literal",value:wn}})();var On=H.setValue(it());if(!(On===wt||On===ve)){if(On===K)break;if(ar=On,ar instanceof ds&&ar.value===er){ar=wt;continue}if(ar instanceof io||ar instanceof bo||ar instanceof ds)break}}return ar}},A.withStatementHandler=function(O){var H=this,de=this.createClosure(O.object),je=this.createClosure(O.body);return function(){var it=de(),at=H.getCurrentScope(),er=new Ts(it,at,Mr);H.setCurrentScope(er);var ar=H.setValue(je());return H.setCurrentScope(at),ar}},A.throwStatementHandler=function(O){var H=this,de=this.createClosure(O.argument);return function(){throw H.setValue(void 0),de()}},A.tryStatementHandler=function(O){var H=this,de=this.createClosure(O.block),je=O.handler?this.catchClauseHandler(O.handler):null,it=O.finalizer?this.createClosure(O.finalizer):null;return function(){var at=H.getCurrentScope(),er=H.getCurrentContext(),ar=at.labelStack.concat([]),wn=H.callStack.concat([]),Qn=wt,On,ji,ca=function(){H.setCurrentScope(at),H.setCurrentContext(er),at.labelStack=ar,H.callStack=wn};try{Qn=H.setValue(de()),Qn instanceof io&&(On=Qn)}catch(Ea){if(ca(),H.isInterruptThrow(Ea))throw Ea;if(je)try{Qn=H.setValue(je(Ea)),Qn instanceof io&&(On=Qn)}catch(zi){if(ca(),H.isInterruptThrow(zi))throw zi;ji=zi}}if(it)try{Qn=it(),Qn instanceof io&&(On=Qn)}catch(Ea){if(ca(),H.isInterruptThrow(Ea))throw Ea;ji=Ea}if(ji)throw ji;return On||Qn}},A.catchClauseHandler=function(O){var H=this,de=this.createParamNameGetter(O.param),je=this.createClosure(O.body);return function(it){var at,er=H.getCurrentScope(),ar=er.data,wn=de(),Qn=hs.call(ar,wn),On=ar[wn];return ar[wn]=it,at=je(),Qn?ar[wn]=On:delete ar[wn],at}},A.continueStatementHandler=function(O){return function(){return O.label?new ds(O.label.name):ve}},A.breakStatementHandler=function(O){return function(){return O.label?new bo(O.label.name):K}},A.switchStatementHandler=function(O){var H=this,de=this.createClosure(O.discriminant),je=O.cases.map(function(it){return H.switchCaseHandler(it)});return function(){for(var it=de(),at=!1,er,ar,wn,Qn=0;Qn<je.length;Qn++){var On=je[Qn](),ji=On.testClosure();if(ji===He){wn=On;continue}if(at||ji===it){if(at=!0,ar=H.setValue(On.bodyClosure()),ar===wt)continue;if(ar===K||(er=ar,er instanceof io||er instanceof bo||er instanceof ds||er===ve))break}}if(!at&&wn){ar=H.setValue(wn.bodyClosure());var ca=ar===wt||ar===K||ar===ve;ca||(er=ar)}return er}},A.switchCaseHandler=function(O){var H=O.test?this.createClosure(O.test):function(){return He},de=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:H,bodyClosure:de}}},A.labeledStatementHandler=function(O){var H=this,de=O.label.name,je=this.createClosure(O.body);return function(){var it,at=H.getCurrentScope();return at.labelStack.push(de),it=je(O),it instanceof bo&&it.value===de&&(it=wt),at.labelStack.pop(),it}},A.debuggerStatementHandler=function(O){return function(){debugger;return wt}},A.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ra.ParamTypeSyntaxError,O.type,O)},A.createObjectKeyGetter=function(O){var H;return O.type==="Identifier"?H=function(){return O.name}:H=this.createClosure(O),function(){return H()}},A.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},A.createObjectGetter=function(O){var H=this;switch(O.type){case"Identifier":return function(){return H.getScopeDataFromName(O.name,H.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ra.AssignmentTypeSyntaxError,O.type,O)}},A.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ra.AssignmentTypeSyntaxError,O.type,O)}},A.varDeclaration=function(O){var H=this.collectDeclVars;H[O]=void 0},A.funcDeclaration=function(O,H){var de=this.collectDeclFuncs;de[O]=H},A.addDeclarationsToScope=function(O,H,de){var je=de.data;for(var it in H){var at=H[it];je[it]=at&&at()}for(var er in O)er in je||(je[er]=void 0)},A.getScopeValue=function(O,H){var de=this.getScopeFromName(O,H);return de.data[O]},A.getScopeDataFromName=function(O,H){return this.getScopeFromName(O,H).data},A.getScopeFromName=function(O,H){var de=H;do if(O in de.data)return de;while(de=de.parent);return this.globalScope},A.setValue=function(O){var H=this.callStack.length;return this.isVarDeclMode||H||O===wt||O===K||O===ve||O instanceof bo||O instanceof ds||(this.value=O instanceof io?O.value:O),O},A.getValue=function(){return this.value},g}();ma.version=As,ma.eval=Vo,ma.Function=ps,ma.ecmaVersion=5,ma.globalContextInFunction=void 0,ma.global=Object.create(null);function ts(g){return g===void 0&&(g=Object.create(null)),g}function ef(g,A,D){A===void 0&&(A=[]),D===void 0&&(D={});var O=D.parsingContext,H=D.timeout===void 0?0:D.timeout,de=`
    (function anonymous(`+A.join(",")+`){
         `+g+`
    });
    `,je=new ma(O,{ecmaVersion:D.ecmaVersion,timeout:H,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction});return je.evaluate(de)}function wl(g,A,D){var O=new ma(A,D);return O.evaluate(g)}var Gs=wl,Ql=function(){function g(D){this._code=D}var A=g.prototype;return A.runInContext=function(O){return wl(this._code,O)},A.runInNewContext=function(O){return wl(this._code,O)},g}(),zu=function(g,A,D){return wl(g,A,D)};function Hs(){for(var g=arguments.length,A=new Array(g),D=0;D<g;D++)A[D]=arguments[D];var O=A.pop();return ef(O||"",A)}var il=zu},10329:function(Cr,te,$){var Pe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(me,m,Ie,G){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",he=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Fe=ce||he,ge=["","webkit","Moz","MS","ms","o"],Qe=Fe?"":m.createElement("div"),ct="function",xt=Math.round,Qt=Math.abs,ur=Date.now;function Mt(K,ve,He){return setTimeout(ot(K,He),ve)}function Jt(K,ve,He){return Array.isArray(K)?(zt(K,He[ve],He),!0):!1}function zt(K,ve,He){var wt;if(!!K)if(K.forEach)K.forEach(ve,He);else if(K.length!==G)for(wt=0;wt<K.length;)ve.call(He,K[wt],wt,K),wt++;else for(wt in K)K.hasOwnProperty(wt)&&ve.call(He,K[wt],wt,K)}function lt(K,ve,He){var wt="DEPRECATED METHOD: "+ve+`
`+He+` AT 
`;return function(){var Mr=new Error("get-stack-trace"),Cn=Mr&&Mr.stack?Mr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ti=me.console&&(me.console.warn||me.console.log);return Ti&&Ti.call(me.console,wt,Cn),K.apply(this,arguments)}}var pt;typeof Object.assign!="function"?pt=function(ve){if(ve===G||ve===null)throw new TypeError("Cannot convert undefined or null to object");for(var He=Object(ve),wt=1;wt<arguments.length;wt++){var Mr=arguments[wt];if(Mr!==G&&Mr!==null)for(var Cn in Mr)Mr.hasOwnProperty(Cn)&&(He[Cn]=Mr[Cn])}return He}:pt=Object.assign;var ir=lt(function(ve,He,wt){for(var Mr=Object.keys(He),Cn=0;Cn<Mr.length;)(!wt||wt&&ve[Mr[Cn]]===G)&&(ve[Mr[Cn]]=He[Mr[Cn]]),Cn++;return ve},"extend","Use `assign`."),W=lt(function(ve,He){return ir(ve,He,!0)},"merge","Use `assign`.");function Wt(K,ve,He){var wt=ve.prototype,Mr;Mr=K.prototype=Object.create(wt),Mr.constructor=K,Mr._super=wt,He&&pt(Mr,He)}function ot(K,ve){return function(){return K.apply(ve,arguments)}}function Ye(K,ve){return typeof K==ct?K.apply(ve&&ve[0]||G,ve):K}function bt(K,ve){return K===G?ve:K}function Ke(K,ve,He){zt(en(ve),function(wt){K.addEventListener(wt,He,!1)})}function Xt(K,ve,He){zt(en(ve),function(wt){K.removeEventListener(wt,He,!1)})}function Sr(K,ve){for(;K;){if(K==ve)return!0;K=K.parentNode}return!1}function Vr(K,ve){return K.indexOf(ve)>-1}function en(K){return K.trim().split(/\s+/g)}function C(K,ve,He){if(K.indexOf&&!He)return K.indexOf(ve);for(var wt=0;wt<K.length;){if(He&&K[wt][He]==ve||!He&&K[wt]===ve)return wt;wt++}return-1}function Ee(K){return Array.prototype.slice.call(K,0)}function Re(K,ve,He){for(var wt=[],Mr=[],Cn=0;Cn<K.length;){var Ti=ve?K[Cn][ve]:K[Cn];C(Mr,Ti)<0&&wt.push(K[Cn]),Mr[Cn]=Ti,Cn++}return He&&(ve?wt=wt.sort(function(ka,Ba){return ka[ve]>Ba[ve]}):wt=wt.sort()),wt}function yt(K,ve){for(var He,wt,Mr=ve[0].toUpperCase()+ve.slice(1),Cn=0;Cn<ge.length;){if(He=ge[Cn],wt=He?He+Mr:ve,wt in K)return wt;Cn++}return G}var ft=1;function It(){return ft++}function Ht(K){var ve=K.ownerDocument||K;return ve.defaultView||ve.parentWindow||me}var xr=/mobile|tablet|ip(ad|hone|od)|android/i,Kn="ontouchstart"in me,dn=yt(me,"PointerEvent")!==G,di=Kn&&xr.test(navigator.userAgent),jn="touch",ni="pen",vi="mouse",Hn="kinect",mi=25,ha=1,Hi=2,Di=4,Qi=8,pa=1,Lo=2,La=4,ga=8,Bi=16,aa=Lo|La,Ji=ga|Bi,Cs=aa|Ji,le=["x","y"],ii=["clientX","clientY"];function mo(K,ve){var He=this;this.manager=K,this.callback=ve,this.element=K.element,this.target=K.options.inputTarget,this.domHandler=function(wt){Ye(K.options.enable,[K])&&He.handler(wt)},this.init()}mo.prototype={handler:function(){},init:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(Ht(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Xt(this.element,this.evEl,this.domHandler),this.evTarget&&Xt(this.target,this.evTarget,this.domHandler),this.evWin&&Xt(Ht(this.element),this.evWin,this.domHandler)}};function Js(K){var ve,He=K.options.inputClass;return He?ve=He:dn?ve=Ae:di?ve=Pt:Kn?ve=Et:ve=ya,new ve(K,kt)}function kt(K,ve,He){var wt=He.pointers.length,Mr=He.changedPointers.length,Cn=ve&ha&&wt-Mr==0,Ti=ve&(Di|Qi)&&wt-Mr==0;He.isFirst=!!Cn,He.isFinal=!!Ti,Cn&&(K.session={}),He.eventType=ve,Kt(K,He),K.emit("hammer.input",He),K.recognize(He),K.session.prevInput=He}function Kt(K,ve){var He=K.session,wt=ve.pointers,Mr=wt.length;He.firstInput||(He.firstInput=Sn(ve)),Mr>1&&!He.firstMultiple?He.firstMultiple=Sn(ve):Mr===1&&(He.firstMultiple=!1);var Cn=He.firstInput,Ti=He.firstMultiple,eo=Ti?Ti.center:Cn.center,ka=ve.center=Bn(wt);ve.timeStamp=ur(),ve.deltaTime=ve.timeStamp-Cn.timeStamp,ve.angle=Oi(eo,ka),ve.distance=_n(eo,ka),Ir(He,ve),ve.offsetDirection=li(ve.deltaX,ve.deltaY);var Ba=yi(ve.deltaTime,ve.deltaX,ve.deltaY);ve.overallVelocityX=Ba.x,ve.overallVelocityY=Ba.y,ve.overallVelocity=Qt(Ba.x)>Qt(Ba.y)?Ba.x:Ba.y,ve.scale=Ti?Ja(Ti.pointers,wt):1,ve.rotation=Ti?Mi(Ti.pointers,wt):0,ve.maxPointers=He.prevInput?ve.pointers.length>He.prevInput.maxPointers?ve.pointers.length:He.prevInput.maxPointers:ve.pointers.length,nn(He,ve);var Vo=K.element;Sr(ve.srcEvent.target,Vo)&&(Vo=ve.srcEvent.target),ve.target=Vo}function Ir(K,ve){var He=ve.center,wt=K.offsetDelta||{},Mr=K.prevDelta||{},Cn=K.prevInput||{};(ve.eventType===ha||Cn.eventType===Di)&&(Mr=K.prevDelta={x:Cn.deltaX||0,y:Cn.deltaY||0},wt=K.offsetDelta={x:He.x,y:He.y}),ve.deltaX=Mr.x+(He.x-wt.x),ve.deltaY=Mr.y+(He.y-wt.y)}function nn(K,ve){var He=K.lastInterval||ve,wt=ve.timeStamp-He.timeStamp,Mr,Cn,Ti,eo;if(ve.eventType!=Qi&&(wt>mi||He.velocity===G)){var ka=ve.deltaX-He.deltaX,Ba=ve.deltaY-He.deltaY,Vo=yi(wt,ka,Ba);Cn=Vo.x,Ti=Vo.y,Mr=Qt(Vo.x)>Qt(Vo.y)?Vo.x:Vo.y,eo=li(ka,Ba),K.lastInterval=ve}else Mr=He.velocity,Cn=He.velocityX,Ti=He.velocityY,eo=He.direction;ve.velocity=Mr,ve.velocityX=Cn,ve.velocityY=Ti,ve.direction=eo}function Sn(K){for(var ve=[],He=0;He<K.pointers.length;)ve[He]={clientX:xt(K.pointers[He].clientX),clientY:xt(K.pointers[He].clientY)},He++;return{timeStamp:ur(),pointers:ve,center:Bn(ve),deltaX:K.deltaX,deltaY:K.deltaY}}function Bn(K){var ve=K.length;if(ve===1)return{x:xt(K[0].clientX),y:xt(K[0].clientY)};for(var He=0,wt=0,Mr=0;Mr<ve;)He+=K[Mr].clientX,wt+=K[Mr].clientY,Mr++;return{x:xt(He/ve),y:xt(wt/ve)}}function yi(K,ve,He){return{x:ve/K||0,y:He/K||0}}function li(K,ve){return K===ve?pa:Qt(K)>=Qt(ve)?K<0?Lo:La:ve<0?ga:Bi}function _n(K,ve,He){He||(He=le);var wt=ve[He[0]]-K[He[0]],Mr=ve[He[1]]-K[He[1]];return Math.sqrt(wt*wt+Mr*Mr)}function Oi(K,ve,He){He||(He=le);var wt=ve[He[0]]-K[He[0]],Mr=ve[He[1]]-K[He[1]];return Math.atan2(Mr,wt)*180/Math.PI}function Mi(K,ve){return Oi(ve[1],ve[0],ii)+Oi(K[1],K[0],ii)}function Ja(K,ve){return _n(ve[0],ve[1],ii)/_n(K[0],K[1],ii)}var fs={mousedown:ha,mousemove:Hi,mouseup:Di},Uo="mousedown",Fa="mousemove mouseup";function ya(){this.evEl=Uo,this.evWin=Fa,this.pressed=!1,mo.apply(this,arguments)}Wt(ya,mo,{handler:function(ve){var He=fs[ve.type];He&ha&&ve.button===0&&(this.pressed=!0),He&Hi&&ve.which!==1&&(He=Di),!!this.pressed&&(He&Di&&(this.pressed=!1),this.callback(this.manager,He,{pointers:[ve],changedPointers:[ve],pointerType:vi,srcEvent:ve}))}});var Z={pointerdown:ha,pointermove:Hi,pointerup:Di,pointercancel:Qi,pointerout:Qi},X={2:jn,3:ni,4:vi,5:Hn},Q="pointerdown",fe="pointermove pointerup pointercancel";!Fe&&me.MSPointerEvent&&!me.PointerEvent&&(Q="MSPointerDown",fe="MSPointerMove MSPointerUp MSPointerCancel");function Ae(){this.evEl=Q,this.evWin=fe,mo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Wt(Ae,mo,{handler:function(ve){var He=this.store,wt=!1,Mr=ve.type.toLowerCase().replace("ms",""),Cn=Z[Mr],Ti=X[ve.pointerType]||ve.pointerType,eo=Ti==jn,ka=C(He,ve.pointerId,"pointerId");Cn&ha&&(ve.button===0||eo)?ka<0&&(He.push(ve),ka=He.length-1):Cn&(Di|Qi)&&(wt=!0),!(ka<0)&&(He[ka]=ve,this.callback(this.manager,Cn,{pointers:He,changedPointers:[ve],pointerType:Ti,srcEvent:ve}),wt&&He.splice(ka,1))}});var Ze={touchstart:ha,touchmove:Hi,touchend:Di,touchcancel:Qi},qe="touchstart",ie="touchstart touchmove touchend touchcancel";function Oe(){this.evTarget=qe,this.evWin=ie,this.started=!1,mo.apply(this,arguments)}Wt(Oe,mo,{handler:function(ve){var He=Ze[ve.type];if(He===ha&&(this.started=!0),!!this.started){var wt=st.call(this,ve,He);He&(Di|Qi)&&wt[0].length-wt[1].length==0&&(this.started=!1),this.callback(this.manager,He,{pointers:wt[0],changedPointers:wt[1],pointerType:jn,srcEvent:ve})}}});function st(K,ve){var He=Ee(K.touches),wt=Ee(K.changedTouches);return ve&(Di|Qi)&&(He=Re(He.concat(wt),"identifier",!0)),[He,wt]}var fr={touchstart:ha,touchmove:Hi,touchend:Di,touchcancel:Qi},At="touchstart touchmove touchend touchcancel";function Pt(){this.evTarget=At,this.targetIds={},mo.apply(this,arguments)}Wt(Pt,mo,{handler:function(ve){var He=fr[ve.type],wt=hr.call(this,ve,He);!wt||this.callback(this.manager,He,{pointers:wt[0],changedPointers:wt[1],pointerType:jn,srcEvent:ve})}});function hr(K,ve){var He=Ee(K.touches),wt=this.targetIds;if(ve&(ha|Hi)&&He.length===1)return wt[He[0].identifier]=!0,[He,He];var Mr,Cn,Ti=Ee(K.changedTouches),eo=[],ka=this.target;if(Cn=He.filter(function(Ba){return Sr(Ba.target,ka)}),ve===ha)for(Mr=0;Mr<Cn.length;)wt[Cn[Mr].identifier]=!0,Mr++;for(Mr=0;Mr<Ti.length;)wt[Ti[Mr].identifier]&&eo.push(Ti[Mr]),ve&(Di|Qi)&&delete wt[Ti[Mr].identifier],Mr++;if(!!eo.length)return[Re(Cn.concat(eo),"identifier",!0),eo]}var vn=2500,sn=25;function Et(){mo.apply(this,arguments);var K=ot(this.handler,this);this.touch=new Pt(this.manager,K),this.mouse=new ya(this.manager,K),this.primaryTouch=null,this.lastTouches=[]}Wt(Et,mo,{handler:function(ve,He,wt){var Mr=wt.pointerType==jn,Cn=wt.pointerType==vi;if(!(Cn&&wt.sourceCapabilities&&wt.sourceCapabilities.firesTouchEvents)){if(Mr)qr.call(this,He,wt);else if(Cn&&jr.call(this,wt))return;this.callback(ve,He,wt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function qr(K,ve){K&ha?(this.primaryTouch=ve.changedPointers[0].identifier,Dr.call(this,ve)):K&(Di|Qi)&&Dr.call(this,ve)}function Dr(K){var ve=K.changedPointers[0];if(ve.identifier===this.primaryTouch){var He={x:ve.clientX,y:ve.clientY};this.lastTouches.push(He);var wt=this.lastTouches,Mr=function(){var Cn=wt.indexOf(He);Cn>-1&&wt.splice(Cn,1)};setTimeout(Mr,vn)}}function jr(K){for(var ve=K.srcEvent.clientX,He=K.srcEvent.clientY,wt=0;wt<this.lastTouches.length;wt++){var Mr=this.lastTouches[wt],Cn=Math.abs(ve-Mr.x),Ti=Math.abs(He-Mr.y);if(Cn<=sn&&Ti<=sn)return!0}return!1}var ci=Fe?G:yt(Qe.style,"touchAction"),Kr=ci!==G,Pn="compute",Vi="auto",si="manipulation",Ci="none",gi="pan-x",_t="pan-y",jt=Ai();function Aa(K,ve){this.manager=K,this.set(ve)}Aa.prototype={set:function(K){K==Pn&&(K=this.compute()),Kr&&this.manager.element.style&&jt[K]&&(this.manager.element.style[ci]=K),this.actions=K.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var K=[];return zt(this.manager.recognizers,function(ve){Ye(ve.options.enable,[ve])&&(K=K.concat(ve.getTouchAction()))}),xi(K.join(" "))},preventDefaults:function(K){var ve=K.srcEvent,He=K.offsetDirection;if(this.manager.session.prevented){ve.preventDefault();return}var wt=this.actions,Mr=Vr(wt,Ci)&&!jt[Ci],Cn=Vr(wt,_t)&&!jt[_t],Ti=Vr(wt,gi)&&!jt[gi];if(Mr){var eo=K.pointers.length===1,ka=K.distance<2,Ba=K.deltaTime<250;if(eo&&ka&&Ba)return}if(!(Ti&&Cn)&&(Mr||Cn&&He&aa||Ti&&He&Ji))return this.preventSrc(ve)},preventSrc:function(K){this.manager.session.prevented=!0,K.preventDefault()}};function xi(K){if(Vr(K,Ci))return Ci;var ve=Vr(K,gi),He=Vr(K,_t);return ve&&He?Ci:ve||He?ve?gi:_t:Vr(K,si)?si:Vi}function Ai(){if(!Kr)return!1;var K={};if(Fe)return K;var ve=me.CSS&&me.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(He){K[He]=ve?me.CSS.supports("touch-action",He):!0}),K}var Fi=1,Hr=2,En=4,Dt=8,ea=Dt,ye=16,Yo=32;function Yi(K){this.options=pt({},this.defaults,K||{}),this.id=It(),this.manager=null,this.options.enable=bt(this.options.enable,!0),this.state=Fi,this.simultaneous={},this.requireFail=[]}Yi.prototype={defaults:{},set:function(K){return pt(this.options,K),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(K){if(Jt(K,"recognizeWith",this))return this;var ve=this.simultaneous;return K=Ta(K,this),ve[K.id]||(ve[K.id]=K,K.recognizeWith(this)),this},dropRecognizeWith:function(K){return Jt(K,"dropRecognizeWith",this)?this:(K=Ta(K,this),delete this.simultaneous[K.id],this)},requireFailure:function(K){if(Jt(K,"requireFailure",this))return this;var ve=this.requireFail;return K=Ta(K,this),C(ve,K)===-1&&(ve.push(K),K.requireFailure(this)),this},dropRequireFailure:function(K){if(Jt(K,"dropRequireFailure",this))return this;K=Ta(K,this);var ve=C(this.requireFail,K);return ve>-1&&this.requireFail.splice(ve,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(K){return!!this.simultaneous[K.id]},emit:function(K){var ve=this,He=this.state;function wt(Mr){ve.manager.emit(Mr,K)}He<Dt&&wt(ve.options.event+fu(He)),wt(ve.options.event),K.additionalEvent&&wt(K.additionalEvent),He>=Dt&&wt(ve.options.event+fu(He))},tryEmit:function(K){if(this.canEmit())return this.emit(K);this.state=Yo},canEmit:function(){for(var K=0;K<this.requireFail.length;){if(!(this.requireFail[K].state&(Yo|Fi)))return!1;K++}return!0},recognize:function(K){var ve=pt({},K);if(!Ye(this.options.enable,[this,ve])){this.reset(),this.state=Yo;return}this.state&(ea|ye|Yo)&&(this.state=Fi),this.state=this.process(ve),this.state&(Hr|En|Dt|ye)&&this.tryEmit(ve)},process:function(K){},getTouchAction:function(){},reset:function(){}};function fu(K){return K&ye?"cancel":K&Dt?"end":K&En?"move":K&Hr?"start":""}function Na(K){return K==Bi?"down":K==ga?"up":K==Lo?"left":K==La?"right":""}function Ta(K,ve){var He=ve.manager;return He?He.get(K):K}function Ga(){Yi.apply(this,arguments)}Wt(Ga,Yi,{defaults:{pointers:1},attrTest:function(K){var ve=this.options.pointers;return ve===0||K.pointers.length===ve},process:function(K){var ve=this.state,He=K.eventType,wt=ve&(Hr|En),Mr=this.attrTest(K);return wt&&(He&Qi||!Mr)?ve|ye:wt||Mr?He&Di?ve|Dt:ve&Hr?ve|En:Hr:Yo}});function ta(){Ga.apply(this,arguments),this.pX=null,this.pY=null}Wt(ta,Ga,{defaults:{event:"pan",threshold:10,pointers:1,direction:Cs},getTouchAction:function(){var K=this.options.direction,ve=[];return K&aa&&ve.push(_t),K&Ji&&ve.push(gi),ve},directionTest:function(K){var ve=this.options,He=!0,wt=K.distance,Mr=K.direction,Cn=K.deltaX,Ti=K.deltaY;return Mr&ve.direction||(ve.direction&aa?(Mr=Cn===0?pa:Cn<0?Lo:La,He=Cn!=this.pX,wt=Math.abs(K.deltaX)):(Mr=Ti===0?pa:Ti<0?ga:Bi,He=Ti!=this.pY,wt=Math.abs(K.deltaY))),K.direction=Mr,He&&wt>ve.threshold&&Mr&ve.direction},attrTest:function(K){return Ga.prototype.attrTest.call(this,K)&&(this.state&Hr||!(this.state&Hr)&&this.directionTest(K))},emit:function(K){this.pX=K.deltaX,this.pY=K.deltaY;var ve=Na(K.direction);ve&&(K.additionalEvent=this.options.event+ve),this._super.emit.call(this,K)}});function xo(){Ga.apply(this,arguments)}Wt(xo,Ga,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.scale-1)>this.options.threshold||this.state&Hr)},emit:function(K){if(K.scale!==1){var ve=K.scale<1?"in":"out";K.additionalEvent=this.options.event+ve}this._super.emit.call(this,K)}});function Zo(){Yi.apply(this,arguments),this._timer=null,this._input=null}Wt(Zo,Yi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Vi]},process:function(K){var ve=this.options,He=K.pointers.length===ve.pointers,wt=K.distance<ve.threshold,Mr=K.deltaTime>ve.time;if(this._input=K,!wt||!He||K.eventType&(Di|Qi)&&!Mr)this.reset();else if(K.eventType&ha)this.reset(),this._timer=Mt(function(){this.state=ea,this.tryEmit()},ve.time,this);else if(K.eventType&Di)return ea;return Yo},reset:function(){clearTimeout(this._timer)},emit:function(K){this.state===ea&&(K&&K.eventType&Di?this.manager.emit(this.options.event+"up",K):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function wu(){Ga.apply(this,arguments)}Wt(wu,Ga,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.rotation)>this.options.threshold||this.state&Hr)}});function lo(){Ga.apply(this,arguments)}Wt(lo,Ga,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:aa|Ji,pointers:1},getTouchAction:function(){return ta.prototype.getTouchAction.call(this)},attrTest:function(K){var ve=this.options.direction,He;return ve&(aa|Ji)?He=K.overallVelocity:ve&aa?He=K.overallVelocityX:ve&Ji&&(He=K.overallVelocityY),this._super.attrTest.call(this,K)&&ve&K.offsetDirection&&K.distance>this.options.threshold&&K.maxPointers==this.options.pointers&&Qt(He)>this.options.velocity&&K.eventType&Di},emit:function(K){var ve=Na(K.offsetDirection);ve&&this.manager.emit(this.options.event+ve,K),this.manager.emit(this.options.event,K)}});function ko(){Yi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Wt(ko,Yi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[si]},process:function(K){var ve=this.options,He=K.pointers.length===ve.pointers,wt=K.distance<ve.threshold,Mr=K.deltaTime<ve.time;if(this.reset(),K.eventType&ha&&this.count===0)return this.failTimeout();if(wt&&Mr&&He){if(K.eventType!=Di)return this.failTimeout();var Cn=this.pTime?K.timeStamp-this.pTime<ve.interval:!0,Ti=!this.pCenter||_n(this.pCenter,K.center)<ve.posThreshold;this.pTime=K.timeStamp,this.pCenter=K.center,!Ti||!Cn?this.count=1:this.count+=1,this._input=K;var eo=this.count%ve.taps;if(eo===0)return this.hasRequireFailures()?(this._timer=Mt(function(){this.state=ea,this.tryEmit()},ve.interval,this),Hr):ea}return Yo},failTimeout:function(){return this._timer=Mt(function(){this.state=Yo},this.options.interval,this),Yo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ea&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ra(K,ve){return ve=ve||{},ve.recognizers=bt(ve.recognizers,ra.defaults.preset),new Wa(K,ve)}ra.VERSION="2.0.7",ra.defaults={domEvents:!1,touchAction:Pn,enable:!0,inputTarget:null,inputClass:null,preset:[[wu,{enable:!1}],[xo,{enable:!1},["rotate"]],[lo,{direction:aa}],[ta,{direction:aa},["swipe"]],[ko],[ko,{event:"doubletap",taps:2},["tap"]],[Zo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ha=1,Do=2;function Wa(K,ve){this.options=pt({},ra.defaults,ve||{}),this.options.inputTarget=this.options.inputTarget||K,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=K,this.input=Js(this),this.touchAction=new Aa(this,this.options.touchAction),As(this,!0),zt(this.options.recognizers,function(He){var wt=this.add(new He[0](He[1]));He[2]&&wt.recognizeWith(He[2]),He[3]&&wt.requireFailure(He[3])},this)}Wa.prototype={set:function(K){return pt(this.options,K),K.touchAction&&this.touchAction.update(),K.inputTarget&&(this.input.destroy(),this.input.target=K.inputTarget,this.input.init()),this},stop:function(K){this.session.stopped=K?Do:Ha},recognize:function(K){var ve=this.session;if(!ve.stopped){this.touchAction.preventDefaults(K);var He,wt=this.recognizers,Mr=ve.curRecognizer;(!Mr||Mr&&Mr.state&ea)&&(Mr=ve.curRecognizer=null);for(var Cn=0;Cn<wt.length;)He=wt[Cn],ve.stopped!==Do&&(!Mr||He==Mr||He.canRecognizeWith(Mr))?He.recognize(K):He.reset(),!Mr&&He.state&(Hr|En|Dt)&&(Mr=ve.curRecognizer=He),Cn++}},get:function(K){if(K instanceof Yi)return K;for(var ve=this.recognizers,He=0;He<ve.length;He++)if(ve[He].options.event==K)return ve[He];return null},add:function(K){if(Jt(K,"add",this))return this;var ve=this.get(K.options.event);return ve&&this.remove(ve),this.recognizers.push(K),K.manager=this,this.touchAction.update(),K},remove:function(K){if(Jt(K,"remove",this))return this;if(K=this.get(K),K){var ve=this.recognizers,He=C(ve,K);He!==-1&&(ve.splice(He,1),this.touchAction.update())}return this},on:function(K,ve){if(K!==G&&ve!==G){var He=this.handlers;return zt(en(K),function(wt){He[wt]=He[wt]||[],He[wt].push(ve)}),this}},off:function(K,ve){if(K!==G){var He=this.handlers;return zt(en(K),function(wt){ve?He[wt]&&He[wt].splice(C(He[wt],ve),1):delete He[wt]}),this}},emit:function(K,ve){this.options.domEvents&&Sl(K,ve);var He=this.handlers[K]&&this.handlers[K].slice();if(!(!He||!He.length)){ve.type=K,ve.preventDefault=function(){ve.srcEvent.preventDefault()};for(var wt=0;wt<He.length;)He[wt](ve),wt++}},destroy:function(){this.element&&As(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function As(K,ve){var He=K.element;if(!!He.style){var wt;zt(K.options.cssProps,function(Mr,Cn){wt=yt(He.style,Cn),ve?(K.oldCssProps[wt]=He.style[wt],He.style[wt]=Mr):He.style[wt]=K.oldCssProps[wt]||""}),ve||(K.oldCssProps={})}}function Sl(K,ve){if(!Fe){var He=m.createEvent("Event");He.initEvent(K,!0,!0),He.gesture=ve,ve.target.dispatchEvent(He)}}if(!Fe){pt(ra,{INPUT_START:ha,INPUT_MOVE:Hi,INPUT_END:Di,INPUT_CANCEL:Qi,STATE_POSSIBLE:Fi,STATE_BEGAN:Hr,STATE_CHANGED:En,STATE_ENDED:Dt,STATE_RECOGNIZED:ea,STATE_CANCELLED:ye,STATE_FAILED:Yo,DIRECTION_NONE:pa,DIRECTION_LEFT:Lo,DIRECTION_RIGHT:La,DIRECTION_UP:ga,DIRECTION_DOWN:Bi,DIRECTION_HORIZONTAL:aa,DIRECTION_VERTICAL:Ji,DIRECTION_ALL:Cs,Manager:Wa,Input:mo,TouchAction:Aa,TouchInput:Pt,MouseInput:ya,PointerEventInput:Ae,TouchMouseInput:Et,SingleTouchInput:Oe,Recognizer:Yi,AttrRecognizer:Ga,Tap:ko,Pan:ta,Swipe:lo,Pinch:xo,Rotate:wu,Press:Zo,on:Ke,off:Xt,each:zt,merge:W,extend:ir,assign:pt,inherit:Wt,bindFn:ot,prefixed:yt});var hs=typeof window!="undefined"?window:typeof self!="undefined"?self:{};hs.Hammer=ra,Pe=function(){return ra}.call(te,$,te,Cr),Pe!==G&&(Cr.exports=Pe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},81242:function(Cr,te,$){(function(Pe,me){Cr.exports=me($(9180))})(this,function(Pe){"use strict";var me=function(F){return F instanceof Uint8Array||F instanceof Uint16Array||F instanceof Uint32Array||F instanceof Int8Array||F instanceof Int16Array||F instanceof Int32Array||F instanceof Float32Array||F instanceof Float64Array||F instanceof Uint8ClampedArray},m=function(F,ue){for(var ke=Object.keys(ue),Tt=0;Tt<ke.length;++Tt)F[ke[Tt]]=ue[ke[Tt]];return F},Ie=`
`;function G(F){return typeof atob!="undefined"?atob(F):"base64:"+F}function ce(F){var ue=new Error("(regl) "+F);throw console.error(ue),ue}function he(F,ue){F||ce(ue)}function Fe(F){return F?": "+F:""}function ge(F,ue,ke){F in ue||ce("unknown parameter ("+F+")"+Fe(ke)+". possible values: "+Object.keys(ue).join())}function Qe(F,ue){me(F)||ce("invalid parameter type"+Fe(ue)+". must be a typed array")}function ct(F,ue){switch(ue){case"number":return typeof F=="number";case"object":return typeof F=="object";case"string":return typeof F=="string";case"boolean":return typeof F=="boolean";case"function":return typeof F=="function";case"undefined":return typeof F=="undefined";case"symbol":return typeof F=="symbol"}}function xt(F,ue,ke){ct(F,ue)||ce("invalid parameter type"+Fe(ke)+". expected "+ue+", got "+typeof F)}function Qt(F,ue){F>=0&&(F|0)===F||ce("invalid parameter type, ("+F+")"+Fe(ue)+". must be a nonnegative integer")}function ur(F,ue,ke){ue.indexOf(F)<0&&ce("invalid value"+Fe(ke)+". must be one of: "+ue)}var Mt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Jt(F){Object.keys(F).forEach(function(ue){Mt.indexOf(ue)<0&&ce('invalid regl constructor argument "'+ue+'". must be one of '+Mt)})}function zt(F,ue){for(F=F+"";F.length<ue;)F=" "+F;return F}function lt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function pt(F,ue){this.number=F,this.line=ue,this.errors=[]}function ir(F,ue,ke){this.file=F,this.line=ue,this.message=ke}function W(){var F=new Error,ue=(F.stack||F).toString(),ke=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ue);if(ke)return ke[1];var Tt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ue);return Tt?Tt[1]:"unknown"}function Wt(){var F=new Error,ue=(F.stack||F).toString(),ke=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ue);if(ke)return ke[1];var Tt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ue);return Tt?Tt[1]:"unknown"}function ot(F,ue){var ke=F.split(`
`),Tt=1,tr=0,Ct={unknown:new lt,0:new lt};Ct.unknown.name=Ct[0].name=ue||W(),Ct.unknown.lines.push(new pt(0,""));for(var Yt=0;Yt<ke.length;++Yt){var sr=ke[Yt],pr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(sr);if(pr)switch(pr[1]){case"line":var gr=/(\d+)(\s+\d+)?/.exec(pr[2]);gr&&(Tt=gr[1]|0,gr[2]&&(tr=gr[2]|0,tr in Ct||(Ct[tr]=new lt)));break;case"define":var br=/SHADER_NAME(_B64)?\s+(.*)$/.exec(pr[2]);br&&(Ct[tr].name=br[1]?G(br[2]):br[2]);break}Ct[tr].lines.push(new pt(Tt++,sr))}return Object.keys(Ct).forEach(function(Ar){var zr=Ct[Ar];zr.lines.forEach(function(vr){zr.index[vr.number]=vr})}),Ct}function Ye(F){var ue=[];return F.split(`
`).forEach(function(ke){if(!(ke.length<5)){var Tt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ke);Tt?ue.push(new ir(Tt[1]|0,Tt[2]|0,Tt[3].trim())):ke.length>0&&ue.push(new ir("unknown",0,ke))}}),ue}function bt(F,ue){ue.forEach(function(ke){var Tt=F[ke.file];if(Tt){var tr=Tt.index[ke.line];if(tr){tr.errors.push(ke),Tt.hasErrors=!0;return}}F.unknown.hasErrors=!0,F.unknown.lines[0].errors.push(ke)})}function Ke(F,ue,ke,Tt,tr){if(!F.getShaderParameter(ue,F.COMPILE_STATUS)){var Ct=F.getShaderInfoLog(ue),Yt=Tt===F.FRAGMENT_SHADER?"fragment":"vertex";Re(ke,"string",Yt+" shader source must be a string",tr);var sr=ot(ke,tr),pr=Ye(Ct);bt(sr,pr),Object.keys(sr).forEach(function(gr){var br=sr[gr];if(!br.hasErrors)return;var Ar=[""],zr=[""];function vr(_r,tt){Ar.push(_r),zr.push(tt||"")}vr("file number "+gr+": "+br.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),br.lines.forEach(function(_r){if(_r.errors.length>0){vr(zt(_r.number,4)+"|  ","background-color:yellow; font-weight:bold"),vr(_r.line+Ie,"color:red; background-color:yellow; font-weight:bold");var tt=0;_r.errors.forEach(function(Ft){var mr=Ft.message,kr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(mr);if(kr){var or=kr[1];switch(mr=kr[2],or){case"assign":or="=";break}tt=Math.max(_r.line.indexOf(or,tt),0)}else tt=0;vr(zt("| ",6)),vr(zt("^^^",tt+3)+Ie,"font-weight:bold"),vr(zt("| ",6)),vr(mr+Ie,"font-weight:bold")}),vr(zt("| ",6)+Ie)}else vr(zt(_r.number,4)+"|  "),vr(_r.line+Ie,"color:red")}),typeof document!="undefined"&&!window.chrome?(zr[0]=Ar.join("%c"),console.log.apply(console,zr)):console.log(Ar.join(""))}),he.raise("Error compiling "+Yt+" shader, "+sr[0].name)}}function Xt(F,ue,ke,Tt,tr){if(!F.getProgramParameter(ue,F.LINK_STATUS)){var Ct=F.getProgramInfoLog(ue),Yt=ot(ke,tr),sr=ot(Tt,tr),pr='Error linking program with vertex shader, "'+sr[0].name+'", and fragment shader "'+Yt[0].name+'"';typeof document!="undefined"?console.log("%c"+pr+Ie+"%c"+Ct,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(pr+Ie+Ct),he.raise(pr)}}function Sr(F){F._commandRef=W()}function Vr(F,ue,ke,Tt){Sr(F);function tr(pr){return pr?Tt.id(pr):0}F._fragId=tr(F.static.frag),F._vertId=tr(F.static.vert);function Ct(pr,gr){Object.keys(gr).forEach(function(br){pr[Tt.id(br)]=!0})}var Yt=F._uniformSet={};Ct(Yt,ue.static),Ct(Yt,ue.dynamic);var sr=F._attributeSet={};Ct(sr,ke.static),Ct(sr,ke.dynamic),F._hasCount="count"in F.static||"count"in F.dynamic||"elements"in F.static||"elements"in F.dynamic}function en(F,ue){var ke=Wt();ce(F+" in command "+(ue||W())+(ke==="unknown"?"":" called from "+ke))}function C(F,ue,ke){F||en(ue,ke||W())}function Ee(F,ue,ke,Tt){F in ue||en("unknown parameter ("+F+")"+Fe(ke)+". possible values: "+Object.keys(ue).join(),Tt||W())}function Re(F,ue,ke,Tt){ct(F,ue)||en("invalid parameter type"+Fe(ke)+". expected "+ue+", got "+typeof F,Tt||W())}function yt(F){F()}function ft(F,ue,ke){F.texture?ur(F.texture._texture.internalformat,ue,"unsupported texture format for attachment"):ur(F.renderbuffer._renderbuffer.format,ke,"unsupported renderbuffer format for attachment")}var It=33071,Ht=9728,xr=9984,Kn=9985,dn=9986,di=9987,jn=5120,ni=5121,vi=5122,Hn=5123,mi=5124,ha=5125,Hi=5126,Di=32819,Qi=32820,pa=33635,Lo=34042,La=36193,ga={};ga[jn]=ga[ni]=1,ga[vi]=ga[Hn]=ga[La]=ga[pa]=ga[Di]=ga[Qi]=2,ga[mi]=ga[ha]=ga[Hi]=ga[Lo]=4;function Bi(F,ue){return F===Qi||F===Di||F===pa?2:F===Lo?4:ga[F]*ue}function aa(F){return!(F&F-1)&&!!F}function Ji(F,ue,ke){var Tt,tr=ue.width,Ct=ue.height,Yt=ue.channels;he(tr>0&&tr<=ke.maxTextureSize&&Ct>0&&Ct<=ke.maxTextureSize,"invalid texture shape"),(F.wrapS!==It||F.wrapT!==It)&&he(aa(tr)&&aa(Ct),"incompatible wrap mode for texture, both width and height must be power of 2"),ue.mipmask===1?tr!==1&&Ct!==1&&he(F.minFilter!==xr&&F.minFilter!==dn&&F.minFilter!==Kn&&F.minFilter!==di,"min filter requires mipmap"):(he(aa(tr)&&aa(Ct),"texture must be a square power of 2 to support mipmapping"),he(ue.mipmask===(tr<<1)-1,"missing or incomplete mipmap data")),ue.type===Hi&&(ke.extensions.indexOf("oes_texture_float_linear")<0&&he(F.minFilter===Ht&&F.magFilter===Ht,"filter not supported, must enable oes_texture_float_linear"),he(!F.genMipmaps,"mipmap generation not supported with float textures"));var sr=ue.images;for(Tt=0;Tt<16;++Tt)if(sr[Tt]){var pr=tr>>Tt,gr=Ct>>Tt;he(ue.mipmask&1<<Tt,"missing mipmap data");var br=sr[Tt];if(he(br.width===pr&&br.height===gr,"invalid shape for mip images"),he(br.format===ue.format&&br.internalformat===ue.internalformat&&br.type===ue.type,"incompatible type for mip image"),!br.compressed)if(br.data){var Ar=Math.ceil(Bi(br.type,Yt)*pr/br.unpackAlignment)*br.unpackAlignment;he(br.data.byteLength===Ar*gr,"invalid data for image, buffer size is inconsistent with image format")}else br.element||br.copy}else F.genMipmaps||he((ue.mipmask&1<<Tt)==0,"extra mipmap data");ue.compressed&&he(!F.genMipmaps,"mipmap generation for compressed images not supported")}function Cs(F,ue,ke,Tt){var tr=F.width,Ct=F.height,Yt=F.channels;he(tr>0&&tr<=Tt.maxTextureSize&&Ct>0&&Ct<=Tt.maxTextureSize,"invalid texture shape"),he(tr===Ct,"cube map must be square"),he(ue.wrapS===It&&ue.wrapT===It,"wrap mode not supported by cube map");for(var sr=0;sr<ke.length;++sr){var pr=ke[sr];he(pr.width===tr&&pr.height===Ct,"inconsistent cube map face shape"),ue.genMipmaps&&(he(!pr.compressed,"can not generate mipmap for compressed textures"),he(pr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var gr=pr.images,br=0;br<16;++br){var Ar=gr[br];if(Ar){var zr=tr>>br,vr=Ct>>br;he(pr.mipmask&1<<br,"missing mipmap data"),he(Ar.width===zr&&Ar.height===vr,"invalid shape for mip images"),he(Ar.format===F.format&&Ar.internalformat===F.internalformat&&Ar.type===F.type,"incompatible type for mip image"),Ar.compressed||(Ar.data?he(Ar.data.byteLength===zr*vr*Math.max(Bi(Ar.type,Yt),Ar.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ar.element||Ar.copy)}}}}var le=m(he,{optional:yt,raise:ce,commandRaise:en,command:C,parameter:ge,commandParameter:Ee,constructor:Jt,type:xt,commandType:Re,isTypedArray:Qe,nni:Qt,oneOf:ur,shaderError:Ke,linkError:Xt,callSite:Wt,saveCommandRef:Sr,saveDrawInfo:Vr,framebufferFormat:ft,guessCommand:W,texture2D:Ji,textureCube:Cs}),ii=0,mo=0,Js=5,kt=6;function Kt(F,ue){this.id=ii++,this.type=F,this.data=ue}function Ir(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function nn(F){if(F.length===0)return[];var ue=F.charAt(0),ke=F.charAt(F.length-1);if(F.length>1&&ue===ke&&(ue==='"'||ue==="'"))return['"'+Ir(F.substr(1,F.length-2))+'"'];var Tt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(F);if(Tt)return nn(F.substr(0,Tt.index)).concat(nn(Tt[1])).concat(nn(F.substr(Tt.index+Tt[0].length)));var tr=F.split(".");if(tr.length===1)return['"'+Ir(F)+'"'];for(var Ct=[],Yt=0;Yt<tr.length;++Yt)Ct=Ct.concat(nn(tr[Yt]));return Ct}function Sn(F){return"["+nn(F).join("][")+"]"}function Bn(F,ue){return new Kt(F,Sn(ue+""))}function yi(F){return typeof F=="function"&&!F._reglType||F instanceof Kt}function li(F,ue){if(typeof F=="function")return new Kt(mo,F);if(typeof F=="number"||typeof F=="boolean")return new Kt(Js,F);if(Array.isArray(F))return new Kt(kt,F.map(function(ke,Tt){return li(ke,ue+"["+Tt+"]")}));if(F instanceof Kt)return F;le(!1,"invalid option type in uniform "+ue)}var _n={DynamicVariable:Kt,define:Bn,isDynamic:yi,unbox:li,accessor:Sn},Oi={next:typeof requestAnimationFrame=="function"?function(F){return requestAnimationFrame(F)}:function(F){return setTimeout(F,16)},cancel:typeof cancelAnimationFrame=="function"?function(F){return cancelAnimationFrame(F)}:clearTimeout},Mi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ja=Mi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fs(){var F={"":0},ue=[""];return{id:function(ke){var Tt=F[ke];return Tt||(Tt=F[ke]=ue.length,ue.push(ke),Tt)},str:function(ke){return ue[ke]}}}function Uo(F,ue,ke){var Tt=document.createElement("canvas");m(Tt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),F.appendChild(Tt),F===document.body&&(Tt.style.position="absolute",m(F.style,{margin:0,padding:0}));function tr(){var sr=window.innerWidth,pr=window.innerHeight;if(F!==document.body){var gr=Tt.getBoundingClientRect();sr=gr.right-gr.left,pr=gr.bottom-gr.top}Tt.width=ke*sr,Tt.height=ke*pr}var Ct;F!==document.body&&typeof ResizeObserver=="function"?(Ct=new ResizeObserver(function(){setTimeout(tr)}),Ct.observe(F)):window.addEventListener("resize",tr,!1);function Yt(){Ct?Ct.disconnect():window.removeEventListener("resize",tr),F.removeChild(Tt)}return tr(),{canvas:Tt,onDestroy:Yt}}function Fa(F,ue){function ke(Tt){try{return F.getContext(Tt,ue)}catch(tr){return null}}return ke("webgl")||ke("experimental-webgl")||ke("webgl-experimental")}function ya(F){return typeof F.nodeName=="string"&&typeof F.appendChild=="function"&&typeof F.getBoundingClientRect=="function"}function Z(F){return typeof F.drawArrays=="function"||typeof F.drawElements=="function"}function X(F){return typeof F=="string"?F.split():(le(Array.isArray(F),"invalid extension array"),F)}function Q(F){return typeof F=="string"?(le(typeof document!="undefined","not supported outside of DOM"),document.querySelector(F)):F}function fe(F){var ue=F||{},ke,Tt,tr,Ct,Yt={},sr=[],pr=[],gr=typeof window=="undefined"?1:window.devicePixelRatio,br=!1,Ar=function(_r){_r&&le.raise(_r)},zr=function(){};if(typeof ue=="string"?(le(typeof document!="undefined","selector queries only supported in DOM environments"),ke=document.querySelector(ue),le(ke,"invalid query string for element")):typeof ue=="object"?ya(ue)?ke=ue:Z(ue)?(Ct=ue,tr=Ct.canvas):(le.constructor(ue),"gl"in ue?Ct=ue.gl:"canvas"in ue?tr=Q(ue.canvas):"container"in ue&&(Tt=Q(ue.container)),"attributes"in ue&&(Yt=ue.attributes,le.type(Yt,"object","invalid context attributes")),"extensions"in ue&&(sr=X(ue.extensions)),"optionalExtensions"in ue&&(pr=X(ue.optionalExtensions)),"onDone"in ue&&(le.type(ue.onDone,"function","invalid or missing onDone callback"),Ar=ue.onDone),"profile"in ue&&(br=!!ue.profile),"pixelRatio"in ue&&(gr=+ue.pixelRatio,le(gr>0,"invalid pixel ratio"))):le.raise("invalid arguments to regl"),ke&&(ke.nodeName.toLowerCase()==="canvas"?tr=ke:Tt=ke),!Ct){if(!tr){le(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var vr=Uo(Tt||document.body,Ar,gr);if(!vr)return null;tr=vr.canvas,zr=vr.onDestroy}Yt.premultipliedAlpha===void 0&&(Yt.premultipliedAlpha=!0),Ct=Fa(tr,Yt)}return Ct?{gl:Ct,canvas:tr,container:Tt,extensions:sr,optionalExtensions:pr,pixelRatio:gr,profile:br,onDone:Ar,onDestroy:zr}:(zr(),Ar("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ae(F,ue){var ke={};function Tt(sr){le.type(sr,"string","extension name must be string");var pr=sr.toLowerCase(),gr;try{gr=ke[pr]=tr(sr)}catch(br){}return!!gr}function tr(sr){return F.getExtension(sr)?F.getExtension(sr):F.getExtension(sr.toLowerCase())?F.getExtension(sr.toLowerCase()):null}for(var Ct=0;Ct<ue.extensions.length;++Ct){var Yt=ue.extensions[Ct];if(!Tt(Yt))return ue.onDestroy(),ue.onDone('"'+Yt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ue.optionalExtensions.forEach(Tt),{extensions:ke,restore:function(){Object.keys(ke).forEach(function(sr){if(ke[sr]&&!Tt(sr))throw new Error("(regl): error restoring extension "+sr)})}}}function Ze(F,ue){for(var ke=Array(F),Tt=0;Tt<F;++Tt)ke[Tt]=ue(Tt);return ke}var qe=5120,ie=5121,Oe=5122,st=5123,fr=5124,At=5125,Pt=5126;function hr(F){for(var ue=16;ue<=1<<28;ue*=16)if(F<=ue)return ue;return 0}function vn(F){var ue,ke;return ue=(F>65535)<<4,F>>>=ue,ke=(F>255)<<3,F>>>=ke,ue|=ke,ke=(F>15)<<2,F>>>=ke,ue|=ke,ke=(F>3)<<1,F>>>=ke,ue|=ke,ue|F>>1}function sn(){var F=Ze(8,function(){return[]});function ue(Ct){var Yt=hr(Ct),sr=F[vn(Yt)>>2];return sr.length>0?sr.pop():new ArrayBuffer(Yt)}function ke(Ct){F[vn(Ct.byteLength)>>2].push(Ct)}function Tt(Ct,Yt){var sr=null;switch(Ct){case qe:sr=new Int8Array(ue(Yt),0,Yt);break;case ie:sr=new Uint8Array(ue(Yt),0,Yt);break;case Oe:sr=new Int16Array(ue(2*Yt),0,Yt);break;case st:sr=new Uint16Array(ue(2*Yt),0,Yt);break;case fr:sr=new Int32Array(ue(4*Yt),0,Yt);break;case At:sr=new Uint32Array(ue(4*Yt),0,Yt);break;case Pt:sr=new Float32Array(ue(4*Yt),0,Yt);break;default:return null}return sr.length!==Yt?sr.subarray(0,Yt):sr}function tr(Ct){ke(Ct.buffer)}return{alloc:ue,free:ke,allocType:Tt,freeType:tr}}var Et=sn();Et.zero=sn();var qr=3408,Dr=3410,jr=3411,ci=3412,Kr=3413,Pn=3414,Vi=3415,si=33901,Ci=33902,gi=3379,_t=3386,jt=34921,Aa=36347,xi=36348,Ai=35661,Fi=35660,Hr=34930,En=36349,Dt=34076,ea=34024,ye=7936,Yo=7937,Yi=7938,fu=35724,Na=34047,Ta=36063,Ga=34852,ta=3553,xo=34067,Zo=34069,wu=33984,lo=6408,ko=5126,ra=5121,Ha=36160,Do=36053,Wa=36064,As=16384,Sl=function(F,ue){var ke=1;ue.ext_texture_filter_anisotropic&&(ke=F.getParameter(Na));var Tt=1,tr=1;ue.webgl_draw_buffers&&(Tt=F.getParameter(Ga),tr=F.getParameter(Ta));var Ct=!!ue.oes_texture_float;if(Ct){var Yt=F.createTexture();F.bindTexture(ta,Yt),F.texImage2D(ta,0,lo,1,1,0,lo,ko,null);var sr=F.createFramebuffer();if(F.bindFramebuffer(Ha,sr),F.framebufferTexture2D(Ha,Wa,ta,Yt,0),F.bindTexture(ta,null),F.checkFramebufferStatus(Ha)!==Do)Ct=!1;else{F.viewport(0,0,1,1),F.clearColor(1,0,0,1),F.clear(As);var pr=Et.allocType(ko,4);F.readPixels(0,0,1,1,lo,ko,pr),F.getError()?Ct=!1:(F.deleteFramebuffer(sr),F.deleteTexture(Yt),Ct=pr[0]===1),Et.freeType(pr)}}var gr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),br=!0;if(!gr){var Ar=F.createTexture(),zr=Et.allocType(ra,36);F.activeTexture(wu),F.bindTexture(xo,Ar),F.texImage2D(Zo,0,lo,3,3,0,lo,ra,zr),Et.freeType(zr),F.bindTexture(xo,null),F.deleteTexture(Ar),br=!F.getError()}return{colorBits:[F.getParameter(Dr),F.getParameter(jr),F.getParameter(ci),F.getParameter(Kr)],depthBits:F.getParameter(Pn),stencilBits:F.getParameter(Vi),subpixelBits:F.getParameter(qr),extensions:Object.keys(ue).filter(function(vr){return!!ue[vr]}),maxAnisotropic:ke,maxDrawbuffers:Tt,maxColorAttachments:tr,pointSizeDims:F.getParameter(si),lineWidthDims:F.getParameter(Ci),maxViewportDims:F.getParameter(_t),maxCombinedTextureUnits:F.getParameter(Ai),maxCubeMapSize:F.getParameter(Dt),maxRenderbufferSize:F.getParameter(ea),maxTextureUnits:F.getParameter(Hr),maxTextureSize:F.getParameter(gi),maxAttributes:F.getParameter(jt),maxVertexUniforms:F.getParameter(Aa),maxVertexTextureUnits:F.getParameter(Fi),maxVaryingVectors:F.getParameter(xi),maxFragmentUniforms:F.getParameter(En),glsl:F.getParameter(fu),renderer:F.getParameter(Yo),vendor:F.getParameter(ye),version:F.getParameter(Yi),readFloat:Ct,npotTextureCube:br}};function hs(F){return!!F&&typeof F=="object"&&Array.isArray(F.shape)&&Array.isArray(F.stride)&&typeof F.offset=="number"&&F.shape.length===F.stride.length&&(Array.isArray(F.data)||me(F.data))}var K=function(F){return Object.keys(F).map(function(ue){return F[ue]})},ve={shape:eo,flatten:Ti};function He(F,ue,ke){for(var Tt=0;Tt<ue;++Tt)ke[Tt]=F[Tt]}function wt(F,ue,ke,Tt){for(var tr=0,Ct=0;Ct<ue;++Ct)for(var Yt=F[Ct],sr=0;sr<ke;++sr)Tt[tr++]=Yt[sr]}function Mr(F,ue,ke,Tt,tr,Ct){for(var Yt=Ct,sr=0;sr<ue;++sr)for(var pr=F[sr],gr=0;gr<ke;++gr)for(var br=pr[gr],Ar=0;Ar<Tt;++Ar)tr[Yt++]=br[Ar]}function Cn(F,ue,ke,Tt,tr){for(var Ct=1,Yt=ke+1;Yt<ue.length;++Yt)Ct*=ue[Yt];var sr=ue[ke];if(ue.length-ke==4){var pr=ue[ke+1],gr=ue[ke+2],br=ue[ke+3];for(Yt=0;Yt<sr;++Yt)Mr(F[Yt],pr,gr,br,Tt,tr),tr+=Ct}else for(Yt=0;Yt<sr;++Yt)Cn(F[Yt],ue,ke+1,Tt,tr),tr+=Ct}function Ti(F,ue,ke,Tt){var tr=1;if(ue.length)for(var Ct=0;Ct<ue.length;++Ct)tr*=ue[Ct];else tr=0;var Yt=Tt||Et.allocType(ke,tr);switch(ue.length){case 0:break;case 1:He(F,ue[0],Yt);break;case 2:wt(F,ue[0],ue[1],Yt);break;case 3:Mr(F,ue[0],ue[1],ue[2],Yt,0);break;default:Cn(F,ue,0,Yt,0)}return Yt}function eo(F){for(var ue=[],ke=F;ke.length;ke=ke[0])ue.push(ke.length);return ue}var ka={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ba=5120,Vo=5122,ps=5124,io=5121,bo=5123,ds=5125,Ts=5126,Ds=5126,eu={int8:Ba,int16:Vo,int32:ps,uint8:io,uint16:bo,uint32:ds,float:Ts,float32:Ds},vs=35048,da=35040,ma={dynamic:vs,stream:da,static:35044},ts=ve.flatten,ef=ve.shape,wl=35044,Gs=35040,Ql=5121,zu=5126,Hs=[];Hs[5120]=1,Hs[5122]=2,Hs[5124]=4,Hs[5121]=1,Hs[5123]=2,Hs[5125]=4,Hs[5126]=4;function il(F){return ka[Object.prototype.toString.call(F)]|0}function g(F,ue){for(var ke=0;ke<ue.length;++ke)F[ke]=ue[ke]}function A(F,ue,ke,Tt,tr,Ct,Yt){for(var sr=0,pr=0;pr<ke;++pr)for(var gr=0;gr<Tt;++gr)F[sr++]=ue[tr*pr+Ct*gr+Yt]}function D(F,ue,ke,Tt){var tr=0,Ct={};function Yt(tt){this.id=tr++,this.buffer=F.createBuffer(),this.type=tt,this.usage=wl,this.byteLength=0,this.dimension=1,this.dtype=Ql,this.persistentData=null,ke.profile&&(this.stats={size:0})}Yt.prototype.bind=function(){F.bindBuffer(this.type,this.buffer)},Yt.prototype.destroy=function(){zr(this)};var sr=[];function pr(tt,Ft){var mr=sr.pop();return mr||(mr=new Yt(tt)),mr.bind(),Ar(mr,Ft,Gs,0,1,!1),mr}function gr(tt){sr.push(tt)}function br(tt,Ft,mr){tt.byteLength=Ft.byteLength,F.bufferData(tt.type,Ft,mr)}function Ar(tt,Ft,mr,kr,or,Tr){var Wr;if(tt.usage=mr,Array.isArray(Ft)){if(tt.dtype=kr||zu,Ft.length>0){var Nn;if(Array.isArray(Ft[0])){Wr=ef(Ft);for(var qt=1,$t=1;$t<Wr.length;++$t)qt*=Wr[$t];tt.dimension=qt,Nn=ts(Ft,Wr,tt.dtype),br(tt,Nn,mr),Tr?tt.persistentData=Nn:Et.freeType(Nn)}else if(typeof Ft[0]=="number"){tt.dimension=or;var mn=Et.allocType(tt.dtype,Ft.length);g(mn,Ft),br(tt,mn,mr),Tr?tt.persistentData=mn:Et.freeType(mn)}else me(Ft[0])?(tt.dimension=Ft[0].length,tt.dtype=kr||il(Ft[0])||zu,Nn=ts(Ft,[Ft.length,Ft[0].length],tt.dtype),br(tt,Nn,mr),Tr?tt.persistentData=Nn:Et.freeType(Nn)):le.raise("invalid buffer data")}}else if(me(Ft))tt.dtype=kr||il(Ft),tt.dimension=or,br(tt,Ft,mr),Tr&&(tt.persistentData=new Uint8Array(new Uint8Array(Ft.buffer)));else if(hs(Ft)){Wr=Ft.shape;var Ur=Ft.stride,yr=Ft.offset,Xr=0,Yr=0,hi=0,Jn=0;Wr.length===1?(Xr=Wr[0],Yr=1,hi=Ur[0],Jn=0):Wr.length===2?(Xr=Wr[0],Yr=Wr[1],hi=Ur[0],Jn=Ur[1]):le.raise("invalid shape"),tt.dtype=kr||il(Ft.data)||zu,tt.dimension=Yr;var Gr=Et.allocType(tt.dtype,Xr*Yr);A(Gr,Ft.data,Xr,Yr,hi,Jn,yr),br(tt,Gr,mr),Tr?tt.persistentData=Gr:Et.freeType(Gr)}else Ft instanceof ArrayBuffer?(tt.dtype=Ql,tt.dimension=or,br(tt,Ft,mr),Tr&&(tt.persistentData=new Uint8Array(new Uint8Array(Ft)))):le.raise("invalid buffer data")}function zr(tt){ue.bufferCount--,Tt(tt);var Ft=tt.buffer;le(Ft,"buffer must not be deleted already"),F.deleteBuffer(Ft),tt.buffer=null,delete Ct[tt.id]}function vr(tt,Ft,mr,kr){ue.bufferCount++;var or=new Yt(Ft);Ct[or.id]=or;function Tr(qt){var $t=wl,mn=null,Ur=0,yr=0,Xr=1;return Array.isArray(qt)||me(qt)||hs(qt)||qt instanceof ArrayBuffer?mn=qt:typeof qt=="number"?Ur=qt|0:qt&&(le.type(qt,"object","buffer arguments must be an object, a number or an array"),"data"in qt&&(le(mn===null||Array.isArray(mn)||me(mn)||hs(mn),"invalid data for buffer"),mn=qt.data),"usage"in qt&&(le.parameter(qt.usage,ma,"invalid buffer usage"),$t=ma[qt.usage]),"type"in qt&&(le.parameter(qt.type,eu,"invalid buffer type"),yr=eu[qt.type]),"dimension"in qt&&(le.type(qt.dimension,"number","invalid dimension"),Xr=qt.dimension|0),"length"in qt&&(le.nni(Ur,"buffer length must be a nonnegative integer"),Ur=qt.length|0)),or.bind(),mn?Ar(or,mn,$t,yr,Xr,kr):(Ur&&F.bufferData(or.type,Ur,$t),or.dtype=yr||Ql,or.usage=$t,or.dimension=Xr,or.byteLength=Ur),ke.profile&&(or.stats.size=or.byteLength*Hs[or.dtype]),Tr}function Wr(qt,$t){le($t+qt.byteLength<=or.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+qt.byteLength+" starting from offset "+$t+" to a buffer of size "+or.byteLength),F.bufferSubData(or.type,$t,qt)}function Nn(qt,$t){var mn=($t||0)|0,Ur;if(or.bind(),me(qt)||qt instanceof ArrayBuffer)Wr(qt,mn);else if(Array.isArray(qt)){if(qt.length>0)if(typeof qt[0]=="number"){var yr=Et.allocType(or.dtype,qt.length);g(yr,qt),Wr(yr,mn),Et.freeType(yr)}else if(Array.isArray(qt[0])||me(qt[0])){Ur=ef(qt);var Xr=ts(qt,Ur,or.dtype);Wr(Xr,mn),Et.freeType(Xr)}else le.raise("invalid buffer data")}else if(hs(qt)){Ur=qt.shape;var Yr=qt.stride,hi=0,Jn=0,Gr=0,Qr=0;Ur.length===1?(hi=Ur[0],Jn=1,Gr=Yr[0],Qr=0):Ur.length===2?(hi=Ur[0],Jn=Ur[1],Gr=Yr[0],Qr=Yr[1]):le.raise("invalid shape");var Yn=Array.isArray(qt.data)?or.dtype:il(qt.data),oi=Et.allocType(Yn,hi*Jn);A(oi,qt.data,hi,Jn,Gr,Qr,qt.offset),Wr(oi,mn),Et.freeType(oi)}else le.raise("invalid data for buffer subdata");return Tr}return mr||Tr(tt),Tr._reglType="buffer",Tr._buffer=or,Tr.subdata=Nn,ke.profile&&(Tr.stats=or.stats),Tr.destroy=function(){zr(or)},Tr}function _r(){K(Ct).forEach(function(tt){tt.buffer=F.createBuffer(),F.bindBuffer(tt.type,tt.buffer),F.bufferData(tt.type,tt.persistentData||tt.byteLength,tt.usage)})}return ke.profile&&(ue.getTotalBufferSize=function(){var tt=0;return Object.keys(Ct).forEach(function(Ft){tt+=Ct[Ft].stats.size}),tt}),{create:vr,createStream:pr,destroyStream:gr,clear:function(){K(Ct).forEach(zr),sr.forEach(zr)},getBuffer:function(tt){return tt&&tt._buffer instanceof Yt?tt._buffer:null},restore:_r,_initBuffer:Ar}}var O=0,H=0,de=1,je=1,it=4,at=4,er={points:O,point:H,lines:de,line:je,triangles:it,triangle:at,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ar=0,wn=1,Qn=4,On=5120,ji=5121,ca=5122,Ea=5123,zi=5124,ms=5125,tu=34963,Uu=35040,tf=35044;function al(F,ue,ke,Tt){var tr={},Ct=0,Yt={uint8:ji,uint16:Ea};ue.oes_element_index_uint&&(Yt.uint32=ms);function sr(_r){this.id=Ct++,tr[this.id]=this,this.buffer=_r,this.primType=Qn,this.vertCount=0,this.type=0}sr.prototype.bind=function(){this.buffer.bind()};var pr=[];function gr(_r){var tt=pr.pop();return tt||(tt=new sr(ke.create(null,tu,!0,!1)._buffer)),Ar(tt,_r,Uu,-1,-1,0,0),tt}function br(_r){pr.push(_r)}function Ar(_r,tt,Ft,mr,kr,or,Tr){_r.buffer.bind();var Wr;if(tt){var Nn=Tr;!Tr&&(!me(tt)||hs(tt)&&!me(tt.data))&&(Nn=ue.oes_element_index_uint?ms:Ea),ke._initBuffer(_r.buffer,tt,Ft,Nn,3)}else F.bufferData(tu,or,Ft),_r.buffer.dtype=Wr||ji,_r.buffer.usage=Ft,_r.buffer.dimension=3,_r.buffer.byteLength=or;if(Wr=Tr,!Tr){switch(_r.buffer.dtype){case ji:case On:Wr=ji;break;case Ea:case ca:Wr=Ea;break;case ms:case zi:Wr=ms;break;default:le.raise("unsupported type for element array")}_r.buffer.dtype=Wr}_r.type=Wr,le(Wr!==ms||!!ue.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var qt=kr;qt<0&&(qt=_r.buffer.byteLength,Wr===Ea?qt>>=1:Wr===ms&&(qt>>=2)),_r.vertCount=qt;var $t=mr;if(mr<0){$t=Qn;var mn=_r.buffer.dimension;mn===1&&($t=ar),mn===2&&($t=wn),mn===3&&($t=Qn)}_r.primType=$t}function zr(_r){Tt.elementsCount--,le(_r.buffer!==null,"must not double destroy elements"),delete tr[_r.id],_r.buffer.destroy(),_r.buffer=null}function vr(_r,tt){var Ft=ke.create(null,tu,!0),mr=new sr(Ft._buffer);Tt.elementsCount++;function kr(or){if(!or)Ft(),mr.primType=Qn,mr.vertCount=0,mr.type=ji;else if(typeof or=="number")Ft(or),mr.primType=Qn,mr.vertCount=or|0,mr.type=ji;else{var Tr=null,Wr=tf,Nn=-1,qt=-1,$t=0,mn=0;Array.isArray(or)||me(or)||hs(or)?Tr=or:(le.type(or,"object","invalid arguments for elements"),"data"in or&&(Tr=or.data,le(Array.isArray(Tr)||me(Tr)||hs(Tr),"invalid data for element buffer")),"usage"in or&&(le.parameter(or.usage,ma,"invalid element buffer usage"),Wr=ma[or.usage]),"primitive"in or&&(le.parameter(or.primitive,er,"invalid element buffer primitive"),Nn=er[or.primitive]),"count"in or&&(le(typeof or.count=="number"&&or.count>=0,"invalid vertex count for elements"),qt=or.count|0),"type"in or&&(le.parameter(or.type,Yt,"invalid buffer type"),mn=Yt[or.type]),"length"in or?$t=or.length|0:($t=qt,mn===Ea||mn===ca?$t*=2:(mn===ms||mn===zi)&&($t*=4))),Ar(mr,Tr,Wr,Nn,qt,$t,mn)}return kr}return kr(_r),kr._reglType="elements",kr._elements=mr,kr.subdata=function(or,Tr){return Ft.subdata(or,Tr),kr},kr.destroy=function(){zr(mr)},kr}return{create:vr,createStream:gr,destroyStream:br,getElements:function(_r){return typeof _r=="function"&&_r._elements instanceof sr?_r._elements:null},clear:function(){K(tr).forEach(zr)}}}var Tc=new Float32Array(1),Cu=new Uint32Array(Tc.buffer),Au=5123;function Tu(F){for(var ue=Et.allocType(Au,F.length),ke=0;ke<F.length;++ke)if(isNaN(F[ke]))ue[ke]=65535;else if(F[ke]===Infinity)ue[ke]=31744;else if(F[ke]===-Infinity)ue[ke]=64512;else{Tc[0]=F[ke];var Tt=Cu[0],tr=Tt>>>31<<15,Ct=(Tt<<1>>>24)-127,Yt=Tt>>13&(1<<10)-1;if(Ct<-24)ue[ke]=tr;else if(Ct<-14){var sr=-14-Ct;ue[ke]=tr+(Yt+(1<<10)>>sr)}else Ct>15?ue[ke]=tr+31744:ue[ke]=tr+(Ct+15<<10)+Yt}return ue}function ao(F){return Array.isArray(F)||me(F)}var Ff=function(F){return!(F&F-1)&&!!F},Nf=34467,qo=3553,Mc=34067,Mu=34069,ru=6408,rf=6406,Cl=6407,Ri=6409,Al=6410,xh=32854,ol=32855,Pc=36194,Bf=32819,bh=32820,zf=33635,Ic=34042,Jl=6402,ec=34041,Tl=35904,sl=35906,Ml=36193,Zu=33776,Ws=33777,nf=33778,af=33779,Uf=35986,nu=35987,tc=34798,Oc=35840,of=35841,Pl=35842,Yh=35843,sf=36196,Il=5121,uf=5123,lf=5125,Ol=5126,Rc=10242,Eh=10243,Sh=10497,rc=33071,wh=33648,Rl=10240,Wi=10241,nc=9728,oa=9729,Pu=9984,Gi=9985,Ma=9986,gs=9987,Lc=33170,Vu=4352,za=4353,ic=4354,Ll=34046,ju=3317,kc=37440,Iu=37441,co=37443,kl=37444,ac=33984,fo=[Pu,Ma,Gi,gs],cn=[0,Ri,Al,Cl,ru],oo={};oo[Ri]=oo[rf]=oo[Jl]=1,oo[ec]=oo[Al]=2,oo[Cl]=oo[Tl]=3,oo[ru]=oo[sl]=4;function Gu(F){return"[object "+F+"]"}var Da=Gu("HTMLCanvasElement"),Xs=Gu("OffscreenCanvas"),Ms=Gu("CanvasRenderingContext2D"),cf=Gu("ImageBitmap"),Br=Gu("HTMLImageElement"),oc=Gu("HTMLVideoElement"),ff=Object.keys(ka).concat([Da,Xs,Ms,cf,Br,oc]),ul=[];ul[Il]=1,ul[Ol]=4,ul[Ml]=2,ul[uf]=2,ul[lf]=4;var Sa=[];Sa[xh]=2,Sa[ol]=2,Sa[Pc]=2,Sa[ec]=4,Sa[Zu]=.5,Sa[Ws]=.5,Sa[nf]=1,Sa[af]=1,Sa[Uf]=.5,Sa[nu]=1,Sa[tc]=1,Sa[Oc]=.5,Sa[of]=.25,Sa[Pl]=.5,Sa[Yh]=.25,Sa[sf]=.5;function ys(F){return Array.isArray(F)&&(F.length===0||typeof F[0]=="number")}function hf(F){if(!Array.isArray(F))return!1;var ue=F.length;return!(ue===0||!ao(F[0]))}function Ou(F){return Object.prototype.toString.call(F)}function Fs(F){return Ou(F)===Da}function Ru(F){return Ou(F)===Xs}function Zf(F){return Ou(F)===Ms}function ll(F){return Ou(F)===cf}function Vf(F){return Ou(F)===Br}function pf(F){return Ou(F)===oc}function iu(F){var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ue&&F&&F.getContext)}function Ps(F){var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ue&&F&&"src"in F&&"crossOrigin"in F)}function Ei(F){if(!F)return!1;if(iu(F)||Ps(F))return!0;var ue=Ou(F);return ff.indexOf(ue)>=0?!0:ys(F)||hf(F)||hs(F)}function Lu(F){return ka[Object.prototype.toString.call(F)]|0}function au(F,ue){var ke=ue.length;switch(F.type){case Il:case uf:case lf:case Ol:var Tt=Et.allocType(F.type,ke);Tt.set(ue),F.data=Tt;break;case Ml:F.data=Tu(ue);break;default:le.raise("unsupported texture type, must specify a typed array")}}function jo(F,ue){return Et.allocType(F.type===Ml?Ol:F.type,ue)}function cl(F,ue){F.type===Ml?(F.data=Tu(ue),Et.freeType(ue)):F.data=ue}function Ns(F,ue,ke,Tt,tr,Ct){for(var Yt=F.width,sr=F.height,pr=F.channels,gr=Yt*sr*pr,br=jo(F,gr),Ar=0,zr=0;zr<sr;++zr)for(var vr=0;vr<Yt;++vr)for(var _r=0;_r<pr;++_r)br[Ar++]=ue[ke*vr+Tt*zr+tr*_r+Ct];cl(F,br)}function Ys(F,ue,ke,Tt,tr,Ct){var Yt;if(typeof Sa[F]!="undefined"?Yt=Sa[F]:Yt=oo[F]*ul[ue],Ct&&(Yt*=6),tr){for(var sr=0,pr=ke;pr>=1;)sr+=Yt*pr*pr,pr/=2;return sr}else return Yt*ke*Tt}function _s(F,ue,ke,Tt,tr,Ct,Yt){var sr={"don't care":Vu,"dont care":Vu,nice:ic,fast:za},pr={repeat:Sh,clamp:rc,mirror:wh},gr={nearest:nc,linear:oa},br=m({mipmap:gs,"nearest mipmap nearest":Pu,"linear mipmap nearest":Gi,"nearest mipmap linear":Ma,"linear mipmap linear":gs},gr),Ar={none:0,browser:kl},zr={uint8:Il,rgba4:Bf,rgb565:zf,"rgb5 a1":bh},vr={alpha:rf,luminance:Ri,"luminance alpha":Al,rgb:Cl,rgba:ru,rgba4:xh,"rgb5 a1":ol,rgb565:Pc},_r={};ue.ext_srgb&&(vr.srgb=Tl,vr.srgba=sl),ue.oes_texture_float&&(zr.float32=zr.float=Ol),ue.oes_texture_half_float&&(zr.float16=zr["half float"]=Ml),ue.webgl_depth_texture&&(m(vr,{depth:Jl,"depth stencil":ec}),m(zr,{uint16:uf,uint32:lf,"depth stencil":Ic})),ue.webgl_compressed_texture_s3tc&&m(_r,{"rgb s3tc dxt1":Zu,"rgba s3tc dxt1":Ws,"rgba s3tc dxt3":nf,"rgba s3tc dxt5":af}),ue.webgl_compressed_texture_atc&&m(_r,{"rgb atc":Uf,"rgba atc explicit alpha":nu,"rgba atc interpolated alpha":tc}),ue.webgl_compressed_texture_pvrtc&&m(_r,{"rgb pvrtc 4bppv1":Oc,"rgb pvrtc 2bppv1":of,"rgba pvrtc 4bppv1":Pl,"rgba pvrtc 2bppv1":Yh}),ue.webgl_compressed_texture_etc1&&(_r["rgb etc1"]=sf);var tt=Array.prototype.slice.call(F.getParameter(Nf)||new Uint32Array(0));Object.keys(_r).forEach(function(we){var Rt=_r[we];tt.indexOf(Rt)>=0&&(vr[we]=Rt)});var Ft=Object.keys(vr);ke.textureFormats=Ft;var mr=[];Object.keys(vr).forEach(function(we){var Rt=vr[we];mr[Rt]=we});var kr=[];Object.keys(zr).forEach(function(we){var Rt=zr[we];kr[Rt]=we});var or=[];Object.keys(gr).forEach(function(we){var Rt=gr[we];or[Rt]=we});var Tr=[];Object.keys(br).forEach(function(we){var Rt=br[we];Tr[Rt]=we});var Wr=[];Object.keys(pr).forEach(function(we){var Rt=pr[we];Wr[Rt]=we});var Nn=Ft.reduce(function(we,Rt){var dt=vr[Rt];return dt===Ri||dt===rf||dt===Ri||dt===Al||dt===Jl||dt===ec||ue.ext_srgb&&(dt===Tl||dt===sl)?we[dt]=dt:dt===ol||Rt.indexOf("rgba")>=0?we[dt]=ru:we[dt]=Cl,we},{});function qt(){this.internalformat=ru,this.format=ru,this.type=Il,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=kl,this.width=0,this.height=0,this.channels=0}function $t(we,Rt){we.internalformat=Rt.internalformat,we.format=Rt.format,we.type=Rt.type,we.compressed=Rt.compressed,we.premultiplyAlpha=Rt.premultiplyAlpha,we.flipY=Rt.flipY,we.unpackAlignment=Rt.unpackAlignment,we.colorSpace=Rt.colorSpace,we.width=Rt.width,we.height=Rt.height,we.channels=Rt.channels}function mn(we,Rt){if(!(typeof Rt!="object"||!Rt)){if("premultiplyAlpha"in Rt&&(le.type(Rt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=Rt.premultiplyAlpha),"flipY"in Rt&&(le.type(Rt.flipY,"boolean","invalid texture flip"),we.flipY=Rt.flipY),"alignment"in Rt&&(le.oneOf(Rt.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=Rt.alignment),"colorSpace"in Rt&&(le.parameter(Rt.colorSpace,Ar,"invalid colorSpace"),we.colorSpace=Ar[Rt.colorSpace]),"type"in Rt){var dt=Rt.type;le(ue.oes_texture_float||!(dt==="float"||dt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),le(ue.oes_texture_half_float||!(dt==="half float"||dt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),le(ue.webgl_depth_texture||!(dt==="uint16"||dt==="uint32"||dt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(dt,zr,"invalid texture type"),we.type=zr[dt]}var fn=we.width,Ui=we.height,_e=we.channels,re=!1;"shape"in Rt?(le(Array.isArray(Rt.shape)&&Rt.shape.length>=2,"shape must be an array"),fn=Rt.shape[0],Ui=Rt.shape[1],Rt.shape.length===3&&(_e=Rt.shape[2],le(_e>0&&_e<=4,"invalid number of channels"),re=!0),le(fn>=0&&fn<=ke.maxTextureSize,"invalid width"),le(Ui>=0&&Ui<=ke.maxTextureSize,"invalid height")):("radius"in Rt&&(fn=Ui=Rt.radius,le(fn>=0&&fn<=ke.maxTextureSize,"invalid radius")),"width"in Rt&&(fn=Rt.width,le(fn>=0&&fn<=ke.maxTextureSize,"invalid width")),"height"in Rt&&(Ui=Rt.height,le(Ui>=0&&Ui<=ke.maxTextureSize,"invalid height")),"channels"in Rt&&(_e=Rt.channels,le(_e>0&&_e<=4,"invalid number of channels"),re=!0)),we.width=fn|0,we.height=Ui|0,we.channels=_e|0;var Ue=!1;if("format"in Rt){var rt=Rt.format;le(ue.webgl_depth_texture||!(rt==="depth"||rt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(rt,vr,"invalid texture format");var St=we.internalformat=vr[rt];we.format=Nn[St],rt in zr&&("type"in Rt||(we.type=zr[rt])),rt in _r&&(we.compressed=!0),Ue=!0}!re&&Ue?we.channels=oo[we.format]:re&&!Ue?we.channels!==cn[we.format]&&(we.format=we.internalformat=cn[we.channels]):Ue&&re&&le(we.channels===oo[we.format],"number of channels inconsistent with specified format")}}function Ur(we){F.pixelStorei(kc,we.flipY),F.pixelStorei(Iu,we.premultiplyAlpha),F.pixelStorei(co,we.colorSpace),F.pixelStorei(ju,we.unpackAlignment)}function yr(){qt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Xr(we,Rt){var dt=null;if(Ei(Rt)?dt=Rt:Rt&&(le.type(Rt,"object","invalid pixel data type"),mn(we,Rt),"x"in Rt&&(we.xOffset=Rt.x|0),"y"in Rt&&(we.yOffset=Rt.y|0),Ei(Rt.data)&&(dt=Rt.data)),le(!we.compressed||dt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Rt.copy){le(!dt,"can not specify copy and data field for the same texture");var fn=tr.viewportWidth,Ui=tr.viewportHeight;we.width=we.width||fn-we.xOffset,we.height=we.height||Ui-we.yOffset,we.needsCopy=!0,le(we.xOffset>=0&&we.xOffset<fn&&we.yOffset>=0&&we.yOffset<Ui&&we.width>0&&we.width<=fn&&we.height>0&&we.height<=Ui,"copy texture read out of bounds")}else if(!dt)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(me(dt))we.channels=we.channels||4,we.data=dt,!("type"in Rt)&&we.type===Il&&(we.type=Lu(dt));else if(ys(dt))we.channels=we.channels||4,au(we,dt),we.alignment=1,we.needsFree=!0;else if(hs(dt)){var _e=dt.data;!Array.isArray(_e)&&we.type===Il&&(we.type=Lu(_e));var re=dt.shape,Ue=dt.stride,rt,St,We,Le,$e,pe;re.length===3?(We=re[2],pe=Ue[2]):(le(re.length===2,"invalid ndarray pixel data, must be 2 or 3D"),We=1,pe=1),rt=re[0],St=re[1],Le=Ue[0],$e=Ue[1],we.alignment=1,we.width=rt,we.height=St,we.channels=We,we.format=we.internalformat=cn[We],we.needsFree=!0,Ns(we,_e,Le,$e,pe,dt.offset)}else if(iu(dt)||Fs(dt)||Ru(dt)||Zf(dt))iu(dt)||Fs(dt)||Ru(dt)?we.element=dt:we.element=dt.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(ll(dt))we.element=dt,we.width=dt.width,we.height=dt.height,we.channels=4;else if(Vf(dt))we.element=dt,we.width=dt.naturalWidth,we.height=dt.naturalHeight,we.channels=4;else if(Ps(dt))we.element=dt,we.width=dt.width,we.height=dt.height,we.channels=4;else if(pf(dt))we.element=dt,we.width=dt.videoWidth,we.height=dt.videoHeight,we.channels=4;else if(hf(dt)){var Be=we.width||dt[0].length,xe=we.height||dt.length,nt=we.channels;ao(dt[0][0])?nt=nt||dt[0][0].length:nt=nt||1;for(var mt=ve.shape(dt),cr=1,Fr=0;Fr<mt.length;++Fr)cr*=mt[Fr];var Nr=jo(we,cr);ve.flatten(dt,mt,"",Nr),cl(we,Nr),we.alignment=1,we.width=Be,we.height=xe,we.channels=nt,we.format=we.internalformat=cn[nt],we.needsFree=!0}we.type===Ol?le(ke.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===Ml&&le(ke.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Yr(we,Rt,dt){var fn=we.element,Ui=we.data,_e=we.internalformat,re=we.format,Ue=we.type,rt=we.width,St=we.height;Ur(we),fn?F.texImage2D(Rt,dt,re,re,Ue,fn):we.compressed?F.compressedTexImage2D(Rt,dt,_e,rt,St,0,Ui):we.needsCopy?(Tt(),F.copyTexImage2D(Rt,dt,re,we.xOffset,we.yOffset,rt,St,0)):F.texImage2D(Rt,dt,re,rt,St,0,re,Ue,Ui||null)}function hi(we,Rt,dt,fn,Ui){var _e=we.element,re=we.data,Ue=we.internalformat,rt=we.format,St=we.type,We=we.width,Le=we.height;Ur(we),_e?F.texSubImage2D(Rt,Ui,dt,fn,rt,St,_e):we.compressed?F.compressedTexSubImage2D(Rt,Ui,dt,fn,Ue,We,Le,re):we.needsCopy?(Tt(),F.copyTexSubImage2D(Rt,Ui,dt,fn,we.xOffset,we.yOffset,We,Le)):F.texSubImage2D(Rt,Ui,dt,fn,We,Le,rt,St,re)}var Jn=[];function Gr(){return Jn.pop()||new yr}function Qr(we){we.needsFree&&Et.freeType(we.data),yr.call(we),Jn.push(we)}function Yn(){qt.call(this),this.genMipmaps=!1,this.mipmapHint=Vu,this.mipmask=0,this.images=Array(16)}function oi(we,Rt,dt){var fn=we.images[0]=Gr();we.mipmask=1,fn.width=we.width=Rt,fn.height=we.height=dt,fn.channels=we.channels=4}function Li(we,Rt){var dt=null;if(Ei(Rt))dt=we.images[0]=Gr(),$t(dt,we),Xr(dt,Rt),we.mipmask=1;else if(mn(we,Rt),Array.isArray(Rt.mipmap))for(var fn=Rt.mipmap,Ui=0;Ui<fn.length;++Ui)dt=we.images[Ui]=Gr(),$t(dt,we),dt.width>>=Ui,dt.height>>=Ui,Xr(dt,fn[Ui]),we.mipmask|=1<<Ui;else dt=we.images[0]=Gr(),$t(dt,we),Xr(dt,Rt),we.mipmask=1;$t(we,we.images[0]),we.compressed&&(we.internalformat===Zu||we.internalformat===Ws||we.internalformat===nf||we.internalformat===af)&&le(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ya(we,Rt){for(var dt=we.images,fn=0;fn<dt.length;++fn){if(!dt[fn])return;Yr(dt[fn],Rt,fn)}}var ro=[];function Pi(){var we=ro.pop()||new Yn;qt.call(we),we.mipmask=0;for(var Rt=0;Rt<16;++Rt)we.images[Rt]=null;return we}function $o(we){for(var Rt=we.images,dt=0;dt<Rt.length;++dt)Rt[dt]&&Qr(Rt[dt]),Rt[dt]=null;ro.push(we)}function Za(){this.minFilter=nc,this.magFilter=nc,this.wrapS=rc,this.wrapT=rc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vu}function Ho(we,Rt){if("min"in Rt){var dt=Rt.min;le.parameter(dt,br),we.minFilter=br[dt],fo.indexOf(we.minFilter)>=0&&!("faces"in Rt)&&(we.genMipmaps=!0)}if("mag"in Rt){var fn=Rt.mag;le.parameter(fn,gr),we.magFilter=gr[fn]}var Ui=we.wrapS,_e=we.wrapT;if("wrap"in Rt){var re=Rt.wrap;typeof re=="string"?(le.parameter(re,pr),Ui=_e=pr[re]):Array.isArray(re)&&(le.parameter(re[0],pr),le.parameter(re[1],pr),Ui=pr[re[0]],_e=pr[re[1]])}else{if("wrapS"in Rt){var Ue=Rt.wrapS;le.parameter(Ue,pr),Ui=pr[Ue]}if("wrapT"in Rt){var rt=Rt.wrapT;le.parameter(rt,pr),_e=pr[rt]}}if(we.wrapS=Ui,we.wrapT=_e,"anisotropic"in Rt){var St=Rt.anisotropic;le(typeof St=="number"&&St>=1&&St<=ke.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=Rt.anisotropic}if("mipmap"in Rt){var We=!1;switch(typeof Rt.mipmap){case"string":le.parameter(Rt.mipmap,sr,"invalid mipmap hint"),we.mipmapHint=sr[Rt.mipmap],we.genMipmaps=!0,We=!0;break;case"boolean":We=we.genMipmaps=Rt.mipmap;break;case"object":le(Array.isArray(Rt.mipmap),"invalid mipmap type"),we.genMipmaps=!1,We=!0;break;default:le.raise("invalid mipmap type")}We&&!("min"in Rt)&&(we.minFilter=Pu)}}function Rn(we,Rt){F.texParameteri(Rt,Wi,we.minFilter),F.texParameteri(Rt,Rl,we.magFilter),F.texParameteri(Rt,Rc,we.wrapS),F.texParameteri(Rt,Eh,we.wrapT),ue.ext_texture_filter_anisotropic&&F.texParameteri(Rt,Ll,we.anisotropic),we.genMipmaps&&(F.hint(Lc,we.mipmapHint),F.generateMipmap(Rt))}var kn=0,Co={},bs=ke.maxTextureUnits,uo=Array(bs).map(function(){return null});function _i(we){qt.call(this),this.mipmask=0,this.internalformat=ru,this.id=kn++,this.refCount=1,this.target=we,this.texture=F.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Za,Yt.profile&&(this.stats={size:0})}function Wo(we){F.activeTexture(ac),F.bindTexture(we.target,we.texture)}function ia(){var we=uo[0];we?F.bindTexture(we.target,we.texture):F.bindTexture(qo,null)}function ss(we){var Rt=we.texture;le(Rt,"must not double destroy texture");var dt=we.unit,fn=we.target;dt>=0&&(F.activeTexture(ac+dt),F.bindTexture(fn,null),uo[dt]=null),F.deleteTexture(Rt),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Co[we.id],Ct.textureCount--}m(_i.prototype,{bind:function(){var we=this;we.bindCount+=1;var Rt=we.unit;if(Rt<0){for(var dt=0;dt<bs;++dt){var fn=uo[dt];if(fn){if(fn.bindCount>0)continue;fn.unit=-1}uo[dt]=we,Rt=dt;break}Rt>=bs&&le.raise("insufficient number of texture units"),Yt.profile&&Ct.maxTextureUnits<Rt+1&&(Ct.maxTextureUnits=Rt+1),we.unit=Rt,F.activeTexture(ac+Rt),F.bindTexture(we.target,we.texture)}return Rt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ss(this)}});function ei(we,Rt){var dt=new _i(qo);Co[dt.id]=dt,Ct.textureCount++;function fn(re,Ue){var rt=dt.texInfo;Za.call(rt);var St=Pi();return typeof re=="number"?typeof Ue=="number"?oi(St,re|0,Ue|0):oi(St,re|0,re|0):re?(le.type(re,"object","invalid arguments to regl.texture"),Ho(rt,re),Li(St,re)):oi(St,1,1),rt.genMipmaps&&(St.mipmask=(St.width<<1)-1),dt.mipmask=St.mipmask,$t(dt,St),le.texture2D(rt,St,ke),dt.internalformat=St.internalformat,fn.width=St.width,fn.height=St.height,Wo(dt),Ya(St,qo),Rn(rt,qo),ia(),$o(St),Yt.profile&&(dt.stats.size=Ys(dt.internalformat,dt.type,St.width,St.height,rt.genMipmaps,!1)),fn.format=mr[dt.internalformat],fn.type=kr[dt.type],fn.mag=or[rt.magFilter],fn.min=Tr[rt.minFilter],fn.wrapS=Wr[rt.wrapS],fn.wrapT=Wr[rt.wrapT],fn}function Ui(re,Ue,rt,St){le(!!re,"must specify image data");var We=Ue|0,Le=rt|0,$e=St|0,pe=Gr();return $t(pe,dt),pe.width=0,pe.height=0,Xr(pe,re),pe.width=pe.width||(dt.width>>$e)-We,pe.height=pe.height||(dt.height>>$e)-Le,le(dt.type===pe.type&&dt.format===pe.format&&dt.internalformat===pe.internalformat,"incompatible format for texture.subimage"),le(We>=0&&Le>=0&&We+pe.width<=dt.width&&Le+pe.height<=dt.height,"texture.subimage write out of bounds"),le(dt.mipmask&1<<$e,"missing mipmap data"),le(pe.data||pe.element||pe.needsCopy,"missing image data"),Wo(dt),hi(pe,qo,We,Le,$e),ia(),Qr(pe),fn}function _e(re,Ue){var rt=re|0,St=Ue|0||rt;if(rt===dt.width&&St===dt.height)return fn;fn.width=dt.width=rt,fn.height=dt.height=St,Wo(dt);for(var We=0;dt.mipmask>>We;++We){var Le=rt>>We,$e=St>>We;if(!Le||!$e)break;F.texImage2D(qo,We,dt.format,Le,$e,0,dt.format,dt.type,null)}return ia(),Yt.profile&&(dt.stats.size=Ys(dt.internalformat,dt.type,rt,St,!1,!1)),fn}return fn(we,Rt),fn.subimage=Ui,fn.resize=_e,fn._reglType="texture2d",fn._texture=dt,Yt.profile&&(fn.stats=dt.stats),fn.destroy=function(){dt.decRef()},fn}function Ni(we,Rt,dt,fn,Ui,_e){var re=new _i(Mc);Co[re.id]=re,Ct.cubeCount++;var Ue=new Array(6);function rt(Le,$e,pe,Be,xe,nt){var mt,cr=re.texInfo;for(Za.call(cr),mt=0;mt<6;++mt)Ue[mt]=Pi();if(typeof Le=="number"||!Le){var Fr=Le|0||1;for(mt=0;mt<6;++mt)oi(Ue[mt],Fr,Fr)}else if(typeof Le=="object")if($e)Li(Ue[0],Le),Li(Ue[1],$e),Li(Ue[2],pe),Li(Ue[3],Be),Li(Ue[4],xe),Li(Ue[5],nt);else if(Ho(cr,Le),mn(re,Le),"faces"in Le){var Nr=Le.faces;for(le(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),mt=0;mt<6;++mt)le(typeof Nr[mt]=="object"&&!!Nr[mt],"invalid input for cube map face"),$t(Ue[mt],re),Li(Ue[mt],Nr[mt])}else for(mt=0;mt<6;++mt)Li(Ue[mt],Le);else le.raise("invalid arguments to cube map");for($t(re,Ue[0]),le.optional(function(){ke.npotTextureCube||le(Ff(re.width)&&Ff(re.height),"your browser does not support non power or two texture dimensions")}),cr.genMipmaps?re.mipmask=(Ue[0].width<<1)-1:re.mipmask=Ue[0].mipmask,le.textureCube(re,cr,Ue,ke),re.internalformat=Ue[0].internalformat,rt.width=Ue[0].width,rt.height=Ue[0].height,Wo(re),mt=0;mt<6;++mt)Ya(Ue[mt],Mu+mt);for(Rn(cr,Mc),ia(),Yt.profile&&(re.stats.size=Ys(re.internalformat,re.type,rt.width,rt.height,cr.genMipmaps,!0)),rt.format=mr[re.internalformat],rt.type=kr[re.type],rt.mag=or[cr.magFilter],rt.min=Tr[cr.minFilter],rt.wrapS=Wr[cr.wrapS],rt.wrapT=Wr[cr.wrapT],mt=0;mt<6;++mt)$o(Ue[mt]);return rt}function St(Le,$e,pe,Be,xe){le(!!$e,"must specify image data"),le(typeof Le=="number"&&Le===(Le|0)&&Le>=0&&Le<6,"invalid face");var nt=pe|0,mt=Be|0,cr=xe|0,Fr=Gr();return $t(Fr,re),Fr.width=0,Fr.height=0,Xr(Fr,$e),Fr.width=Fr.width||(re.width>>cr)-nt,Fr.height=Fr.height||(re.height>>cr)-mt,le(re.type===Fr.type&&re.format===Fr.format&&re.internalformat===Fr.internalformat,"incompatible format for texture.subimage"),le(nt>=0&&mt>=0&&nt+Fr.width<=re.width&&mt+Fr.height<=re.height,"texture.subimage write out of bounds"),le(re.mipmask&1<<cr,"missing mipmap data"),le(Fr.data||Fr.element||Fr.needsCopy,"missing image data"),Wo(re),hi(Fr,Mu+Le,nt,mt,cr),ia(),Qr(Fr),rt}function We(Le){var $e=Le|0;if($e!==re.width){rt.width=re.width=$e,rt.height=re.height=$e,Wo(re);for(var pe=0;pe<6;++pe)for(var Be=0;re.mipmask>>Be;++Be)F.texImage2D(Mu+pe,Be,re.format,$e>>Be,$e>>Be,0,re.format,re.type,null);return ia(),Yt.profile&&(re.stats.size=Ys(re.internalformat,re.type,rt.width,rt.height,!1,!0)),rt}}return rt(we,Rt,dt,fn,Ui,_e),rt.subimage=St,rt.resize=We,rt._reglType="textureCube",rt._texture=re,Yt.profile&&(rt.stats=re.stats),rt.destroy=function(){re.decRef()},rt}function va(){for(var we=0;we<bs;++we)F.activeTexture(ac+we),F.bindTexture(qo,null),uo[we]=null;K(Co).forEach(ss),Ct.cubeCount=0,Ct.textureCount=0}Yt.profile&&(Ct.getTotalTextureSize=function(){var we=0;return Object.keys(Co).forEach(function(Rt){we+=Co[Rt].stats.size}),we});function Ao(){for(var we=0;we<bs;++we){var Rt=uo[we];Rt&&(Rt.bindCount=0,Rt.unit=-1,uo[we]=null)}K(Co).forEach(function(dt){dt.texture=F.createTexture(),F.bindTexture(dt.target,dt.texture);for(var fn=0;fn<32;++fn)if((dt.mipmask&1<<fn)!=0)if(dt.target===qo)F.texImage2D(qo,fn,dt.internalformat,dt.width>>fn,dt.height>>fn,0,dt.internalformat,dt.type,null);else for(var Ui=0;Ui<6;++Ui)F.texImage2D(Mu+Ui,fn,dt.internalformat,dt.width>>fn,dt.height>>fn,0,dt.internalformat,dt.type,null);Rn(dt.texInfo,dt.target)})}function Zl(){for(var we=0;we<bs;++we){var Rt=uo[we];Rt&&(Rt.bindCount=0,Rt.unit=-1,uo[we]=null),F.activeTexture(ac+we),F.bindTexture(qo,null),F.bindTexture(Mc,null)}}return{create2D:ei,createCube:Ni,clear:va,getTexture:function(we){return null},restore:Ao,refresh:Zl}}var hu=36161,Tn=32854,xn=32855,Dc=36194,rs=33189,ns=36168,Fo=34041,wa=35907,Hu=34836,Wu=34842,na=34843,_a=[];_a[Tn]=2,_a[xn]=2,_a[Dc]=2,_a[rs]=2,_a[ns]=1,_a[Fo]=4,_a[wa]=4,_a[Hu]=16,_a[Wu]=8,_a[na]=6;function sc(F,ue,ke){return _a[F]*ue*ke}var fl=function(F,ue,ke,Tt,tr){var Ct={rgba4:Tn,rgb565:Dc,"rgb5 a1":xn,depth:rs,stencil:ns,"depth stencil":Fo};ue.ext_srgb&&(Ct.srgba=wa),ue.ext_color_buffer_half_float&&(Ct.rgba16f=Wu,Ct.rgb16f=na),ue.webgl_color_buffer_float&&(Ct.rgba32f=Hu);var Yt=[];Object.keys(Ct).forEach(function(vr){var _r=Ct[vr];Yt[_r]=vr});var sr=0,pr={};function gr(vr){this.id=sr++,this.refCount=1,this.renderbuffer=vr,this.format=Tn,this.width=0,this.height=0,tr.profile&&(this.stats={size:0})}gr.prototype.decRef=function(){--this.refCount<=0&&br(this)};function br(vr){var _r=vr.renderbuffer;le(_r,"must not double destroy renderbuffer"),F.bindRenderbuffer(hu,null),F.deleteRenderbuffer(_r),vr.renderbuffer=null,vr.refCount=0,delete pr[vr.id],Tt.renderbufferCount--}function Ar(vr,_r){var tt=new gr(F.createRenderbuffer());pr[tt.id]=tt,Tt.renderbufferCount++;function Ft(kr,or){var Tr=0,Wr=0,Nn=Tn;if(typeof kr=="object"&&kr){var qt=kr;if("shape"in qt){var $t=qt.shape;le(Array.isArray($t)&&$t.length>=2,"invalid renderbuffer shape"),Tr=$t[0]|0,Wr=$t[1]|0}else"radius"in qt&&(Tr=Wr=qt.radius|0),"width"in qt&&(Tr=qt.width|0),"height"in qt&&(Wr=qt.height|0);"format"in qt&&(le.parameter(qt.format,Ct,"invalid renderbuffer format"),Nn=Ct[qt.format])}else typeof kr=="number"?(Tr=kr|0,typeof or=="number"?Wr=or|0:Wr=Tr):kr?le.raise("invalid arguments to renderbuffer constructor"):Tr=Wr=1;if(le(Tr>0&&Wr>0&&Tr<=ke.maxRenderbufferSize&&Wr<=ke.maxRenderbufferSize,"invalid renderbuffer size"),!(Tr===tt.width&&Wr===tt.height&&Nn===tt.format))return Ft.width=tt.width=Tr,Ft.height=tt.height=Wr,tt.format=Nn,F.bindRenderbuffer(hu,tt.renderbuffer),F.renderbufferStorage(hu,Nn,Tr,Wr),le(F.getError()===0,"invalid render buffer format"),tr.profile&&(tt.stats.size=sc(tt.format,tt.width,tt.height)),Ft.format=Yt[tt.format],Ft}function mr(kr,or){var Tr=kr|0,Wr=or|0||Tr;return Tr===tt.width&&Wr===tt.height||(le(Tr>0&&Wr>0&&Tr<=ke.maxRenderbufferSize&&Wr<=ke.maxRenderbufferSize,"invalid renderbuffer size"),Ft.width=tt.width=Tr,Ft.height=tt.height=Wr,F.bindRenderbuffer(hu,tt.renderbuffer),F.renderbufferStorage(hu,tt.format,Tr,Wr),le(F.getError()===0,"invalid render buffer format"),tr.profile&&(tt.stats.size=sc(tt.format,tt.width,tt.height))),Ft}return Ft(vr,_r),Ft.resize=mr,Ft._reglType="renderbuffer",Ft._renderbuffer=tt,tr.profile&&(Ft.stats=tt.stats),Ft.destroy=function(){tt.decRef()},Ft}tr.profile&&(Tt.getTotalRenderbufferSize=function(){var vr=0;return Object.keys(pr).forEach(function(_r){vr+=pr[_r].stats.size}),vr});function zr(){K(pr).forEach(function(vr){vr.renderbuffer=F.createRenderbuffer(),F.bindRenderbuffer(hu,vr.renderbuffer),F.renderbufferStorage(hu,vr.format,vr.width,vr.height)}),F.bindRenderbuffer(hu,null)}return{create:Ar,clear:function(){K(pr).forEach(br)},restore:zr}},pu=36160,du=36161,Eo=3553,Xu=34069,vu=36064,Dl=36096,Yu=36128,uc=33306,Fc=36053,lc=36054,Fl=36055,jf=36057,hl=36061,pl=36193,Bs=5121,dl=5126,Go=6407,df=6408,Nl=6402,Nc=[Go,df],cc=[];cc[df]=4,cc[Go]=3;var l=[];l[Bs]=1,l[dl]=4,l[pl]=2;var f=32854,c=32855,d=36194,b=33189,w=36168,T=34041,R=35907,z=34836,j=34842,ne=34843,ae=[f,c,d,R,j,ne,z],oe={};oe[Fc]="complete",oe[lc]="incomplete attachment",oe[jf]="incomplete dimensions",oe[Fl]="incomplete, missing attachment",oe[hl]="unsupported";function Se(F,ue,ke,Tt,tr,Ct){var Yt={cur:null,next:null,dirty:!1,setFBO:null},sr=["rgba"],pr=["rgba4","rgb565","rgb5 a1"];ue.ext_srgb&&pr.push("srgba"),ue.ext_color_buffer_half_float&&pr.push("rgba16f","rgb16f"),ue.webgl_color_buffer_float&&pr.push("rgba32f");var gr=["uint8"];ue.oes_texture_half_float&&gr.push("half float","float16"),ue.oes_texture_float&&gr.push("float","float32");function br(yr,Xr,Yr){this.target=yr,this.texture=Xr,this.renderbuffer=Yr;var hi=0,Jn=0;Xr?(hi=Xr.width,Jn=Xr.height):Yr&&(hi=Yr.width,Jn=Yr.height),this.width=hi,this.height=Jn}function Ar(yr){yr&&(yr.texture&&yr.texture._texture.decRef(),yr.renderbuffer&&yr.renderbuffer._renderbuffer.decRef())}function zr(yr,Xr,Yr){if(!!yr)if(yr.texture){var hi=yr.texture._texture,Jn=Math.max(1,hi.width),Gr=Math.max(1,hi.height);le(Jn===Xr&&Gr===Yr,"inconsistent width/height for supplied texture"),hi.refCount+=1}else{var Qr=yr.renderbuffer._renderbuffer;le(Qr.width===Xr&&Qr.height===Yr,"inconsistent width/height for renderbuffer"),Qr.refCount+=1}}function vr(yr,Xr){Xr&&(Xr.texture?F.framebufferTexture2D(pu,yr,Xr.target,Xr.texture._texture.texture,0):F.framebufferRenderbuffer(pu,yr,du,Xr.renderbuffer._renderbuffer.renderbuffer))}function _r(yr){var Xr=Eo,Yr=null,hi=null,Jn=yr;typeof yr=="object"&&(Jn=yr.data,"target"in yr&&(Xr=yr.target|0)),le.type(Jn,"function","invalid attachment data");var Gr=Jn._reglType;return Gr==="texture2d"?(Yr=Jn,le(Xr===Eo)):Gr==="textureCube"?(Yr=Jn,le(Xr>=Xu&&Xr<Xu+6,"invalid cube map target")):Gr==="renderbuffer"?(hi=Jn,Xr=du):le.raise("invalid regl object for attachment"),new br(Xr,Yr,hi)}function tt(yr,Xr,Yr,hi,Jn){if(Yr){var Gr=Tt.create2D({width:yr,height:Xr,format:hi,type:Jn});return Gr._texture.refCount=0,new br(Eo,Gr,null)}else{var Qr=tr.create({width:yr,height:Xr,format:hi});return Qr._renderbuffer.refCount=0,new br(du,null,Qr)}}function Ft(yr){return yr&&(yr.texture||yr.renderbuffer)}function mr(yr,Xr,Yr){yr&&(yr.texture?yr.texture.resize(Xr,Yr):yr.renderbuffer&&yr.renderbuffer.resize(Xr,Yr),yr.width=Xr,yr.height=Yr)}var kr=0,or={};function Tr(){this.id=kr++,or[this.id]=this,this.framebuffer=F.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Wr(yr){yr.colorAttachments.forEach(Ar),Ar(yr.depthAttachment),Ar(yr.stencilAttachment),Ar(yr.depthStencilAttachment)}function Nn(yr){var Xr=yr.framebuffer;le(Xr,"must not double destroy framebuffer"),F.deleteFramebuffer(Xr),yr.framebuffer=null,Ct.framebufferCount--,delete or[yr.id]}function qt(yr){var Xr;F.bindFramebuffer(pu,yr.framebuffer);var Yr=yr.colorAttachments;for(Xr=0;Xr<Yr.length;++Xr)vr(vu+Xr,Yr[Xr]);for(Xr=Yr.length;Xr<ke.maxColorAttachments;++Xr)F.framebufferTexture2D(pu,vu+Xr,Eo,null,0);F.framebufferTexture2D(pu,uc,Eo,null,0),F.framebufferTexture2D(pu,Dl,Eo,null,0),F.framebufferTexture2D(pu,Yu,Eo,null,0),vr(Dl,yr.depthAttachment),vr(Yu,yr.stencilAttachment),vr(uc,yr.depthStencilAttachment);var hi=F.checkFramebufferStatus(pu);!F.isContextLost()&&hi!==Fc&&le.raise("framebuffer configuration not supported, status = "+oe[hi]),F.bindFramebuffer(pu,Yt.next?Yt.next.framebuffer:null),Yt.cur=Yt.next,F.getError()}function $t(yr,Xr){var Yr=new Tr;Ct.framebufferCount++;function hi(Gr,Qr){var Yn;le(Yt.next!==Yr,"can not update framebuffer which is currently in use");var oi=0,Li=0,Ya=!0,ro=!0,Pi=null,$o=!0,Za="rgba",Ho="uint8",Rn=1,kn=null,Co=null,bs=null,uo=!1;if(typeof Gr=="number")oi=Gr|0,Li=Qr|0||oi;else if(!Gr)oi=Li=1;else{le.type(Gr,"object","invalid arguments for framebuffer");var _i=Gr;if("shape"in _i){var Wo=_i.shape;le(Array.isArray(Wo)&&Wo.length>=2,"invalid shape for framebuffer"),oi=Wo[0],Li=Wo[1]}else"radius"in _i&&(oi=Li=_i.radius),"width"in _i&&(oi=_i.width),"height"in _i&&(Li=_i.height);("color"in _i||"colors"in _i)&&(Pi=_i.color||_i.colors,Array.isArray(Pi)&&le(Pi.length===1||ue.webgl_draw_buffers,"multiple render targets not supported")),Pi||("colorCount"in _i&&(Rn=_i.colorCount|0,le(Rn>0,"invalid color buffer count")),"colorTexture"in _i&&($o=!!_i.colorTexture,Za="rgba4"),"colorType"in _i&&(Ho=_i.colorType,$o?(le(ue.oes_texture_float||!(Ho==="float"||Ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),le(ue.oes_texture_half_float||!(Ho==="half float"||Ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ho==="half float"||Ho==="float16"?(le(ue.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Za="rgba16f"):(Ho==="float"||Ho==="float32")&&(le(ue.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Za="rgba32f"),le.oneOf(Ho,gr,"invalid color type")),"colorFormat"in _i&&(Za=_i.colorFormat,sr.indexOf(Za)>=0?$o=!0:pr.indexOf(Za)>=0?$o=!1:le.optional(function(){$o?le.oneOf(_i.colorFormat,sr,"invalid color format for texture"):le.oneOf(_i.colorFormat,pr,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(uo=!!(_i.depthTexture||_i.depthStencilTexture),le(!uo||ue.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?Ya=_i.depth:(kn=_i.depth,ro=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?ro=_i.stencil:(Co=_i.stencil,Ya=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?Ya=ro=_i.depthStencil:(bs=_i.depthStencil,Ya=!1,ro=!1))}var ia=null,ss=null,ei=null,Ni=null;if(Array.isArray(Pi))ia=Pi.map(_r);else if(Pi)ia=[_r(Pi)];else for(ia=new Array(Rn),Yn=0;Yn<Rn;++Yn)ia[Yn]=tt(oi,Li,$o,Za,Ho);le(ue.webgl_draw_buffers||ia.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),le(ia.length<=ke.maxColorAttachments,"too many color attachments, not supported"),oi=oi||ia[0].width,Li=Li||ia[0].height,kn?ss=_r(kn):Ya&&!ro&&(ss=tt(oi,Li,uo,"depth","uint32")),Co?ei=_r(Co):ro&&!Ya&&(ei=tt(oi,Li,!1,"stencil","uint8")),bs?Ni=_r(bs):!kn&&!Co&&ro&&Ya&&(Ni=tt(oi,Li,uo,"depth stencil","depth stencil")),le(!!kn+!!Co+!!bs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var va=null;for(Yn=0;Yn<ia.length;++Yn)if(zr(ia[Yn],oi,Li),le(!ia[Yn]||ia[Yn].texture&&Nc.indexOf(ia[Yn].texture._texture.format)>=0||ia[Yn].renderbuffer&&ae.indexOf(ia[Yn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Yn+" is invalid"),ia[Yn]&&ia[Yn].texture){var Ao=cc[ia[Yn].texture._texture.format]*l[ia[Yn].texture._texture.type];va===null?va=Ao:le(va===Ao,"all color attachments much have the same number of bits per pixel.")}return zr(ss,oi,Li),le(!ss||ss.texture&&ss.texture._texture.format===Nl||ss.renderbuffer&&ss.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),zr(ei,oi,Li),le(!ei||ei.renderbuffer&&ei.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),zr(Ni,oi,Li),le(!Ni||Ni.texture&&Ni.texture._texture.format===T||Ni.renderbuffer&&Ni.renderbuffer._renderbuffer.format===T,"invalid depth-stencil attachment for framebuffer object"),Wr(Yr),Yr.width=oi,Yr.height=Li,Yr.colorAttachments=ia,Yr.depthAttachment=ss,Yr.stencilAttachment=ei,Yr.depthStencilAttachment=Ni,hi.color=ia.map(Ft),hi.depth=Ft(ss),hi.stencil=Ft(ei),hi.depthStencil=Ft(Ni),hi.width=Yr.width,hi.height=Yr.height,qt(Yr),hi}function Jn(Gr,Qr){le(Yt.next!==Yr,"can not resize a framebuffer which is currently in use");var Yn=Math.max(Gr|0,1),oi=Math.max(Qr|0||Yn,1);if(Yn===Yr.width&&oi===Yr.height)return hi;for(var Li=Yr.colorAttachments,Ya=0;Ya<Li.length;++Ya)mr(Li[Ya],Yn,oi);return mr(Yr.depthAttachment,Yn,oi),mr(Yr.stencilAttachment,Yn,oi),mr(Yr.depthStencilAttachment,Yn,oi),Yr.width=hi.width=Yn,Yr.height=hi.height=oi,qt(Yr),hi}return hi(yr,Xr),m(hi,{resize:Jn,_reglType:"framebuffer",_framebuffer:Yr,destroy:function(){Nn(Yr),Wr(Yr)},use:function(Gr){Yt.setFBO({framebuffer:hi},Gr)}})}function mn(yr){var Xr=Array(6);function Yr(Jn){var Gr;le(Xr.indexOf(Yt.next)<0,"can not update framebuffer which is currently in use");var Qr={color:null},Yn=0,oi=null,Li="rgba",Ya="uint8",ro=1;if(typeof Jn=="number")Yn=Jn|0;else if(!Jn)Yn=1;else{le.type(Jn,"object","invalid arguments for framebuffer");var Pi=Jn;if("shape"in Pi){var $o=Pi.shape;le(Array.isArray($o)&&$o.length>=2,"invalid shape for framebuffer"),le($o[0]===$o[1],"cube framebuffer must be square"),Yn=$o[0]}else"radius"in Pi&&(Yn=Pi.radius|0),"width"in Pi?(Yn=Pi.width|0,"height"in Pi&&le(Pi.height===Yn,"must be square")):"height"in Pi&&(Yn=Pi.height|0);("color"in Pi||"colors"in Pi)&&(oi=Pi.color||Pi.colors,Array.isArray(oi)&&le(oi.length===1||ue.webgl_draw_buffers,"multiple render targets not supported")),oi||("colorCount"in Pi&&(ro=Pi.colorCount|0,le(ro>0,"invalid color buffer count")),"colorType"in Pi&&(le.oneOf(Pi.colorType,gr,"invalid color type"),Ya=Pi.colorType),"colorFormat"in Pi&&(Li=Pi.colorFormat,le.oneOf(Pi.colorFormat,sr,"invalid color format for texture"))),"depth"in Pi&&(Qr.depth=Pi.depth),"stencil"in Pi&&(Qr.stencil=Pi.stencil),"depthStencil"in Pi&&(Qr.depthStencil=Pi.depthStencil)}var Za;if(oi)if(Array.isArray(oi))for(Za=[],Gr=0;Gr<oi.length;++Gr)Za[Gr]=oi[Gr];else Za=[oi];else{Za=Array(ro);var Ho={radius:Yn,format:Li,type:Ya};for(Gr=0;Gr<ro;++Gr)Za[Gr]=Tt.createCube(Ho)}for(Qr.color=Array(Za.length),Gr=0;Gr<Za.length;++Gr){var Rn=Za[Gr];le(typeof Rn=="function"&&Rn._reglType==="textureCube","invalid cube map"),Yn=Yn||Rn.width,le(Rn.width===Yn&&Rn.height===Yn,"invalid cube map shape"),Qr.color[Gr]={target:Xu,data:Za[Gr]}}for(Gr=0;Gr<6;++Gr){for(var kn=0;kn<Za.length;++kn)Qr.color[kn].target=Xu+Gr;Gr>0&&(Qr.depth=Xr[0].depth,Qr.stencil=Xr[0].stencil,Qr.depthStencil=Xr[0].depthStencil),Xr[Gr]?Xr[Gr](Qr):Xr[Gr]=$t(Qr)}return m(Yr,{width:Yn,height:Yn,color:Za})}function hi(Jn){var Gr,Qr=Jn|0;if(le(Qr>0&&Qr<=ke.maxCubeMapSize,"invalid radius for cube fbo"),Qr===Yr.width)return Yr;var Yn=Yr.color;for(Gr=0;Gr<Yn.length;++Gr)Yn[Gr].resize(Qr);for(Gr=0;Gr<6;++Gr)Xr[Gr].resize(Qr);return Yr.width=Yr.height=Qr,Yr}return Yr(yr),m(Yr,{faces:Xr,resize:hi,_reglType:"framebufferCube",destroy:function(){Xr.forEach(function(Jn){Jn.destroy()})}})}function Ur(){Yt.cur=null,Yt.next=null,Yt.dirty=!0,K(or).forEach(function(yr){yr.framebuffer=F.createFramebuffer(),qt(yr)})}return m(Yt,{getFramebuffer:function(yr){if(typeof yr=="function"&&yr._reglType==="framebuffer"){var Xr=yr._framebuffer;if(Xr instanceof Tr)return Xr}return null},create:$t,createCube:mn,clear:function(){K(or).forEach(Nn)},restore:Ur})}var Me=5126,Ve=34962,be=34963,ze=["attributes","elements","offset","count","primitive","instances"];function Xe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Me,this.offset=0,this.stride=0,this.divisor=0}function ut(F,ue,ke,Tt,tr,Ct,Yt){for(var sr=ke.maxAttributes,pr=new Array(sr),gr=0;gr<sr;++gr)pr[gr]=new Xe;var br=0,Ar={},zr={Record:Xe,scope:{},state:pr,currentVAO:null,targetVAO:null,restore:_r()?Wr:function(){},createVAO:Nn,getVAO:Ft,destroyBuffer:vr,setVAO:_r()?mr:kr,clear:_r()?or:function(){}};function vr(qt){for(var $t=0;$t<pr.length;++$t){var mn=pr[$t];mn.buffer===qt&&(F.disableVertexAttribArray($t),mn.buffer=null)}}function _r(){return ue.oes_vertex_array_object}function tt(){return ue.angle_instanced_arrays}function Ft(qt){return typeof qt=="function"&&qt._vao?qt._vao:null}function mr(qt){if(qt!==zr.currentVAO){var $t=_r();qt?$t.bindVertexArrayOES(qt.vao):$t.bindVertexArrayOES(null),zr.currentVAO=qt}}function kr(qt){if(qt!==zr.currentVAO){if(qt)qt.bindAttrs();else{for(var $t=tt(),mn=0;mn<pr.length;++mn){var Ur=pr[mn];Ur.buffer?(F.enableVertexAttribArray(mn),Ur.buffer.bind(),F.vertexAttribPointer(mn,Ur.size,Ur.type,Ur.normalized,Ur.stride,Ur.offfset),$t&&Ur.divisor&&$t.vertexAttribDivisorANGLE(mn,Ur.divisor)):(F.disableVertexAttribArray(mn),F.vertexAttrib4f(mn,Ur.x,Ur.y,Ur.z,Ur.w))}Yt.elements?F.bindBuffer(be,Yt.elements.buffer.buffer):F.bindBuffer(be,null)}zr.currentVAO=qt}}function or(){K(Ar).forEach(function(qt){qt.destroy()})}function Tr(){this.id=++br,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var qt=_r();qt?this.vao=qt.createVertexArrayOES():this.vao=null,Ar[this.id]=this,this.buffers=[]}Tr.prototype.bindAttrs=function(){for(var qt=tt(),$t=this.attributes,mn=0;mn<$t.length;++mn){var Ur=$t[mn];Ur.buffer?(F.enableVertexAttribArray(mn),F.bindBuffer(Ve,Ur.buffer.buffer),F.vertexAttribPointer(mn,Ur.size,Ur.type,Ur.normalized,Ur.stride,Ur.offset),qt&&Ur.divisor&&qt.vertexAttribDivisorANGLE(mn,Ur.divisor)):(F.disableVertexAttribArray(mn),F.vertexAttrib4f(mn,Ur.x,Ur.y,Ur.z,Ur.w))}for(var yr=$t.length;yr<sr;++yr)F.disableVertexAttribArray(yr);var Xr=Ct.getElements(this.elements);Xr?F.bindBuffer(be,Xr.buffer.buffer):F.bindBuffer(be,null)},Tr.prototype.refresh=function(){var qt=_r();qt&&(qt.bindVertexArrayOES(this.vao),this.bindAttrs(),zr.currentVAO=null,qt.bindVertexArrayOES(null))},Tr.prototype.destroy=function(){if(this.vao){var qt=_r();this===zr.currentVAO&&(zr.currentVAO=null,qt.bindVertexArrayOES(null)),qt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ar[this.id]&&(delete Ar[this.id],Tt.vaoCount-=1)};function Wr(){var qt=_r();qt&&K(Ar).forEach(function($t){$t.refresh()})}function Nn(qt){var $t=new Tr;Tt.vaoCount+=1;function mn(Ur){var yr;if(Array.isArray(Ur))yr=Ur,$t.elements&&$t.ownsElements&&$t.elements.destroy(),$t.elements=null,$t.ownsElements=!1,$t.offset=0,$t.count=0,$t.instances=-1,$t.primitive=4;else{if(le(typeof Ur=="object","invalid arguments for create vao"),le("attributes"in Ur,"must specify attributes for vao"),Ur.elements){var Xr=Ur.elements;$t.ownsElements?typeof Xr=="function"&&Xr._reglType==="elements"?($t.elements.destroy(),$t.ownsElements=!1):($t.elements(Xr),$t.ownsElements=!1):Ct.getElements(Ur.elements)?($t.elements=Ur.elements,$t.ownsElements=!1):($t.elements=Ct.create(Ur.elements),$t.ownsElements=!0)}else $t.elements=null,$t.ownsElements=!1;yr=Ur.attributes,$t.offset=0,$t.count=-1,$t.instances=-1,$t.primitive=4,$t.elements&&($t.count=$t.elements._elements.vertCount,$t.primitive=$t.elements._elements.primType),"offset"in Ur&&($t.offset=Ur.offset|0),"count"in Ur&&($t.count=Ur.count|0),"instances"in Ur&&($t.instances=Ur.instances|0),"primitive"in Ur&&(le(Ur.primitive in er,"bad primitive type: "+Ur.primitive),$t.primitive=er[Ur.primitive]),le.optional(()=>{for(var Ya=Object.keys(Ur),ro=0;ro<Ya.length;++ro)le(ze.indexOf(Ya[ro])>=0,'invalid option for vao: "'+Ya[ro]+'" valid options are '+ze)}),le(Array.isArray(yr),"attributes must be an array")}le(yr.length<sr,"too many attributes"),le(yr.length>0,"must specify at least one attribute");var Yr={},hi=$t.attributes;hi.length=yr.length;for(var Jn=0;Jn<yr.length;++Jn){var Gr=yr[Jn],Qr=hi[Jn]=new Xe,Yn=Gr.data||Gr;if(Array.isArray(Yn)||me(Yn)||hs(Yn)){var oi;$t.buffers[Jn]&&(oi=$t.buffers[Jn],me(Yn)&&oi._buffer.byteLength>=Yn.byteLength?oi.subdata(Yn):(oi.destroy(),$t.buffers[Jn]=null)),$t.buffers[Jn]||(oi=$t.buffers[Jn]=tr.create(Gr,Ve,!1,!0)),Qr.buffer=tr.getBuffer(oi),Qr.size=Qr.buffer.dimension|0,Qr.normalized=!1,Qr.type=Qr.buffer.dtype,Qr.offset=0,Qr.stride=0,Qr.divisor=0,Qr.state=1,Yr[Jn]=1}else tr.getBuffer(Gr)?(Qr.buffer=tr.getBuffer(Gr),Qr.size=Qr.buffer.dimension|0,Qr.normalized=!1,Qr.type=Qr.buffer.dtype,Qr.offset=0,Qr.stride=0,Qr.divisor=0,Qr.state=1):tr.getBuffer(Gr.buffer)?(Qr.buffer=tr.getBuffer(Gr.buffer),Qr.size=(+Gr.size||Qr.buffer.dimension)|0,Qr.normalized=!!Gr.normalized||!1,"type"in Gr?(le.parameter(Gr.type,eu,"invalid buffer type"),Qr.type=eu[Gr.type]):Qr.type=Qr.buffer.dtype,Qr.offset=(Gr.offset||0)|0,Qr.stride=(Gr.stride||0)|0,Qr.divisor=(Gr.divisor||0)|0,Qr.state=1,le(Qr.size>=1&&Qr.size<=4,"size must be between 1 and 4"),le(Qr.offset>=0,"invalid offset"),le(Qr.stride>=0&&Qr.stride<=255,"stride must be between 0 and 255"),le(Qr.divisor>=0,"divisor must be positive"),le(!Qr.divisor||!!ue.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gr?(le(Jn>0,"first attribute must not be a constant"),Qr.x=+Gr.x||0,Qr.y=+Gr.y||0,Qr.z=+Gr.z||0,Qr.w=+Gr.w||0,Qr.state=2):le(!1,"invalid attribute spec for location "+Jn)}for(var Li=0;Li<$t.buffers.length;++Li)!Yr[Li]&&$t.buffers[Li]&&($t.buffers[Li].destroy(),$t.buffers[Li]=null);return $t.refresh(),mn}return mn.destroy=function(){for(var Ur=0;Ur<$t.buffers.length;++Ur)$t.buffers[Ur]&&$t.buffers[Ur].destroy();$t.buffers.length=0,$t.ownsElements&&($t.elements.destroy(),$t.elements=null,$t.ownsElements=!1),$t.destroy()},mn._vao=$t,mn._reglType="vao",mn(qt)}return zr}var Ut=35632,Ot=35633,Zt=35718,lr=35721;function Or(F,ue,ke,Tt){var tr={},Ct={};function Yt(tt,Ft,mr,kr){this.name=tt,this.id=Ft,this.location=mr,this.info=kr}function sr(tt,Ft){for(var mr=0;mr<tt.length;++mr)if(tt[mr].id===Ft.id){tt[mr].location=Ft.location;return}tt.push(Ft)}function pr(tt,Ft,mr){var kr=tt===Ut?tr:Ct,or=kr[Ft];if(!or){var Tr=ue.str(Ft);or=F.createShader(tt),F.shaderSource(or,Tr),F.compileShader(or),le.shaderError(F,or,Tr,tt,mr),kr[Ft]=or}return or}var gr={},br=[],Ar=0;function zr(tt,Ft){this.id=Ar++,this.fragId=tt,this.vertId=Ft,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Tt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function vr(tt,Ft,mr){var kr,or,Tr=pr(Ut,tt.fragId),Wr=pr(Ot,tt.vertId),Nn=tt.program=F.createProgram();if(F.attachShader(Nn,Tr),F.attachShader(Nn,Wr),mr)for(kr=0;kr<mr.length;++kr){var qt=mr[kr];F.bindAttribLocation(Nn,qt[0],qt[1])}F.linkProgram(Nn),le.linkError(F,Nn,ue.str(tt.fragId),ue.str(tt.vertId),Ft);var $t=F.getProgramParameter(Nn,Zt);Tt.profile&&(tt.stats.uniformsCount=$t);var mn=tt.uniforms;for(kr=0;kr<$t;++kr)if(or=F.getActiveUniform(Nn,kr),or)if(or.size>1)for(var Ur=0;Ur<or.size;++Ur){var yr=or.name.replace("[0]","["+Ur+"]");sr(mn,new Yt(yr,ue.id(yr),F.getUniformLocation(Nn,yr),or))}else sr(mn,new Yt(or.name,ue.id(or.name),F.getUniformLocation(Nn,or.name),or));var Xr=F.getProgramParameter(Nn,lr);Tt.profile&&(tt.stats.attributesCount=Xr);var Yr=tt.attributes;for(kr=0;kr<Xr;++kr)or=F.getActiveAttrib(Nn,kr),or&&sr(Yr,new Yt(or.name,ue.id(or.name),F.getAttribLocation(Nn,or.name),or))}Tt.profile&&(ke.getMaxUniformsCount=function(){var tt=0;return br.forEach(function(Ft){Ft.stats.uniformsCount>tt&&(tt=Ft.stats.uniformsCount)}),tt},ke.getMaxAttributesCount=function(){var tt=0;return br.forEach(function(Ft){Ft.stats.attributesCount>tt&&(tt=Ft.stats.attributesCount)}),tt});function _r(){tr={},Ct={};for(var tt=0;tt<br.length;++tt)vr(br[tt],null,br[tt].attributes.map(function(Ft){return[Ft.location,Ft.name]}))}return{clear:function(){var tt=F.deleteShader.bind(F);K(tr).forEach(tt),tr={},K(Ct).forEach(tt),Ct={},br.forEach(function(Ft){F.deleteProgram(Ft.program)}),br.length=0,gr={},ke.shaderCount=0},program:function(tt,Ft,mr,kr){le.command(tt>=0,"missing vertex shader",mr),le.command(Ft>=0,"missing fragment shader",mr);var or=gr[Ft];or||(or=gr[Ft]={});var Tr=or[tt];if(Tr&&(Tr.refCount++,!kr))return Tr;var Wr=new zr(Ft,tt);return ke.shaderCount++,vr(Wr,mr,kr),Tr||(or[tt]=Wr),br.push(Wr),m(Wr,{destroy:function(){if(Wr.refCount--,Wr.refCount<=0){F.deleteProgram(Wr.program);var Nn=br.indexOf(Wr);br.splice(Nn,1),ke.shaderCount--}or[Wr.vertId].refCount<=0&&(F.deleteShader(Ct[Wr.vertId]),delete Ct[Wr.vertId],delete gr[Wr.fragId][Wr.vertId]),Object.keys(gr[Wr.fragId]).length||(F.deleteShader(tr[Wr.fragId]),delete tr[Wr.fragId],delete gr[Wr.fragId])}})},restore:_r,shader:pr,frag:-1,vert:-1}}var Pr=6408,$r=5121,Ln=3333,Fn=5126;function zn(F,ue,ke,Tt,tr,Ct,Yt){function sr(br){var Ar;ue.next===null?(le(tr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ar=$r):(le(ue.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ar=ue.next.colorAttachments[0].texture._texture.type,le.optional(function(){Ct.oes_texture_float?(le(Ar===$r||Ar===Fn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ar===Fn&&le(Yt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):le(Ar===$r,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var zr=0,vr=0,_r=Tt.framebufferWidth,tt=Tt.framebufferHeight,Ft=null;me(br)?Ft=br:br&&(le.type(br,"object","invalid arguments to regl.read()"),zr=br.x|0,vr=br.y|0,le(zr>=0&&zr<Tt.framebufferWidth,"invalid x offset for regl.read"),le(vr>=0&&vr<Tt.framebufferHeight,"invalid y offset for regl.read"),_r=(br.width||Tt.framebufferWidth-zr)|0,tt=(br.height||Tt.framebufferHeight-vr)|0,Ft=br.data||null),Ft&&(Ar===$r?le(Ft instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ar===Fn&&le(Ft instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),le(_r>0&&_r+zr<=Tt.framebufferWidth,"invalid width for read pixels"),le(tt>0&&tt+vr<=Tt.framebufferHeight,"invalid height for read pixels"),ke();var mr=_r*tt*4;return Ft||(Ar===$r?Ft=new Uint8Array(mr):Ar===Fn&&(Ft=Ft||new Float32Array(mr))),le.isTypedArray(Ft,"data buffer for regl.read() must be a typedarray"),le(Ft.byteLength>=mr,"data buffer for regl.read() too small"),F.pixelStorei(Ln,4),F.readPixels(zr,vr,_r,tt,Pr,Ar,Ft),Ft}function pr(br){var Ar;return ue.setFBO({framebuffer:br.framebuffer},function(){Ar=sr(br)}),Ar}function gr(br){return!br||!("framebuffer"in br)?sr(br):pr(br)}return gr}function ui(F){return Array.prototype.slice.call(F)}function rn(F){return ui(F).join("")}function ti(){var F=0,ue=[],ke=[];function Tt(Ar){for(var zr=0;zr<ke.length;++zr)if(ke[zr]===Ar)return ue[zr];var vr="g"+F++;return ue.push(vr),ke.push(Ar),vr}function tr(){var Ar=[];function zr(){Ar.push.apply(Ar,ui(arguments))}var vr=[];function _r(){var tt="v"+F++;return vr.push(tt),arguments.length>0&&(Ar.push(tt,"="),Ar.push.apply(Ar,ui(arguments)),Ar.push(";")),tt}return m(zr,{def:_r,toString:function(){return rn([vr.length>0?"var "+vr.join(",")+";":"",rn(Ar)])}})}function Ct(){var Ar=tr(),zr=tr(),vr=Ar.toString,_r=zr.toString;function tt(Ft,mr){zr(Ft,mr,"=",Ar.def(Ft,mr),";")}return m(function(){Ar.apply(Ar,ui(arguments))},{def:Ar.def,entry:Ar,exit:zr,save:tt,set:function(Ft,mr,kr){tt(Ft,mr),Ar(Ft,mr,"=",kr,";")},toString:function(){return vr()+_r()}})}function Yt(){var Ar=rn(arguments),zr=Ct(),vr=Ct(),_r=zr.toString,tt=vr.toString;return m(zr,{then:function(){return zr.apply(zr,ui(arguments)),this},else:function(){return vr.apply(vr,ui(arguments)),this},toString:function(){var Ft=tt();return Ft&&(Ft="else{"+Ft+"}"),rn(["if(",Ar,"){",_r(),"}",Ft])}})}var sr=tr(),pr={};function gr(Ar,zr){var vr=[];function _r(){var or="a"+vr.length;return vr.push(or),or}zr=zr||0;for(var tt=0;tt<zr;++tt)_r();var Ft=Ct(),mr=Ft.toString,kr=pr[Ar]=m(Ft,{arg:_r,toString:function(){return rn(["function(",vr.join(),"){",mr(),"}"])}});return kr}function br(){var Ar=['"use strict";',sr,"return {"];Object.keys(pr).forEach(function(tt){Ar.push('"',tt,'":',pr[tt].toString(),",")}),Ar.push("}");var zr=rn(Ar).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",_r=vr?Pe.Function.apply(null,ue.concat(zr)):Function.apply(null,ue.concat(zr));return _r.apply(null,ke)}return{global:sr,link:Tt,block:tr,proc:gr,scope:Ct,cond:Yt,compile:br}}var ai="xyzw".split(""),$n=5121,Gn=1,fi=2,Xn=0,Zn=1,xa=2,Xa=3,No=4,So=5,Ua=6,to="dither",xs="blend.enable",is="blend.color",ku="blend.equation",as="blend.func",qs="depth.enable",Ks="depth.func",fc="depth.range",Bl="depth.mask",mu="colorMask",vl="cull.enable",hc="cull.face",ou="frontFace",zl="lineWidth",gu="polygonOffset.enable",go="polygonOffset.offset",yu="sample.alpha",qu="sample.enable",Du="sample.coverage",Xi="stencil.enable",zs="stencil.mask",os="stencil.func",Ku="stencil.opFront",Bc="stencil.opBack",zc="scissor.enable",vf="scissor.box",Ko="viewport",pc="profile",su="framebuffer",ml="vert",Uc="frag",uu="elements",wo="primitive",Zc="count",Gf="offset",Hf="instances",mf="vao",qh="Width",Kh="Height",dc=su+qh,gf=su+Kh,Ch=Ko+qh,_d=Ko+Kh,Rr="drawingBuffer",yf=Rr+qh,Gt=Rr+Kh,xd=[as,ku,os,Ku,Bc,Du,Ko,vf,go],_f=34962,Ah=34963,zp=35632,Up=35633,Zp=3553,Th=34067,Wf=2884,xf=3042,bd=3024,yo=2960,Xf=2929,$h=3089,Yf=32823,qf=32926,Kf=32928,$f=5126,bf=35664,gl=35665,Ef=35666,Qf=5124,Mh=35667,vc=35668,Ph=35669,Jf=35670,Ih=35671,Vc=35672,Sf=35673,Us=35674,eh=35675,Oh=35676,th=35678,wf=35680,rh=4,yl=1028,mc=1029,Qh=2304,Rh=2305,Vp=32775,Ed=32776,jp=519,Is=7680,Gp=0,Ca=1,_u=32774,$u=513,Hp=36160,Wp=36064,_l={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},jc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Gc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Qu={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Xp={frag:zp,vert:Up},Jh={cw:Qh,ccw:Rh};function xu(F){return Array.isArray(F)||me(F)||hs(F)}function Hc(F){return F.sort(function(ue,ke){return ue===Ko?-1:ke===Ko?1:ue<ke?-1:1})}function qi(F,ue,ke,Tt){this.thisDep=F,this.contextDep=ue,this.propDep=ke,this.append=Tt}function gc(F){return F&&!(F.thisDep||F.contextDep||F.propDep)}function so(F){return new qi(!1,!1,!1,F)}function Os(F,ue){var ke=F.type;if(ke===Xn){var Tt=F.data.length;return new qi(!0,Tt>=1,Tt>=2,ue)}else if(ke===No){var tr=F.data;return new qi(tr.thisDep,tr.contextDep,tr.propDep,ue)}else{if(ke===So)return new qi(!1,!1,!1,ue);if(ke===Ua){for(var Ct=!1,Yt=!1,sr=!1,pr=0;pr<F.data.length;++pr){var gr=F.data[pr];if(gr.type===Zn)sr=!0;else if(gr.type===xa)Yt=!0;else if(gr.type===Xa)Ct=!0;else if(gr.type===Xn){Ct=!0;var br=gr.data;br>=1&&(Yt=!0),br>=2&&(sr=!0)}else gr.type===No&&(Ct=Ct||gr.data.thisDep,Yt=Yt||gr.data.contextDep,sr=sr||gr.data.propDep)}return new qi(Ct,Yt,sr,ue)}else return new qi(ke===Xa,ke===xa,ke===Zn,ue)}}var Lh=new qi(!1,!1,!1,function(){});function ep(F,ue,ke,Tt,tr,Ct,Yt,sr,pr,gr,br,Ar,zr,vr,_r){var tt=gr.Record,Ft={add:32774,subtract:32778,"reverse subtract":32779};ke.ext_blend_minmax&&(Ft.min=Vp,Ft.max=Ed);var mr=ke.angle_instanced_arrays,kr=ke.webgl_draw_buffers,or=ke.oes_vertex_array_object,Tr={dirty:!0,profile:_r.profile},Wr={},Nn=[],qt={},$t={};function mn(_e){return _e.replace(".","_")}function Ur(_e,re,Ue){var rt=mn(_e);Nn.push(_e),Wr[rt]=Tr[rt]=!!Ue,qt[rt]=re}function yr(_e,re,Ue){var rt=mn(_e);Nn.push(_e),Array.isArray(Ue)?(Tr[rt]=Ue.slice(),Wr[rt]=Ue.slice()):Tr[rt]=Wr[rt]=Ue,$t[rt]=re}Ur(to,bd),Ur(xs,xf),yr(is,"blendColor",[0,0,0,0]),yr(ku,"blendEquationSeparate",[_u,_u]),yr(as,"blendFuncSeparate",[Ca,Gp,Ca,Gp]),Ur(qs,Xf,!0),yr(Ks,"depthFunc",$u),yr(fc,"depthRange",[0,1]),yr(Bl,"depthMask",!0),yr(mu,mu,[!0,!0,!0,!0]),Ur(vl,Wf),yr(hc,"cullFace",mc),yr(ou,ou,Rh),yr(zl,zl,1),Ur(gu,Yf),yr(go,"polygonOffset",[0,0]),Ur(yu,qf),Ur(qu,Kf),yr(Du,"sampleCoverage",[1,!1]),Ur(Xi,yo),yr(zs,"stencilMask",-1),yr(os,"stencilFunc",[jp,0,-1]),yr(Ku,"stencilOpSeparate",[yl,Is,Is,Is]),yr(Bc,"stencilOpSeparate",[mc,Is,Is,Is]),Ur(zc,$h),yr(vf,"scissor",[0,0,F.drawingBufferWidth,F.drawingBufferHeight]),yr(Ko,Ko,[0,0,F.drawingBufferWidth,F.drawingBufferHeight]);var Xr={gl:F,context:zr,strings:ue,next:Wr,current:Tr,draw:Ar,elements:Ct,buffer:tr,shader:br,attributes:gr.state,vao:gr,uniforms:pr,framebuffer:sr,extensions:ke,timer:vr,isBufferArgs:xu},Yr={primTypes:er,compareFuncs:Gc,blendFuncs:_l,blendEquations:Ft,stencilOps:Qu,glTypes:eu,orientationType:Jh};le.optional(function(){Xr.isArrayLike=ao}),kr&&(Yr.backBuffer=[mc],Yr.drawBuffer=Ze(Tt.maxDrawbuffers,function(_e){return _e===0?[0]:Ze(_e,function(re){return Wp+re})}));var hi=0;function Jn(){var _e=ti(),re=_e.link,Ue=_e.global;_e.id=hi++,_e.batchId="0";var rt=re(Xr),St=_e.shared={props:"a0"};Object.keys(Xr).forEach(function(Be){St[Be]=Ue.def(rt,".",Be)}),le.optional(function(){_e.CHECK=re(le),_e.commandStr=le.guessCommand(),_e.command=re(_e.commandStr),_e.assert=function(Be,xe,nt){Be("if(!(",xe,"))",this.CHECK,".commandRaise(",re(nt),",",this.command,");")},Yr.invalidBlendCombinations=jc});var We=_e.next={},Le=_e.current={};Object.keys($t).forEach(function(Be){Array.isArray(Tr[Be])&&(We[Be]=Ue.def(St.next,".",Be),Le[Be]=Ue.def(St.current,".",Be))});var $e=_e.constants={};Object.keys(Yr).forEach(function(Be){$e[Be]=Ue.def(JSON.stringify(Yr[Be]))}),_e.invoke=function(Be,xe){switch(xe.type){case Xn:var nt=["this",St.context,St.props,_e.batchId];return Be.def(re(xe.data),".call(",nt.slice(0,Math.max(xe.data.length+1,4)),")");case Zn:return Be.def(St.props,xe.data);case xa:return Be.def(St.context,xe.data);case Xa:return Be.def("this",xe.data);case No:return xe.data.append(_e,Be),xe.data.ref;case So:return xe.data.toString();case Ua:return xe.data.map(function(mt){return _e.invoke(Be,mt)})}},_e.attribCache={};var pe={};return _e.scopeAttrib=function(Be){var xe=ue.id(Be);if(xe in pe)return pe[xe];var nt=gr.scope[xe];nt||(nt=gr.scope[xe]=new tt);var mt=pe[xe]=re(nt);return mt},_e}function Gr(_e){var re=_e.static,Ue=_e.dynamic,rt;if(pc in re){var St=!!re[pc];rt=so(function(Le,$e){return St}),rt.enable=St}else if(pc in Ue){var We=Ue[pc];rt=Os(We,function(Le,$e){return Le.invoke($e,We)})}return rt}function Qr(_e,re){var Ue=_e.static,rt=_e.dynamic;if(su in Ue){var St=Ue[su];return St?(St=sr.getFramebuffer(St),le.command(St,"invalid framebuffer object"),so(function(Le,$e){var pe=Le.link(St),Be=Le.shared;$e.set(Be.framebuffer,".next",pe);var xe=Be.context;return $e.set(xe,"."+dc,pe+".width"),$e.set(xe,"."+gf,pe+".height"),pe})):so(function(Le,$e){var pe=Le.shared;$e.set(pe.framebuffer,".next","null");var Be=pe.context;return $e.set(Be,"."+dc,Be+"."+yf),$e.set(Be,"."+gf,Be+"."+Gt),"null"})}else if(su in rt){var We=rt[su];return Os(We,function(Le,$e){var pe=Le.invoke($e,We),Be=Le.shared,xe=Be.framebuffer,nt=$e.def(xe,".getFramebuffer(",pe,")");le.optional(function(){Le.assert($e,"!"+pe+"||"+nt,"invalid framebuffer object")}),$e.set(xe,".next",nt);var mt=Be.context;return $e.set(mt,"."+dc,nt+"?"+nt+".width:"+mt+"."+yf),$e.set(mt,"."+gf,nt+"?"+nt+".height:"+mt+"."+Gt),nt})}else return null}function Yn(_e,re,Ue){var rt=_e.static,St=_e.dynamic;function We(pe){if(pe in rt){var Be=rt[pe];le.commandType(Be,"object","invalid "+pe,Ue.commandStr);var xe=!0,nt=Be.x|0,mt=Be.y|0,cr,Fr;return"width"in Be?(cr=Be.width|0,le.command(cr>=0,"invalid "+pe,Ue.commandStr)):xe=!1,"height"in Be?(Fr=Be.height|0,le.command(Fr>=0,"invalid "+pe,Ue.commandStr)):xe=!1,new qi(!xe&&re&&re.thisDep,!xe&&re&&re.contextDep,!xe&&re&&re.propDep,function(Lr,bn){var an=Lr.shared.context,yn=cr;"width"in Be||(yn=bn.def(an,".",dc,"-",nt));var gn=Fr;return"height"in Be||(gn=bn.def(an,".",gf,"-",mt)),[nt,mt,yn,gn]})}else if(pe in St){var Nr=St[pe],tn=Os(Nr,function(Lr,bn){var an=Lr.invoke(bn,Nr);le.optional(function(){Lr.assert(bn,an+"&&typeof "+an+'==="object"',"invalid "+pe)});var yn=Lr.shared.context,gn=bn.def(an,".x|0"),hn=bn.def(an,".y|0"),qn=bn.def('"width" in ',an,"?",an,".width|0:","(",yn,".",dc,"-",gn,")"),fa=bn.def('"height" in ',an,"?",an,".height|0:","(",yn,".",gf,"-",hn,")");return le.optional(function(){Lr.assert(bn,qn+">=0&&"+fa+">=0","invalid "+pe)}),[gn,hn,qn,fa]});return re&&(tn.thisDep=tn.thisDep||re.thisDep,tn.contextDep=tn.contextDep||re.contextDep,tn.propDep=tn.propDep||re.propDep),tn}else return re?new qi(re.thisDep,re.contextDep,re.propDep,function(Lr,bn){var an=Lr.shared.context;return[0,0,bn.def(an,".",dc),bn.def(an,".",gf)]}):null}var Le=We(Ko);if(Le){var $e=Le;Le=new qi(Le.thisDep,Le.contextDep,Le.propDep,function(pe,Be){var xe=$e.append(pe,Be),nt=pe.shared.context;return Be.set(nt,"."+Ch,xe[2]),Be.set(nt,"."+_d,xe[3]),xe})}return{viewport:Le,scissor_box:We(vf)}}function oi(_e,re){var Ue=_e.static,rt=typeof Ue[Uc]=="string"&&typeof Ue[ml]=="string";if(rt){if(Object.keys(re.dynamic).length>0)return null;var St=re.static,We=Object.keys(St);if(We.length>0&&typeof St[We[0]]=="number"){for(var Le=[],$e=0;$e<We.length;++$e)le(typeof St[We[$e]]=="number","must specify all vertex attribute locations when using vaos"),Le.push([St[We[$e]]|0,We[$e]]);return Le}}return null}function Li(_e,re,Ue){var rt=_e.static,St=_e.dynamic;function We(xe){if(xe in rt){var nt=ue.id(rt[xe]);le.optional(function(){br.shader(Xp[xe],nt,le.guessCommand())});var mt=so(function(){return nt});return mt.id=nt,mt}else if(xe in St){var cr=St[xe];return Os(cr,function(Fr,Nr){var tn=Fr.invoke(Nr,cr),Lr=Nr.def(Fr.shared.strings,".id(",tn,")");return le.optional(function(){Nr(Fr.shared.shader,".shader(",Xp[xe],",",Lr,",",Fr.command,");")}),Lr})}return null}var Le=We(Uc),$e=We(ml),pe=null,Be;return gc(Le)&&gc($e)?(pe=br.program($e.id,Le.id,null,Ue),Be=so(function(xe,nt){return xe.link(pe)})):Be=new qi(Le&&Le.thisDep||$e&&$e.thisDep,Le&&Le.contextDep||$e&&$e.contextDep,Le&&Le.propDep||$e&&$e.propDep,function(xe,nt){var mt=xe.shared.shader,cr;Le?cr=Le.append(xe,nt):cr=nt.def(mt,".",Uc);var Fr;$e?Fr=$e.append(xe,nt):Fr=nt.def(mt,".",ml);var Nr=mt+".program("+Fr+","+cr;return le.optional(function(){Nr+=","+xe.command}),nt.def(Nr+")")}),{frag:Le,vert:$e,progVar:Be,program:pe}}function Ya(_e,re){var Ue=_e.static,rt=_e.dynamic,St={},We=!1;function Le(){if(mf in Ue){var bn=Ue[mf];return bn!==null&&gr.getVAO(bn)===null&&(bn=gr.createVAO(bn)),We=!0,St.vao=bn,so(function(yn){var gn=gr.getVAO(bn);return gn?yn.link(gn):"null"})}else if(mf in rt){We=!0;var an=rt[mf];return Os(an,function(yn,gn){var hn=yn.invoke(gn,an);return gn.def(yn.shared.vao+".getVAO("+hn+")")})}return null}var $e=Le(),pe=!1;function Be(){if(uu in Ue){var bn=Ue[uu];if(St.elements=bn,xu(bn)){var an=St.elements=Ct.create(bn,!0);bn=Ct.getElements(an),pe=!0}else bn&&(bn=Ct.getElements(bn),pe=!0,le.command(bn,"invalid elements",re.commandStr));var yn=so(function(hn,qn){if(bn){var fa=hn.link(bn);return hn.ELEMENTS=fa,fa}return hn.ELEMENTS=null,null});return yn.value=bn,yn}else if(uu in rt){pe=!0;var gn=rt[uu];return Os(gn,function(hn,qn){var fa=hn.shared,Qo=fa.isBufferArgs,Ia=fa.elements,sa=hn.invoke(qn,gn),Rs=qn.def("null"),To=qn.def(Qo,"(",sa,")"),Fu=hn.cond(To).then(Rs,"=",Ia,".createStream(",sa,");").else(Rs,"=",Ia,".getElements(",sa,");");return le.optional(function(){hn.assert(Fu.else,"!"+sa+"||"+Rs,"invalid elements")}),qn.entry(Fu),qn.exit(hn.cond(To).then(Ia,".destroyStream(",Rs,");")),hn.ELEMENTS=Rs,Rs})}else if(We)return new qi($e.thisDep,$e.contextDep,$e.propDep,function(hn,qn){return qn.def(hn.shared.vao+".currentVAO?"+hn.shared.elements+".getElements("+hn.shared.vao+".currentVAO.elements):null")});return null}var xe=Be();function nt(){if(wo in Ue){var bn=Ue[wo];return St.primitive=bn,le.commandParameter(bn,er,"invalid primitve",re.commandStr),so(function(yn,gn){return er[bn]})}else if(wo in rt){var an=rt[wo];return Os(an,function(yn,gn){var hn=yn.constants.primTypes,qn=yn.invoke(gn,an);return le.optional(function(){yn.assert(gn,qn+" in "+hn,"invalid primitive, must be one of "+Object.keys(er))}),gn.def(hn,"[",qn,"]")})}else{if(pe)return gc(xe)?xe.value?so(function(yn,gn){return gn.def(yn.ELEMENTS,".primType")}):so(function(){return rh}):new qi(xe.thisDep,xe.contextDep,xe.propDep,function(yn,gn){var hn=yn.ELEMENTS;return gn.def(hn,"?",hn,".primType:",rh)});if(We)return new qi($e.thisDep,$e.contextDep,$e.propDep,function(yn,gn){return gn.def(yn.shared.vao+".currentVAO?"+yn.shared.vao+".currentVAO.primitive:"+rh)})}return null}function mt(bn,an){if(bn in Ue){var yn=Ue[bn]|0;return an?St.offset=yn:St.instances=yn,le.command(!an||yn>=0,"invalid "+bn,re.commandStr),so(function(hn,qn){return an&&(hn.OFFSET=yn),yn})}else if(bn in rt){var gn=rt[bn];return Os(gn,function(hn,qn){var fa=hn.invoke(qn,gn);return an&&(hn.OFFSET=fa,le.optional(function(){hn.assert(qn,fa+">=0","invalid "+bn)})),fa})}else if(an){if(pe)return so(function(hn,qn){return hn.OFFSET=0,0});if(We)return new qi($e.thisDep,$e.contextDep,$e.propDep,function(hn,qn){return qn.def(hn.shared.vao+".currentVAO?"+hn.shared.vao+".currentVAO.offset:0")})}else if(We)return new qi($e.thisDep,$e.contextDep,$e.propDep,function(hn,qn){return qn.def(hn.shared.vao+".currentVAO?"+hn.shared.vao+".currentVAO.instances:-1")});return null}var cr=mt(Gf,!0);function Fr(){if(Zc in Ue){var bn=Ue[Zc]|0;return St.count=bn,le.command(typeof bn=="number"&&bn>=0,"invalid vertex count",re.commandStr),so(function(){return bn})}else if(Zc in rt){var an=rt[Zc];return Os(an,function(qn,fa){var Qo=qn.invoke(fa,an);return le.optional(function(){qn.assert(fa,"typeof "+Qo+'==="number"&&'+Qo+">=0&&"+Qo+"===("+Qo+"|0)","invalid vertex count")}),Qo})}else if(pe)if(gc(xe)){if(xe)return cr?new qi(cr.thisDep,cr.contextDep,cr.propDep,function(qn,fa){var Qo=fa.def(qn.ELEMENTS,".vertCount-",qn.OFFSET);return le.optional(function(){qn.assert(fa,Qo+">=0","invalid vertex offset/element buffer too small")}),Qo}):so(function(qn,fa){return fa.def(qn.ELEMENTS,".vertCount")});var yn=so(function(){return-1});return le.optional(function(){yn.MISSING=!0}),yn}else{var gn=new qi(xe.thisDep||cr.thisDep,xe.contextDep||cr.contextDep,xe.propDep||cr.propDep,function(qn,fa){var Qo=qn.ELEMENTS;return qn.OFFSET?fa.def(Qo,"?",Qo,".vertCount-",qn.OFFSET,":-1"):fa.def(Qo,"?",Qo,".vertCount:-1")});return le.optional(function(){gn.DYNAMIC=!0}),gn}else if(We){var hn=new qi($e.thisDep,$e.contextDep,$e.propDep,function(qn,fa){return fa.def(qn.shared.vao,".currentVAO?",qn.shared.vao,".currentVAO.count:-1")});return hn}return null}var Nr=nt(),tn=Fr(),Lr=mt(Hf,!1);return{elements:xe,primitive:Nr,count:tn,instances:Lr,offset:cr,vao:$e,vaoActive:We,elementsActive:pe,static:St}}function ro(_e,re){var Ue=_e.static,rt=_e.dynamic,St={};return Nn.forEach(function(We){var Le=mn(We);function $e(pe,Be){if(We in Ue){var xe=pe(Ue[We]);St[Le]=so(function(){return xe})}else if(We in rt){var nt=rt[We];St[Le]=Os(nt,function(mt,cr){return Be(mt,cr,mt.invoke(cr,nt))})}}switch(We){case vl:case xs:case to:case Xi:case qs:case zc:case gu:case yu:case qu:case Bl:return $e(function(pe){return le.commandType(pe,"boolean",We,re.commandStr),pe},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,"typeof "+xe+'==="boolean"',"invalid flag "+We,pe.commandStr)}),xe});case Ks:return $e(function(pe){return le.commandParameter(pe,Gc,"invalid "+We,re.commandStr),Gc[pe]},function(pe,Be,xe){var nt=pe.constants.compareFuncs;return le.optional(function(){pe.assert(Be,xe+" in "+nt,"invalid "+We+", must be one of "+Object.keys(Gc))}),Be.def(nt,"[",xe,"]")});case fc:return $e(function(pe){return le.command(ao(pe)&&pe.length===2&&typeof pe[0]=="number"&&typeof pe[1]=="number"&&pe[0]<=pe[1],"depth range is 2d array",re.commandStr),pe},function(pe,Be,xe){le.optional(function(){pe.assert(Be,pe.shared.isArrayLike+"("+xe+")&&"+xe+".length===2&&typeof "+xe+'[0]==="number"&&typeof '+xe+'[1]==="number"&&'+xe+"[0]<="+xe+"[1]","depth range must be a 2d array")});var nt=Be.def("+",xe,"[0]"),mt=Be.def("+",xe,"[1]");return[nt,mt]});case as:return $e(function(pe){le.commandType(pe,"object","blend.func",re.commandStr);var Be="srcRGB"in pe?pe.srcRGB:pe.src,xe="srcAlpha"in pe?pe.srcAlpha:pe.src,nt="dstRGB"in pe?pe.dstRGB:pe.dst,mt="dstAlpha"in pe?pe.dstAlpha:pe.dst;return le.commandParameter(Be,_l,Le+".srcRGB",re.commandStr),le.commandParameter(xe,_l,Le+".srcAlpha",re.commandStr),le.commandParameter(nt,_l,Le+".dstRGB",re.commandStr),le.commandParameter(mt,_l,Le+".dstAlpha",re.commandStr),le.command(jc.indexOf(Be+", "+nt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Be+", "+nt+")",re.commandStr),[_l[Be],_l[nt],_l[xe],_l[mt]]},function(pe,Be,xe){var nt=pe.constants.blendFuncs;le.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid blend func, must be an object")});function mt(an,yn){var gn=Be.def('"',an,yn,'" in ',xe,"?",xe,".",an,yn,":",xe,".",an);return le.optional(function(){pe.assert(Be,gn+" in "+nt,"invalid "+We+"."+an+yn+", must be one of "+Object.keys(_l))}),gn}var cr=mt("src","RGB"),Fr=mt("dst","RGB");le.optional(function(){var an=pe.constants.invalidBlendCombinations;pe.assert(Be,an+".indexOf("+cr+'+", "+'+Fr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nr=Be.def(nt,"[",cr,"]"),tn=Be.def(nt,"[",mt("src","Alpha"),"]"),Lr=Be.def(nt,"[",Fr,"]"),bn=Be.def(nt,"[",mt("dst","Alpha"),"]");return[Nr,Lr,tn,bn]});case ku:return $e(function(pe){if(typeof pe=="string")return le.commandParameter(pe,Ft,"invalid "+We,re.commandStr),[Ft[pe],Ft[pe]];if(typeof pe=="object")return le.commandParameter(pe.rgb,Ft,We+".rgb",re.commandStr),le.commandParameter(pe.alpha,Ft,We+".alpha",re.commandStr),[Ft[pe.rgb],Ft[pe.alpha]];le.commandRaise("invalid blend.equation",re.commandStr)},function(pe,Be,xe){var nt=pe.constants.blendEquations,mt=Be.def(),cr=Be.def(),Fr=pe.cond("typeof ",xe,'==="string"');return le.optional(function(){function Nr(tn,Lr,bn){pe.assert(tn,bn+" in "+nt,"invalid "+Lr+", must be one of "+Object.keys(Ft))}Nr(Fr.then,We,xe),pe.assert(Fr.else,xe+"&&typeof "+xe+'==="object"',"invalid "+We),Nr(Fr.else,We+".rgb",xe+".rgb"),Nr(Fr.else,We+".alpha",xe+".alpha")}),Fr.then(mt,"=",cr,"=",nt,"[",xe,"];"),Fr.else(mt,"=",nt,"[",xe,".rgb];",cr,"=",nt,"[",xe,".alpha];"),Be(Fr),[mt,cr]});case is:return $e(function(pe){return le.command(ao(pe)&&pe.length===4,"blend.color must be a 4d array",re.commandStr),Ze(4,function(Be){return+pe[Be]})},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,pe.shared.isArrayLike+"("+xe+")&&"+xe+".length===4","blend.color must be a 4d array")}),Ze(4,function(nt){return Be.def("+",xe,"[",nt,"]")})});case zs:return $e(function(pe){return le.commandType(pe,"number",Le,re.commandStr),pe|0},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,"typeof "+xe+'==="number"',"invalid stencil.mask")}),Be.def(xe,"|0")});case os:return $e(function(pe){le.commandType(pe,"object",Le,re.commandStr);var Be=pe.cmp||"keep",xe=pe.ref||0,nt="mask"in pe?pe.mask:-1;return le.commandParameter(Be,Gc,We+".cmp",re.commandStr),le.commandType(xe,"number",We+".ref",re.commandStr),le.commandType(nt,"number",We+".mask",re.commandStr),[Gc[Be],xe,nt]},function(pe,Be,xe){var nt=pe.constants.compareFuncs;le.optional(function(){function Nr(){pe.assert(Be,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nr(xe+"&&typeof ",xe,'==="object"'),Nr('!("cmp" in ',xe,")||(",xe,".cmp in ",nt,")")});var mt=Be.def('"cmp" in ',xe,"?",nt,"[",xe,".cmp]",":",Is),cr=Be.def(xe,".ref|0"),Fr=Be.def('"mask" in ',xe,"?",xe,".mask|0:-1");return[mt,cr,Fr]});case Ku:case Bc:return $e(function(pe){le.commandType(pe,"object",Le,re.commandStr);var Be=pe.fail||"keep",xe=pe.zfail||"keep",nt=pe.zpass||"keep";return le.commandParameter(Be,Qu,We+".fail",re.commandStr),le.commandParameter(xe,Qu,We+".zfail",re.commandStr),le.commandParameter(nt,Qu,We+".zpass",re.commandStr),[We===Bc?mc:yl,Qu[Be],Qu[xe],Qu[nt]]},function(pe,Be,xe){var nt=pe.constants.stencilOps;le.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid "+We)});function mt(cr){return le.optional(function(){pe.assert(Be,'!("'+cr+'" in '+xe+")||("+xe+"."+cr+" in "+nt+")","invalid "+We+"."+cr+", must be one of "+Object.keys(Qu))}),Be.def('"',cr,'" in ',xe,"?",nt,"[",xe,".",cr,"]:",Is)}return[We===Bc?mc:yl,mt("fail"),mt("zfail"),mt("zpass")]});case go:return $e(function(pe){le.commandType(pe,"object",Le,re.commandStr);var Be=pe.factor|0,xe=pe.units|0;return le.commandType(Be,"number",Le+".factor",re.commandStr),le.commandType(xe,"number",Le+".units",re.commandStr),[Be,xe]},function(pe,Be,xe){le.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid "+We)});var nt=Be.def(xe,".factor|0"),mt=Be.def(xe,".units|0");return[nt,mt]});case hc:return $e(function(pe){var Be=0;return pe==="front"?Be=yl:pe==="back"&&(Be=mc),le.command(!!Be,Le,re.commandStr),Be},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,xe+'==="front"||'+xe+'==="back"',"invalid cull.face")}),Be.def(xe,'==="front"?',yl,":",mc)});case zl:return $e(function(pe){return le.command(typeof pe=="number"&&pe>=Tt.lineWidthDims[0]&&pe<=Tt.lineWidthDims[1],"invalid line width, must be a positive number between "+Tt.lineWidthDims[0]+" and "+Tt.lineWidthDims[1],re.commandStr),pe},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,"typeof "+xe+'==="number"&&'+xe+">="+Tt.lineWidthDims[0]+"&&"+xe+"<="+Tt.lineWidthDims[1],"invalid line width")}),xe});case ou:return $e(function(pe){return le.commandParameter(pe,Jh,Le,re.commandStr),Jh[pe]},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,xe+'==="cw"||'+xe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Be.def(xe+'==="cw"?'+Qh+":"+Rh)});case mu:return $e(function(pe){return le.command(ao(pe)&&pe.length===4,"color.mask must be length 4 array",re.commandStr),pe.map(function(Be){return!!Be})},function(pe,Be,xe){return le.optional(function(){pe.assert(Be,pe.shared.isArrayLike+"("+xe+")&&"+xe+".length===4","invalid color.mask")}),Ze(4,function(nt){return"!!"+xe+"["+nt+"]"})});case Du:return $e(function(pe){le.command(typeof pe=="object"&&pe,Le,re.commandStr);var Be="value"in pe?pe.value:1,xe=!!pe.invert;return le.command(typeof Be=="number"&&Be>=0&&Be<=1,"sample.coverage.value must be a number between 0 and 1",re.commandStr),[Be,xe]},function(pe,Be,xe){le.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid sample.coverage")});var nt=Be.def('"value" in ',xe,"?+",xe,".value:1"),mt=Be.def("!!",xe,".invert");return[nt,mt]})}}),St}function Pi(_e,re){var Ue=_e.static,rt=_e.dynamic,St={};return Object.keys(Ue).forEach(function(We){var Le=Ue[We],$e;if(typeof Le=="number"||typeof Le=="boolean")$e=so(function(){return Le});else if(typeof Le=="function"){var pe=Le._reglType;pe==="texture2d"||pe==="textureCube"?$e=so(function(Be){return Be.link(Le)}):pe==="framebuffer"||pe==="framebufferCube"?(le.command(Le.color.length>0,'missing color attachment for framebuffer sent to uniform "'+We+'"',re.commandStr),$e=so(function(Be){return Be.link(Le.color[0])})):le.commandRaise('invalid data for uniform "'+We+'"',re.commandStr)}else ao(Le)?$e=so(function(Be){var xe=Be.global.def("[",Ze(Le.length,function(nt){return le.command(typeof Le[nt]=="number"||typeof Le[nt]=="boolean","invalid uniform "+We,Be.commandStr),Le[nt]}),"]");return xe}):le.commandRaise('invalid or missing data for uniform "'+We+'"',re.commandStr);$e.value=Le,St[We]=$e}),Object.keys(rt).forEach(function(We){var Le=rt[We];St[We]=Os(Le,function($e,pe){return $e.invoke(pe,Le)})}),St}function $o(_e,re){var Ue=_e.static,rt=_e.dynamic,St={};return Object.keys(Ue).forEach(function(We){var Le=Ue[We],$e=ue.id(We),pe=new tt;if(xu(Le))pe.state=Gn,pe.buffer=tr.getBuffer(tr.create(Le,_f,!1,!0)),pe.type=0;else{var Be=tr.getBuffer(Le);if(Be)pe.state=Gn,pe.buffer=Be,pe.type=0;else if(le.command(typeof Le=="object"&&Le,"invalid data for attribute "+We,re.commandStr),"constant"in Le){var xe=Le.constant;pe.buffer="null",pe.state=fi,typeof xe=="number"?pe.x=xe:(le.command(ao(xe)&&xe.length>0&&xe.length<=4,"invalid constant for attribute "+We,re.commandStr),ai.forEach(function(Lr,bn){bn<xe.length&&(pe[Lr]=xe[bn])}))}else{xu(Le.buffer)?Be=tr.getBuffer(tr.create(Le.buffer,_f,!1,!0)):Be=tr.getBuffer(Le.buffer),le.command(!!Be,'missing buffer for attribute "'+We+'"',re.commandStr);var nt=Le.offset|0;le.command(nt>=0,'invalid offset for attribute "'+We+'"',re.commandStr);var mt=Le.stride|0;le.command(mt>=0&&mt<256,'invalid stride for attribute "'+We+'", must be integer betweeen [0, 255]',re.commandStr);var cr=Le.size|0;le.command(!("size"in Le)||cr>0&&cr<=4,'invalid size for attribute "'+We+'", must be 1,2,3,4',re.commandStr);var Fr=!!Le.normalized,Nr=0;"type"in Le&&(le.commandParameter(Le.type,eu,"invalid type for attribute "+We,re.commandStr),Nr=eu[Le.type]);var tn=Le.divisor|0;le.optional(function(){"divisor"in Le&&(le.command(tn===0||mr,'cannot specify divisor for attribute "'+We+'", instancing not supported',re.commandStr),le.command(tn>=0,'invalid divisor for attribute "'+We+'"',re.commandStr));var Lr=re.commandStr,bn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Le).forEach(function(an){le.command(bn.indexOf(an)>=0,'unknown parameter "'+an+'" for attribute pointer "'+We+'" (valid parameters are '+bn+")",Lr)})}),pe.buffer=Be,pe.state=Gn,pe.size=cr,pe.normalized=Fr,pe.type=Nr||Be.dtype,pe.offset=nt,pe.stride=mt,pe.divisor=tn}}St[We]=so(function(Lr,bn){var an=Lr.attribCache;if($e in an)return an[$e];var yn={isStream:!1};return Object.keys(pe).forEach(function(gn){yn[gn]=pe[gn]}),pe.buffer&&(yn.buffer=Lr.link(pe.buffer),yn.type=yn.type||yn.buffer+".dtype"),an[$e]=yn,yn})}),Object.keys(rt).forEach(function(We){var Le=rt[We];function $e(pe,Be){var xe=pe.invoke(Be,Le),nt=pe.shared,mt=pe.constants,cr=nt.isBufferArgs,Fr=nt.buffer;le.optional(function(){pe.assert(Be,xe+"&&(typeof "+xe+'==="object"||typeof '+xe+'==="function")&&('+cr+"("+xe+")||"+Fr+".getBuffer("+xe+")||"+Fr+".getBuffer("+xe+".buffer)||"+cr+"("+xe+'.buffer)||("constant" in '+xe+"&&(typeof "+xe+'.constant==="number"||'+nt.isArrayLike+"("+xe+".constant))))",'invalid dynamic attribute "'+We+'"')});var Nr={isStream:Be.def(!1)},tn=new tt;tn.state=Gn,Object.keys(tn).forEach(function(yn){Nr[yn]=Be.def(""+tn[yn])});var Lr=Nr.buffer,bn=Nr.type;Be("if(",cr,"(",xe,")){",Nr.isStream,"=true;",Lr,"=",Fr,".createStream(",_f,",",xe,");",bn,"=",Lr,".dtype;","}else{",Lr,"=",Fr,".getBuffer(",xe,");","if(",Lr,"){",bn,"=",Lr,".dtype;",'}else if("constant" in ',xe,"){",Nr.state,"=",fi,";","if(typeof "+xe+'.constant === "number"){',Nr[ai[0]],"=",xe,".constant;",ai.slice(1).map(function(yn){return Nr[yn]}).join("="),"=0;","}else{",ai.map(function(yn,gn){return Nr[yn]+"="+xe+".constant.length>"+gn+"?"+xe+".constant["+gn+"]:0;"}).join(""),"}}else{","if(",cr,"(",xe,".buffer)){",Lr,"=",Fr,".createStream(",_f,",",xe,".buffer);","}else{",Lr,"=",Fr,".getBuffer(",xe,".buffer);","}",bn,'="type" in ',xe,"?",mt.glTypes,"[",xe,".type]:",Lr,".dtype;",Nr.normalized,"=!!",xe,".normalized;");function an(yn){Be(Nr[yn],"=",xe,".",yn,"|0;")}return an("size"),an("offset"),an("stride"),an("divisor"),Be("}}"),Be.exit("if(",Nr.isStream,"){",Fr,".destroyStream(",Lr,");","}"),Nr}St[We]=Os(Le,$e)}),St}function Za(_e){var re=_e.static,Ue=_e.dynamic,rt={};return Object.keys(re).forEach(function(St){var We=re[St];rt[St]=so(function(Le,$e){return typeof We=="number"||typeof We=="boolean"?""+We:Le.link(We)})}),Object.keys(Ue).forEach(function(St){var We=Ue[St];rt[St]=Os(We,function(Le,$e){return Le.invoke($e,We)})}),rt}function Ho(_e,re,Ue,rt,St){var We=_e.static,Le=_e.dynamic;le.optional(function(){var an=[su,ml,Uc,uu,wo,Gf,Zc,Hf,pc,mf].concat(Nn);function yn(gn){Object.keys(gn).forEach(function(hn){le.command(an.indexOf(hn)>=0,'unknown parameter "'+hn+'"',St.commandStr)})}yn(We),yn(Le)});var $e=oi(_e,re),pe=Qr(_e,St),Be=Yn(_e,pe,St),xe=Ya(_e,St),nt=ro(_e,St),mt=Li(_e,St,$e);function cr(an){var yn=Be[an];yn&&(nt[an]=yn)}cr(Ko),cr(mn(vf));var Fr=Object.keys(nt).length>0,Nr={framebuffer:pe,draw:xe,shader:mt,state:nt,dirty:Fr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nr.profile=Gr(_e,St),Nr.uniforms=Pi(Ue,St),Nr.drawVAO=Nr.scopeVAO=xe.vao,!Nr.drawVAO&&mt.program&&!$e&&ke.angle_instanced_arrays&&xe.static.elements){var tn=!0,Lr=mt.program.attributes.map(function(an){var yn=re.static[an];return tn=tn&&!!yn,yn});if(tn&&Lr.length>0){var bn=gr.getVAO(gr.createVAO({attributes:Lr,elements:xe.static.elements}));Nr.drawVAO=new qi(null,null,null,function(an,yn){return an.link(bn)}),Nr.useVAO=!0}}return $e?Nr.useVAO=!0:Nr.attributes=$o(re,St),Nr.context=Za(rt,St),Nr}function Rn(_e,re,Ue){var rt=_e.shared,St=rt.context,We=_e.scope();Object.keys(Ue).forEach(function(Le){re.save(St,"."+Le);var $e=Ue[Le],pe=$e.append(_e,re);Array.isArray(pe)?We(St,".",Le,"=[",pe.join(),"];"):We(St,".",Le,"=",pe,";")}),re(We)}function kn(_e,re,Ue,rt){var St=_e.shared,We=St.gl,Le=St.framebuffer,$e;kr&&($e=re.def(St.extensions,".webgl_draw_buffers"));var pe=_e.constants,Be=pe.drawBuffer,xe=pe.backBuffer,nt;Ue?nt=Ue.append(_e,re):nt=re.def(Le,".next"),rt||re("if(",nt,"!==",Le,".cur){"),re("if(",nt,"){",We,".bindFramebuffer(",Hp,",",nt,".framebuffer);"),kr&&re($e,".drawBuffersWEBGL(",Be,"[",nt,".colorAttachments.length]);"),re("}else{",We,".bindFramebuffer(",Hp,",null);"),kr&&re($e,".drawBuffersWEBGL(",xe,");"),re("}",Le,".cur=",nt,";"),rt||re("}")}function Co(_e,re,Ue){var rt=_e.shared,St=rt.gl,We=_e.current,Le=_e.next,$e=rt.current,pe=rt.next,Be=_e.cond($e,".dirty");Nn.forEach(function(xe){var nt=mn(xe);if(!(nt in Ue.state)){var mt,cr;if(nt in Le){mt=Le[nt],cr=We[nt];var Fr=Ze(Tr[nt].length,function(tn){return Be.def(mt,"[",tn,"]")});Be(_e.cond(Fr.map(function(tn,Lr){return tn+"!=="+cr+"["+Lr+"]"}).join("||")).then(St,".",$t[nt],"(",Fr,");",Fr.map(function(tn,Lr){return cr+"["+Lr+"]="+tn}).join(";"),";"))}else{mt=Be.def(pe,".",nt);var Nr=_e.cond(mt,"!==",$e,".",nt);Be(Nr),nt in qt?Nr(_e.cond(mt).then(St,".enable(",qt[nt],");").else(St,".disable(",qt[nt],");"),$e,".",nt,"=",mt,";"):Nr(St,".",$t[nt],"(",mt,");",$e,".",nt,"=",mt,";")}}}),Object.keys(Ue.state).length===0&&Be($e,".dirty=false;"),re(Be)}function bs(_e,re,Ue,rt){var St=_e.shared,We=_e.current,Le=St.current,$e=St.gl;Hc(Object.keys(Ue)).forEach(function(pe){var Be=Ue[pe];if(!(rt&&!rt(Be))){var xe=Be.append(_e,re);if(qt[pe]){var nt=qt[pe];gc(Be)?xe?re($e,".enable(",nt,");"):re($e,".disable(",nt,");"):re(_e.cond(xe).then($e,".enable(",nt,");").else($e,".disable(",nt,");")),re(Le,".",pe,"=",xe,";")}else if(ao(xe)){var mt=We[pe];re($e,".",$t[pe],"(",xe,");",xe.map(function(cr,Fr){return mt+"["+Fr+"]="+cr}).join(";"),";")}else re($e,".",$t[pe],"(",xe,");",Le,".",pe,"=",xe,";")}})}function uo(_e,re){mr&&(_e.instancing=re.def(_e.shared.extensions,".angle_instanced_arrays"))}function _i(_e,re,Ue,rt,St){var We=_e.shared,Le=_e.stats,$e=We.current,pe=We.timer,Be=Ue.profile;function xe(){var an=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return an||typeof performance=="undefined"?"Date.now()":"performance.now()"}var nt,mt;function cr(an){nt=re.def(),an(nt,"=",xe(),";"),typeof St=="string"?an(Le,".count+=",St,";"):an(Le,".count++;"),vr&&(rt?(mt=re.def(),an(mt,"=",pe,".getNumPendingQueries();")):an(pe,".beginQuery(",Le,");"))}function Fr(an){an(Le,".cpuTime+=",xe(),"-",nt,";"),vr&&(rt?an(pe,".pushScopeStats(",mt,",",pe,".getNumPendingQueries(),",Le,");"):an(pe,".endQuery();"))}function Nr(an){var yn=re.def($e,".profile");re($e,".profile=",an,";"),re.exit($e,".profile=",yn,";")}var tn;if(Be){if(gc(Be)){Be.enable?(cr(re),Fr(re.exit),Nr("true")):Nr("false");return}tn=Be.append(_e,re),Nr(tn)}else tn=re.def($e,".profile");var Lr=_e.block();cr(Lr),re("if(",tn,"){",Lr,"}");var bn=_e.block();Fr(bn),re.exit("if(",tn,"){",bn,"}")}function Wo(_e,re,Ue,rt,St){var We=_e.shared;function Le(pe){switch(pe){case bf:case Mh:case Ih:return 2;case gl:case vc:case Vc:return 3;case Ef:case Ph:case Sf:return 4;default:return 1}}function $e(pe,Be,xe){var nt=We.gl,mt=re.def(pe,".location"),cr=re.def(We.attributes,"[",mt,"]"),Fr=xe.state,Nr=xe.buffer,tn=[xe.x,xe.y,xe.z,xe.w],Lr=["buffer","normalized","offset","stride"];function bn(){re("if(!",cr,".buffer){",nt,".enableVertexAttribArray(",mt,");}");var yn=xe.type,gn;if(xe.size?gn=re.def(xe.size,"||",Be):gn=Be,re("if(",cr,".type!==",yn,"||",cr,".size!==",gn,"||",Lr.map(function(qn){return cr+"."+qn+"!=="+xe[qn]}).join("||"),"){",nt,".bindBuffer(",_f,",",Nr,".buffer);",nt,".vertexAttribPointer(",[mt,gn,yn,xe.normalized,xe.stride,xe.offset],");",cr,".type=",yn,";",cr,".size=",gn,";",Lr.map(function(qn){return cr+"."+qn+"="+xe[qn]+";"}).join(""),"}"),mr){var hn=xe.divisor;re("if(",cr,".divisor!==",hn,"){",_e.instancing,".vertexAttribDivisorANGLE(",[mt,hn],");",cr,".divisor=",hn,";}")}}function an(){re("if(",cr,".buffer){",nt,".disableVertexAttribArray(",mt,");",cr,".buffer=null;","}if(",ai.map(function(yn,gn){return cr+"."+yn+"!=="+tn[gn]}).join("||"),"){",nt,".vertexAttrib4f(",mt,",",tn,");",ai.map(function(yn,gn){return cr+"."+yn+"="+tn[gn]+";"}).join(""),"}")}Fr===Gn?bn():Fr===fi?an():(re("if(",Fr,"===",Gn,"){"),bn(),re("}else{"),an(),re("}"))}rt.forEach(function(pe){var Be=pe.name,xe=Ue.attributes[Be],nt;if(xe){if(!St(xe))return;nt=xe.append(_e,re)}else{if(!St(Lh))return;var mt=_e.scopeAttrib(Be);le.optional(function(){_e.assert(re,mt+".state","missing attribute "+Be)}),nt={},Object.keys(new tt).forEach(function(cr){nt[cr]=re.def(mt,".",cr)})}$e(_e.link(pe),Le(pe.info.type),nt)})}function ia(_e,re,Ue,rt,St,We){for(var Le=_e.shared,$e=Le.gl,pe,Be=0;Be<rt.length;++Be){var xe=rt[Be],nt=xe.name,mt=xe.info.type,cr=Ue.uniforms[nt],Fr=_e.link(xe),Nr=Fr+".location",tn;if(cr){if(!St(cr))continue;if(gc(cr)){var Lr=cr.value;if(le.command(Lr!==null&&typeof Lr!="undefined",'missing uniform "'+nt+'"',_e.commandStr),mt===th||mt===wf){le.command(typeof Lr=="function"&&(mt===th&&(Lr._reglType==="texture2d"||Lr._reglType==="framebuffer")||mt===wf&&(Lr._reglType==="textureCube"||Lr._reglType==="framebufferCube")),"invalid texture for uniform "+nt,_e.commandStr);var bn=_e.link(Lr._texture||Lr.color[0]._texture);re($e,".uniform1i(",Nr,",",bn+".bind());"),re.exit(bn,".unbind();")}else if(mt===Us||mt===eh||mt===Oh){le.optional(function(){le.command(ao(Lr),"invalid matrix for uniform "+nt,_e.commandStr),le.command(mt===Us&&Lr.length===4||mt===eh&&Lr.length===9||mt===Oh&&Lr.length===16,"invalid length for matrix uniform "+nt,_e.commandStr)});var an=_e.global.def("new Float32Array(["+Array.prototype.slice.call(Lr)+"])"),yn=2;mt===eh?yn=3:mt===Oh&&(yn=4),re($e,".uniformMatrix",yn,"fv(",Nr,",false,",an,");")}else{switch(mt){case $f:le.commandType(Lr,"number","uniform "+nt,_e.commandStr),pe="1f";break;case bf:le.command(ao(Lr)&&Lr.length===2,"uniform "+nt,_e.commandStr),pe="2f";break;case gl:le.command(ao(Lr)&&Lr.length===3,"uniform "+nt,_e.commandStr),pe="3f";break;case Ef:le.command(ao(Lr)&&Lr.length===4,"uniform "+nt,_e.commandStr),pe="4f";break;case Jf:le.commandType(Lr,"boolean","uniform "+nt,_e.commandStr),pe="1i";break;case Qf:le.commandType(Lr,"number","uniform "+nt,_e.commandStr),pe="1i";break;case Ih:le.command(ao(Lr)&&Lr.length===2,"uniform "+nt,_e.commandStr),pe="2i";break;case Mh:le.command(ao(Lr)&&Lr.length===2,"uniform "+nt,_e.commandStr),pe="2i";break;case Vc:le.command(ao(Lr)&&Lr.length===3,"uniform "+nt,_e.commandStr),pe="3i";break;case vc:le.command(ao(Lr)&&Lr.length===3,"uniform "+nt,_e.commandStr),pe="3i";break;case Sf:le.command(ao(Lr)&&Lr.length===4,"uniform "+nt,_e.commandStr),pe="4i";break;case Ph:le.command(ao(Lr)&&Lr.length===4,"uniform "+nt,_e.commandStr),pe="4i";break}re($e,".uniform",pe,"(",Nr,",",ao(Lr)?Array.prototype.slice.call(Lr):Lr,");")}continue}else tn=cr.append(_e,re)}else{if(!St(Lh))continue;tn=re.def(Le.uniforms,"[",ue.id(nt),"]")}mt===th?(le(!Array.isArray(tn),"must specify a scalar prop for textures"),re("if(",tn,"&&",tn,'._reglType==="framebuffer"){',tn,"=",tn,".color[0];","}")):mt===wf&&(le(!Array.isArray(tn),"must specify a scalar prop for cube maps"),re("if(",tn,"&&",tn,'._reglType==="framebufferCube"){',tn,"=",tn,".color[0];","}")),le.optional(function(){function To($s,Vl){_e.assert(re,$s,'bad data or missing for uniform "'+nt+'".  '+Vl)}function Fu($s){le(!Array.isArray(tn),"must not specify an array type for uniform"),To("typeof "+tn+'==="'+$s+'"',"invalid type, expected "+$s)}function lu($s,Vl){Array.isArray(tn)?le(tn.length===$s,"must have length "+$s):To(Le.isArrayLike+"("+tn+")&&"+tn+".length==="+$s,"invalid vector, should have length "+$s,_e.commandStr)}function Dh($s){le(!Array.isArray(tn),"must not specify a value type"),To("typeof "+tn+'==="function"&&'+tn+'._reglType==="texture'+($s===Zp?"2d":"Cube")+'"',"invalid texture type",_e.commandStr)}switch(mt){case Qf:Fu("number");break;case Mh:lu(2,"number");break;case vc:lu(3,"number");break;case Ph:lu(4,"number");break;case $f:Fu("number");break;case bf:lu(2,"number");break;case gl:lu(3,"number");break;case Ef:lu(4,"number");break;case Jf:Fu("boolean");break;case Ih:lu(2,"boolean");break;case Vc:lu(3,"boolean");break;case Sf:lu(4,"boolean");break;case Us:lu(4,"number");break;case eh:lu(9,"number");break;case Oh:lu(16,"number");break;case th:Dh(Zp);break;case wf:Dh(Th);break}});var gn=1;switch(mt){case th:case wf:var hn=re.def(tn,"._texture");re($e,".uniform1i(",Nr,",",hn,".bind());"),re.exit(hn,".unbind();");continue;case Qf:case Jf:pe="1i";break;case Mh:case Ih:pe="2i",gn=2;break;case vc:case Vc:pe="3i",gn=3;break;case Ph:case Sf:pe="4i",gn=4;break;case $f:pe="1f";break;case bf:pe="2f",gn=2;break;case gl:pe="3f",gn=3;break;case Ef:pe="4f",gn=4;break;case Us:pe="Matrix2fv";break;case eh:pe="Matrix3fv";break;case Oh:pe="Matrix4fv";break}if(pe.charAt(0)==="M"){re($e,".uniform",pe,"(",Nr,",");var qn=Math.pow(mt-Us+2,2),fa=_e.global.def("new Float32Array(",qn,")");Array.isArray(tn)?re("false,(",Ze(qn,function(To){return fa+"["+To+"]="+tn[To]}),",",fa,")"):re("false,(Array.isArray(",tn,")||",tn," instanceof Float32Array)?",tn,":(",Ze(qn,function(To){return fa+"["+To+"]="+tn+"["+To+"]"}),",",fa,")"),re(");")}else if(gn>1){for(var Qo=[],Ia=[],sa=0;sa<gn;++sa)Array.isArray(tn)?Ia.push(tn[sa]):Ia.push(re.def(tn+"["+sa+"]")),We&&Qo.push(re.def());We&&re("if(!",_e.batchId,"||",Qo.map(function(To,Fu){return To+"!=="+Ia[Fu]}).join("||"),"){",Qo.map(function(To,Fu){return To+"="+Ia[Fu]+";"}).join("")),re($e,".uniform",pe,"(",Nr,",",Ia.join(","),");"),We&&re("}")}else{if(le(!Array.isArray(tn),"uniform value must not be an array"),We){var Rs=re.def();re("if(!",_e.batchId,"||",Rs,"!==",tn,"){",Rs,"=",tn,";")}re($e,".uniform",pe,"(",Nr,",",tn,");"),We&&re("}")}}}function ss(_e,re,Ue,rt){var St=_e.shared,We=St.gl,Le=St.draw,$e=rt.draw;function pe(){var gn=$e.elements,hn,qn=re;return gn?((gn.contextDep&&rt.contextDynamic||gn.propDep)&&(qn=Ue),hn=gn.append(_e,qn),$e.elementsActive&&qn("if("+hn+")"+We+".bindBuffer("+Ah+","+hn+".buffer.buffer);")):(hn=qn.def(),qn(hn,"=",Le,".",uu,";","if(",hn,"){",We,".bindBuffer(",Ah,",",hn,".buffer.buffer);}","else if(",St.vao,".currentVAO){",hn,"=",_e.shared.elements+".getElements("+St.vao,".currentVAO.elements);",or?"":"if("+hn+")"+We+".bindBuffer("+Ah+","+hn+".buffer.buffer);","}")),hn}function Be(){var gn=$e.count,hn,qn=re;return gn?((gn.contextDep&&rt.contextDynamic||gn.propDep)&&(qn=Ue),hn=gn.append(_e,qn),le.optional(function(){gn.MISSING&&_e.assert(re,"false","missing vertex count"),gn.DYNAMIC&&_e.assert(qn,hn+">=0","missing vertex count")})):(hn=qn.def(Le,".",Zc),le.optional(function(){_e.assert(qn,hn+">=0","missing vertex count")})),hn}var xe=pe();function nt(gn){var hn=$e[gn];return hn?hn.contextDep&&rt.contextDynamic||hn.propDep?hn.append(_e,Ue):hn.append(_e,re):re.def(Le,".",gn)}var mt=nt(wo),cr=nt(Gf),Fr=Be();if(typeof Fr=="number"){if(Fr===0)return}else Ue("if(",Fr,"){"),Ue.exit("}");var Nr,tn;mr&&(Nr=nt(Hf),tn=_e.instancing);var Lr=xe+".type",bn=$e.elements&&gc($e.elements)&&!$e.vaoActive;function an(){function gn(){Ue(tn,".drawElementsInstancedANGLE(",[mt,Fr,Lr,cr+"<<(("+Lr+"-"+$n+")>>1)",Nr],");")}function hn(){Ue(tn,".drawArraysInstancedANGLE(",[mt,cr,Fr,Nr],");")}xe&&xe!=="null"?bn?gn():(Ue("if(",xe,"){"),gn(),Ue("}else{"),hn(),Ue("}")):hn()}function yn(){function gn(){Ue(We+".drawElements("+[mt,Fr,Lr,cr+"<<(("+Lr+"-"+$n+")>>1)"]+");")}function hn(){Ue(We+".drawArrays("+[mt,cr,Fr]+");")}xe&&xe!=="null"?bn?gn():(Ue("if(",xe,"){"),gn(),Ue("}else{"),hn(),Ue("}")):hn()}mr&&(typeof Nr!="number"||Nr>=0)?typeof Nr=="string"?(Ue("if(",Nr,">0){"),an(),Ue("}else if(",Nr,"<0){"),yn(),Ue("}")):an():yn()}function ei(_e,re,Ue,rt,St){var We=Jn(),Le=We.proc("body",St);return le.optional(function(){We.commandStr=re.commandStr,We.command=We.link(re.commandStr)}),mr&&(We.instancing=Le.def(We.shared.extensions,".angle_instanced_arrays")),_e(We,Le,Ue,rt),We.compile().body}function Ni(_e,re,Ue,rt){uo(_e,re),Ue.useVAO?Ue.drawVAO?re(_e.shared.vao,".setVAO(",Ue.drawVAO.append(_e,re),");"):re(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(re(_e.shared.vao,".setVAO(null);"),Wo(_e,re,Ue,rt.attributes,function(){return!0})),ia(_e,re,Ue,rt.uniforms,function(){return!0},!1),ss(_e,re,re,Ue)}function va(_e,re){var Ue=_e.proc("draw",1);uo(_e,Ue),Rn(_e,Ue,re.context),kn(_e,Ue,re.framebuffer),Co(_e,Ue,re),bs(_e,Ue,re.state),_i(_e,Ue,re,!1,!0);var rt=re.shader.progVar.append(_e,Ue);if(Ue(_e.shared.gl,".useProgram(",rt,".program);"),re.shader.program)Ni(_e,Ue,re,re.shader.program);else{Ue(_e.shared.vao,".setVAO(null);");var St=_e.global.def("{}"),We=Ue.def(rt,".id"),Le=Ue.def(St,"[",We,"]");Ue(_e.cond(Le).then(Le,".call(this,a0);").else(Le,"=",St,"[",We,"]=",_e.link(function($e){return ei(Ni,_e,re,$e,1)}),"(",rt,");",Le,".call(this,a0);"))}Object.keys(re.state).length>0&&Ue(_e.shared.current,".dirty=true;"),_e.shared.vao&&Ue(_e.shared.vao,".setVAO(null);")}function Ao(_e,re,Ue,rt){_e.batchId="a1",uo(_e,re);function St(){return!0}Wo(_e,re,Ue,rt.attributes,St),ia(_e,re,Ue,rt.uniforms,St,!1),ss(_e,re,re,Ue)}function Zl(_e,re,Ue,rt){uo(_e,re);var St=Ue.contextDep,We=re.def(),Le="a0",$e="a1",pe=re.def();_e.shared.props=pe,_e.batchId=We;var Be=_e.scope(),xe=_e.scope();re(Be.entry,"for(",We,"=0;",We,"<",$e,";++",We,"){",pe,"=",Le,"[",We,"];",xe,"}",Be.exit);function nt(Lr){return Lr.contextDep&&St||Lr.propDep}function mt(Lr){return!nt(Lr)}if(Ue.needsContext&&Rn(_e,xe,Ue.context),Ue.needsFramebuffer&&kn(_e,xe,Ue.framebuffer),bs(_e,xe,Ue.state,nt),Ue.profile&&nt(Ue.profile)&&_i(_e,xe,Ue,!1,!0),rt)Ue.useVAO?Ue.drawVAO?nt(Ue.drawVAO)?xe(_e.shared.vao,".setVAO(",Ue.drawVAO.append(_e,xe),");"):Be(_e.shared.vao,".setVAO(",Ue.drawVAO.append(_e,Be),");"):Be(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(Be(_e.shared.vao,".setVAO(null);"),Wo(_e,Be,Ue,rt.attributes,mt),Wo(_e,xe,Ue,rt.attributes,nt)),ia(_e,Be,Ue,rt.uniforms,mt,!1),ia(_e,xe,Ue,rt.uniforms,nt,!0),ss(_e,Be,xe,Ue);else{var cr=_e.global.def("{}"),Fr=Ue.shader.progVar.append(_e,xe),Nr=xe.def(Fr,".id"),tn=xe.def(cr,"[",Nr,"]");xe(_e.shared.gl,".useProgram(",Fr,".program);","if(!",tn,"){",tn,"=",cr,"[",Nr,"]=",_e.link(function(Lr){return ei(Ao,_e,Ue,Lr,2)}),"(",Fr,");}",tn,".call(this,a0[",We,"],",We,");")}}function we(_e,re){var Ue=_e.proc("batch",2);_e.batchId="0",uo(_e,Ue);var rt=!1,St=!0;Object.keys(re.context).forEach(function(cr){rt=rt||re.context[cr].propDep}),rt||(Rn(_e,Ue,re.context),St=!1);var We=re.framebuffer,Le=!1;We?(We.propDep?rt=Le=!0:We.contextDep&&rt&&(Le=!0),Le||kn(_e,Ue,We)):kn(_e,Ue,null),re.state.viewport&&re.state.viewport.propDep&&(rt=!0);function $e(cr){return cr.contextDep&&rt||cr.propDep}Co(_e,Ue,re),bs(_e,Ue,re.state,function(cr){return!$e(cr)}),(!re.profile||!$e(re.profile))&&_i(_e,Ue,re,!1,"a1"),re.contextDep=rt,re.needsContext=St,re.needsFramebuffer=Le;var pe=re.shader.progVar;if(pe.contextDep&&rt||pe.propDep)Zl(_e,Ue,re,null);else{var Be=pe.append(_e,Ue);if(Ue(_e.shared.gl,".useProgram(",Be,".program);"),re.shader.program)Zl(_e,Ue,re,re.shader.program);else{Ue(_e.shared.vao,".setVAO(null);");var xe=_e.global.def("{}"),nt=Ue.def(Be,".id"),mt=Ue.def(xe,"[",nt,"]");Ue(_e.cond(mt).then(mt,".call(this,a0,a1);").else(mt,"=",xe,"[",nt,"]=",_e.link(function(cr){return ei(Zl,_e,re,cr,2)}),"(",Be,");",mt,".call(this,a0,a1);"))}}Object.keys(re.state).length>0&&Ue(_e.shared.current,".dirty=true;"),_e.shared.vao&&Ue(_e.shared.vao,".setVAO(null);")}function Rt(_e,re){var Ue=_e.proc("scope",3);_e.batchId="a2";var rt=_e.shared,St=rt.current;Rn(_e,Ue,re.context),re.framebuffer&&re.framebuffer.append(_e,Ue),Hc(Object.keys(re.state)).forEach(function(Le){var $e=re.state[Le],pe=$e.append(_e,Ue);ao(pe)?pe.forEach(function(Be,xe){Ue.set(_e.next[Le],"["+xe+"]",Be)}):Ue.set(rt.next,"."+Le,pe)}),_i(_e,Ue,re,!0,!0),[uu,Gf,Zc,Hf,wo].forEach(function(Le){var $e=re.draw[Le];!$e||Ue.set(rt.draw,"."+Le,""+$e.append(_e,Ue))}),Object.keys(re.uniforms).forEach(function(Le){var $e=re.uniforms[Le].append(_e,Ue);Array.isArray($e)&&($e="["+$e.join()+"]"),Ue.set(rt.uniforms,"["+ue.id(Le)+"]",$e)}),Object.keys(re.attributes).forEach(function(Le){var $e=re.attributes[Le].append(_e,Ue),pe=_e.scopeAttrib(Le);Object.keys(new tt).forEach(function(Be){Ue.set(pe,"."+Be,$e[Be])})}),re.scopeVAO&&Ue.set(rt.vao,".targetVAO",re.scopeVAO.append(_e,Ue));function We(Le){var $e=re.shader[Le];$e&&Ue.set(rt.shader,"."+Le,$e.append(_e,Ue))}We(ml),We(Uc),Object.keys(re.state).length>0&&(Ue(St,".dirty=true;"),Ue.exit(St,".dirty=true;")),Ue("a1(",_e.shared.context,",a0,",_e.batchId,");")}function dt(_e){if(!(typeof _e!="object"||ao(_e))){for(var re=Object.keys(_e),Ue=0;Ue<re.length;++Ue)if(_n.isDynamic(_e[re[Ue]]))return!0;return!1}}function fn(_e,re,Ue){var rt=re.static[Ue];if(!rt||!dt(rt))return;var St=_e.global,We=Object.keys(rt),Le=!1,$e=!1,pe=!1,Be=_e.global.def("{}");We.forEach(function(nt){var mt=rt[nt];if(_n.isDynamic(mt)){typeof mt=="function"&&(mt=rt[nt]=_n.unbox(mt));var cr=Os(mt,null);Le=Le||cr.thisDep,pe=pe||cr.propDep,$e=$e||cr.contextDep}else{switch(St(Be,".",nt,"="),typeof mt){case"number":St(mt);break;case"string":St('"',mt,'"');break;case"object":Array.isArray(mt)&&St("[",mt.join(),"]");break;default:St(_e.link(mt));break}St(";")}});function xe(nt,mt){We.forEach(function(cr){var Fr=rt[cr];if(!!_n.isDynamic(Fr)){var Nr=nt.invoke(mt,Fr);mt(Be,".",cr,"=",Nr,";")}})}re.dynamic[Ue]=new _n.DynamicVariable(No,{thisDep:Le,contextDep:$e,propDep:pe,ref:Be,append:xe}),delete re.static[Ue]}function Ui(_e,re,Ue,rt,St){var We=Jn();We.stats=We.link(St),Object.keys(re.static).forEach(function($e){fn(We,re,$e)}),xd.forEach(function($e){fn(We,_e,$e)});var Le=Ho(_e,re,Ue,rt,We);return va(We,Le),Rt(We,Le),we(We,Le),m(We.compile(),{destroy:function(){Le.shader.program.destroy()}})}return{next:Wr,current:Tr,procs:function(){var _e=Jn(),re=_e.proc("poll"),Ue=_e.proc("refresh"),rt=_e.block();re(rt),Ue(rt);var St=_e.shared,We=St.gl,Le=St.next,$e=St.current;rt($e,".dirty=false;"),kn(_e,re),kn(_e,Ue,null,!0);var pe;mr&&(pe=_e.link(mr)),ke.oes_vertex_array_object&&Ue(_e.link(ke.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Be=0;Be<Tt.maxAttributes;++Be){var xe=Ue.def(St.attributes,"[",Be,"]"),nt=_e.cond(xe,".buffer");nt.then(We,".enableVertexAttribArray(",Be,");",We,".bindBuffer(",_f,",",xe,".buffer.buffer);",We,".vertexAttribPointer(",Be,",",xe,".size,",xe,".type,",xe,".normalized,",xe,".stride,",xe,".offset);").else(We,".disableVertexAttribArray(",Be,");",We,".vertexAttrib4f(",Be,",",xe,".x,",xe,".y,",xe,".z,",xe,".w);",xe,".buffer=null;"),Ue(nt),mr&&Ue(pe,".vertexAttribDivisorANGLE(",Be,",",xe,".divisor);")}return Ue(_e.shared.vao,".currentVAO=null;",_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"),Object.keys(qt).forEach(function(mt){var cr=qt[mt],Fr=rt.def(Le,".",mt),Nr=_e.block();Nr("if(",Fr,"){",We,".enable(",cr,")}else{",We,".disable(",cr,")}",$e,".",mt,"=",Fr,";"),Ue(Nr),re("if(",Fr,"!==",$e,".",mt,"){",Nr,"}")}),Object.keys($t).forEach(function(mt){var cr=$t[mt],Fr=Tr[mt],Nr,tn,Lr=_e.block();if(Lr(We,".",cr,"("),ao(Fr)){var bn=Fr.length;Nr=_e.global.def(Le,".",mt),tn=_e.global.def($e,".",mt),Lr(Ze(bn,function(an){return Nr+"["+an+"]"}),");",Ze(bn,function(an){return tn+"["+an+"]="+Nr+"["+an+"];"}).join("")),re("if(",Ze(bn,function(an){return Nr+"["+an+"]!=="+tn+"["+an+"]"}).join("||"),"){",Lr,"}")}else Nr=rt.def(Le,".",mt),tn=rt.def($e,".",mt),Lr(Nr,");",$e,".",mt,"=",Nr,";"),re("if(",Nr,"!==",tn,"){",Lr,"}");Ue(Lr)}),_e.compile()}(),compile:Ui}}function Sd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var wd=34918,Cd=34919,tp=35007,Ad=function(F,ue){if(!ue.ext_disjoint_timer_query)return null;var ke=[];function Tt(){return ke.pop()||ue.ext_disjoint_timer_query.createQueryEXT()}function tr(mr){ke.push(mr)}var Ct=[];function Yt(mr){var kr=Tt();ue.ext_disjoint_timer_query.beginQueryEXT(tp,kr),Ct.push(kr),vr(Ct.length-1,Ct.length,mr)}function sr(){ue.ext_disjoint_timer_query.endQueryEXT(tp)}function pr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var gr=[];function br(){return gr.pop()||new pr}function Ar(mr){gr.push(mr)}var zr=[];function vr(mr,kr,or){var Tr=br();Tr.startQueryIndex=mr,Tr.endQueryIndex=kr,Tr.sum=0,Tr.stats=or,zr.push(Tr)}var _r=[],tt=[];function Ft(){var mr,kr,or=Ct.length;if(or!==0){tt.length=Math.max(tt.length,or+1),_r.length=Math.max(_r.length,or+1),_r[0]=0,tt[0]=0;var Tr=0;for(mr=0,kr=0;kr<Ct.length;++kr){var Wr=Ct[kr];ue.ext_disjoint_timer_query.getQueryObjectEXT(Wr,Cd)?(Tr+=ue.ext_disjoint_timer_query.getQueryObjectEXT(Wr,wd),tr(Wr)):Ct[mr++]=Wr,_r[kr+1]=Tr,tt[kr+1]=mr}for(Ct.length=mr,mr=0,kr=0;kr<zr.length;++kr){var Nn=zr[kr],qt=Nn.startQueryIndex,$t=Nn.endQueryIndex;Nn.sum+=_r[$t]-_r[qt];var mn=tt[qt],Ur=tt[$t];Ur===mn?(Nn.stats.gpuTime+=Nn.sum/1e6,Ar(Nn)):(Nn.startQueryIndex=mn,Nn.endQueryIndex=Ur,zr[mr++]=Nn)}zr.length=mr}}return{beginQuery:Yt,endQuery:sr,pushScopeStats:vr,update:Ft,getNumPendingQueries:function(){return Ct.length},clear:function(){ke.push.apply(ke,Ct);for(var mr=0;mr<ke.length;mr++)ue.ext_disjoint_timer_query.deleteQueryEXT(ke[mr]);Ct.length=0,ke.length=0},restore:function(){Ct.length=0,ke.length=0}}},Yp=16384,nh=256,qp=1024,rp=34962,ih="webglcontextlost",Pa="webglcontextrestored",np=1,Ul=2,Cf=3;function kh(F,ue){for(var ke=0;ke<F.length;++ke)if(F[ke]===ue)return ke;return-1}function Kp(F){var ue=fe(F);if(!ue)return null;var ke=ue.gl,Tt=ke.getContextAttributes(),tr=ke.isContextLost(),Ct=Ae(ke,ue);if(!Ct)return null;var Yt=fs(),sr=Sd(),pr=Ct.extensions,gr=Ad(ke,pr),br=Ja(),Ar=ke.drawingBufferWidth,zr=ke.drawingBufferHeight,vr={tick:0,time:0,viewportWidth:Ar,viewportHeight:zr,framebufferWidth:Ar,framebufferHeight:zr,drawingBufferWidth:Ar,drawingBufferHeight:zr,pixelRatio:ue.pixelRatio},_r={},tt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ft=Sl(ke,pr),mr=D(ke,sr,ue,Tr),kr=al(ke,pr,mr,sr),or=ut(ke,pr,Ft,sr,mr,kr,tt);function Tr(ei){return or.destroyBuffer(ei)}var Wr=Or(ke,Yt,sr,ue),Nn=_s(ke,pr,Ft,function(){mn.procs.poll()},vr,sr,ue),qt=fl(ke,pr,Ft,sr,ue),$t=Se(ke,pr,Ft,Nn,qt,sr),mn=ep(ke,Yt,pr,Ft,mr,kr,Nn,$t,_r,or,Wr,tt,vr,gr,ue),Ur=zn(ke,$t,mn.procs.poll,vr,Tt,pr,Ft),yr=mn.next,Xr=ke.canvas,Yr=[],hi=[],Jn=[],Gr=[ue.onDestroy],Qr=null;function Yn(){if(Yr.length===0){gr&&gr.update(),Qr=null;return}Qr=Oi.next(Yn),uo();for(var ei=Yr.length-1;ei>=0;--ei){var Ni=Yr[ei];Ni&&Ni(vr,null,0)}ke.flush(),gr&&gr.update()}function oi(){!Qr&&Yr.length>0&&(Qr=Oi.next(Yn))}function Li(){Qr&&(Oi.cancel(Yn),Qr=null)}function Ya(ei){ei.preventDefault(),tr=!0,Li(),hi.forEach(function(Ni){Ni()})}function ro(ei){ke.getError(),tr=!1,Ct.restore(),Wr.restore(),mr.restore(),Nn.restore(),qt.restore(),$t.restore(),or.restore(),gr&&gr.restore(),mn.procs.refresh(),oi(),Jn.forEach(function(Ni){Ni()})}var Pi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!Pi&&Xr&&(Xr.addEventListener(ih,Ya,!1),Xr.addEventListener(Pa,ro,!1));function $o(){Yr.length=0,Li(),!Pi&&Xr&&(Xr.removeEventListener(ih,Ya),Xr.removeEventListener(Pa,ro)),Wr.clear(),$t.clear(),qt.clear(),or.clear(),Nn.clear(),kr.clear(),mr.clear(),gr&&gr.clear(),Gr.forEach(function(ei){ei()})}function Za(ei){le(!!ei,"invalid args to regl({...})"),le.type(ei,"object","invalid args to regl({...})");function Ni(We){var Le=m({},We);delete Le.uniforms,delete Le.attributes,delete Le.context,delete Le.vao,"stencil"in Le&&Le.stencil.op&&(Le.stencil.opBack=Le.stencil.opFront=Le.stencil.op,delete Le.stencil.op);function $e(pe){if(pe in Le){var Be=Le[pe];delete Le[pe],Object.keys(Be).forEach(function(xe){Le[pe+"."+xe]=Be[xe]})}}return $e("blend"),$e("depth"),$e("cull"),$e("stencil"),$e("polygonOffset"),$e("scissor"),$e("sample"),"vao"in We&&(Le.vao=We.vao),Le}function va(We,Le){var $e={},pe={};return Object.keys(We).forEach(function(Be){var xe=We[Be];if(_n.isDynamic(xe)){pe[Be]=_n.unbox(xe,Be);return}else if(Le&&Array.isArray(xe)){for(var nt=0;nt<xe.length;++nt)if(_n.isDynamic(xe[nt])){pe[Be]=_n.unbox(xe,Be);return}}$e[Be]=xe}),{dynamic:pe,static:$e}}var Ao=va(ei.context||{},!0),Zl=va(ei.uniforms||{},!0),we=va(ei.attributes||{},!1),Rt=va(Ni(ei),!1),dt={gpuTime:0,cpuTime:0,count:0},fn=mn.compile(Rt,we,Zl,Ao,dt),Ui=fn.draw,_e=fn.batch,re=fn.scope,Ue=[];function rt(We){for(;Ue.length<We;)Ue.push(null);return Ue}function St(We,Le){var $e;if(tr&&le.raise("context lost"),typeof We=="function")return re.call(this,null,We,0);if(typeof Le=="function")if(typeof We=="number")for($e=0;$e<We;++$e)re.call(this,null,Le,$e);else if(Array.isArray(We))for($e=0;$e<We.length;++$e)re.call(this,We[$e],Le,$e);else return re.call(this,We,Le,0);else if(typeof We=="number"){if(We>0)return _e.call(this,rt(We|0),We|0)}else if(Array.isArray(We)){if(We.length)return _e.call(this,We,We.length)}else return Ui.call(this,We)}return m(St,{stats:dt,destroy:function(){fn.destroy()}})}var Ho=$t.setFBO=Za({framebuffer:_n.define.call(null,np,"framebuffer")});function Rn(ei,Ni){var va=0;mn.procs.poll();var Ao=Ni.color;Ao&&(ke.clearColor(+Ao[0]||0,+Ao[1]||0,+Ao[2]||0,+Ao[3]||0),va|=Yp),"depth"in Ni&&(ke.clearDepth(+Ni.depth),va|=nh),"stencil"in Ni&&(ke.clearStencil(Ni.stencil|0),va|=qp),le(!!va,"called regl.clear with no buffer specified"),ke.clear(va)}function kn(ei){if(le(typeof ei=="object"&&ei,"regl.clear() takes an object as input"),"framebuffer"in ei)if(ei.framebuffer&&ei.framebuffer_reglType==="framebufferCube")for(var Ni=0;Ni<6;++Ni)Ho(m({framebuffer:ei.framebuffer.faces[Ni]},ei),Rn);else Ho(ei,Rn);else Rn(null,ei)}function Co(ei){le.type(ei,"function","regl.frame() callback must be a function"),Yr.push(ei);function Ni(){var va=kh(Yr,ei);le(va>=0,"cannot cancel a frame twice");function Ao(){var Zl=kh(Yr,Ao);Yr[Zl]=Yr[Yr.length-1],Yr.length-=1,Yr.length<=0&&Li()}Yr[va]=Ao}return oi(),{cancel:Ni}}function bs(){var ei=yr.viewport,Ni=yr.scissor_box;ei[0]=ei[1]=Ni[0]=Ni[1]=0,vr.viewportWidth=vr.framebufferWidth=vr.drawingBufferWidth=ei[2]=Ni[2]=ke.drawingBufferWidth,vr.viewportHeight=vr.framebufferHeight=vr.drawingBufferHeight=ei[3]=Ni[3]=ke.drawingBufferHeight}function uo(){vr.tick+=1,vr.time=Wo(),bs(),mn.procs.poll()}function _i(){Nn.refresh(),bs(),mn.procs.refresh(),gr&&gr.update()}function Wo(){return(Ja()-br)/1e3}_i();function ia(ei,Ni){le.type(Ni,"function","listener callback must be a function");var va;switch(ei){case"frame":return Co(Ni);case"lost":va=hi;break;case"restore":va=Jn;break;case"destroy":va=Gr;break;default:le.raise("invalid event, must be one of frame,lost,restore,destroy")}return va.push(Ni),{cancel:function(){for(var Ao=0;Ao<va.length;++Ao)if(va[Ao]===Ni){va[Ao]=va[va.length-1],va.pop();return}}}}var ss=m(Za,{clear:kn,prop:_n.define.bind(null,np),context:_n.define.bind(null,Ul),this:_n.define.bind(null,Cf),draw:Za({}),buffer:function(ei){return mr.create(ei,rp,!1,!1)},elements:function(ei){return kr.create(ei,!1)},texture:Nn.create2D,cube:Nn.createCube,renderbuffer:qt.create,framebuffer:$t.create,framebufferCube:$t.createCube,vao:or.createVAO,attributes:Tt,frame:Co,on:ia,limits:Ft,hasExtension:function(ei){return Ft.extensions.indexOf(ei.toLowerCase())>=0},read:Ur,destroy:$o,_gl:ke,_refresh:_i,poll:function(){uo(),gr&&gr.update()},now:Wo,stats:sr});return ue.onDone(null,ss),ss}return Kp})},34130:function(Cr){var te=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function $(Pe){return Pe.match(te)||[]}Cr.exports=$},14318:function(Cr){function te($,Pe,me){return $===$&&(me!==void 0&&($=$<=me?$:me),Pe!==void 0&&($=$>=Pe?$:Pe)),$}Cr.exports=te},61856:function(Cr){function te($){return function(Pe){return $==null?void 0:$[Pe]}}Cr.exports=te},97815:function(Cr,te,$){var Pe=$(4324),me=$(55015),m=$(80935),Ie=$(44140);function G(ce){return function(he){he=Ie(he);var Fe=me(he)?m(he):void 0,ge=Fe?Fe[0]:he.charAt(0),Qe=Fe?Pe(Fe,1).join(""):he.slice(1);return ge[ce]()+Qe}}Cr.exports=G},74749:function(Cr,te,$){var Pe=$(99861),me=$(31876),m=$(61503),Ie="['\u2019]",G=RegExp(Ie,"g");function ce(he){return function(Fe){return Pe(m(me(Fe).replace(G,"")),he,"")}}Cr.exports=ce},70668:function(Cr,te,$){var Pe=$(61856),me={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=Pe(me);Cr.exports=m},62840:function(Cr){var te=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function $(Pe){return te.test(Pe)}Cr.exports=$},97681:function(Cr){var te="\\ud800-\\udfff",$="\\u0300-\\u036f",Pe="\\ufe20-\\ufe2f",me="\\u20d0-\\u20ff",m=$+Pe+me,Ie="\\u2700-\\u27bf",G="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",he="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fe="\\u2000-\\u206f",ge=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qe="A-Z\\xc0-\\xd6\\xd8-\\xde",ct="\\ufe0e\\ufe0f",xt=ce+he+Fe+ge,Qt="['\u2019]",ur="["+xt+"]",Mt="["+m+"]",Jt="\\d+",zt="["+Ie+"]",lt="["+G+"]",pt="[^"+te+xt+Jt+Ie+G+Qe+"]",ir="\\ud83c[\\udffb-\\udfff]",W="(?:"+Mt+"|"+ir+")",Wt="[^"+te+"]",ot="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="["+Qe+"]",Ke="\\u200d",Xt="(?:"+lt+"|"+pt+")",Sr="(?:"+bt+"|"+pt+")",Vr="(?:"+Qt+"(?:d|ll|m|re|s|t|ve))?",en="(?:"+Qt+"(?:D|LL|M|RE|S|T|VE))?",C=W+"?",Ee="["+ct+"]?",Re="(?:"+Ke+"(?:"+[Wt,ot,Ye].join("|")+")"+Ee+C+")*",yt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ft="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",It=Ee+C+Re,Ht="(?:"+[zt,ot,Ye].join("|")+")"+It,xr=RegExp([bt+"?"+lt+"+"+Vr+"(?="+[ur,bt,"$"].join("|")+")",Sr+"+"+en+"(?="+[ur,bt+Xt,"$"].join("|")+")",bt+"?"+Xt+"+"+Vr,bt+"+"+en,ft,yt,Jt,Ht].join("|"),"g");function Kn(dn){return dn.match(xr)||[]}Cr.exports=Kn},34301:function(Cr,te,$){var Pe=$(30225),me=$(74749),m=me(function(Ie,G,ce){return G=G.toLowerCase(),Ie+(ce?Pe(G):G)});Cr.exports=m},30225:function(Cr,te,$){var Pe=$(44140),me=$(53592);function m(Ie){return me(Pe(Ie).toLowerCase())}Cr.exports=m},61400:function(Cr,te,$){var Pe=$(14318),me=$(20168);function m(Ie,G,ce){return ce===void 0&&(ce=G,G=void 0),ce!==void 0&&(ce=me(ce),ce=ce===ce?ce:0),G!==void 0&&(G=me(G),G=G===G?G:0),Pe(me(Ie),G,ce)}Cr.exports=m},31876:function(Cr,te,$){var Pe=$(70668),me=$(44140),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ie="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",he=Ie+G+ce,Fe="["+he+"]",ge=RegExp(Fe,"g");function Qe(ct){return ct=me(ct),ct&&ct.replace(m,Pe).replace(ge,"")}Cr.exports=Qe},93544:function(Cr){function te($){return $==null}Cr.exports=te},68868:function(Cr,te,$){var Pe=$(86756),me=$(93913),m="[object Number]";function Ie(G){return typeof G=="number"||me(G)&&Pe(G)==m}Cr.exports=Ie},24602:function(Cr,te,$){var Pe=$(50097),me=$(63323),m=me(function(Ie,G,ce,he){Pe(Ie,G,ce,he)});Cr.exports=m},21691:function(Cr,te,$){var Pe=$(29098);function me(m){return m&&m.length?Pe(m):[]}Cr.exports=me},53592:function(Cr,te,$){var Pe=$(97815),me=Pe("toUpperCase");Cr.exports=me},61503:function(Cr,te,$){var Pe=$(34130),me=$(62840),m=$(44140),Ie=$(97681);function G(ce,he,Fe){return ce=m(ce),he=Fe?void 0:he,he===void 0?me(ce)?Ie(ce):Pe(ce):ce.match(he)||[]}Cr.exports=G},84105:function(Cr){(function(te,$){Cr.exports=$()})(this,function(){"use strict";var te,$,Pe;function me(m,Ie){if(!te)te=Ie;else if(!$)$=Ie;else{var G="var sharedChunk = {}; ("+te+")(sharedChunk); ("+$+")(sharedChunk);",ce={};te(ce),Pe=Ie(ce),typeof window!="undefined"&&(Pe.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}return me(["exports"],function(m){"use strict";function Ie(t,a){return t(a={exports:{}},a.exports),a.exports}var G=ce;function ce(t,a,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=s,this.p2y=h}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,a){var s,h,p,x,S;for(a===void 0&&(a=1e-6),p=t,S=0;S<8;S++){if(x=this.sampleCurveX(p)-t,Math.abs(x)<a)return p;var M=this.sampleCurveDerivativeX(p);if(Math.abs(M)<1e-6)break;p-=x/M}if((p=t)<(s=0))return s;if(p>(h=1))return h;for(;s<h;){if(x=this.sampleCurveX(p),Math.abs(x-t)<a)return p;t>x?s=p:h=p,p=.5*(h-s)+s}return p},ce.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var he=Fe;function Fe(t,a){this.x=t,this.y=a}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),h=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,a){var s=Math.cos(t),h=Math.sin(t),p=a.y+h*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-h*(this.y-a.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(t){return t instanceof Fe?t:Array.isArray(t)?new Fe(t[0],t[1]):t};var ge=typeof self!="undefined"?self:{},Qe=Math.pow(2,53)-1;function ct(t,a,s,h){var p=new G(t,a,s,h);return function(x){return p.solve(x)}}var xt=ct(.25,.1,.25,1);function Qt(t,a,s){return Math.min(s,Math.max(a,t))}function ur(t,a,s){var h=s-a,p=((t-a)%h+h)%h+a;return p===a?s:p}function Mt(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,p=a;h<p.length;h+=1){var x=p[h];for(var S in x)t[S]=x[S]}return t}var Jt=1;function zt(){return Jt++}function lt(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function pt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ir(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function W(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Wt(t,a,s){var h={};for(var p in t)h[p]=a.call(s||this,t[p],p,t);return h}function ot(t,a,s){var h={};for(var p in t)a.call(s||this,t[p],p,t)&&(h[p]=t[p]);return h}function Ye(t){return Array.isArray(t)?t.map(Ye):typeof t=="object"&&t?Wt(t,Ye):t}var bt={};function Ke(t){bt[t]||(typeof console!="undefined"&&console.warn(t),bt[t]=!0)}function Xt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function Sr(t){for(var a=0,s=0,h=t.length,p=h-1,x=void 0,S=void 0;s<h;p=s++)a+=((S=t[p]).x-(x=t[s]).x)*(x.y+S.y);return a}function Vr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function en(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,p,x,S){var M=x||S;return a[p]=!M||M.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var C=null;function Ee(t){if(C==null){var a=t.navigator?t.navigator.userAgent:null;C=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return C}function Re(t){try{var a=ge[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var yt,ft,It,Ht,xr=ge.performance&&ge.performance.now?ge.performance.now.bind(ge.performance):Date.now.bind(Date),Kn=ge.requestAnimationFrame||ge.mozRequestAnimationFrame||ge.webkitRequestAnimationFrame||ge.msRequestAnimationFrame,dn=ge.cancelAnimationFrame||ge.mozCancelAnimationFrame||ge.webkitCancelAnimationFrame||ge.msCancelAnimationFrame,di={now:xr,frame:function(t){var a=Kn(t);return{cancel:function(){return dn(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=ge.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return yt||(yt=ge.document.createElement("a")),yt.href=t,yt.href},hardwareConcurrency:ge.navigator&&ge.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ge.devicePixelRatio},get prefersReducedMotion(){return!!ge.matchMedia&&(ft==null&&(ft=ge.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches)}},jn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ni={supported:!1,testSupport:function(t){!vi&&Ht&&(Hn?mi(t):It=t)}},vi=!1,Hn=!1;function mi(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ht),t.isContextLost())return;ni.supported=!0}catch(s){}t.deleteTexture(a),vi=!0}ge.document&&((Ht=ge.document.createElement("img")).onload=function(){It&&mi(It),It=null,Hn=!0},Ht.onerror=function(){vi=!0,It=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ha="01",Hi=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function Di(t){return t.indexOf("mapbox:")===0}Hi.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ha,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Hi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Hi.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Hi.prototype.normalizeStyleURL=function(t,a){if(!Di(t))return t;var s=La(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Hi.prototype.normalizeGlyphsURL=function(t,a){if(!Di(t))return t;var s=La(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Hi.prototype.normalizeSourceURL=function(t,a){if(!Di(t))return t;var s=La(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Hi.prototype.normalizeSpriteURL=function(t,a,s,h){var p=La(t);return Di(t)?(p.path="/styles/v1"+p.path+"/sprite"+a+s,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=""+a+s,ga(p))},Hi.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Di(t))return t;var s=La(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(di.devicePixelRatio>=2||a===512?"@2x":"")+(ni.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var h=this._customAccessToken||function(p){for(var x=0,S=p;x<S.length;x+=1){var M=S[x].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(s.params)||jn.ACCESS_TOKEN;return jn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,h)},Hi.prototype.canonicalizeTileURL=function(t,a){var s=La(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=s.path.replace("/v4/","");var p=s.params;return a&&(p=p.filter(function(x){return!x.match(/^access_token=/)})),p.length&&(h+="?"+p.join("&")),h},Hi.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&Di(a),h=[],p=0,x=t.tiles||[];p<x.length;p+=1){var S=x[p];pa(S)?h.push(this.canonicalizeTileURL(S,s)):h.push(S)}return h},Hi.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=La(jn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var p=t.params.indexOf("secure");p>=0&&t.params.splice(p,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!jn.REQUIRE_ACCESS_TOKEN)return ga(t);if(!(a=a||jn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(x){return x.indexOf("access_token")===-1}),t.params.push("access_token="+a),ga(t)};var Qi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function pa(t){return Qi.test(t)}var Lo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function La(t){var a=t.match(Lo);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function ga(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function Bi(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(ge.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var aa=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};aa.prototype.getStorageKey=function(t){var a,s=Bi(jn.ACCESS_TOKEN);return a=s&&s.u?ge.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(h,p){return String.fromCharCode(Number("0x"+p))})):jn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},aa.prototype.fetchEventData=function(){var t=Re("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var h=ge.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var p=ge.localStorage.getItem(s);p&&(this.anonId=p)}catch(x){Ke("Unable to read from LocalStorage")}},aa.prototype.saveEventData=function(){var t=Re("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{ge.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ge.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){Ke("Unable to write to LocalStorage")}},aa.prototype.processRequests=function(t){},aa.prototype.postEvent=function(t,a,s,h){var p=this;if(jn.EVENTS_URL){var x=La(jn.EVENTS_URL);x.params.push("access_token="+(h||jn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ha,userId:this.anonId},M=a?Mt(S,a):S,L={url:ga(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=ya(L,function(N){p.pendingRequest=null,s(N),p.saveEventData(),p.processRequests(h)})}},aa.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var Ji,Cs,le=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,h,p,x){this.skuToken=p,(jn.EVENTS_URL&&x||jn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(S){return Di(S)||pa(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},x)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var p=this.queue.shift(),x=p.id,S=p.timestamp;x&&this.success[x]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=lt()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||x&&(h.success[x]=!0)},s))}},a}(aa),ii=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,h){jn.EVENTS_URL&&jn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(p){return Di(p)||pa(p)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var p=Bi(jn.ACCESS_TOKEN),x=p?p.u:jn.ACCESS_TOKEN,S=x!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=lt(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),N=new Date(M),U=(M-this.eventData.lastSuccess)/864e5;S=S||U>=1||U<-1||L.getDate()!==N.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(V){V||(h.eventData.lastSuccess=M,h.eventData.tokenU=x)},s)}},a}(aa)),mo=ii.postTurnstileEvent.bind(ii),Js=new le,kt=Js.postMapLoadEvent.bind(Js),Kt=500,Ir=50;function nn(){ge.caches&&!Ji&&(Ji=ge.caches.open("mapbox-tiles"))}function Sn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var Bn,yi=1/0;function li(){return Bn==null&&(Bn=ge.OffscreenCanvas&&new ge.OffscreenCanvas(1,1).getContext("2d")&&typeof ge.createImageBitmap=="function"),Bn}var _n={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_n);var Oi=function(t){function a(s,h,p){h===401&&pa(p)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=h,this.url=p,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Mi=Vr()?function(){return self.worker&&self.worker.referrer}:function(){return(ge.location.protocol==="blob:"?ge.parent:ge).location.href},Ja,fs,Uo=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(Mi())&&!/^\w+:/.test(s))){if(ge.fetch&&ge.Request&&ge.AbortController&&ge.Request.prototype.hasOwnProperty("signal"))return function(h,p){var x,S=new ge.AbortController,M=new ge.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Mi(),signal:S.signal}),L=!1,N=!1,U=(x=M.url).indexOf("sku=")>0&&pa(x);h.type==="json"&&M.headers.set("Accept","application/json");var V=function(J,Ce,Te){if(!N){if(J&&J.message!=="SecurityError"&&Ke(J),Ce&&Te)return Y(Ce);var Ge=Date.now();ge.fetch(M).then(function(Ne){if(Ne.ok){var et=U?Ne.clone():null;return Y(Ne,et,Ge)}return p(new Oi(Ne.statusText,Ne.status,h.url))}).catch(function(Ne){Ne.code!==20&&p(new Error(Ne.message))})}},Y=function(J,Ce,Te){(h.type==="arrayBuffer"?J.arrayBuffer():h.type==="json"?J.json():J.text()).then(function(Ge){N||(Ce&&Te&&function(Ne,et,vt){if(nn(),Ji){var Lt={status:et.status,statusText:et.statusText,headers:new ge.Headers};et.headers.forEach(function(rr,wr){return Lt.headers.set(wr,rr)});var Bt=en(et.headers.get("Cache-Control")||"");Bt["no-store"]||(Bt["max-age"]&&Lt.headers.set("Expires",new Date(vt+1e3*Bt["max-age"]).toUTCString()),new Date(Lt.headers.get("Expires")).getTime()-vt<42e4||function(rr,wr){if(Cs===void 0)try{new Response(new ReadableStream),Cs=!0}catch(Zr){Cs=!1}Cs?wr(rr.body):rr.blob().then(wr)}(et,function(rr){var wr=new ge.Response(rr,Lt);nn(),Ji&&Ji.then(function(Zr){return Zr.put(Sn(Ne.url),wr)}).catch(function(Zr){return Ke(Zr.message)})}))}}(M,Ce,Te),L=!0,p(null,Ge,J.headers.get("Cache-Control"),J.headers.get("Expires")))}).catch(function(Ge){N||p(new Error(Ge.message))})};return U?function(J,Ce){if(nn(),!Ji)return Ce(null);var Te=Sn(J.url);Ji.then(function(Ge){Ge.match(Te).then(function(Ne){var et=function(vt){if(!vt)return!1;var Lt=new Date(vt.headers.get("Expires")||0),Bt=en(vt.headers.get("Cache-Control")||"");return Lt>Date.now()&&!Bt["no-cache"]}(Ne);Ge.delete(Te),et&&Ge.put(Te,Ne.clone()),Ce(null,Ne,et)}).catch(Ce)}).catch(Ce)}(M,V):V(null,null),{cancel:function(){N=!0,L||S.abort()}}}(t,a);if(Vr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(h,p){var x=new ge.XMLHttpRequest;for(var S in x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer"),h.headers)x.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=function(){p(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var M=x.response;if(h.type==="json")try{M=JSON.parse(x.response)}catch(L){return p(L)}p(null,M,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else p(new Oi(x.statusText,x.status,h.url))},x.send(h.body),{cancel:function(){return x.abort()}}}(t,a)},Fa=function(t,a){return Uo(Mt(t,{type:"arrayBuffer"}),a)},ya=function(t,a){return Uo(Mt(t,{method:"POST"}),a)},Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ja=[],fs=0;var X=function(t,a){if(ni.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),fs>=jn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ja.push(s),s}fs++;var h=!1,p=function(){if(!h)for(h=!0,fs--;Ja.length&&fs<jn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Ja.shift();S.cancelled||(S.cancel=X(S.requestParameters,S.callback).cancel)}},x=Fa(t,function(S,M,L,N){p(),S?a(S):M&&(li()?function(U,V){var Y=new ge.Blob([new Uint8Array(U)],{type:"image/png"});ge.createImageBitmap(Y).then(function(J){V(null,J)}).catch(function(J){V(new Error("Could not load image because of "+J.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,a):function(U,V,Y,J){var Ce=new ge.Image,Te=ge.URL;Ce.onload=function(){V(null,Ce),Te.revokeObjectURL(Ce.src),Ce.onload=null,ge.requestAnimationFrame(function(){Ce.src=Z})},Ce.onerror=function(){return V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ge=new ge.Blob([new Uint8Array(U)],{type:"image/png"});Ce.cacheControl=Y,Ce.expires=J,Ce.src=U.byteLength?Te.createObjectURL(Ge):Z}(M,a,L,N))});return{cancel:function(){x.cancel(),p()}}};function Q(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function fe(t,a,s){if(s&&s[t]){var h=s[t].indexOf(a);h!==-1&&s[t].splice(h,1)}}var Ae=function(t,a){a===void 0&&(a={}),Mt(this,a),this.type=t},Ze=function(t){function a(s,h){h===void 0&&(h={}),t.call(this,"error",Mt({error:s},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ae),qe=function(){};qe.prototype.on=function(t,a){return this._listeners=this._listeners||{},Q(t,a,this._listeners),this},qe.prototype.off=function(t,a){return fe(t,a,this._listeners),fe(t,a,this._oneTimeListeners),this},qe.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},Q(t,a,this._oneTimeListeners),this},qe.prototype.fire=function(t,a){typeof t=="string"&&(t=new Ae(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var h=0,p=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];h<p.length;h+=1)p[h].call(this,t);for(var x=0,S=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];x<S.length;x+=1){var M=S[x];fe(s,M,this._oneTimeListeners),M.call(this,t)}var L=this._eventedParent;L&&(Mt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(t))}else t instanceof Ze&&console.error(t.error);return this},qe.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},qe.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Oe=function(t,a,s,h){this.message=(t?t+": ":"")+s,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function st(t){var a=t.value;return a?[new Oe(t.key,a,"constants have been deprecated as of v8")]:[]}function fr(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,p=a;h<p.length;h+=1){var x=p[h];for(var S in x)t[S]=x[S]}return t}function At(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Pt(t){if(Array.isArray(t))return t.map(Pt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=Pt(t[s]);return a}return At(t)}var hr=function(t){function a(s,h){t.call(this,h),this.message=h,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),vn=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,h=a;s<h.length;s+=1){var p=h[s];this.bindings[p[0]]=p[1]}};vn.prototype.concat=function(t){return new vn(this,t)},vn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},vn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var sn={kind:"null"},Et={kind:"number"},qr={kind:"string"},Dr={kind:"boolean"},jr={kind:"color"},ci={kind:"object"},Kr={kind:"value"},Pn={kind:"collator"},Vi={kind:"formatted"},si={kind:"resolvedImage"};function Ci(t,a){return{kind:"array",itemType:t,N:a}}function gi(t){if(t.kind==="array"){var a=gi(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var _t=[sn,Et,qr,Dr,jr,Vi,ci,Ci(Kr),si];function jt(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!jt(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,h=_t;s<h.length;s+=1)if(!jt(h[s],a))return null}}return"Expected "+gi(t)+" but found "+gi(a)+" instead."}function Aa(t,a){return a.some(function(s){return s.kind===t.kind})}function xi(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var Ai=Ie(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function p(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function x(M){return(L=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:L>1?1:L;var L}function S(M,L,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?M+(L-M)*N*6:2*N<1?L:3*N<2?M+(L-M)*(2/3-N)*6:M}try{a.parseCSSColor=function(M){var L,N=M.replace(/ /g,"").toLowerCase();if(N in s)return s[N].slice();if(N[0]==="#")return N.length===4?(L=parseInt(N.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:N.length===7&&(L=parseInt(N.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var U=N.indexOf("("),V=N.indexOf(")");if(U!==-1&&V+1===N.length){var Y=N.substr(0,U),J=N.substr(U+1,V-(U+1)).split(","),Ce=1;switch(Y){case"rgba":if(J.length!==4)return null;Ce=x(J.pop());case"rgb":return J.length!==3?null:[p(J[0]),p(J[1]),p(J[2]),Ce];case"hsla":if(J.length!==4)return null;Ce=x(J.pop());case"hsl":if(J.length!==3)return null;var Te=(parseFloat(J[0])%360+360)%360/360,Ge=x(J[1]),Ne=x(J[2]),et=Ne<=.5?Ne*(Ge+1):Ne+Ge-Ne*Ge,vt=2*Ne-et;return[h(255*S(vt,et,Te+1/3)),h(255*S(vt,et,Te)),h(255*S(vt,et,Te-1/3)),Ce];default:return null}}return null}}catch(M){}}).parseCSSColor,Fi=function(t,a,s,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=s,this.a=h};Fi.parse=function(t){if(t){if(t instanceof Fi)return t;if(typeof t=="string"){var a=Ai(t);if(a)return new Fi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Fi.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+h+")"},Fi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Fi.black=new Fi(0,0,0,1),Fi.white=new Fi(1,1,1,1),Fi.transparent=new Fi(0,0,0,0),Fi.red=new Fi(1,0,0,1);var Hr=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Hr.prototype.compare=function(t,a){return this.collator.compare(t,a)},Hr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var En=function(t,a,s,h,p){this.text=t,this.image=a,this.scale=s,this.fontStack=h,this.textColor=p},Dt=function(t){this.sections=t};Dt.fromString=function(t){return new Dt([new En(t,null,null,null,null)])},Dt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Dt.factory=function(t){return t instanceof Dt?t:Dt.fromString(t)},Dt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Dt.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var p={};h.fontStack&&(p["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(p["font-scale"]=h.scale),h.textColor&&(p["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(p)}}return t};var ea=function(t){this.name=t.name,this.available=t.available};function ye(t,a,s,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,s,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,s,h]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Yo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Fi||t instanceof Hr||t instanceof Dt||t instanceof ea)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!Yo(s[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Yo(t[h]))return!1;return!0}return!1}function Yi(t){if(t===null)return sn;if(typeof t=="string")return qr;if(typeof t=="boolean")return Dr;if(typeof t=="number")return Et;if(t instanceof Fi)return jr;if(t instanceof Hr)return Pn;if(t instanceof Dt)return Vi;if(t instanceof ea)return si;if(Array.isArray(t)){for(var a,s=t.length,h=0,p=t;h<p.length;h+=1){var x=Yi(p[h]);if(a){if(a===x)continue;a=Kr;break}a=x}return Ci(a||Kr,s)}return ci}function fu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Fi||t instanceof Dt||t instanceof ea?t.toString():JSON.stringify(t)}ea.prototype.toString=function(){return this.name},ea.fromString=function(t){return t?new ea({name:t,available:!1}):null},ea.prototype.serialize=function(){return["image",this.name]};var Na=function(t,a){this.type=t,this.value=a};Na.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Yo(t[1]))return a.error("invalid value");var s=t[1],h=Yi(s),p=a.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Na(h,s)},Na.prototype.evaluate=function(){return this.value},Na.prototype.eachChild=function(){},Na.prototype.outputDefined=function(){return!0},Na.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toArray()):this.value instanceof Dt?this.value.serialize():this.value};var Ta=function(t){this.name="ExpressionEvaluationError",this.message=t};Ta.prototype.toJSON=function(){return this.message};var Ga={string:qr,number:Et,boolean:Dr,object:ci},ta=function(t,a){this.type=t,this.args=a};ta.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,h=1,p=t[0];if(p==="array"){var x,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in Ga)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ga[M],h++}else x=Kr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}s=Ci(x,S)}else s=Ga[p];for(var L=[];h<t.length;h++){var N=a.parse(t[h],h,Kr);if(!N)return null;L.push(N)}return new ta(s,L)},ta.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!jt(this.type,Yi(s)))return s;if(a===this.args.length-1)throw new Ta("Expected value to be of type "+gi(this.type)+", but found "+gi(Yi(s))+" instead.")}return null},ta.prototype.eachChild=function(t){this.args.forEach(t)},ta.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ta.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(p){return p.serialize()}))};var xo=function(t){this.type=Vi,this.sections=t};xo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var h=[],p=!1,x=1;x<=t.length-1;++x){var S=t[x];if(p&&typeof S=="object"&&!Array.isArray(S)){p=!1;var M=null;if(S["font-scale"]&&!(M=a.parse(S["font-scale"],1,Et)))return null;var L=null;if(S["text-font"]&&!(L=a.parse(S["text-font"],1,Ci(qr))))return null;var N=null;if(S["text-color"]&&!(N=a.parse(S["text-color"],1,jr)))return null;var U=h[h.length-1];U.scale=M,U.font=L,U.textColor=N}else{var V=a.parse(t[x],1,Kr);if(!V)return null;var Y=V.type.kind;if(Y!=="string"&&Y!=="value"&&Y!=="null"&&Y!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:V,scale:null,font:null,textColor:null})}}return new xo(h)},xo.prototype.evaluate=function(t){return new Dt(this.sections.map(function(a){var s=a.content.evaluate(t);return Yi(s)===si?new En("",s,null,null,null):new En(fu(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},xo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},xo.prototype.outputDefined=function(){return!1},xo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t.push(h.content.serialize());var p={};h.scale&&(p["font-scale"]=h.scale.serialize()),h.font&&(p["text-font"]=h.font.serialize()),h.textColor&&(p["text-color"]=h.textColor.serialize()),t.push(p)}return t};var Zo=function(t){this.type=si,this.input=t};Zo.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,qr);return s?new Zo(s):a.error("No image name provided.")},Zo.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=ea.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Zo.prototype.eachChild=function(t){t(this.input)},Zo.prototype.outputDefined=function(){return!1},Zo.prototype.serialize=function(){return["image",this.input.serialize()]};var wu={"to-boolean":Dr,"to-color":jr,"to-number":Et,"to-string":qr},lo=function(t,a){this.type=t,this.args=a};lo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=wu[s],p=[],x=1;x<t.length;x++){var S=a.parse(t[x],x,Kr);if(!S)return null;p.push(S)}return new lo(h,p)},lo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,h=0,p=this.args;h<p.length;h+=1){if(s=null,(a=p[h].evaluate(t))instanceof Fi)return a;if(typeof a=="string"){var x=t.parseColor(a);if(x)return x}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":ye(a[0],a[1],a[2],a[3])))return new Fi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ta(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,L=this.args;M<L.length;M+=1){if((S=L[M].evaluate(t))===null)return 0;var N=Number(S);if(!isNaN(N))return N}throw new Ta("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Dt.fromString(fu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ea.fromString(fu(this.args[0].evaluate(t))):fu(this.args[0].evaluate(t))},lo.prototype.eachChild=function(t){this.args.forEach(t)},lo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},lo.prototype.serialize=function(){if(this.type.kind==="formatted")return new xo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var ko=["Unknown","Point","LineString","Polygon"],ra=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ra.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ra.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ko[this.feature.type]:this.feature.type:null},ra.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ra.prototype.canonicalID=function(){return this.canonical},ra.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ra.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Fi.parse(t)),a};var Ha=function(t,a,s,h){this.name=t,this.type=a,this._evaluate=s,this.args=h};Ha.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ha.prototype.eachChild=function(t){this.args.forEach(t)},Ha.prototype.outputDefined=function(){return!1},Ha.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ha.parse=function(t,a){var s,h=t[0],p=Ha.definitions[h];if(!p)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var x=Array.isArray(p)?p[0]:p.type,S=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,M=S.filter(function(Un){var un=Un[0];return!Array.isArray(un)||un.length===t.length-1}),L=null,N=0,U=M;N<U.length;N+=1){var V=U[N],Y=V[0],J=V[1];L=new Ds(a.registry,a.path,null,a.scope);for(var Ce=[],Te=!1,Ge=1;Ge<t.length;Ge++){var Ne=t[Ge],et=Array.isArray(Y)?Y[Ge-1]:Y.type,vt=L.parse(Ne,1+Ce.length,et);if(!vt){Te=!0;break}Ce.push(vt)}if(!Te)if(Array.isArray(Y)&&Y.length!==Ce.length)L.error("Expected "+Y.length+" arguments, but found "+Ce.length+" instead.");else{for(var Lt=0;Lt<Ce.length;Lt++){var Bt=Array.isArray(Y)?Y[Lt]:Y.type,rr=Ce[Lt];L.concat(Lt+1).checkSubtype(Bt,rr.type)}if(L.errors.length===0)return new Ha(h,x,J,Ce)}}if(M.length===1)(s=a.errors).push.apply(s,L.errors);else{for(var wr=(M.length?M:S).map(function(Un){var un;return un=Un[0],Array.isArray(un)?"("+un.map(gi).join(", ")+")":"("+gi(un.type)+"...)"}).join(" | "),Zr=[],Mn=1;Mn<t.length;Mn++){var on=a.parse(t[Mn],1+Zr.length);if(!on)return null;Zr.push(gi(on.type))}a.error("Expected arguments of type "+wr+", but found ("+Zr.join(", ")+") instead.")}return null},Ha.register=function(t,a){for(var s in Ha.definitions=a,a)t[s]=Ha};var Do=function(t,a,s){this.type=Pn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function Wa(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function As(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function Sl(t,a){var s=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,p=Math.pow(2,a.z);return[Math.round(s*p*8192),Math.round(h*p*8192)]}function hs(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function K(t,a){for(var s,h,p,x,S,M,L,N=!1,U=0,V=a.length;U<V;U++)for(var Y=a[U],J=0,Ce=Y.length;J<Ce-1;J++){if((x=(s=t)[0]-(h=Y[J])[0])*(L=s[1]-(p=Y[J+1])[1])-(M=s[0]-p[0])*(S=s[1]-h[1])==0&&x*M<=0&&S*L<=0)return!1;hs(t,Y[J],Y[J+1])&&(N=!N)}return N}function ve(t,a){for(var s=0;s<a.length;s++)if(K(t,a[s]))return!0;return!1}function He(t,a,s,h){var p=h[0]-s[0],x=h[1]-s[1],S=(t[0]-s[0])*x-p*(t[1]-s[1]),M=(a[0]-s[0])*x-p*(a[1]-s[1]);return S>0&&M<0||S<0&&M>0}function wt(t,a,s){for(var h=0,p=s;h<p.length;h+=1)for(var x=p[h],S=0;S<x.length-1;++S)if((V=[(U=x[S+1])[0]-(N=x[S])[0],U[1]-N[1]])[0]*(Y=[(L=a)[0]-(M=t)[0],L[1]-M[1]])[1]-V[1]*Y[0]!=0&&He(M,L,N,U)&&He(N,U,M,L))return!0;var M,L,N,U,V,Y;return!1}function Mr(t,a){for(var s=0;s<t.length;++s)if(!K(t[s],a))return!1;for(var h=0;h<t.length-1;++h)if(wt(t[h],t[h+1],a))return!1;return!0}function Cn(t,a){for(var s=0;s<a.length;s++)if(Mr(t,a[s]))return!0;return!1}function Ti(t,a,s){for(var h=[],p=0;p<t.length;p++){for(var x=[],S=0;S<t[p].length;S++){var M=Sl(t[p][S],s);Wa(a,M),x.push(M)}h.push(x)}return h}function eo(t,a,s){for(var h=[],p=0;p<t.length;p++){var x=Ti(t[p],a,s);h.push(x)}return h}function ka(t,a,s,h){if(t[0]<s[0]||t[0]>s[2]){var p=.5*h,x=t[0]-s[0]>p?-h:s[0]-t[0]>p?h:0;x===0&&(x=t[0]-s[2]>p?-h:s[2]-t[0]>p?h:0),t[0]+=x}Wa(a,t)}function Ba(t,a,s,h){for(var p=8192*Math.pow(2,h.z),x=[8192*h.x,8192*h.y],S=[],M=0,L=t;M<L.length;M+=1)for(var N=0,U=L[M];N<U.length;N+=1){var V=U[N],Y=[V.x+x[0],V.y+x[1]];ka(Y,a,s,p),S.push(Y)}return S}function Vo(t,a,s,h){for(var p,x=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],M=[],L=0,N=t;L<N.length;L+=1){for(var U=[],V=0,Y=N[L];V<Y.length;V+=1){var J=Y[V],Ce=[J.x+S[0],J.y+S[1]];Wa(a,Ce),U.push(Ce)}M.push(U)}if(a[2]-a[0]<=x/2){(p=a)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(var Te=0,Ge=M;Te<Ge.length;Te+=1)for(var Ne=0,et=Ge[Te];Ne<et.length;Ne+=1)ka(et[Ne],a,s,x)}return M}Do.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var h=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Dr);if(!h)return null;var p=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Dr);if(!p)return null;var x=null;return s.locale&&!(x=a.parse(s.locale,1,qr))?null:new Do(h,p,x)},Do.prototype.evaluate=function(t){return new Hr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Do.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ps=function(t,a){this.type=Dr,this.geojson=t,this.geometries=a};function io(t){if(t instanceof Ha&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ps)return!1;var a=!0;return t.eachChild(function(s){a&&!io(s)&&(a=!1)}),a}function bo(t){if(t instanceof Ha&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!bo(s)&&(a=!1)}),a}function ds(t,a){if(t instanceof Ha&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(h){s&&!ds(h,a)&&(s=!1)}),s}ps.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Yo(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var h=0;h<s.features.length;++h){var p=s.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ps(s,s.features[h].geometry)}else if(s.type==="Feature"){var x=s.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new ps(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ps(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ps.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(s.type==="Polygon"){var S=Ti(s.coordinates,p,x),M=Ba(a.geometry(),h,p,x);if(!As(h,p))return!1;for(var L=0,N=M;L<N.length;L+=1)if(!K(N[L],S))return!1}if(s.type==="MultiPolygon"){var U=eo(s.coordinates,p,x),V=Ba(a.geometry(),h,p,x);if(!As(h,p))return!1;for(var Y=0,J=V;Y<J.length;Y+=1)if(!ve(J[Y],U))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(s.type==="Polygon"){var S=Ti(s.coordinates,p,x),M=Vo(a.geometry(),h,p,x);if(!As(h,p))return!1;for(var L=0,N=M;L<N.length;L+=1)if(!Mr(N[L],S))return!1}if(s.type==="MultiPolygon"){var U=eo(s.coordinates,p,x),V=Vo(a.geometry(),h,p,x);if(!As(h,p))return!1;for(var Y=0,J=V;Y<J.length;Y+=1)if(!Cn(J[Y],U))return!1}return!0}(t,this.geometries)}return!1},ps.prototype.eachChild=function(){},ps.prototype.outputDefined=function(){return!0},ps.prototype.serialize=function(){return["within",this.geojson]};var Ts=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};Ts.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new Ts(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},Ts.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ts.prototype.eachChild=function(){},Ts.prototype.outputDefined=function(){return!1},Ts.prototype.serialize=function(){return["var",this.name]};var Ds=function(t,a,s,h,p){a===void 0&&(a=[]),h===void 0&&(h=new vn),p===void 0&&(p=[]),this.registry=t,this.path=a,this.key=a.map(function(x){return"["+x+"]"}).join(""),this.scope=h,this.errors=p,this.expectedType=s};function eu(t,a){for(var s,h=t.length-1,p=0,x=h,S=0;p<=x;)if((s=t[S=Math.floor((p+x)/2)])<=a){if(S===h||a<t[S+1])return S;p=S+1}else{if(!(s>a))throw new Ta("Input is not a number.");x=S-1}return 0}Ds.prototype.parse=function(t,a,s,h,p){return p===void 0&&(p={}),a?this.concat(a,s,h)._parse(t,p):this._parse(t,p)},Ds.prototype._parse=function(t,a){function s(N,U,V){return V==="assert"?new ta(U,[N]):V==="coerce"?new lo(U,[N]):N}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var p=this.registry[h];if(p){var x=p.parse(t,this);if(!x)return null;if(this.expectedType){var S=this.expectedType,M=x.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else x=s(x,S,a.typeAnnotation||"coerce");else x=s(x,S,a.typeAnnotation||"assert")}if(!(x instanceof Na)&&x.type.kind!=="resolvedImage"&&function N(U){if(U instanceof Ts)return N(U.boundExpression);if(U instanceof Ha&&U.name==="error"||U instanceof Do||U instanceof ps)return!1;var V=U instanceof lo||U instanceof ta,Y=!0;return U.eachChild(function(J){Y=V?Y&&N(J):Y&&J instanceof Na}),!!Y&&io(U)&&ds(U,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(x)){var L=new ra;try{x=new Na(x.type,x.evaluate(L))}catch(N){return this.error(N.message),null}}return x}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ds.prototype.concat=function(t,a,s){var h=typeof t=="number"?this.path.concat(t):this.path,p=s?this.scope.concat(s):this.scope;return new Ds(this.registry,h,a||null,p,this.errors)},Ds.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var h=""+this.key+a.map(function(p){return"["+p+"]"}).join("");this.errors.push(new hr(h,t))},Ds.prototype.checkSubtype=function(t,a){var s=jt(t,a);return s&&this.error(s),s};var vs=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,p=s;h<p.length;h+=1){var x=p[h],S=x[1];this.labels.push(x[0]),this.outputs.push(S)}};function da(t,a,s){return t*(1-s)+a*s}vs.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Et);if(!s)return null;var h=[],p=null;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);for(var x=1;x<t.length;x+=2){var S=x===1?-1/0:t[x],M=t[x+1],L=x,N=x+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(h.length&&h[h.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var U=a.parse(M,N,p);if(!U)return null;p=p||U.type,h.push([S,U])}return new vs(p,s,h)},vs.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var p=a.length;return h>=a[p-1]?s[p-1].evaluate(t):s[eu(a,h)].evaluate(t)},vs.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},vs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},vs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var ma=Object.freeze({__proto__:null,number:da,color:function(t,a,s){return new Fi(da(t.r,a.r,s),da(t.g,a.g,s),da(t.b,a.b,s),da(t.a,a.a,s))},array:function(t,a,s){return t.map(function(h,p){return da(h,a[p],s)})}}),ts=6/29*3*(6/29),ef=Math.PI/180,wl=180/Math.PI;function Gs(t){return t>.008856451679035631?Math.pow(t,1/3):t/ts+4/29}function Ql(t){return t>6/29?t*t*t:ts*(t-4/29)}function zu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Hs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function il(t){var a=Hs(t.r),s=Hs(t.g),h=Hs(t.b),p=Gs((.4124564*a+.3575761*s+.1804375*h)/.95047),x=Gs((.2126729*a+.7151522*s+.072175*h)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-Gs((.0193339*a+.119192*s+.9503041*h)/1.08883)),alpha:t.a}}function g(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*Ql(a),s=.95047*Ql(s),h=1.08883*Ql(h),new Fi(zu(3.2404542*s-1.5371385*a-.4985314*h),zu(-.969266*s+1.8760108*a+.041556*h),zu(.0556434*s-.2040259*a+1.0572252*h),t.alpha)}function A(t,a,s){var h=a-t;return t+s*(h>180||h<-180?h-360*Math.round(h/360):h)}var D={forward:il,reverse:g,interpolate:function(t,a,s){return{l:da(t.l,a.l,s),a:da(t.a,a.a,s),b:da(t.b,a.b,s),alpha:da(t.alpha,a.alpha,s)}}},O={forward:function(t){var a=il(t),s=a.l,h=a.a,p=a.b,x=Math.atan2(p,h)*wl;return{h:x<0?x+360:x,c:Math.sqrt(h*h+p*p),l:s,alpha:t.a}},reverse:function(t){var a=t.h*ef,s=t.c;return g({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:A(t.h,a.h,s),c:da(t.c,a.c,s),l:da(t.l,a.l,s),alpha:da(t.alpha,a.alpha,s)}}},H=Object.freeze({__proto__:null,lab:D,hcl:O}),de=function(t,a,s,h,p){this.type=t,this.operator=a,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(var x=0,S=p;x<S.length;x+=1){var M=S[x],L=M[1];this.labels.push(M[0]),this.outputs.push(L)}};function je(t,a,s,h){var p=h-s,x=t-s;return p===0?0:a===1?x/p:(Math.pow(a,x)-1)/(Math.pow(a,p)-1)}de.interpolationFactor=function(t,a,s,h){var p=0;if(t.name==="exponential")p=je(a,t.base,s,h);else if(t.name==="linear")p=je(a,1,s,h);else if(t.name==="cubic-bezier"){var x=t.controlPoints;p=new G(x[0],x[1],x[2],x[3]).solve(je(a,1,s,h))}return p},de.parse=function(t,a){var s=t[0],h=t[1],p=t[2],x=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(Ge){return typeof Ge!="number"||Ge<0||Ge>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(p=a.parse(p,2,Et)))return null;var L=[],N=null;s==="interpolate-hcl"||s==="interpolate-lab"?N=jr:a.expectedType&&a.expectedType.kind!=="value"&&(N=a.expectedType);for(var U=0;U<x.length;U+=2){var V=x[U],Y=x[U+1],J=U+3,Ce=U+4;if(typeof V!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(L.length&&L[L.length-1][0]>=V)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);var Te=a.parse(Y,Ce,N);if(!Te)return null;N=N||Te.type,L.push([V,Te])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new de(N,s,h,p,L):a.error("Type "+gi(N)+" is not interpolatable.")},de.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var p=a.length;if(h>=a[p-1])return s[p-1].evaluate(t);var x=eu(a,h),S=de.interpolationFactor(this.interpolation,h,a[x],a[x+1]),M=s[x].evaluate(t),L=s[x+1].evaluate(t);return this.operator==="interpolate"?ma[this.type.kind.toLowerCase()](M,L,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(L),S)):D.reverse(D.interpolate(D.forward(M),D.forward(L),S))},de.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},de.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},de.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var it=function(t,a){this.type=t,this.args=a};it.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,h=a.expectedType;h&&h.kind!=="value"&&(s=h);for(var p=[],x=0,S=t.slice(1);x<S.length;x+=1){var M=a.parse(S[x],1+p.length,s,void 0,{typeAnnotation:"omit"});if(!M)return null;s=s||M.type,p.push(M)}var L=h&&p.some(function(N){return jt(h,N.type)});return new it(L?Kr:s,p)},it.prototype.evaluate=function(t){for(var a,s=null,h=0,p=0,x=this.args;p<x.length&&(h++,(s=x[p].evaluate(t))&&s instanceof ea&&!s.available&&(a||(a=s.name),s=null,h===this.args.length&&(s=a)),s===null);p+=1);return s},it.prototype.eachChild=function(t){this.args.forEach(t)},it.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},it.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var at=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};at.prototype.evaluate=function(t){return this.result.evaluate(t)},at.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},at.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],h=1;h<t.length-1;h+=2){var p=t[h];if(typeof p!="string")return a.error("Expected string, but found "+typeof p+" instead.",h);if(/[^a-zA-Z0-9_]/.test(p))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var x=a.parse(t[h+1],h+1);if(!x)return null;s.push([p,x])}var S=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return S?new at(s,S):null},at.prototype.outputDefined=function(){return this.result.outputDefined()},at.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var h=s[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var er=function(t,a,s){this.type=t,this.index=a,this.input=s};er.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Et),h=a.parse(t[2],2,Ci(a.expectedType||Kr));return s&&h?new er(h.type.itemType,s,h):null},er.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new Ta("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new Ta("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new Ta("Array index must be an integer, but found "+a+" instead.");return s[a]},er.prototype.eachChild=function(t){t(this.index),t(this.input)},er.prototype.outputDefined=function(){return!1},er.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ar=function(t,a){this.type=Dr,this.needle=t,this.haystack=a};ar.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Kr),h=a.parse(t[2],2,Kr);return s&&h?Aa(s.type,[Dr,qr,Et,sn,Kr])?new ar(s,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(s.type)+" instead"):null},ar.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!xi(a,["boolean","string","number","null"]))throw new Ta("Expected first argument to be of type boolean, string, number or null, but found "+gi(Yi(a))+" instead.");if(!xi(s,["string","array"]))throw new Ta("Expected second argument to be of type array or string, but found "+gi(Yi(s))+" instead.");return s.indexOf(a)>=0},ar.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ar.prototype.outputDefined=function(){return!0},ar.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var wn=function(t,a,s){this.type=Et,this.needle=t,this.haystack=a,this.fromIndex=s};wn.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Kr),h=a.parse(t[2],2,Kr);if(!s||!h)return null;if(!Aa(s.type,[Dr,qr,Et,sn,Kr]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(s.type)+" instead");if(t.length===4){var p=a.parse(t[3],3,Et);return p?new wn(s,h,p):null}return new wn(s,h)},wn.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!xi(a,["boolean","string","number","null"]))throw new Ta("Expected first argument to be of type boolean, string, number or null, but found "+gi(Yi(a))+" instead.");if(!xi(s,["string","array"]))throw new Ta("Expected second argument to be of type array or string, but found "+gi(Yi(s))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return s.indexOf(a,h)}return s.indexOf(a)},wn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},wn.prototype.outputDefined=function(){return!1},wn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Qn=function(t,a,s,h,p,x){this.inputType=t,this.type=a,this.input=s,this.cases=h,this.outputs=p,this.otherwise=x};Qn.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var p={},x=[],S=2;S<t.length-1;S+=2){var M=t[S],L=t[S+1];Array.isArray(M)||(M=[M]);var N=a.concat(S);if(M.length===0)return N.error("Expected at least one branch label.");for(var U=0,V=M;U<V.length;U+=1){var Y=V[U];if(typeof Y!="number"&&typeof Y!="string")return N.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Y=="number"&&Math.floor(Y)!==Y)return N.error("Numeric branch labels must be integer values.");if(s){if(N.checkSubtype(s,Yi(Y)))return null}else s=Yi(Y);if(p[String(Y)]!==void 0)return N.error("Branch labels must be unique.");p[String(Y)]=x.length}var J=a.parse(L,S,h);if(!J)return null;h=h||J.type,x.push(J)}var Ce=a.parse(t[1],1,Kr);if(!Ce)return null;var Te=a.parse(t[t.length-1],t.length-1,h);return Te?Ce.type.kind!=="value"&&a.concat(1).checkSubtype(s,Ce.type)?null:new Qn(s,h,Ce,p,x,Te):null},Qn.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(Yi(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},Qn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Qn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Qn.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],h={},p=0,x=Object.keys(this.cases).sort();p<x.length;p+=1){var S=x[p];(V=h[this.cases[S]])===void 0?(h[this.cases[S]]=s.length,s.push([this.cases[S],[S]])):s[V][1].push(S)}for(var M=function(J){return t.inputType.kind==="number"?Number(J):J},L=0,N=s;L<N.length;L+=1){var U=N[L],V=U[0],Y=U[1];a.push(Y.length===1?M(Y[0]):Y.map(M)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var On=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};On.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var h=[],p=1;p<t.length-1;p+=2){var x=a.parse(t[p],p,Dr);if(!x)return null;var S=a.parse(t[p+1],p+1,s);if(!S)return null;h.push([x,S]),s=s||S.type}var M=a.parse(t[t.length-1],t.length-1,s);return M?new On(s,h,M):null},On.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],p=h[1];if(h[0].evaluate(t))return p.evaluate(t)}return this.otherwise.evaluate(t)},On.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],p=h[1];t(h[0]),t(p)}t(this.otherwise)},On.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},On.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var ji=function(t,a,s,h){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=h};function ca(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Ea(t,a,s,h){return h.compare(a,s)===0}function zi(t,a,s){var h=t!=="=="&&t!=="!=";return function(){function p(x,S,M){this.type=Dr,this.lhs=x,this.rhs=S,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}return p.parse=function(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");var M=x[0],L=S.parse(x[1],1,Kr);if(!L)return null;if(!ca(M,L.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+gi(L.type)+"'.");var N=S.parse(x[2],2,Kr);if(!N)return null;if(!ca(M,N.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+gi(N.type)+"'.");if(L.type.kind!==N.type.kind&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot compare types '"+gi(L.type)+"' and '"+gi(N.type)+"'.");h&&(L.type.kind==="value"&&N.type.kind!=="value"?L=new ta(N.type,[L]):L.type.kind!=="value"&&N.type.kind==="value"&&(N=new ta(L.type,[N])));var U=null;if(x.length===4){if(L.type.kind!=="string"&&N.type.kind!=="string"&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(U=S.parse(x[3],3,Pn)))return null}return new p(L,N,U)},p.prototype.evaluate=function(x){var S=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){var L=Yi(S),N=Yi(M);if(L.kind!==N.kind||L.kind!=="string"&&L.kind!=="number")throw new Ta('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+L.kind+", "+N.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var U=Yi(S),V=Yi(M);if(U.kind!=="string"||V.kind!=="string")return a(x,S,M)}return this.collator?s(x,S,M,this.collator.evaluate(x)):a(x,S,M)},p.prototype.eachChild=function(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)},p.prototype.outputDefined=function(){return!0},p.prototype.serialize=function(){var x=[t];return this.eachChild(function(S){x.push(S.serialize())}),x},p}()}ji.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Kr),h=a.parse(t[2],2,Et);if(!s||!h)return null;if(!Aa(s.type,[Ci(Kr),qr,Kr]))return a.error("Expected first argument to be of type array or string, but found "+gi(s.type)+" instead");if(t.length===4){var p=a.parse(t[3],3,Et);return p?new ji(s.type,s,h,p):null}return new ji(s.type,s,h)},ji.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!xi(a,["string","array"]))throw new Ta("Expected first argument to be of type array or string, but found "+gi(Yi(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(s,h)}return a.slice(s)},ji.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},ji.prototype.outputDefined=function(){return!1},ji.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ms=zi("==",function(t,a,s){return a===s},Ea),tu=zi("!=",function(t,a,s){return a!==s},function(t,a,s,h){return!Ea(0,a,s,h)}),Uu=zi("<",function(t,a,s){return a<s},function(t,a,s,h){return h.compare(a,s)<0}),tf=zi(">",function(t,a,s){return a>s},function(t,a,s,h){return h.compare(a,s)>0}),al=zi("<=",function(t,a,s){return a<=s},function(t,a,s,h){return h.compare(a,s)<=0}),Tc=zi(">=",function(t,a,s){return a>=s},function(t,a,s,h){return h.compare(a,s)>=0}),Cu=function(t,a,s,h,p){this.type=qr,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=p};Cu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Et);if(!s)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var p=null;if(h.locale&&!(p=a.parse(h.locale,1,qr)))return null;var x=null;if(h.currency&&!(x=a.parse(h.currency,1,qr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=a.parse(h["min-fraction-digits"],1,Et)))return null;var M=null;return h["max-fraction-digits"]&&!(M=a.parse(h["max-fraction-digits"],1,Et))?null:new Cu(s,p,x,S,M)},Cu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Cu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Cu.prototype.outputDefined=function(){return!1},Cu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Au=function(t){this.type=Et,this.input=t};Au.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+gi(s.type)+" instead."):new Au(s):null},Au.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ta("Expected value to be of type string or array, but found "+gi(Yi(a))+" instead.")},Au.prototype.eachChild=function(t){t(this.input)},Au.prototype.outputDefined=function(){return!1},Au.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Tu={"==":ms,"!=":tu,">":tf,"<":Uu,">=":Tc,"<=":al,array:ta,at:er,boolean:ta,case:On,coalesce:it,collator:Do,format:xo,image:Zo,in:ar,"index-of":wn,interpolate:de,"interpolate-hcl":de,"interpolate-lab":de,length:Au,let:at,literal:Na,match:Qn,number:ta,"number-format":Cu,object:ta,slice:ji,step:vs,string:ta,"to-boolean":lo,"to-color":lo,"to-number":lo,"to-string":lo,var:Ts,within:ps};function ao(t,a){var s=a[0],h=a[1],p=a[2],x=a[3];s=s.evaluate(t),h=h.evaluate(t),p=p.evaluate(t);var S=x?x.evaluate(t):1,M=ye(s,h,p,S);if(M)throw new Ta(M);return new Fi(s/255*S,h/255*S,p/255*S,S)}function Ff(t,a){return t in a}function Nf(t,a){var s=a[t];return s===void 0?null:s}function qo(t){return{type:t}}function Mc(t){return{result:"success",value:t}}function Mu(t){return{result:"error",value:t}}function ru(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function rf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Cl(t){return!!t.expression&&t.expression.interpolated}function Ri(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Al(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function xh(t){return t}function ol(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function Pc(t,a,s,h,p){return ol(typeof s===p?h[s]:void 0,t.default,a.default)}function Bf(t,a,s){if(Ri(s)!=="number")return ol(t.default,a.default);var h=t.stops.length;if(h===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[h-1][0])return t.stops[h-1][1];var p=eu(t.stops.map(function(x){return x[0]}),s);return t.stops[p][1]}function bh(t,a,s){var h=t.base!==void 0?t.base:1;if(Ri(s)!=="number")return ol(t.default,a.default);var p=t.stops.length;if(p===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[p-1][0])return t.stops[p-1][1];var x=eu(t.stops.map(function(V){return V[0]}),s),S=function(V,Y,J,Ce){var Te=Ce-J,Ge=V-J;return Te===0?0:Y===1?Ge/Te:(Math.pow(Y,Ge)-1)/(Math.pow(Y,Te)-1)}(s,h,t.stops[x][0],t.stops[x+1][0]),M=t.stops[x][1],L=t.stops[x+1][1],N=ma[a.type]||xh;if(t.colorSpace&&t.colorSpace!=="rgb"){var U=H[t.colorSpace];N=function(V,Y){return U.reverse(U.interpolate(U.forward(V),U.forward(Y),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var V=[],Y=arguments.length;Y--;)V[Y]=arguments[Y];var J=M.evaluate.apply(void 0,V),Ce=L.evaluate.apply(void 0,V);if(J!==void 0&&Ce!==void 0)return N(J,Ce,S)}}:N(M,L,S)}function zf(t,a,s){return a.type==="color"?s=Fi.parse(s):a.type==="formatted"?s=Dt.fromString(s.toString()):a.type==="resolvedImage"?s=ea.fromString(s.toString()):Ri(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),ol(s,t.default,a.default)}Ha.register(Tu,{error:[{kind:"error"},[qr],function(t,a){throw new Ta(a[0].evaluate(t))}],typeof:[qr,[Kr],function(t,a){return gi(Yi(a[0].evaluate(t)))}],"to-rgba":[Ci(Et,4),[jr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[jr,[Et,Et,Et],ao],rgba:[jr,[Et,Et,Et,Et],ao],has:{type:Dr,overloads:[[[qr],function(t,a){return Ff(a[0].evaluate(t),t.properties())}],[[qr,ci],function(t,a){var s=a[1];return Ff(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:Kr,overloads:[[[qr],function(t,a){return Nf(a[0].evaluate(t),t.properties())}],[[qr,ci],function(t,a){var s=a[1];return Nf(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[Kr,[qr],function(t,a){return Nf(a[0].evaluate(t),t.featureState||{})}],properties:[ci,[],function(t){return t.properties()}],"geometry-type":[qr,[],function(t){return t.geometryType()}],id:[Kr,[],function(t){return t.id()}],zoom:[Et,[],function(t){return t.globals.zoom}],"heatmap-density":[Et,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Et,[],function(t){return t.globals.lineProgress||0}],accumulated:[Kr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Et,qo(Et),function(t,a){for(var s=0,h=0,p=a;h<p.length;h+=1)s+=p[h].evaluate(t);return s}],"*":[Et,qo(Et),function(t,a){for(var s=1,h=0,p=a;h<p.length;h+=1)s*=p[h].evaluate(t);return s}],"-":{type:Et,overloads:[[[Et,Et],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Et],function(t,a){return-a[0].evaluate(t)}]]},"/":[Et,[Et,Et],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Et,[Et,Et],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Et,[],function(){return Math.LN2}],pi:[Et,[],function(){return Math.PI}],e:[Et,[],function(){return Math.E}],"^":[Et,[Et,Et],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Et,[Et],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Et,[Et],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Et,[Et],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Et,[Et],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Et,[Et],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Et,[Et],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Et,[Et],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Et,[Et],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Et,[Et],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Et,[Et],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Et,qo(Et),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Et,qo(Et),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Et,[Et],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Et,[Et],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Et,[Et],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Et,[Et],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Dr,[qr,Kr],function(t,a){var s=a[0],h=a[1];return t.properties()[s.value]===h.value}],"filter-id-==":[Dr,[Kr],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[Dr,[qr],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[Dr,[qr,Kr],function(t,a){var s=a[0],h=a[1],p=t.properties()[s.value],x=h.value;return typeof p==typeof x&&p<x}],"filter-id-<":[Dr,[Kr],function(t,a){var s=a[0],h=t.id(),p=s.value;return typeof h==typeof p&&h<p}],"filter->":[Dr,[qr,Kr],function(t,a){var s=a[0],h=a[1],p=t.properties()[s.value],x=h.value;return typeof p==typeof x&&p>x}],"filter-id->":[Dr,[Kr],function(t,a){var s=a[0],h=t.id(),p=s.value;return typeof h==typeof p&&h>p}],"filter-<=":[Dr,[qr,Kr],function(t,a){var s=a[0],h=a[1],p=t.properties()[s.value],x=h.value;return typeof p==typeof x&&p<=x}],"filter-id-<=":[Dr,[Kr],function(t,a){var s=a[0],h=t.id(),p=s.value;return typeof h==typeof p&&h<=p}],"filter->=":[Dr,[qr,Kr],function(t,a){var s=a[0],h=a[1],p=t.properties()[s.value],x=h.value;return typeof p==typeof x&&p>=x}],"filter-id->=":[Dr,[Kr],function(t,a){var s=a[0],h=t.id(),p=s.value;return typeof h==typeof p&&h>=p}],"filter-has":[Dr,[Kr],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Dr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Dr,[Ci(qr)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Dr,[Ci(Kr)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Dr,[qr,Ci(Kr)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[Dr,[qr,Ci(Kr)],function(t,a){var s=a[0],h=a[1];return function(p,x,S,M){for(;S<=M;){var L=S+M>>1;if(x[L]===p)return!0;x[L]>p?M=L-1:S=L+1}return!1}(t.properties()[s.value],h.value,0,h.value.length-1)}],all:{type:Dr,overloads:[[[Dr,Dr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[qo(Dr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(!h[s].evaluate(t))return!1;return!0}]]},any:{type:Dr,overloads:[[[Dr,Dr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[qo(Dr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(h[s].evaluate(t))return!0;return!1}]]},"!":[Dr,[Dr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Dr,[qr],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[qr,[qr],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[qr,[qr],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[qr,qo(Kr),function(t,a){return a.map(function(s){return fu(s.evaluate(t))}).join("")}],"resolved-locale":[qr,[Pn],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var Ic=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new ra,this._defaultValue=a?function(s){return s.type==="color"&&Al(s.default)?new Fi(0,0,0,0):s.type==="color"?Fi.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function Jl(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Tu}function ec(t,a){var s=new Ds(Tu,[],a?function(p){var x={color:jr,string:qr,number:Et,enum:qr,boolean:Dr,formatted:Vi,resolvedImage:si};return p.type==="array"?Ci(x[p.value]||Kr,p.length):x[p.type]}(a):void 0),h=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Mc(new Ic(h,a)):Mu(s.errors)}Ic.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,p,x){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)},Ic.prototype.evaluate=function(t,a,s,h,p,x){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=x||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ta("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Tl=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!bo(a.expression)};Tl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,p,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,p,x)},Tl.prototype.evaluate=function(t,a,s,h,p,x){return this._styleExpression.evaluate(t,a,s,h,p,x)};var sl=function(t,a,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!bo(a.expression),this.interpolationType=h};function Ml(t,a){if((t=ec(t,a)).result==="error")return t;var s=t.value.expression,h=io(s);if(!h&&!ru(a))return Mu([new hr("","data expressions not supported")]);var p=ds(s,["zoom"]);if(!p&&!rf(a))return Mu([new hr("","zoom expressions not supported")]);var x=function S(M){var L=null;if(M instanceof at)L=S(M.result);else if(M instanceof it)for(var N=0,U=M.args;N<U.length&&!(L=S(U[N]));N+=1);else(M instanceof vs||M instanceof de)&&M.input instanceof Ha&&M.input.name==="zoom"&&(L=M);return L instanceof hr||M.eachChild(function(V){var Y=S(V);Y instanceof hr?L=Y:!L&&Y?L=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&Y&&L!==Y&&(L=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(s);return x||p?x instanceof hr?Mu([x]):x instanceof de&&!Cl(a)?Mu([new hr("",'"interpolate" expressions cannot be used with this property')]):Mc(x?new sl(h?"camera":"composite",t.value,x.labels,x instanceof de?x.interpolation:void 0):new Tl(h?"constant":"source",t.value)):Mu([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}sl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,p,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,p,x)},sl.prototype.evaluate=function(t,a,s,h,p,x){return this._styleExpression.evaluate(t,a,s,h,p,x)},sl.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?de.interpolationFactor(this.interpolationType,t,a,s):0};var Zu=function(t,a){this._parameters=t,this._specification=a,fr(this,function s(h,p){var x,S,M,L=p.type==="color",N=h.stops&&typeof h.stops[0][0]=="object",U=N||!(N||h.property!==void 0),V=h.type||(Cl(p)?"exponential":"interval");if(L&&((h=fr({},h)).stops&&(h.stops=h.stops.map(function(on){return[on[0],Fi.parse(on[1])]})),h.default=Fi.parse(h.default?h.default:p.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!H[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(V==="exponential")x=bh;else if(V==="interval")x=Bf;else if(V==="categorical"){x=Pc,S=Object.create(null);for(var Y=0,J=h.stops;Y<J.length;Y+=1){var Ce=J[Y];S[Ce[0]]=Ce[1]}M=typeof h.stops[0][0]}else{if(V!=="identity")throw new Error('Unknown function type "'+V+'"');x=zf}if(N){for(var Te={},Ge=[],Ne=0;Ne<h.stops.length;Ne++){var et=h.stops[Ne],vt=et[0].zoom;Te[vt]===void 0&&(Te[vt]={zoom:vt,type:h.type,property:h.property,default:h.default,stops:[]},Ge.push(vt)),Te[vt].stops.push([et[0].value,et[1]])}for(var Lt=[],Bt=0,rr=Ge;Bt<rr.length;Bt+=1){var wr=rr[Bt];Lt.push([Te[wr].zoom,s(Te[wr],p)])}var Zr={name:"linear"};return{kind:"composite",interpolationType:Zr,interpolationFactor:de.interpolationFactor.bind(void 0,Zr),zoomStops:Lt.map(function(on){return on[0]}),evaluate:function(on,Un){var un=on.zoom;return bh({stops:Lt,base:h.base},p,un).evaluate(un,Un)}}}if(U){var Mn=V==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Mn,interpolationFactor:de.interpolationFactor.bind(void 0,Mn),zoomStops:h.stops.map(function(on){return on[0]}),evaluate:function(on){return x(h,p,on.zoom,S,M)}}}return{kind:"source",evaluate:function(on,Un){var un=Un&&Un.properties?Un.properties[h.property]:void 0;return un===void 0?ol(h.default,p.default):x(h,p,un,S,M)}}}(this._parameters,this._specification))};function Ws(t){var a=t.key,s=t.value,h=t.valueSpec||{},p=t.objectElementValidators||{},x=t.style,S=t.styleSpec,M=[],L=Ri(s);if(L!=="object")return[new Oe(a,s,"object expected, "+L+" found")];for(var N in s){var U=N.split(".")[0],V=h[U]||h["*"],Y=void 0;if(p[U])Y=p[U];else if(h[U])Y=Gi;else if(p["*"])Y=p["*"];else{if(!h["*"]){M.push(new Oe(a,s[N],'unknown property "'+N+'"'));continue}Y=Gi}M=M.concat(Y({key:(a&&a+".")+N,value:s[N],valueSpec:V,style:x,styleSpec:S,object:s,objectKey:N},s))}for(var J in h)p[J]||h[J].required&&h[J].default===void 0&&s[J]===void 0&&M.push(new Oe(a,s,'missing required property "'+J+'"'));return M}function nf(t){var a=t.value,s=t.valueSpec,h=t.style,p=t.styleSpec,x=t.key,S=t.arrayElementValidator||Gi;if(Ri(a)!=="array")return[new Oe(x,a,"array expected, "+Ri(a)+" found")];if(s.length&&a.length!==s.length)return[new Oe(x,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new Oe(x,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var M={type:s.value,values:s.values};p.$version<7&&(M.function=s.function),Ri(s.value)==="object"&&(M=s.value);for(var L=[],N=0;N<a.length;N++)L=L.concat(S({array:a,arrayIndex:N,value:a[N],valueSpec:M,style:h,styleSpec:p,key:x+"["+N+"]"}));return L}function af(t){var a=t.key,s=t.value,h=t.valueSpec,p=Ri(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new Oe(a,s,"number expected, "+p+" found")]:"minimum"in h&&s<h.minimum?[new Oe(a,s,s+" is less than the minimum value "+h.minimum)]:"maximum"in h&&s>h.maximum?[new Oe(a,s,s+" is greater than the maximum value "+h.maximum)]:[]}function Uf(t){var a,s,h,p=t.valueSpec,x=At(t.value.type),S={},M=x!=="categorical"&&t.value.property===void 0,L=!M,N=Ri(t.value.stops)==="array"&&Ri(t.value.stops[0])==="array"&&Ri(t.value.stops[0][0])==="object",U=Ws({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(J){if(x==="identity")return[new Oe(J.key,J.value,'identity function may not have a "stops" property')];var Ce=[],Te=J.value;return Ce=Ce.concat(nf({key:J.key,value:Te,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:V})),Ri(Te)==="array"&&Te.length===0&&Ce.push(new Oe(J.key,Te,"array must have at least one stop")),Ce},default:function(J){return Gi({key:J.key,value:J.value,valueSpec:p,style:J.style,styleSpec:J.styleSpec})}}});return x==="identity"&&M&&U.push(new Oe(t.key,t.value,'missing required property "property"')),x==="identity"||t.value.stops||U.push(new Oe(t.key,t.value,'missing required property "stops"')),x==="exponential"&&t.valueSpec.expression&&!Cl(t.valueSpec)&&U.push(new Oe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(L&&!ru(t.valueSpec)?U.push(new Oe(t.key,t.value,"property functions not supported")):M&&!rf(t.valueSpec)&&U.push(new Oe(t.key,t.value,"zoom functions not supported"))),x!=="categorical"&&!N||t.value.property!==void 0||U.push(new Oe(t.key,t.value,'"property" property is required')),U;function V(J){var Ce=[],Te=J.value,Ge=J.key;if(Ri(Te)!=="array")return[new Oe(Ge,Te,"array expected, "+Ri(Te)+" found")];if(Te.length!==2)return[new Oe(Ge,Te,"array length 2 expected, length "+Te.length+" found")];if(N){if(Ri(Te[0])!=="object")return[new Oe(Ge,Te,"object expected, "+Ri(Te[0])+" found")];if(Te[0].zoom===void 0)return[new Oe(Ge,Te,"object stop key must have zoom")];if(Te[0].value===void 0)return[new Oe(Ge,Te,"object stop key must have value")];if(h&&h>At(Te[0].zoom))return[new Oe(Ge,Te[0].zoom,"stop zoom values must appear in ascending order")];At(Te[0].zoom)!==h&&(h=At(Te[0].zoom),s=void 0,S={}),Ce=Ce.concat(Ws({key:Ge+"[0]",value:Te[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:af,value:Y}}))}else Ce=Ce.concat(Y({key:Ge+"[0]",value:Te[0],valueSpec:{},style:J.style,styleSpec:J.styleSpec},Te));return Jl(Pt(Te[1]))?Ce.concat([new Oe(Ge+"[1]",Te[1],"expressions are not allowed in function stops.")]):Ce.concat(Gi({key:Ge+"[1]",value:Te[1],valueSpec:p,style:J.style,styleSpec:J.styleSpec}))}function Y(J,Ce){var Te=Ri(J.value),Ge=At(J.value),Ne=J.value!==null?J.value:Ce;if(a){if(Te!==a)return[new Oe(J.key,Ne,Te+" stop domain type must match previous stop domain type "+a)]}else a=Te;if(Te!=="number"&&Te!=="string"&&Te!=="boolean")return[new Oe(J.key,Ne,"stop domain value must be a number, string, or boolean")];if(Te!=="number"&&x!=="categorical"){var et="number expected, "+Te+" found";return ru(p)&&x===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(J.key,Ne,et)]}return x!=="categorical"||Te!=="number"||isFinite(Ge)&&Math.floor(Ge)===Ge?x!=="categorical"&&Te==="number"&&s!==void 0&&Ge<s?[new Oe(J.key,Ne,"stop domain values must appear in ascending order")]:(s=Ge,x==="categorical"&&Ge in S?[new Oe(J.key,Ne,"stop domain values must be unique")]:(S[Ge]=!0,[])):[new Oe(J.key,Ne,"integer expected, found "+Ge)]}}function nu(t){var a=(t.expressionContext==="property"?Ml:ec)(Pt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new Oe(""+t.key+h.key,t.value,h.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new Oe(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!bo(s))return[new Oe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!bo(s))return[new Oe(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ds(s,["zoom","feature-state"]))return[new Oe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!io(s))return[new Oe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tc(t){var a=t.key,s=t.value,h=t.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(At(s))===-1&&p.push(new Oe(a,s,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(h.values).indexOf(At(s))===-1&&p.push(new Oe(a,s,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(s)+" found")),p}function Oc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var h=s[a];if(!Oc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Zu.deserialize=function(t){return new Zu(t._parameters,t._specification)},Zu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var of={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Oc(t)||(t=sf(t));var a=ec(t,of);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,h,p){return a.value.evaluate(s,h,{},p)},needGeometry:function s(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var p=1;p<h.length;p++)if(s(h[p]))return!0;return!1}(t)}}function Yh(t,a){return t<a?-1:t>a?1:0}function sf(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?Il(t[1],t[2],"=="):s==="!="?Ol(Il(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Il(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(sf))):s==="all"?["all"].concat(t.slice(1).map(sf)):s==="none"?["all"].concat(t.slice(1).map(sf).map(Ol)):s==="in"?uf(t[1],t.slice(2)):s==="!in"?Ol(uf(t[1],t.slice(2))):s==="has"?lf(t[1]):s==="!has"?Ol(lf(t[1])):s!=="within"||t}function Il(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function uf(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(Yh)]]:["filter-in-small",t,["literal",a]]}}function lf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ol(t){return["!",t]}function Rc(t){return Oc(Pt(t.value))?nu(fr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var h=s.value,p=s.key;if(Ri(h)!=="array")return[new Oe(p,h,"array expected, "+Ri(h)+" found")];var x,S=s.styleSpec,M=[];if(h.length<1)return[new Oe(p,h,"filter array must have at least 1 element")];switch(M=M.concat(tc({key:p+"[0]",value:h[0],valueSpec:S.filter_operator,style:s.style,styleSpec:s.styleSpec})),At(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&At(h[1])==="$type"&&M.push(new Oe(p,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new Oe(p,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(x=Ri(h[1]))!=="string"&&M.push(new Oe(p+"[1]",h[1],"string expected, "+x+" found"));for(var L=2;L<h.length;L++)x=Ri(h[L]),At(h[1])==="$type"?M=M.concat(tc({key:p+"["+L+"]",value:h[L],valueSpec:S.geometry_type,style:s.style,styleSpec:s.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&M.push(new Oe(p+"["+L+"]",h[L],"string, number, or boolean expected, "+x+" found"));break;case"any":case"all":case"none":for(var N=1;N<h.length;N++)M=M.concat(a({key:p+"["+N+"]",value:h[N],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":x=Ri(h[1]),h.length!==2?M.push(new Oe(p,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="string"&&M.push(new Oe(p+"[1]",h[1],"string expected, "+x+" found"));break;case"within":x=Ri(h[1]),h.length!==2?M.push(new Oe(p,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="object"&&M.push(new Oe(p+"[1]",h[1],"object expected, "+x+" found"))}return M}(t)}function Eh(t,a){var s=t.key,h=t.style,p=t.styleSpec,x=t.value,S=t.objectKey,M=p[a+"_"+t.layerType];if(!M)return[];var L=S.match(/^(.*)-transition$/);if(a==="paint"&&L&&M[L[1]]&&M[L[1]].transition)return Gi({key:s,value:x,valueSpec:p.transition,style:h,styleSpec:p});var N,U=t.valueSpec||M[S];if(!U)return[new Oe(s,x,'unknown property "'+S+'"')];if(Ri(x)==="string"&&ru(U)&&!U.tokens&&(N=/^{([^}]+)}$/.exec(x)))return[new Oe(s,x,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var V=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&V.push(new Oe(s,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Al(Pt(x))&&At(x.type)==="identity"&&V.push(new Oe(s,x,'"text-font" does not support identity functions'))),V.concat(Gi({key:t.key,value:x,valueSpec:U,style:h,styleSpec:p,expressionContext:"property",propertyType:a,propertyKey:S}))}function Sh(t){return Eh(t,"paint")}function rc(t){return Eh(t,"layout")}function wh(t){var a=[],s=t.value,h=t.key,p=t.style,x=t.styleSpec;s.type||s.ref||a.push(new Oe(h,s,'either "type" or "ref" is required'));var S,M=At(s.type),L=At(s.ref);if(s.id)for(var N=At(s.id),U=0;U<t.arrayIndex;U++){var V=p.layers[U];At(V.id)===N&&a.push(new Oe(h,s.id,'duplicate layer id "'+s.id+'", previously used at line '+V.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(Ce){Ce in s&&a.push(new Oe(h,s[Ce],'"'+Ce+'" is prohibited for ref layers'))}),p.layers.forEach(function(Ce){At(Ce.id)===L&&(S=Ce)}),S?S.ref?a.push(new Oe(h,s.ref,"ref cannot reference another ref layer")):M=At(S.type):a.push(new Oe(h,s.ref,'ref layer "'+L+'" not found'));else if(M!=="background")if(s.source){var Y=p.sources&&p.sources[s.source],J=Y&&At(Y.type);Y?J==="vector"&&M==="raster"?a.push(new Oe(h,s.source,'layer "'+s.id+'" requires a raster source')):J==="raster"&&M!=="raster"?a.push(new Oe(h,s.source,'layer "'+s.id+'" requires a vector source')):J!=="vector"||s["source-layer"]?J==="raster-dem"&&M!=="hillshade"?a.push(new Oe(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!s.paint||!s.paint["line-gradient"]||J==="geojson"&&Y.lineMetrics||a.push(new Oe(h,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Oe(h,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new Oe(h,s.source,'source "'+s.source+'" not found'))}else a.push(new Oe(h,s,'missing required property "source"'));return a=a.concat(Ws({key:h,value:s,valueSpec:x.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gi({key:h+".type",value:s.type,valueSpec:x.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Rc,layout:function(Ce){return Ws({layer:s,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Te){return rc(fr({layerType:M},Te))}}})},paint:function(Ce){return Ws({layer:s,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Te){return Sh(fr({layerType:M},Te))}}})}}}))}function Rl(t){var a=t.value,s=t.key,h=Ri(a);return h!=="string"?[new Oe(s,a,"string expected, "+h+" found")]:[]}var Wi={promoteId:function(t){var a=t.key,s=t.value;if(Ri(s)==="string")return Rl({key:a,value:s});var h=[];for(var p in s)h.push.apply(h,Rl({key:a+"."+p,value:s[p]}));return h}};function nc(t){var a=t.value,s=t.key,h=t.styleSpec,p=t.style;if(!a.type)return[new Oe(s,a,'"type" is required')];var x,S=At(a.type);switch(S){case"vector":case"raster":case"raster-dem":return Ws({key:s,value:a,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Wi});case"geojson":if(x=Ws({key:s,value:a,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Wi}),a.cluster)for(var M in a.clusterProperties){var L=a.clusterProperties[M],N=L[0],U=typeof N=="string"?[N,["accumulated"],["get",M]]:N;x.push.apply(x,nu({key:s+"."+M+".map",value:L[1],expressionContext:"cluster-map"})),x.push.apply(x,nu({key:s+"."+M+".reduce",value:U,expressionContext:"cluster-reduce"}))}return x;case"video":return Ws({key:s,value:a,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Ws({key:s,value:a,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new Oe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tc({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:h})}}function oa(t){var a=t.value,s=t.styleSpec,h=s.light,p=t.style,x=[],S=Ri(a);if(a===void 0)return x;if(S!=="object")return x.concat([new Oe("light",a,"object expected, "+S+" found")]);for(var M in a){var L=M.match(/^(.*)-transition$/);x=x.concat(L&&h[L[1]]&&h[L[1]].transition?Gi({key:M,value:a[M],valueSpec:s.transition,style:p,styleSpec:s}):h[M]?Gi({key:M,value:a[M],valueSpec:h[M],style:p,styleSpec:s}):[new Oe(M,a[M],'unknown property "'+M+'"')])}return x}var Pu={"*":function(){return[]},array:nf,boolean:function(t){var a=t.value,s=t.key,h=Ri(a);return h!=="boolean"?[new Oe(s,a,"boolean expected, "+h+" found")]:[]},number:af,color:function(t){var a=t.key,s=t.value,h=Ri(s);return h!=="string"?[new Oe(a,s,"color expected, "+h+" found")]:Ai(s)===null?[new Oe(a,s,'color expected, "'+s+'" found')]:[]},constants:st,enum:tc,filter:Rc,function:Uf,layer:wh,object:Ws,source:nc,light:oa,string:Rl,formatted:function(t){return Rl(t).length===0?[]:nu(t)},resolvedImage:function(t){return Rl(t).length===0?[]:nu(t)}};function Gi(t){var a=t.value,s=t.valueSpec,h=t.styleSpec;return s.expression&&Al(At(a))?Uf(t):s.expression&&Jl(Pt(a))?nu(t):s.type&&Pu[s.type]?Pu[s.type](t):Ws(fr({},t,{valueSpec:s.type?h[s.type]:s}))}function Ma(t){var a=t.value,s=t.key,h=Rl(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new Oe(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new Oe(s,a,'"glyphs" url must include a "{range}" token'))),h}function gs(t,a){a===void 0&&(a=ie);var s=[];return s=s.concat(Gi({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(s=s.concat(st({key:"constants",value:t.constants,style:t,styleSpec:a}))),Lc(s)}function Lc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function Vu(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return Lc(t.apply(this,a))}}gs.source=Vu(nc),gs.light=Vu(oa),gs.layer=Vu(wh),gs.filter=Vu(Rc),gs.paintProperty=Vu(Sh),gs.layoutProperty=Vu(rc);var za=gs,ic=za.light,Ll=za.paintProperty,ju=za.layoutProperty;function kc(t,a){var s=!1;if(a&&a.length)for(var h=0,p=a;h<p.length;h+=1)t.fire(new Ze(new Error(p[h].message))),s=!0;return s}var Iu=co;function co(t,a,s){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(a=p[1])+2*(s=p[2]);for(var x=0;x<this.d*this.d;x++){var S=p[3+x],M=p[3+x+1];h.push(S===M?null:p.subarray(S,M))}var L=p[3+h.length+1];this.keys=p.subarray(p[3+h.length],L),this.bboxes=p.subarray(L),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var N=0;N<this.d*this.d;N++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var U=s/a*t;this.min=-U,this.max=t+U}co.prototype.insert=function(t,a,s,h,p){this._forEachCell(a,s,h,p,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(p)},co.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},co.prototype._insertCell=function(t,a,s,h,p,x){this.cells[p].push(x)},co.prototype.query=function(t,a,s,h,p){var x=this.min,S=this.max;if(t<=x&&a<=x&&S<=s&&S<=h&&!p)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,a,s,h,this._queryCell,M,{},p),M},co.prototype._queryCell=function(t,a,s,h,p,x,S,M){var L=this.cells[p];if(L!==null)for(var N=this.keys,U=this.bboxes,V=0;V<L.length;V++){var Y=L[V];if(S[Y]===void 0){var J=4*Y;(M?M(U[J+0],U[J+1],U[J+2],U[J+3]):t<=U[J+2]&&a<=U[J+3]&&s>=U[J+0]&&h>=U[J+1])?(S[Y]=!0,x.push(N[Y])):S[Y]=!1}}},co.prototype._forEachCell=function(t,a,s,h,p,x,S,M){for(var L=this._convertToCellCoord(t),N=this._convertToCellCoord(a),U=this._convertToCellCoord(s),V=this._convertToCellCoord(h),Y=L;Y<=U;Y++)for(var J=N;J<=V;J++){var Ce=this.d*J+Y;if((!M||M(this._convertFromCellCoord(Y),this._convertFromCellCoord(J),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(J+1)))&&p.call(this,t,a,s,h,Ce,x,S,M))return}},co.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},co.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},co.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var p=new Int32Array(a+s+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=a,S=0;S<t.length;S++){var M=t[S];p[3+S]=x,p.set(M,x),x+=M.length}return p[3+t.length]=x,p.set(this.keys,x),p[3+t.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer};var kl=ge.ImageData,ac=ge.ImageBitmap,fo={};function cn(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),fo[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var oo in cn("Object",Object),Iu.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Iu.deserialize=function(t){return new Iu(t.buffer)},cn("Grid",Iu),cn("Color",Fi),cn("Error",Error),cn("ResolvedImage",ea),cn("StylePropertyFunction",Zu),cn("StyleExpression",Ic,{omit:["_evaluator"]}),cn("ZoomDependentExpression",sl),cn("ZoomConstantExpression",Tl),cn("CompoundExpression",Ha,{omit:["_evaluate"]}),Tu)Tu[oo]._classRegistryKey||cn("Expression_"+oo,Tu[oo]);function Gu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Da(t){return ac&&t instanceof ac}function Xs(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gu(t)||Da(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof kl)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],p=0,x=t;p<x.length;p+=1)h.push(Xs(x[p],a));return h}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var L=S.serialize?S.serialize(t,a):{};if(!S.serialize){for(var N in t)if(t.hasOwnProperty(N)&&!(fo[M].omit.indexOf(N)>=0)){var U=t[N];L[N]=fo[M].shallow.indexOf(N)>=0?U:Xs(U,a)}t instanceof Error&&(L.message=t.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(L.$name=M),L}throw new Error("can't serialize object of type "+typeof t)}function Ms(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gu(t)||Da(t)||ArrayBuffer.isView(t)||t instanceof kl)return t;if(Array.isArray(t))return t.map(Ms);if(typeof t=="object"){var a=t.$name||"Object",s=fo[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var h=Object.create(s.prototype),p=0,x=Object.keys(t);p<x.length;p+=1){var S=x[p];if(S!=="$name"){var M=t[S];h[S]=fo[a].shallow.indexOf(S)>=0?M:Ms(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var cf=function(){this.first=!0};cf.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var Br={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function oc(t){for(var a=0,s=t;a<s.length;a+=1)if(ff(s[a].charCodeAt(0)))return!0;return!1}function ff(t){return!(t!==746&&t!==747&&(t<4352||!(Br["Bopomofo Extended"](t)||Br.Bopomofo(t)||Br["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Br["CJK Compatibility Ideographs"](t)||Br["CJK Compatibility"](t)||Br["CJK Radicals Supplement"](t)||Br["CJK Strokes"](t)||!(!Br["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Br["CJK Unified Ideographs Extension A"](t)||Br["CJK Unified Ideographs"](t)||Br["Enclosed CJK Letters and Months"](t)||Br["Hangul Compatibility Jamo"](t)||Br["Hangul Jamo Extended-A"](t)||Br["Hangul Jamo Extended-B"](t)||Br["Hangul Jamo"](t)||Br["Hangul Syllables"](t)||Br.Hiragana(t)||Br["Ideographic Description Characters"](t)||Br.Kanbun(t)||Br["Kangxi Radicals"](t)||Br["Katakana Phonetic Extensions"](t)||Br.Katakana(t)&&t!==12540||!(!Br["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Br["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Br["Unified Canadian Aboriginal Syllabics"](t)||Br["Unified Canadian Aboriginal Syllabics Extended"](t)||Br["Vertical Forms"](t)||Br["Yijing Hexagram Symbols"](t)||Br["Yi Syllables"](t)||Br["Yi Radicals"](t))))}function ul(t){return!(ff(t)||function(a){return!!(Br["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Br["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Br["Letterlike Symbols"](a)||Br["Number Forms"](a)||Br["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Br["Control Pictures"](a)&&a!==9251||Br["Optical Character Recognition"](a)||Br["Enclosed Alphanumerics"](a)||Br["Geometric Shapes"](a)||Br["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Br["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Br["CJK Symbols and Punctuation"](a)||Br.Katakana(a)||Br["Private Use Area"](a)||Br["CJK Compatibility Forms"](a)||Br["Small Form Variants"](a)||Br["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function Sa(t){return t>=1424&&t<=2303||Br["Arabic Presentation Forms-A"](t)||Br["Arabic Presentation Forms-B"](t)}function ys(t,a){return!(!a&&Sa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Br.Khmer(t))}function hf(t){for(var a=0,s=t;a<s.length;a+=1)if(Sa(s[a].charCodeAt(0)))return!0;return!1}var Ou=null,Fs="unavailable",Ru=null,Zf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Fs="error"),Ou&&Ou(t)};function ll(){Vf.fire(new Ae("pluginStateChange",{pluginStatus:Fs,pluginURL:Ru}))}var Vf=new qe,pf=function(){return Fs},iu=function(){if(Fs!=="deferred"||!Ru)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fs="loading",ll(),Ru&&Fa({url:Ru},function(t){t?Zf(t):(Fs="loaded",ll())})},Ps={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Fs==="loaded"||Ps.applyArabicShaping!=null},isLoading:function(){return Fs==="loading"},setState:function(t){Fs=t.pluginStatus,Ru=t.pluginURL},isParsed:function(){return Ps.applyArabicShaping!=null&&Ps.processBidirectionalText!=null&&Ps.processStyledBidirectionalText!=null},getPluginURL:function(){return Ru}},Ei=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cf,this.transition={})};Ei.prototype.isSupportedScript=function(t){return function(a,s){for(var h=0,p=a;h<p.length;h+=1)if(!ys(p[h].charCodeAt(0),s))return!1;return!0}(t,Ps.isLoaded())},Ei.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ei.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Lu=function(t,a){this.property=t,this.value=a,this.expression=function(s,h){if(Al(s))return new Zu(s,h);if(Jl(s)){var p=Ml(s,h);if(p.result==="error")throw new Error(p.value.map(function(S){return S.key+": "+S.message}).join(", "));return p.value}var x=s;return typeof s=="string"&&h.type==="color"&&(x=Fi.parse(s)),{kind:"constant",evaluate:function(){return x}}}(a===void 0?t.specification.default:a,t.specification)};Lu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Lu.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var au=function(t){this.property=t,this.value=new Lu(t,void 0)};au.prototype.transitioned=function(t,a){return new cl(this.property,this.value,a,Mt({},t.transition,this.transition),t.now)},au.prototype.untransitioned=function(){return new cl(this.property,this.value,null,{},0)};var jo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};jo.prototype.getValue=function(t){return Ye(this._values[t].value.value)},jo.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].value=new Lu(this._values[t].property,a===null?void 0:Ye(a))},jo.prototype.getTransition=function(t){return Ye(this._values[t].transition)},jo.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].transition=Ye(a)||void 0},jo.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],p=this.getValue(h);p!==void 0&&(t[h]=p);var x=this.getTransition(h);x!==void 0&&(t[h+"-transition"]=x)}return t},jo.prototype.transitioned=function(t,a){for(var s=new Ns(this._properties),h=0,p=Object.keys(this._values);h<p.length;h+=1){var x=p[h];s._values[x]=this._values[x].transitioned(t,a._values[x])}return s},jo.prototype.untransitioned=function(){for(var t=new Ns(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a];t._values[h]=this._values[h].untransitioned()}return t};var cl=function(t,a,s,h,p){this.property=t,this.value=a,this.begin=p+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)};cl.prototype.possiblyEvaluate=function(t,a,s){var h=t.now||0,p=this.value.possiblyEvaluate(t,a,s),x=this.prior;if(x){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return x.possiblyEvaluate(t,a,s);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,a,s),p,function(M){if(M<=0)return 0;if(M>=1)return 1;var L=M*M,N=L*M;return 4*(M<.5?N:3*(M-L)+N-.75)}(S))}return p};var Ns=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Ns.prototype.possiblyEvaluate=function(t,a,s){for(var h=new hu(this._properties),p=0,x=Object.keys(this._values);p<x.length;p+=1){var S=x[p];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h},Ns.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Ys=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ys.prototype.getValue=function(t){return Ye(this._values[t].value)},Ys.prototype.setValue=function(t,a){this._values[t]=new Lu(this._values[t].property,a===null?void 0:Ye(a))},Ys.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],p=this.getValue(h);p!==void 0&&(t[h]=p)}return t},Ys.prototype.possiblyEvaluate=function(t,a,s){for(var h=new hu(this._properties),p=0,x=Object.keys(this._values);p<x.length;p+=1){var S=x[p];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h};var _s=function(t,a,s){this.property=t,this.value=a,this.parameters=s};_s.prototype.isConstant=function(){return this.value.kind==="constant"},_s.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},_s.prototype.evaluate=function(t,a,s,h){return this.property.evaluate(this.value,this.parameters,t,a,s,h)};var hu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};hu.prototype.get=function(t){return this._values[t]};var Tn=function(t){this.specification=t};Tn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},Tn.prototype.interpolate=function(t,a,s){var h=ma[this.specification.type];return h?h(t,a,s):t};var xn=function(t,a){this.specification=t,this.overrides=a};xn.prototype.possiblyEvaluate=function(t,a,s,h){return new _s(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,h)}:t.expression,a)},xn.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new _s(this,{kind:"constant",value:void 0},t.parameters);var h=ma[this.specification.type];return h?new _s(this,{kind:"constant",value:h(t.value.value,a.value.value,s)},t.parameters):t},xn.prototype.evaluate=function(t,a,s,h,p,x){return t.kind==="constant"?t.value:t.evaluate(a,s,h,p,x)};var Dc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h,p,x){if(s.value===void 0)return new _s(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){var S=s.expression.evaluate(h,null,{},p,x),M=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(M,M,M,h);return new _s(this,{kind:"constant",value:L},h)}if(s.expression.kind==="camera"){var N=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new _s(this,{kind:"constant",value:N},h)}return new _s(this,s.expression,h)},a.prototype.evaluate=function(s,h,p,x,S,M){if(s.kind==="source"){var L=s.evaluate(h,p,x,S,M);return this._calculate(L,L,L,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},p,x),s.evaluate({zoom:Math.floor(h.zoom)},p,x),s.evaluate({zoom:Math.floor(h.zoom)+1},p,x),h):s.value},a.prototype._calculate=function(s,h,p,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:p,to:h}},a.prototype.interpolate=function(s){return s},a}(xn),rs=function(t){this.specification=t};rs.prototype.possiblyEvaluate=function(t,a,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var p=t.expression.evaluate(a,null,{},s,h);return this._calculate(p,p,p,a)}return this._calculate(t.expression.evaluate(new Ei(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Ei(Math.floor(a.zoom),a)),t.expression.evaluate(new Ei(Math.floor(a.zoom+1),a)),a)}},rs.prototype._calculate=function(t,a,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},rs.prototype.interpolate=function(t){return t};var ns=function(t){this.specification=t};ns.prototype.possiblyEvaluate=function(t,a,s,h){return!!t.expression.evaluate(a,null,{},s,h)},ns.prototype.interpolate=function(){return!1};var Fo=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new Lu(s,void 0),p=this.defaultTransitionablePropertyValues[a]=new au(s);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};cn("DataDrivenProperty",xn),cn("DataConstantProperty",Tn),cn("CrossFadedDataDrivenProperty",Dc),cn("CrossFadedProperty",rs),cn("ColorRampProperty",ns);var wa=function(t){function a(s,h){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Ys(h.layout)),h.paint)){for(var p in this._transitionablePaint=new jo(h.paint),s.paint)this.setPaintProperty(p,s.paint[p],{validate:!1});for(var x in s.layout)this.setLayoutProperty(x,s.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hu(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,h,p){p===void 0&&(p={}),h!=null&&this._validate(ju,"layers."+this.id+".layout."+s,s,h,p)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)},a.prototype.getPaintProperty=function(s){return W(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,h,p){if(p===void 0&&(p={}),h!=null&&this._validate(Ll,"layers."+this.id+".paint."+s,s,h,p))return!1;if(W(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),h||void 0),!1;var x=this._transitionablePaint._values[s],S=x.property.specification["property-type"]==="cross-faded-data-driven",M=x.value.isDataDriven(),L=x.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);var N=this._transitionablePaint._values[s].value;return N.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(s,L,N)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,p){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),ot(s,function(h,p){return!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(s,h,p,x,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&kc(this,s.call(za,{key:h,layerType:this.type,objectKey:p,value:x,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var h=this.paint.get(s);if(h instanceof _s&&ru(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(qe),Hu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Wu=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},na=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _a(t,a){a===void 0&&(a=1);var s=0,h=0;return{members:t.map(function(p){var x=Hu[p.type].BYTES_PER_ELEMENT,S=s=sc(s,Math.max(a,x)),M=p.components||1;return h=Math.max(h,x),s+=x*M,{name:p.name,type:p.type,components:M,offset:S}}),size:sc(s,Math.max(h,a)),alignment:a}}function sc(t,a){return Math.ceil(t/a)*a}na.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},na.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},na.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},na.prototype.clear=function(){this.length=0},na.prototype.resize=function(t){this.reserve(t),this.length=t},na.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},na.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var fl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var p=this.length;return this.resize(p+1),this.emplace(p,s,h)},a.prototype.emplace=function(s,h,p){var x=2*s;return this.int16[x+0]=h,this.int16[x+1]=p,s},a}(na);fl.prototype.bytesPerElement=4,cn("StructArrayLayout2i4",fl);var pu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,p,x)},a.prototype.emplace=function(s,h,p,x,S){var M=4*s;return this.int16[M+0]=h,this.int16[M+1]=p,this.int16[M+2]=x,this.int16[M+3]=S,s},a}(na);pu.prototype.bytesPerElement=8,cn("StructArrayLayout4i8",pu);var du=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,p,x,S,M)},a.prototype.emplace=function(s,h,p,x,S,M,L){var N=6*s;return this.int16[N+0]=h,this.int16[N+1]=p,this.int16[N+2]=x,this.int16[N+3]=S,this.int16[N+4]=M,this.int16[N+5]=L,s},a}(na);du.prototype.bytesPerElement=12,cn("StructArrayLayout2i4i12",du);var Eo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,p,x,S,M)},a.prototype.emplace=function(s,h,p,x,S,M,L){var N=4*s,U=8*s;return this.int16[N+0]=h,this.int16[N+1]=p,this.uint8[U+4]=x,this.uint8[U+5]=S,this.uint8[U+6]=M,this.uint8[U+7]=L,s},a}(na);Eo.prototype.bytesPerElement=8,cn("StructArrayLayout2i4ub8",Eo);var Xu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var p=this.length;return this.resize(p+1),this.emplace(p,s,h)},a.prototype.emplace=function(s,h,p){var x=2*s;return this.float32[x+0]=h,this.float32[x+1]=p,s},a}(na);Xu.prototype.bytesPerElement=8,cn("StructArrayLayout2f8",Xu);var vu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M,L,N,U,V){var Y=this.length;return this.resize(Y+1),this.emplace(Y,s,h,p,x,S,M,L,N,U,V)},a.prototype.emplace=function(s,h,p,x,S,M,L,N,U,V,Y){var J=10*s;return this.uint16[J+0]=h,this.uint16[J+1]=p,this.uint16[J+2]=x,this.uint16[J+3]=S,this.uint16[J+4]=M,this.uint16[J+5]=L,this.uint16[J+6]=N,this.uint16[J+7]=U,this.uint16[J+8]=V,this.uint16[J+9]=Y,s},a}(na);vu.prototype.bytesPerElement=20,cn("StructArrayLayout10ui20",vu);var Dl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M,L,N,U,V,Y,J){var Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,s,h,p,x,S,M,L,N,U,V,Y,J)},a.prototype.emplace=function(s,h,p,x,S,M,L,N,U,V,Y,J,Ce){var Te=12*s;return this.int16[Te+0]=h,this.int16[Te+1]=p,this.int16[Te+2]=x,this.int16[Te+3]=S,this.uint16[Te+4]=M,this.uint16[Te+5]=L,this.uint16[Te+6]=N,this.uint16[Te+7]=U,this.int16[Te+8]=V,this.int16[Te+9]=Y,this.int16[Te+10]=J,this.int16[Te+11]=Ce,s},a}(na);Dl.prototype.bytesPerElement=24,cn("StructArrayLayout4i4ui4i24",Dl);var Yu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,p)},a.prototype.emplace=function(s,h,p,x){var S=3*s;return this.float32[S+0]=h,this.float32[S+1]=p,this.float32[S+2]=x,s},a}(na);Yu.prototype.bytesPerElement=12,cn("StructArrayLayout3f12",Yu);var uc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint32[1*s+0]=h,s},a}(na);uc.prototype.bytesPerElement=4,cn("StructArrayLayout1ul4",uc);var Fc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M,L,N,U){var V=this.length;return this.resize(V+1),this.emplace(V,s,h,p,x,S,M,L,N,U)},a.prototype.emplace=function(s,h,p,x,S,M,L,N,U,V){var Y=10*s,J=5*s;return this.int16[Y+0]=h,this.int16[Y+1]=p,this.int16[Y+2]=x,this.int16[Y+3]=S,this.int16[Y+4]=M,this.int16[Y+5]=L,this.uint32[J+3]=N,this.uint16[Y+8]=U,this.uint16[Y+9]=V,s},a}(na);Fc.prototype.bytesPerElement=20,cn("StructArrayLayout6i1ul2ui20",Fc);var lc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,p,x,S,M)},a.prototype.emplace=function(s,h,p,x,S,M,L){var N=6*s;return this.int16[N+0]=h,this.int16[N+1]=p,this.int16[N+2]=x,this.int16[N+3]=S,this.int16[N+4]=M,this.int16[N+5]=L,s},a}(na);lc.prototype.bytesPerElement=12,cn("StructArrayLayout2i2i2i12",lc);var Fl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,h,p,x,S)},a.prototype.emplace=function(s,h,p,x,S,M){var L=4*s,N=8*s;return this.float32[L+0]=h,this.float32[L+1]=p,this.float32[L+2]=x,this.int16[N+6]=S,this.int16[N+7]=M,s},a}(na);Fl.prototype.bytesPerElement=16,cn("StructArrayLayout2f1f2i16",Fl);var jf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,p,x)},a.prototype.emplace=function(s,h,p,x,S){var M=12*s,L=3*s;return this.uint8[M+0]=h,this.uint8[M+1]=p,this.float32[L+1]=x,this.float32[L+2]=S,s},a}(na);jf.prototype.bytesPerElement=12,cn("StructArrayLayout2ub2f12",jf);var hl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,p)},a.prototype.emplace=function(s,h,p,x){var S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=p,this.uint16[S+2]=x,s},a}(na);hl.prototype.bytesPerElement=6,cn("StructArrayLayout3ui6",hl);var pl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te,Ge,Ne,et){var vt=this.length;return this.resize(vt+1),this.emplace(vt,s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te,Ge,Ne,et)},a.prototype.emplace=function(s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te,Ge,Ne,et,vt){var Lt=24*s,Bt=12*s,rr=48*s;return this.int16[Lt+0]=h,this.int16[Lt+1]=p,this.uint16[Lt+2]=x,this.uint16[Lt+3]=S,this.uint32[Bt+2]=M,this.uint32[Bt+3]=L,this.uint32[Bt+4]=N,this.uint16[Lt+10]=U,this.uint16[Lt+11]=V,this.uint16[Lt+12]=Y,this.float32[Bt+7]=J,this.float32[Bt+8]=Ce,this.uint8[rr+36]=Te,this.uint8[rr+37]=Ge,this.uint8[rr+38]=Ne,this.uint32[Bt+10]=et,this.int16[Lt+22]=vt,s},a}(na);pl.prototype.bytesPerElement=48,cn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",pl);var Bs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te,Ge,Ne,et,vt,Lt,Bt,rr,wr,Zr,Mn,on,Un,un,Ii){var Wn=this.length;return this.resize(Wn+1),this.emplace(Wn,s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te,Ge,Ne,et,vt,Lt,Bt,rr,wr,Zr,Mn,on,Un,un,Ii)},a.prototype.emplace=function(s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te,Ge,Ne,et,vt,Lt,Bt,rr,wr,Zr,Mn,on,Un,un,Ii,Wn){var An=34*s,Si=17*s;return this.int16[An+0]=h,this.int16[An+1]=p,this.int16[An+2]=x,this.int16[An+3]=S,this.int16[An+4]=M,this.int16[An+5]=L,this.int16[An+6]=N,this.int16[An+7]=U,this.uint16[An+8]=V,this.uint16[An+9]=Y,this.uint16[An+10]=J,this.uint16[An+11]=Ce,this.uint16[An+12]=Te,this.uint16[An+13]=Ge,this.uint16[An+14]=Ne,this.uint16[An+15]=et,this.uint16[An+16]=vt,this.uint16[An+17]=Lt,this.uint16[An+18]=Bt,this.uint16[An+19]=rr,this.uint16[An+20]=wr,this.uint16[An+21]=Zr,this.uint16[An+22]=Mn,this.uint32[Si+12]=on,this.float32[Si+13]=Un,this.float32[Si+14]=un,this.float32[Si+15]=Ii,this.float32[Si+16]=Wn,s},a}(na);Bs.prototype.bytesPerElement=68,cn("StructArrayLayout8i15ui1ul4f68",Bs);var dl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.float32[1*s+0]=h,s},a}(na);dl.prototype.bytesPerElement=4,cn("StructArrayLayout1f4",dl);var Go=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,p)},a.prototype.emplace=function(s,h,p,x){var S=3*s;return this.int16[S+0]=h,this.int16[S+1]=p,this.int16[S+2]=x,s},a}(na);Go.prototype.bytesPerElement=6,cn("StructArrayLayout3i6",Go);var df=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,p)},a.prototype.emplace=function(s,h,p,x){var S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=p,this.uint16[S+3]=x,s},a}(na);df.prototype.bytesPerElement=8,cn("StructArrayLayout1ul2ui8",df);var Nl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var p=this.length;return this.resize(p+1),this.emplace(p,s,h)},a.prototype.emplace=function(s,h,p){var x=2*s;return this.uint16[x+0]=h,this.uint16[x+1]=p,s},a}(na);Nl.prototype.bytesPerElement=4,cn("StructArrayLayout2ui4",Nl);var Nc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint16[1*s+0]=h,s},a}(na);Nc.prototype.bytesPerElement=2,cn("StructArrayLayout1ui2",Nc);var cc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,p,x){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,p,x)},a.prototype.emplace=function(s,h,p,x,S){var M=4*s;return this.float32[M+0]=h,this.float32[M+1]=p,this.float32[M+2]=x,this.float32[M+3]=S,s},a}(na);cc.prototype.bytesPerElement=16,cn("StructArrayLayout4f16",cc);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new he(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(Wu);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(Fc);cn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(Wu);c.prototype.size=48;var d=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new c(this,s)},a}(pl);cn("PlacedSymbolArray",d);var b=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(Wu);b.prototype.size=68;var w=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new b(this,s)},a}(Bs);cn("SymbolInstanceArray",w);var T=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(dl);cn("GlyphOffsetArray",T);var R=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(Go);cn("SymbolLineVertexArray",R);var z=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(Wu);z.prototype.size=8;var j=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new z(this,s)},a}(df);cn("FeatureIndexArray",j);var ne=_a([{name:"a_pos",components:2,type:"Int16"}],4).members,ae=function(t){t===void 0&&(t=[]),this.segments=t};function oe(t,a){return 256*(t=Qt(Math.floor(t),0,255))+Qt(Math.floor(a),0,255)}ae.prototype.prepareSegment=function(t,a,s,h){var p=this.segments[this.segments.length-1];return t>ae.MAX_VERTEX_ARRAY_LENGTH&&Ke("Max vertices per segment is "+ae.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!p||p.vertexLength+t>ae.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p},ae.prototype.get=function(){return this.segments},ae.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var h in s.vaos)s.vaos[h].destroy()}},ae.simpleSegment=function(t,a,s,h){return new ae([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])},ae.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,cn("SegmentVector",ae);var Se=_a([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Me=Ie(function(t){t.exports=function(a,s){var h,p,x,S,M,L,N,U;for(p=a.length-(h=3&a.length),x=s,M=3432918353,L=461845907,U=0;U<p;)N=255&a.charCodeAt(U)|(255&a.charCodeAt(++U))<<8|(255&a.charCodeAt(++U))<<16|(255&a.charCodeAt(++U))<<24,++U,x=27492+(65535&(S=5*(65535&(x=(x^=N=(65535&(N=(N=(65535&N)*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*L+(((N>>>16)*L&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,h){case 3:N^=(255&a.charCodeAt(U+2))<<16;case 2:N^=(255&a.charCodeAt(U+1))<<8;case 1:x^=N=(65535&(N=(N=(65535&(N^=255&a.charCodeAt(U)))*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*L+(((N>>>16)*L&65535)<<16)&4294967295}return x^=a.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Ve=Ie(function(t){t.exports=function(a,s){for(var h,p=a.length,x=s^p,S=0;p>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++S;switch(p){case 3:x^=(255&a.charCodeAt(S+2))<<16;case 2:x^=(255&a.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&a.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),be=Me,ze=Ve;be.murmur3=Me,be.murmur2=ze;var Xe=function(){this.ids=[],this.positions=[],this.indexed=!1};Xe.prototype.add=function(t,a,s,h){this.ids.push(Ut(t)),this.positions.push(a,s,h)},Xe.prototype.getPositions=function(t){for(var a=Ut(t),s=0,h=this.ids.length-1;s<h;){var p=s+h>>1;this.ids[p]>=a?h=p:s=p+1}for(var x=[];this.ids[s]===a;)x.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return x},Xe.serialize=function(t,a){var s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function p(x,S,M,L){for(;M<L;){for(var N=x[M+L>>1],U=M-1,V=L+1;;){do U++;while(x[U]<N);do V--;while(x[V]>N);if(U>=V)break;Ot(x,U,V),Ot(S,3*U,3*V),Ot(S,3*U+1,3*V+1),Ot(S,3*U+2,3*V+2)}V-M<L-V?(p(x,S,M,V),M=V+1):(p(x,S,V+1,L),L=V)}}(s,h,0,s.length-1),a&&a.push(s.buffer,h.buffer),{ids:s,positions:h}},Xe.deserialize=function(t){var a=new Xe;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var ut=Math.pow(2,53)-1;function Ut(t){var a=+t;return!isNaN(a)&&a<=ut?a:be(String(t))}function Ot(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}cn("FeaturePositionMap",Xe);var Zt=function(t,a){this.gl=t.gl,this.location=a},lr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(Zt),Or=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(Zt),Pr=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(Zt),$r=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(Zt),Ln=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(Zt),Fn=function(t){function a(s,h){t.call(this,s,h),this.current=Fi.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(Zt),zn=new Float32Array(16),ui=function(t){function a(s,h){t.call(this,s,h),this.current=zn}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(Zt);function rn(t){return[oe(255*t.r,255*t.g),oe(255*t.b,255*t.a)]}var ti=function(t,a,s){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=s};ti.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},ti.prototype.getBinding=function(t,a,s){return this.type==="color"?new Fn(t,a):new Or(t,a)};var ai=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ai.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},ai.prototype.setUniform=function(t,a,s,h){var p=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)},ai.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new Ln(t,a):new Or(t,a)};var $n=function(t,a,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(p){return{name:"a_"+p,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new h};$n.prototype.populatePaintArray=function(t,a,s,h,p){var x=this.paintVertexArray.length,S=this.expression.evaluate(new Ei(0),a,{},h,[],p);this.paintVertexArray.resize(t),this._setPaintValue(x,t,S)},$n.prototype.updatePaintArray=function(t,a,s,h){var p=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,a,p)},$n.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var h=rn(s),p=t;p<a;p++)this.paintVertexArray.emplace(p,h[0],h[1]);else{for(var x=t;x<a;x++)this.paintVertexArray.emplace(x,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},$n.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$n.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Gn=function(t,a,s,h,p,x){this.expression=t,this.uniformNames=a.map(function(S){return"u_"+S+"_t"}),this.type=s,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=a.map(function(S){return{name:"a_"+S,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new x};Gn.prototype.populatePaintArray=function(t,a,s,h,p){var x=this.expression.evaluate(new Ei(this.zoom),a,{},h,[],p),S=this.expression.evaluate(new Ei(this.zoom+1),a,{},h,[],p),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,S)},Gn.prototype.updatePaintArray=function(t,a,s,h){var p=this.expression.evaluate({zoom:this.zoom},s,h),x=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,a,p,x)},Gn.prototype._setPaintValue=function(t,a,s,h){if(this.type==="color")for(var p=rn(s),x=rn(h),S=t;S<a;S++)this.paintVertexArray.emplace(S,p[0],p[1],x[0],x[1]);else{for(var M=t;M<a;M++)this.paintVertexArray.emplace(M,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}},Gn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Gn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Gn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Qt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)},Gn.prototype.getBinding=function(t,a,s){return new Or(t,a)};var fi=function(t,a,s,h,p,x){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=h,this.layerId=x,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p};fi.prototype.populatePaintArray=function(t,a,s){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],s)},fi.prototype.updatePaintArray=function(t,a,s,h,p){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],p)},fi.prototype._setPaintValues=function(t,a,s,h){if(h&&s){var p=h[s.min],x=h[s.mid],S=h[s.max];if(p&&x&&S)for(var M=t;M<a;M++)this.zoomInPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],x.pixelRatio,p.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}},fi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Se.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Se.members,this.expression.isStateDependent))},fi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Xn=function(t,a,s){this.binders={},this._buffers=[];var h=[];for(var p in t.paint._values)if(s(p)){var x=t.paint.get(p);if(x instanceof _s&&ru(x.property.specification)){var S=xa(p,t.type),M=x.value,L=x.property.specification.type,N=x.property.useIntegerZoom,U=x.property.specification["property-type"],V=U==="cross-faded"||U==="cross-faded-data-driven";if(M.kind==="constant")this.binders[p]=V?new ai(M.value,S):new ti(M.value,S,L),h.push("/u_"+p);else if(M.kind==="source"||V){var Y=Xa(p,L,"source");this.binders[p]=V?new fi(M,L,N,a,Y,t.id):new $n(M,S,L,Y),h.push("/a_"+p)}else{var J=Xa(p,L,"composite");this.binders[p]=new Gn(M,S,L,N,a,J),h.push("/z_"+p)}}}this.cacheKey=h.sort().join("")};Xn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof $n||a instanceof Gn?a.maxValue:0},Xn.prototype.populatePaintArrays=function(t,a,s,h,p){for(var x in this.binders){var S=this.binders[x];(S instanceof $n||S instanceof Gn||S instanceof fi)&&S.populatePaintArray(t,a,s,h,p)}},Xn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var h=this.binders[s];h instanceof ai&&h.setConstantPatternPositions(t,a)}},Xn.prototype.updatePaintArrays=function(t,a,s,h,p){var x=!1;for(var S in t)for(var M=0,L=a.getPositions(S);M<L.length;M+=1){var N=L[M],U=s.feature(N.index);for(var V in this.binders){var Y=this.binders[V];if((Y instanceof $n||Y instanceof Gn||Y instanceof fi)&&Y.expression.isStateDependent===!0){var J=h.paint.get(V);Y.expression=J.value,Y.updatePaintArray(N.start,N.end,U,t[S],p),x=!0}}}return x},Xn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof ti||s instanceof ai)&&t.push.apply(t,s.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Xn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof $n||s instanceof Gn)for(var h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof fi)for(var p=0;p<Se.members.length;p++)t.push(Se.members[p].name)}return t},Xn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ti||s instanceof ai||s instanceof Gn)for(var h=0,p=s.uniformNames;h<p.length;h+=1)t.push(p[h])}return t},Xn.prototype.getPaintVertexBuffers=function(){return this._buffers},Xn.prototype.getUniforms=function(t,a){var s=[];for(var h in this.binders){var p=this.binders[h];if(p instanceof ti||p instanceof ai||p instanceof Gn)for(var x=0,S=p.uniformNames;x<S.length;x+=1){var M=S[x];if(a[M]){var L=p.getBinding(t,a[M],M);s.push({name:M,property:h,binding:L})}}}return s},Xn.prototype.setUniforms=function(t,a,s,h){for(var p=0,x=a;p<x.length;p+=1){var S=x[p],M=S.name,L=S.property;this.binders[L].setUniform(S.binding,h,s.get(L),M)}},Xn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof fi){var h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof $n||s instanceof Gn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Xn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof $n||s instanceof Gn||s instanceof fi)&&s.upload(t)}this.updatePaintBuffers()},Xn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof $n||a instanceof Gn||a instanceof fi)&&a.destroy()}};var Zn=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var h=0,p=t;h<p.length;h+=1){var x=p[h];this.programConfigurations[x.id]=new Xn(x,a,s)}this.needsUpload=!1,this._featureMap=new Xe,this._bufferOffset=0};function xa(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function Xa(t,a,s){var h={color:{source:Xu,composite:cc},number:{source:dl,composite:Xu}},p=function(x){return{"line-pattern":{source:vu,composite:vu},"fill-pattern":{source:vu,composite:vu},"fill-extrusion-pattern":{source:vu,composite:vu}}[x]}(t);return p&&p[s]||h[a][s]}Zn.prototype.populatePaintArrays=function(t,a,s,h,p,x){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,a,h,p,x);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Zn.prototype.updatePaintArrays=function(t,a,s,h){for(var p=0,x=s;p<x.length;p+=1){var S=x[p];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,a,S,h)||this.needsUpload}},Zn.prototype.get=function(t){return this.programConfigurations[t]},Zn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},Zn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},cn("ConstantBinder",ti),cn("CrossFadedConstantBinder",ai),cn("SourceExpressionBinder",$n),cn("CrossFadedCompositeBinder",fi),cn("CompositeExpressionBinder",Gn),cn("ProgramConfiguration",Xn,{omit:["_buffers"]}),cn("ProgramConfigurationSet",Zn);var No=Math.pow(2,14)-1,So=-No-1;function Ua(t){for(var a=8192/t.extent,s=t.loadGeometry(),h=0;h<s.length;h++)for(var p=s[h],x=0;x<p.length;x++){var S=p[x],M=Math.round(S.x*a),L=Math.round(S.y*a);S.x=Qt(M,So,No),S.y=Qt(L,So,No),(M<S.x||M>S.x+1||L<S.y||L>S.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function to(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?Ua(t):[]}}function xs(t,a,s,h,p){t.emplaceBack(2*a+(h+1)/2,2*s+(p+1)/2)}var is=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new fl,this.indexArray=new hl,this.segments=new ae,this.programConfigurations=new Zn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function ku(t,a){for(var s=0;s<t.length;s++)if(ou(a,t[s]))return!0;for(var h=0;h<a.length;h++)if(ou(t,a[h]))return!0;return!!fc(t,a)}function as(t,a,s){return!!ou(t,a)||!!mu(a,t,s)}function qs(t,a){if(t.length===1)return hc(a,t[0]);for(var s=0;s<a.length;s++)for(var h=a[s],p=0;p<h.length;p++)if(ou(t,h[p]))return!0;for(var x=0;x<t.length;x++)if(hc(a,t[x]))return!0;for(var S=0;S<a.length;S++)if(fc(t,a[S]))return!0;return!1}function Ks(t,a,s){if(t.length>1){if(fc(t,a))return!0;for(var h=0;h<a.length;h++)if(mu(a[h],t,s))return!0}for(var p=0;p<t.length;p++)if(mu(t[p],a,s))return!0;return!1}function fc(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var h=t[s],p=t[s+1],x=0;x<a.length-1;x++)if(Bl(h,p,a[x],a[x+1]))return!0;return!1}function Bl(t,a,s,h){return Xt(t,s,h)!==Xt(a,s,h)&&Xt(t,a,s)!==Xt(t,a,h)}function mu(t,a,s){var h=s*s;if(a.length===1)return t.distSqr(a[0])<h;for(var p=1;p<a.length;p++)if(vl(t,a[p-1],a[p])<h)return!0;return!1}function vl(t,a,s){var h=a.distSqr(s);if(h===0)return t.distSqr(a);var p=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/h;return t.distSqr(p<0?a:p>1?s:s.sub(a)._mult(p)._add(a))}function hc(t,a){for(var s,h,p,x=!1,S=0;S<t.length;S++)for(var M=0,L=(s=t[S]).length-1;M<s.length;L=M++)(h=s[M]).y>a.y!=(p=s[L]).y>a.y&&a.x<(p.x-h.x)*(a.y-h.y)/(p.y-h.y)+h.x&&(x=!x);return x}function ou(t,a){for(var s=!1,h=0,p=t.length-1;h<t.length;p=h++){var x=t[h],S=t[p];x.y>a.y!=S.y>a.y&&a.x<(S.x-x.x)*(a.y-x.y)/(S.y-x.y)+x.x&&(s=!s)}return s}function zl(t,a,s){var h=s[0],p=s[2];if(t.x<h.x&&a.x<h.x||t.x>p.x&&a.x>p.x||t.y<h.y&&a.y<h.y||t.y>p.y&&a.y>p.y)return!1;var x=Xt(t,a,s[0]);return x!==Xt(t,a,s[1])||x!==Xt(t,a,s[2])||x!==Xt(t,a,s[3])}function gu(t,a,s){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:s.programConfigurations.get(a.id).getMaxValue(t)}function go(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function yu(t,a,s,h,p){if(!a[0]&&!a[1])return t;var x=he.convert(a)._mult(p);s==="viewport"&&x._rotate(-h);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(x));return S}is.prototype.populate=function(t,a,s){var h=this.layers[0],p=[],x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var L=M[S],N=L.feature,U=L.id,V=L.index,Y=L.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,Ce=to(N,J);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),Ce,s)){var Te=x?x.evaluate(Ce,{},s):void 0,Ge={id:U,properties:N.properties,type:N.type,sourceLayerIndex:Y,index:V,geometry:J?Ce.geometry:Ua(N),patterns:{},sortKey:Te};p.push(Ge)}}x&&p.sort(function(Zr,Mn){return Zr.sortKey-Mn.sortKey});for(var Ne=0,et=p;Ne<et.length;Ne+=1){var vt=et[Ne],Lt=vt.geometry,Bt=vt.index,rr=vt.sourceLayerIndex,wr=t[Bt].feature;this.addFeature(vt,Lt,Bt,s),a.featureIndex.insert(wr,Lt,Bt,rr,this.index)}},is.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},is.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},is.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},is.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ne),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},is.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},is.prototype.addFeature=function(t,a,s,h){for(var p=0,x=a;p<x.length;p+=1)for(var S=0,M=x[p];S<M.length;S+=1){var L=M[S],N=L.x,U=L.y;if(!(N<0||N>=8192||U<0||U>=8192)){var V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Y=V.vertexLength;xs(this.layoutVertexArray,N,U,-1,-1),xs(this.layoutVertexArray,N,U,1,-1),xs(this.layoutVertexArray,N,U,1,1),xs(this.layoutVertexArray,N,U,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+3,Y+2),V.vertexLength+=4,V.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)},cn("CircleBucket",is,{omit:["layers"]});var qu=new Fo({"circle-sort-key":new xn(ie.layout_circle["circle-sort-key"])}),Du={paint:new Fo({"circle-radius":new xn(ie.paint_circle["circle-radius"]),"circle-color":new xn(ie.paint_circle["circle-color"]),"circle-blur":new xn(ie.paint_circle["circle-blur"]),"circle-opacity":new xn(ie.paint_circle["circle-opacity"]),"circle-translate":new Tn(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new Tn(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tn(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tn(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xn(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xn(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xn(ie.paint_circle["circle-stroke-opacity"])}),layout:qu},Xi=typeof Float32Array!="undefined"?Float32Array:Array;function zs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function os(t,a,s){var h=a[0],p=a[1],x=a[2],S=a[3],M=a[4],L=a[5],N=a[6],U=a[7],V=a[8],Y=a[9],J=a[10],Ce=a[11],Te=a[12],Ge=a[13],Ne=a[14],et=a[15],vt=s[0],Lt=s[1],Bt=s[2],rr=s[3];return t[0]=vt*h+Lt*M+Bt*V+rr*Te,t[1]=vt*p+Lt*L+Bt*Y+rr*Ge,t[2]=vt*x+Lt*N+Bt*J+rr*Ne,t[3]=vt*S+Lt*U+Bt*Ce+rr*et,t[4]=(vt=s[4])*h+(Lt=s[5])*M+(Bt=s[6])*V+(rr=s[7])*Te,t[5]=vt*p+Lt*L+Bt*Y+rr*Ge,t[6]=vt*x+Lt*N+Bt*J+rr*Ne,t[7]=vt*S+Lt*U+Bt*Ce+rr*et,t[8]=(vt=s[8])*h+(Lt=s[9])*M+(Bt=s[10])*V+(rr=s[11])*Te,t[9]=vt*p+Lt*L+Bt*Y+rr*Ge,t[10]=vt*x+Lt*N+Bt*J+rr*Ne,t[11]=vt*S+Lt*U+Bt*Ce+rr*et,t[12]=(vt=s[12])*h+(Lt=s[13])*M+(Bt=s[14])*V+(rr=s[15])*Te,t[13]=vt*p+Lt*L+Bt*Y+rr*Ge,t[14]=vt*x+Lt*N+Bt*J+rr*Ne,t[15]=vt*S+Lt*U+Bt*Ce+rr*et,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var Ku,Bc=os;function zc(t,a,s){var h=a[0],p=a[1],x=a[2],S=a[3];return t[0]=s[0]*h+s[4]*p+s[8]*x+s[12]*S,t[1]=s[1]*h+s[5]*p+s[9]*x+s[13]*S,t[2]=s[2]*h+s[6]*p+s[10]*x+s[14]*S,t[3]=s[3]*h+s[7]*p+s[11]*x+s[15]*S,t}Ku=new Xi(3),Xi!=Float32Array&&(Ku[0]=0,Ku[1]=0,Ku[2]=0),function(){var t=new Xi(4);Xi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var vf=(function(){var t=new Xi(2);Xi!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,Du)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new is(s)},a.prototype.queryRadius=function(s){var h=s;return gu("circle-radius",this,h)+gu("circle-stroke-width",this,h)+go(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,h,p,x,S,M,L,N){for(var U=yu(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,L),V=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),Y=this.paint.get("circle-pitch-alignment")==="map",J=Y?U:function(wr,Zr){return wr.map(function(Mn){return Ko(Mn,Zr)})}(U,N),Ce=Y?V*L:V,Te=0,Ge=x;Te<Ge.length;Te+=1)for(var Ne=0,et=Ge[Te];Ne<et.length;Ne+=1){var vt=et[Ne],Lt=Y?vt:Ko(vt,N),Bt=Ce,rr=zc([],[vt.x,vt.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Bt*=rr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Bt*=M.cameraToCenterDistance/rr[3]),as(J,Lt,Bt))return!0}return!1},a}(wa));function Ko(t,a){var s=zc([],[t.x,t.y,0,1],a);return new he(s[0]/s[3],s[1]/s[3])}var pc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(is);function su(t,a,s,h){var p=a.width,x=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==p*x*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(p*x*s);return t.width=p,t.height=x,t.data=h,t}function ml(t,a,s){var h=a.width,p=a.height;if(h!==t.width||p!==t.height){var x=su({},{width:h,height:p},s);Uc(t,x,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,p)},s),t.width=h,t.height=p,t.data=x.data}}function Uc(t,a,s,h,p,x){if(p.width===0||p.height===0)return a;if(p.width>t.width||p.height>t.height||s.x>t.width-p.width||s.y>t.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>a.width||p.height>a.height||h.x>a.width-p.width||h.y>a.height-p.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=a.data,L=0;L<p.height;L++)for(var N=((s.y+L)*t.width+s.x)*x,U=((h.y+L)*a.width+h.x)*x,V=0;V<p.width*x;V++)M[U+V]=S[N+V];return a}cn("HeatmapBucket",pc,{omit:["layers"]});var uu=function(t,a){su(this,t,1,a)};uu.prototype.resize=function(t){ml(this,t,1)},uu.prototype.clone=function(){return new uu({width:this.width,height:this.height},new Uint8Array(this.data))},uu.copy=function(t,a,s,h,p){Uc(t,a,s,h,p,1)};var wo=function(t,a){su(this,t,4,a)};wo.prototype.resize=function(t){ml(this,t,4)},wo.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},wo.prototype.clone=function(){return new wo({width:this.width,height:this.height},new Uint8Array(this.data))},wo.copy=function(t,a,s,h,p){Uc(t,a,s,h,p,4)},cn("AlphaImage",uu),cn("RGBAImage",wo);var Zc={paint:new Fo({"heatmap-radius":new xn(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xn(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tn(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ns(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tn(ie.paint_heatmap["heatmap-opacity"])})};function Gf(t){var a={},s=t.resolution||256,h=t.clips?t.clips.length:1,p=t.image||new wo({width:s,height:h}),x=function(Ce,Te,Ge){a[t.evaluationKey]=Ge;var Ne=t.expression.evaluate(a);p.data[Ce+Te+0]=Math.floor(255*Ne.r/Ne.a),p.data[Ce+Te+1]=Math.floor(255*Ne.g/Ne.a),p.data[Ce+Te+2]=Math.floor(255*Ne.b/Ne.a),p.data[Ce+Te+3]=Math.floor(255*Ne.a)};if(t.clips)for(var S=0,M=0;S<h;++S,M+=4*s)for(var L=0,N=0;L<s;L++,N+=4){var U=L/(s-1),V=t.clips[S];x(M,N,V.start*(1-U)+V.end*U)}else for(var Y=0,J=0;Y<s;Y++,J+=4)x(0,J,Y/(s-1));return p}var Hf=function(t){function a(s){t.call(this,s,Zc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new pc(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(wa),mf={paint:new Fo({"hillshade-illumination-direction":new Tn(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tn(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tn(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tn(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tn(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tn(ie.paint_hillshade["hillshade-accent-color"])})},qh=function(t){function a(s){t.call(this,s,mf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(wa),Kh=_a([{name:"a_pos",components:2,type:"Int16"}],4).members,dc=Ch,gf=Ch;function Ch(t,a,s){s=s||2;var h,p,x,S,M,L,N,U=a&&a.length,V=U?a[0]*s:t.length,Y=_d(t,0,V,s,!0),J=[];if(!Y||Y.next===Y.prev)return J;if(U&&(Y=function(Te,Ge,Ne,et){var vt,Lt,Bt,rr=[];for(vt=0,Lt=Ge.length;vt<Lt;vt++)(Bt=_d(Te,Ge[vt]*et,vt<Lt-1?Ge[vt+1]*et:Te.length,et,!1))===Bt.next&&(Bt.steiner=!0),rr.push(Wf(Bt));for(rr.sort(zp),vt=0;vt<rr.length;vt++)Up(rr[vt],Ne),Ne=Rr(Ne,Ne.next);return Ne}(t,a,Y,s)),t.length>80*s){h=x=t[0],p=S=t[1];for(var Ce=s;Ce<V;Ce+=s)(M=t[Ce])<h&&(h=M),(L=t[Ce+1])<p&&(p=L),M>x&&(x=M),L>S&&(S=L);N=(N=Math.max(x-h,S-p))!==0?1/N:0}return yf(Y,J,s,h,p,N),J}function _d(t,a,s,h,p){var x,S;if(p===Qf(t,a,s,h)>0)for(x=a;x<s;x+=h)S=bf(x,t[x],t[x+1],S);else for(x=s-h;x>=a;x-=h)S=bf(x,t[x],t[x+1],S);return S&&Xf(S,S.next)&&(gl(S),S=S.next),S}function Rr(t,a){if(!t)return t;a||(a=t);var s,h=t;do if(s=!1,h.steiner||!Xf(h,h.next)&&yo(h.prev,h,h.next)!==0)h=h.next;else{if(gl(h),(h=a=h.prev)===h.next)break;s=!0}while(s||h!==a);return a}function yf(t,a,s,h,p,x,S){if(t){!S&&x&&function(U,V,Y,J){var Ce=U;do Ce.z===null&&(Ce.z=Th(Ce.x,Ce.y,V,Y,J)),Ce.prevZ=Ce.prev,Ce.nextZ=Ce.next,Ce=Ce.next;while(Ce!==U);Ce.prevZ.nextZ=null,Ce.prevZ=null,function(Te){var Ge,Ne,et,vt,Lt,Bt,rr,wr,Zr=1;do{for(Ne=Te,Te=null,Lt=null,Bt=0;Ne;){for(Bt++,et=Ne,rr=0,Ge=0;Ge<Zr&&(rr++,et=et.nextZ);Ge++);for(wr=Zr;rr>0||wr>0&&et;)rr!==0&&(wr===0||!et||Ne.z<=et.z)?(vt=Ne,Ne=Ne.nextZ,rr--):(vt=et,et=et.nextZ,wr--),Lt?Lt.nextZ=vt:Te=vt,vt.prevZ=Lt,Lt=vt;Ne=et}Lt.nextZ=null,Zr*=2}while(Bt>1)}(Ce)}(t,h,p,x);for(var M,L,N=t;t.prev!==t.next;)if(M=t.prev,L=t.next,x?xd(t,h,p,x):Gt(t))a.push(M.i/s),a.push(t.i/s),a.push(L.i/s),gl(t),t=L.next,N=L.next;else if((t=L)===N){S?S===1?yf(t=_f(Rr(t),a,s),a,s,h,p,x,2):S===2&&Ah(t,a,s,h,p,x):yf(Rr(t),a,s,h,p,x,1);break}}}function Gt(t){var a=t.prev,s=t,h=t.next;if(yo(a,s,h)>=0)return!1;for(var p=t.next.next;p!==t.prev;){if(xf(a.x,a.y,s.x,s.y,h.x,h.y,p.x,p.y)&&yo(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function xd(t,a,s,h){var p=t.prev,x=t,S=t.next;if(yo(p,x,S)>=0)return!1;for(var M=p.x>x.x?p.x>S.x?p.x:S.x:x.x>S.x?x.x:S.x,L=p.y>x.y?p.y>S.y?p.y:S.y:x.y>S.y?x.y:S.y,N=Th(p.x<x.x?p.x<S.x?p.x:S.x:x.x<S.x?x.x:S.x,p.y<x.y?p.y<S.y?p.y:S.y:x.y<S.y?x.y:S.y,a,s,h),U=Th(M,L,a,s,h),V=t.prevZ,Y=t.nextZ;V&&V.z>=N&&Y&&Y.z<=U;){if(V!==t.prev&&V!==t.next&&xf(p.x,p.y,x.x,x.y,S.x,S.y,V.x,V.y)&&yo(V.prev,V,V.next)>=0||(V=V.prevZ,Y!==t.prev&&Y!==t.next&&xf(p.x,p.y,x.x,x.y,S.x,S.y,Y.x,Y.y)&&yo(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;V&&V.z>=N;){if(V!==t.prev&&V!==t.next&&xf(p.x,p.y,x.x,x.y,S.x,S.y,V.x,V.y)&&yo(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;Y&&Y.z<=U;){if(Y!==t.prev&&Y!==t.next&&xf(p.x,p.y,x.x,x.y,S.x,S.y,Y.x,Y.y)&&yo(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function _f(t,a,s){var h=t;do{var p=h.prev,x=h.next.next;!Xf(p,x)&&$h(p,h,h.next,x)&&Kf(p,x)&&Kf(x,p)&&(a.push(p.i/s),a.push(h.i/s),a.push(x.i/s),gl(h),gl(h.next),h=t=x),h=h.next}while(h!==t);return Rr(h)}function Ah(t,a,s,h,p,x){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&bd(S,M)){var L=$f(S,M);return S=Rr(S,S.next),L=Rr(L,L.next),yf(S,a,s,h,p,x),void yf(L,a,s,h,p,x)}M=M.next}S=S.next}while(S!==t)}function zp(t,a){return t.x-a.x}function Up(t,a){if(a=function(h,p){var x,S=p,M=h.x,L=h.y,N=-1/0;do{if(L<=S.y&&L>=S.next.y&&S.next.y!==S.y){var U=S.x+(L-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(U<=M&&U>N){if(N=U,U===M){if(L===S.y)return S;if(L===S.next.y)return S.next}x=S.x<S.next.x?S:S.next}}S=S.next}while(S!==p);if(!x)return null;if(M===N)return x;var V,Y=x,J=x.x,Ce=x.y,Te=1/0;S=x;do M>=S.x&&S.x>=J&&M!==S.x&&xf(L<Ce?M:N,L,J,Ce,L<Ce?N:M,L,S.x,S.y)&&(V=Math.abs(L-S.y)/(M-S.x),Kf(S,h)&&(V<Te||V===Te&&(S.x>x.x||S.x===x.x&&Zp(x,S)))&&(x=S,Te=V)),S=S.next;while(S!==Y);return x}(t,a)){var s=$f(a,t);Rr(a,a.next),Rr(s,s.next)}}function Zp(t,a){return yo(t.prev,t,a.prev)<0&&yo(a.next,t,t.next)<0}function Th(t,a,s,h,p){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*p)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*p)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Wf(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function xf(t,a,s,h,p,x,S,M){return(p-S)*(a-M)-(t-S)*(x-M)>=0&&(t-S)*(h-M)-(s-S)*(a-M)>=0&&(s-S)*(x-M)-(p-S)*(h-M)>=0}function bd(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,h){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==h.i&&p.next.i!==h.i&&$h(p,p.next,s,h))return!0;p=p.next}while(p!==s);return!1}(t,a)&&(Kf(t,a)&&Kf(a,t)&&function(s,h){var p=s,x=!1,S=(s.x+h.x)/2,M=(s.y+h.y)/2;do p.y>M!=p.next.y>M&&p.next.y!==p.y&&S<(p.next.x-p.x)*(M-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==s);return x}(t,a)&&(yo(t.prev,t,a.prev)||yo(t,a.prev,a))||Xf(t,a)&&yo(t.prev,t,t.next)>0&&yo(a.prev,a,a.next)>0)}function yo(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Xf(t,a){return t.x===a.x&&t.y===a.y}function $h(t,a,s,h){var p=qf(yo(t,a,s)),x=qf(yo(t,a,h)),S=qf(yo(s,h,t)),M=qf(yo(s,h,a));return p!==x&&S!==M||!(p!==0||!Yf(t,s,a))||!(x!==0||!Yf(t,h,a))||!(S!==0||!Yf(s,t,h))||!(M!==0||!Yf(s,a,h))}function Yf(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function qf(t){return t>0?1:t<0?-1:0}function Kf(t,a){return yo(t.prev,t,t.next)<0?yo(t,a,t.next)>=0&&yo(t,t.prev,a)>=0:yo(t,a,t.prev)<0||yo(t,t.next,a)<0}function $f(t,a){var s=new Ef(t.i,t.x,t.y),h=new Ef(a.i,a.x,a.y),p=t.next,x=a.prev;return t.next=a,a.prev=t,s.next=p,p.prev=s,h.next=s,s.prev=h,x.next=h,h.prev=x,h}function bf(t,a,s,h){var p=new Ef(t,a,s);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function gl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ef(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qf(t,a,s,h){for(var p=0,x=a,S=s-h;x<s;x+=h)p+=(t[S]-t[x])*(t[x+1]+t[S+1]),S=x;return p}function Mh(t,a,s,h,p){(function x(S,M,L,N,U){for(;N>L;){if(N-L>600){var V=N-L+1,Y=M-L+1,J=Math.log(V),Ce=.5*Math.exp(2*J/3),Te=.5*Math.sqrt(J*Ce*(V-Ce)/V)*(Y-V/2<0?-1:1);x(S,M,Math.max(L,Math.floor(M-Y*Ce/V+Te)),Math.min(N,Math.floor(M+(V-Y)*Ce/V+Te)),U)}var Ge=S[M],Ne=L,et=N;for(vc(S,L,M),U(S[N],Ge)>0&&vc(S,L,N);Ne<et;){for(vc(S,Ne,et),Ne++,et--;U(S[Ne],Ge)<0;)Ne++;for(;U(S[et],Ge)>0;)et--}U(S[L],Ge)===0?vc(S,L,et):vc(S,++et,N),et<=M&&(L=et+1),M<=et&&(N=et-1)}})(t,a,s||0,h||t.length-1,p||Ph)}function vc(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}function Ph(t,a){return t<a?-1:t>a?1:0}function Jf(t,a){var s=t.length;if(s<=1)return[t];for(var h,p,x=[],S=0;S<s;S++){var M=Sr(t[S]);M!==0&&(t[S].area=Math.abs(M),p===void 0&&(p=M<0),p===M<0?(h&&x.push(h),h=[t[S]]):h.push(t[S]))}if(h&&x.push(h),a>1)for(var L=0;L<x.length;L++)x[L].length<=a||(Mh(x[L],a,1,x[L].length-1,Ih),x[L]=x[L].slice(0,a));return x}function Ih(t,a){return a.area-t.area}function Vc(t,a,s){for(var h=s.patternDependencies,p=!1,x=0,S=a;x<S.length;x+=1){var M=S[x].paint.get(t+"-pattern");M.isConstant()||(p=!0);var L=M.constantOr(null);L&&(p=!0,h[L.to]=!0,h[L.from]=!0)}return p}function Sf(t,a,s,h,p){for(var x=p.patternDependencies,S=0,M=a;S<M.length;S+=1){var L=M[S],N=L.paint.get(t+"-pattern").value;if(N.kind!=="constant"){var U=N.evaluate({zoom:h-1},s,{},p.availableImages),V=N.evaluate({zoom:h},s,{},p.availableImages),Y=N.evaluate({zoom:h+1},s,{},p.availableImages);V=V&&V.name?V.name:V,Y=Y&&Y.name?Y.name:Y,x[U=U&&U.name?U.name:U]=!0,x[V]=!0,x[Y]=!0,s.patterns[L.id]={min:U,mid:V,max:Y}}}return s}Ch.deviation=function(t,a,s,h){var p=a&&a.length,x=Math.abs(Qf(t,0,p?a[0]*s:t.length,s));if(p)for(var S=0,M=a.length;S<M;S++)x-=Math.abs(Qf(t,a[S]*s,S<M-1?a[S+1]*s:t.length,s));var L=0;for(S=0;S<h.length;S+=3){var N=h[S]*s,U=h[S+1]*s,V=h[S+2]*s;L+=Math.abs((t[N]-t[V])*(t[U+1]-t[N+1])-(t[N]-t[U])*(t[V+1]-t[N+1]))}return x===0&&L===0?0:Math.abs((L-x)/x)},Ch.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},h=0,p=0;p<t.length;p++){for(var x=0;x<t[p].length;x++)for(var S=0;S<a;S++)s.vertices.push(t[p][x][S]);p>0&&s.holes.push(h+=t[p-1].length)}return s},dc.default=gf;var Us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fl,this.indexArray=new hl,this.indexArray2=new Nl,this.programConfigurations=new Zn(t.layers,t.zoom),this.segments=new ae,this.segments2=new ae,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Us.prototype.populate=function(t,a,s){this.hasPattern=Vc("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),p=[],x=0,S=t;x<S.length;x+=1){var M=S[x],L=M.feature,N=M.id,U=M.index,V=M.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,J=to(L,Y);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),J,s)){var Ce=h?h.evaluate(J,{},s,a.availableImages):void 0,Te={id:N,properties:L.properties,type:L.type,sourceLayerIndex:V,index:U,geometry:Y?J.geometry:Ua(L),patterns:{},sortKey:Ce};p.push(Te)}}h&&p.sort(function(wr,Zr){return wr.sortKey-Zr.sortKey});for(var Ge=0,Ne=p;Ge<Ne.length;Ge+=1){var et=Ne[Ge],vt=et.geometry,Lt=et.index,Bt=et.sourceLayerIndex;if(this.hasPattern){var rr=Sf("fill",this.layers,et,this.zoom,a);this.patternFeatures.push(rr)}else this.addFeature(et,vt,Lt,s,{});a.featureIndex.insert(t[Lt].feature,vt,Lt,Bt,this.index)}},Us.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Us.prototype.addFeatures=function(t,a,s){for(var h=0,p=this.patternFeatures;h<p.length;h+=1){var x=p[h];this.addFeature(x,x.geometry,x.index,a,s)}},Us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Us.prototype.addFeature=function(t,a,s,h,p){for(var x=0,S=Jf(a,500);x<S.length;x+=1){for(var M=S[x],L=0,N=0,U=M;N<U.length;N+=1)L+=U[N].length;for(var V=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),Y=V.vertexLength,J=[],Ce=[],Te=0,Ge=M;Te<Ge.length;Te+=1){var Ne=Ge[Te];if(Ne.length!==0){Ne!==M[0]&&Ce.push(J.length/2);var et=this.segments2.prepareSegment(Ne.length,this.layoutVertexArray,this.indexArray2),vt=et.vertexLength;this.layoutVertexArray.emplaceBack(Ne[0].x,Ne[0].y),this.indexArray2.emplaceBack(vt+Ne.length-1,vt),J.push(Ne[0].x),J.push(Ne[0].y);for(var Lt=1;Lt<Ne.length;Lt++)this.layoutVertexArray.emplaceBack(Ne[Lt].x,Ne[Lt].y),this.indexArray2.emplaceBack(vt+Lt-1,vt+Lt),J.push(Ne[Lt].x),J.push(Ne[Lt].y);et.vertexLength+=Ne.length,et.primitiveLength+=Ne.length}}for(var Bt=dc(J,Ce),rr=0;rr<Bt.length;rr+=3)this.indexArray.emplaceBack(Y+Bt[rr],Y+Bt[rr+1],Y+Bt[rr+2]);V.vertexLength+=L,V.primitiveLength+=Bt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,h)},cn("FillBucket",Us,{omit:["layers","patternFeatures"]});var eh=new Fo({"fill-sort-key":new xn(ie.layout_fill["fill-sort-key"])}),Oh={paint:new Fo({"fill-antialias":new Tn(ie.paint_fill["fill-antialias"]),"fill-opacity":new xn(ie.paint_fill["fill-opacity"]),"fill-color":new xn(ie.paint_fill["fill-color"]),"fill-outline-color":new xn(ie.paint_fill["fill-outline-color"]),"fill-translate":new Tn(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new Tn(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dc(ie.paint_fill["fill-pattern"])}),layout:eh},th=function(t){function a(s){t.call(this,s,Oh)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h);var p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new Us(s)},a.prototype.queryRadius=function(){return go(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,h,p,x,S,M,L){return qs(yu(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,L),x)},a.prototype.isTileClipped=function(){return!0},a}(wa),wf=_a([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,rh=yl;function yl(t,a,s,h,p){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=p,t.readFields(mc,this,a)}function mc(t,a,s){t==1?a.id=s.readVarint():t==2?function(h,p){for(var x=h.readVarint()+h.pos;h.pos<x;){var S=p._keys[h.readVarint()],M=p._values[h.readVarint()];p.properties[S]=M}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function Qh(t){for(var a,s,h=0,p=0,x=t.length,S=x-1;p<x;S=p++)h+=((s=t[S]).x-(a=t[p]).x)*(a.y+s.y);return h}yl.types=["Unknown","Point","LineString","Polygon"],yl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,h=1,p=0,x=0,S=0,M=[];t.pos<s;){if(p<=0){var L=t.readVarint();h=7&L,p=L>>3}if(p--,h===1||h===2)x+=t.readSVarint(),S+=t.readSVarint(),h===1&&(a&&M.push(a),a=[]),a.push(new he(x,S));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&M.push(a),M},yl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,h=0,p=0,x=0,S=1/0,M=-1/0,L=1/0,N=-1/0;t.pos<a;){if(h<=0){var U=t.readVarint();s=7&U,h=U>>3}if(h--,s===1||s===2)(p+=t.readSVarint())<S&&(S=p),p>M&&(M=p),(x+=t.readSVarint())<L&&(L=x),x>N&&(N=x);else if(s!==7)throw new Error("unknown command "+s)}return[S,L,M,N]},yl.prototype.toGeoJSON=function(t,a,s){var h,p,x=this.extent*Math.pow(2,s),S=this.extent*t,M=this.extent*a,L=this.loadGeometry(),N=yl.types[this.type];function U(J){for(var Ce=0;Ce<J.length;Ce++){var Te=J[Ce];J[Ce]=[360*(Te.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Te.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(h=0;h<L.length;h++)V[h]=L[h][0];U(L=V);break;case 2:for(h=0;h<L.length;h++)U(L[h]);break;case 3:for(L=function(J){var Ce=J.length;if(Ce<=1)return[J];for(var Te,Ge,Ne=[],et=0;et<Ce;et++){var vt=Qh(J[et]);vt!==0&&(Ge===void 0&&(Ge=vt<0),Ge===vt<0?(Te&&Ne.push(Te),Te=[J[et]]):Te.push(J[et]))}return Te&&Ne.push(Te),Ne}(L),h=0;h<L.length;h++)for(p=0;p<L[h].length;p++)U(L[h][p])}L.length===1?L=L[0]:N="Multi"+N;var Y={type:"Feature",geometry:{type:N,coordinates:L},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var Rh=Vp;function Vp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ed,this,a),this.length=this._features.length}function Ed(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(h){for(var p=null,x=h.readVarint()+h.pos;h.pos<x;){var S=h.readVarint()>>3;p=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return p}(s))}function jp(t,a,s){if(t===3){var h=new Rh(s,s.readVarint()+s.pos);h.length&&(a[h.name]=h)}}Vp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new rh(this._pbf,a,this.extent,this._keys,this._values)};var Is={VectorTile:function(t,a){this.layers=t.readFields(jp,{},a)},VectorTileFeature:rh,VectorTileLayer:Rh},Gp=Is.VectorTileFeature.types,Ca=Math.pow(2,13);function _u(t,a,s,h,p,x,S,M){t.emplaceBack(a,s,2*Math.floor(h*Ca)+S,p*Ca*2,x*Ca*2,Math.round(M))}var $u=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new du,this.indexArray=new hl,this.programConfigurations=new Zn(t.layers,t.zoom),this.segments=new ae,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Hp(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}$u.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=Vc("fill-extrusion",this.layers,a);for(var h=0,p=t;h<p.length;h+=1){var x=p[h],S=x.feature,M=x.id,L=x.index,N=x.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,V=to(S,U);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),V,s)){var Y={id:M,sourceLayerIndex:N,index:L,geometry:U?V.geometry:Ua(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Sf("fill-extrusion",this.layers,Y,this.zoom,a)):this.addFeature(Y,Y.geometry,L,s,{}),a.featureIndex.insert(S,Y.geometry,L,N,this.index,!0)}}},$u.prototype.addFeatures=function(t,a,s){for(var h=0,p=this.features;h<p.length;h+=1){var x=p[h];this.addFeature(x,x.geometry,x.index,a,s)}},$u.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},$u.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$u.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$u.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},$u.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$u.prototype.addFeature=function(t,a,s,h,p){for(var x=0,S=Jf(a,500);x<S.length;x+=1){for(var M=S[x],L=0,N=0,U=M;N<U.length;N+=1)L+=U[N].length;for(var V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Y=0,J=M;Y<J.length;Y+=1){var Ce=J[Y];if(Ce.length!==0&&!((Si=Ce).every(function(bi){return bi.x<0})||Si.every(function(bi){return bi.x>8192})||Si.every(function(bi){return bi.y<0})||Si.every(function(bi){return bi.y>8192})))for(var Te=0,Ge=0;Ge<Ce.length;Ge++){var Ne=Ce[Ge];if(Ge>=1){var et=Ce[Ge-1];if(!Hp(Ne,et)){V.vertexLength+4>ae.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var vt=Ne.sub(et)._perp()._unit(),Lt=et.dist(Ne);Te+Lt>32768&&(Te=0),_u(this.layoutVertexArray,Ne.x,Ne.y,vt.x,vt.y,0,0,Te),_u(this.layoutVertexArray,Ne.x,Ne.y,vt.x,vt.y,0,1,Te),_u(this.layoutVertexArray,et.x,et.y,vt.x,vt.y,0,0,Te+=Lt),_u(this.layoutVertexArray,et.x,et.y,vt.x,vt.y,0,1,Te);var Bt=V.vertexLength;this.indexArray.emplaceBack(Bt,Bt+2,Bt+1),this.indexArray.emplaceBack(Bt+1,Bt+2,Bt+3),V.vertexLength+=4,V.primitiveLength+=2}}}}if(V.vertexLength+L>ae.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),Gp[t.type]==="Polygon"){for(var rr=[],wr=[],Zr=V.vertexLength,Mn=0,on=M;Mn<on.length;Mn+=1){var Un=on[Mn];if(Un.length!==0){Un!==M[0]&&wr.push(rr.length/2);for(var un=0;un<Un.length;un++){var Ii=Un[un];_u(this.layoutVertexArray,Ii.x,Ii.y,0,0,1,1,0),rr.push(Ii.x),rr.push(Ii.y)}}}for(var Wn=dc(rr,wr),An=0;An<Wn.length;An+=3)this.indexArray.emplaceBack(Zr+Wn[An],Zr+Wn[An+2],Zr+Wn[An+1]);V.primitiveLength+=Wn.length/3,V.vertexLength+=L}}var Si;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,h)},cn("FillExtrusionBucket",$u,{omit:["layers","features"]});var Wp={paint:new Fo({"fill-extrusion-opacity":new Tn(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xn(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tn(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tn(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dc(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xn(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xn(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tn(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},_l=function(t){function a(s){t.call(this,s,Wp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new $u(s)},a.prototype.queryRadius=function(){return go(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,h,p,x,S,M,L,N){var U=yu(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,L),V=this.paint.get("fill-extrusion-height").evaluate(h,p),Y=this.paint.get("fill-extrusion-base").evaluate(h,p),J=function(Te,Ge,Ne,et){for(var vt=[],Lt=0,Bt=Te;Lt<Bt.length;Lt+=1){var rr=Bt[Lt],wr=[rr.x,rr.y,0,1];zc(wr,wr,Ge),vt.push(new he(wr[0]/wr[3],wr[1]/wr[3]))}return vt}(U,N),Ce=function(Te,Ge,Ne,et){for(var vt=[],Lt=[],Bt=et[8]*Ge,rr=et[9]*Ge,wr=et[10]*Ge,Zr=et[11]*Ge,Mn=et[8]*Ne,on=et[9]*Ne,Un=et[10]*Ne,un=et[11]*Ne,Ii=0,Wn=Te;Ii<Wn.length;Ii+=1){for(var An=[],Si=[],bi=0,Ki=Wn[Ii];bi<Ki.length;bi+=1){var Dn=Ki[bi],ua=Dn.x,qa=Dn.y,ho=et[0]*ua+et[4]*qa+et[12],no=et[1]*ua+et[5]*qa+et[13],Ka=et[2]*ua+et[6]*qa+et[14],po=et[3]*ua+et[7]*qa+et[15],Bo=Ka+wr,ls=po+Zr,Zs=ho+Mn,cs=no+on,ks=Ka+Un,Po=po+un,Jo=new he((ho+Bt)/ls,(no+rr)/ls);Jo.z=Bo/ls,An.push(Jo);var Zi=new he(Zs/Po,cs/Po);Zi.z=ks/Po,Si.push(Zi)}vt.push(An),Lt.push(Si)}return[vt,Lt]}(x,Y,V,N);return function(Te,Ge,Ne){var et=1/0;qs(Ne,Ge)&&(et=Gc(Ne,Ge[0]));for(var vt=0;vt<Ge.length;vt++)for(var Lt=Ge[vt],Bt=Te[vt],rr=0;rr<Lt.length-1;rr++){var wr=Lt[rr],Zr=[wr,Lt[rr+1],Bt[rr+1],Bt[rr],wr];ku(Ne,Zr)&&(et=Math.min(et,Gc(Ne,Zr)))}return et!==1/0&&et}(Ce[0],Ce[1],J)},a}(wa);function jc(t,a){return t.x*a.x+t.y*a.y}function Gc(t,a){if(t.length===1){for(var s,h=0,p=a[h++];!s||p.equals(s);)if(!(s=a[h++]))return 1/0;for(;h<a.length;h++){var x=a[h],S=t[0],M=s.sub(p),L=x.sub(p),N=S.sub(p),U=jc(M,M),V=jc(M,L),Y=jc(L,L),J=jc(N,M),Ce=jc(N,L),Te=U*Y-V*V,Ge=(Y*J-V*Ce)/Te,Ne=(U*Ce-V*J)/Te,et=p.z*(1-Ge-Ne)+s.z*Ge+x.z*Ne;if(isFinite(et))return et}return 1/0}for(var vt=1/0,Lt=0,Bt=a;Lt<Bt.length;Lt+=1)vt=Math.min(vt,Bt[Lt].z);return vt}var Qu=_a([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Xp=_a([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Jh=Is.VectorTileFeature.types,xu=Math.cos(Math.PI/180*37.5),Hc=Math.pow(2,14)/.5,qi=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new Eo,this.layoutVertexArray2=new Xu,this.indexArray=new hl,this.programConfigurations=new Zn(t.layers,t.zoom),this.segments=new ae,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};qi.prototype.populate=function(t,a,s){this.hasPattern=Vc("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),p=[],x=0,S=t;x<S.length;x+=1){var M=S[x],L=M.feature,N=M.id,U=M.index,V=M.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,J=to(L,Y);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),J,s)){var Ce=h?h.evaluate(J,{},s):void 0,Te={id:N,properties:L.properties,type:L.type,sourceLayerIndex:V,index:U,geometry:Y?J.geometry:Ua(L),patterns:{},sortKey:Ce};p.push(Te)}}h&&p.sort(function(wr,Zr){return wr.sortKey-Zr.sortKey});for(var Ge=0,Ne=p;Ge<Ne.length;Ge+=1){var et=Ne[Ge],vt=et.geometry,Lt=et.index,Bt=et.sourceLayerIndex;if(this.hasPattern){var rr=Sf("line",this.layers,et,this.zoom,a);this.patternFeatures.push(rr)}else this.addFeature(et,vt,Lt,s,{});a.featureIndex.insert(t[Lt].feature,vt,Lt,Bt,this.index)}},qi.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},qi.prototype.addFeatures=function(t,a,s){for(var h=0,p=this.patternFeatures;h<p.length;h+=1){var x=p[h];this.addFeature(x,x.geometry,x.index,a,s)}},qi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qi.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Xp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},qi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qi.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},qi.prototype.addFeature=function(t,a,s,h,p){var x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),L=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var U=0,V=a;U<V.length;U+=1)this.addLine(V[U],t,S,M,L,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,h)},qi.prototype.addLine=function(t,a,s,h,p,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Jh[a.type]==="Polygon",L=t.length;L>=2&&t[L-1].equals(t[L-2]);)L--;for(var N=0;N<L-1&&t[N].equals(t[N+1]);)N++;if(!(L<(M?3:2))){s==="bevel"&&(p=1.05);var U,V=this.overscaling<=16?122880/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),J=void 0,Ce=void 0,Te=void 0,Ge=void 0;this.e1=this.e2=-1,M&&(Ge=t[N].sub(U=t[L-2])._unit()._perp());for(var Ne=N;Ne<L;Ne++)if(!(Ce=Ne===L-1?M?t[N+1]:void 0:t[Ne+1])||!t[Ne].equals(Ce)){Ge&&(Te=Ge),U&&(J=U),U=t[Ne],Ge=Ce?Ce.sub(U)._unit()._perp():Te;var et=(Te=Te||Ge).add(Ge);et.x===0&&et.y===0||et._unit();var vt=Te.x*Ge.x+Te.y*Ge.y,Lt=et.x*Ge.x+et.y*Ge.y,Bt=Lt!==0?1/Lt:1/0,rr=2*Math.sqrt(2-2*Lt),wr=Lt<xu&&J&&Ce,Zr=Te.x*Ge.y-Te.y*Ge.x>0;if(wr&&Ne>N){var Mn=U.dist(J);if(Mn>2*V){var on=U.sub(U.sub(J)._mult(V/Mn)._round());this.updateDistance(J,on),this.addCurrentVertex(on,Te,0,0,Y),J=on}}var Un=J&&Ce,un=Un?s:M?"butt":h;if(Un&&un==="round"&&(Bt<x?un="miter":Bt<=2&&(un="fakeround")),un==="miter"&&Bt>p&&(un="bevel"),un==="bevel"&&(Bt>2&&(un="flipbevel"),Bt<p&&(un="miter")),J&&this.updateDistance(J,U),un==="miter")et._mult(Bt),this.addCurrentVertex(U,et,0,0,Y);else if(un==="flipbevel"){if(Bt>100)et=Ge.mult(-1);else{var Ii=Bt*Te.add(Ge).mag()/Te.sub(Ge).mag();et._perp()._mult(Ii*(Zr?-1:1))}this.addCurrentVertex(U,et,0,0,Y),this.addCurrentVertex(U,et.mult(-1),0,0,Y)}else if(un==="bevel"||un==="fakeround"){var Wn=-Math.sqrt(Bt*Bt-1),An=Zr?Wn:0,Si=Zr?0:Wn;if(J&&this.addCurrentVertex(U,Te,An,Si,Y),un==="fakeround")for(var bi=Math.round(180*rr/Math.PI/20),Ki=1;Ki<bi;Ki++){var Dn=Ki/bi;if(Dn!==.5){var ua=Dn-.5;Dn+=Dn*ua*(Dn-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*ua*ua+(.848013+vt*(.215638*vt-1.06021)))}var qa=Ge.sub(Te)._mult(Dn)._add(Te)._unit()._mult(Zr?-1:1);this.addHalfVertex(U,qa.x,qa.y,!1,Zr,0,Y)}Ce&&this.addCurrentVertex(U,Ge,-An,-Si,Y)}else if(un==="butt")this.addCurrentVertex(U,et,0,0,Y);else if(un==="square"){var ho=J?1:-1;this.addCurrentVertex(U,et,ho,ho,Y)}else un==="round"&&(J&&(this.addCurrentVertex(U,Te,0,0,Y),this.addCurrentVertex(U,Te,1,1,Y,!0)),Ce&&(this.addCurrentVertex(U,Ge,-1,-1,Y,!0),this.addCurrentVertex(U,Ge,0,0,Y)));if(wr&&Ne<L-1){var no=U.dist(Ce);if(no>2*V){var Ka=U.add(Ce.sub(U)._mult(V/no)._round());this.updateDistance(U,Ka),this.addCurrentVertex(Ka,Ge,0,0,Y),U=Ka}}}}},qi.prototype.addCurrentVertex=function(t,a,s,h,p,x){x===void 0&&(x=!1);var S=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,x,!1,s,p),this.addHalfVertex(t,S,M,x,!0,-h,p),this.distance>Hc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,h,p,x))},qi.prototype.addHalfVertex=function(t,a,s,h,p,x,S){var M=.5*(this.lineClips?this.scaledDistance*(Hc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(x===0?0:x<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),S.primitiveLength++),p?this.e2=L:this.e1=L},qi.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},qi.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},cn("LineBucket",qi,{omit:["layers","patternFeatures"]});var gc=new Fo({"line-cap":new Tn(ie.layout_line["line-cap"]),"line-join":new xn(ie.layout_line["line-join"]),"line-miter-limit":new Tn(ie.layout_line["line-miter-limit"]),"line-round-limit":new Tn(ie.layout_line["line-round-limit"]),"line-sort-key":new xn(ie.layout_line["line-sort-key"])}),so={paint:new Fo({"line-opacity":new xn(ie.paint_line["line-opacity"]),"line-color":new xn(ie.paint_line["line-color"]),"line-translate":new Tn(ie.paint_line["line-translate"]),"line-translate-anchor":new Tn(ie.paint_line["line-translate-anchor"]),"line-width":new xn(ie.paint_line["line-width"]),"line-gap-width":new xn(ie.paint_line["line-gap-width"]),"line-offset":new xn(ie.paint_line["line-offset"]),"line-blur":new xn(ie.paint_line["line-blur"]),"line-dasharray":new rs(ie.paint_line["line-dasharray"]),"line-pattern":new Dc(ie.paint_line["line-pattern"]),"line-gradient":new ns(ie.paint_line["line-gradient"])}),layout:gc},Os=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h){return h=new Ei(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,s,h)},a.prototype.evaluate=function(s,h,p,x){return h=Mt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,s,h,p,x)},a}(xn))(so.paint.properties["line-width"].specification);Os.useIntegerZoom=!0;var Lh=function(t){function a(s){t.call(this,s,so),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof vs,this.gradientVersion=(this.gradientVersion+1)%Qe)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h),this.paint._values["line-floorwidth"]=Os.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new qi(s)},a.prototype.queryRadius=function(s){var h=s,p=ep(gu("line-width",this,h),gu("line-gap-width",this,h)),x=gu("line-offset",this,h);return p/2+Math.abs(x)+go(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,h,p,x,S,M,L){var N=yu(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,L),U=L/2*ep(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),V=this.paint.get("line-offset").evaluate(h,p);return V&&(x=function(Y,J){for(var Ce=[],Te=new he(0,0),Ge=0;Ge<Y.length;Ge++){for(var Ne=Y[Ge],et=[],vt=0;vt<Ne.length;vt++){var Lt=Ne[vt],Bt=Ne[vt+1],rr=vt===0?Te:Lt.sub(Ne[vt-1])._unit()._perp(),wr=vt===Ne.length-1?Te:Bt.sub(Lt)._unit()._perp(),Zr=rr._add(wr)._unit();Zr._mult(1/(Zr.x*wr.x+Zr.y*wr.y)),et.push(Zr._mult(J)._add(Lt))}Ce.push(et)}return Ce}(x,V*L)),function(Y,J,Ce){for(var Te=0;Te<J.length;Te++){var Ge=J[Te];if(Y.length>=3){for(var Ne=0;Ne<Ge.length;Ne++)if(ou(Y,Ge[Ne]))return!0}if(Ks(Y,Ge,Ce))return!0}return!1}(N,x,U)},a.prototype.isTileClipped=function(){return!0},a}(wa);function ep(t,a){return a>0?a+2*t:t}var Sd=_a([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wd=_a([{name:"a_projected_pos",components:3,type:"Float32"}],4),Cd=(_a([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_a([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),tp=(_a([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_a([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ad=_a([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yp(t,a,s){return t.sections.forEach(function(h){h.text=function(p,x,S){var M=x.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?p=p.toLocaleUpperCase():M==="lowercase"&&(p=p.toLocaleLowerCase()),Ps.applyArabicShaping&&(p=Ps.applyArabicShaping(p)),p}(h.text,a,s)}),t}_a([{name:"triangle",components:3,type:"Uint16"}]),_a([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_a([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_a([{type:"Float32",name:"offsetX"}]),_a([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var nh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},qp=function(t,a,s,h,p){var x,S,M=8*p-h-1,L=(1<<M)-1,N=L>>1,U=-7,V=s?p-1:0,Y=s?-1:1,J=t[a+V];for(V+=Y,x=J&(1<<-U)-1,J>>=-U,U+=M;U>0;x=256*x+t[a+V],V+=Y,U-=8);for(S=x&(1<<-U)-1,x>>=-U,U+=h;U>0;S=256*S+t[a+V],V+=Y,U-=8);if(x===0)x=1-N;else{if(x===L)return S?NaN:1/0*(J?-1:1);S+=Math.pow(2,h),x-=N}return(J?-1:1)*S*Math.pow(2,x-h)},rp=function(t,a,s,h,p,x){var S,M,L,N=8*x-p-1,U=(1<<N)-1,V=U>>1,Y=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=h?0:x-1,Ce=h?1:-1,Te=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=U):(S=Math.floor(Math.log(a)/Math.LN2),a*(L=Math.pow(2,-S))<1&&(S--,L*=2),(a+=S+V>=1?Y/L:Y*Math.pow(2,1-V))*L>=2&&(S++,L/=2),S+V>=U?(M=0,S=U):S+V>=1?(M=(a*L-1)*Math.pow(2,p),S+=V):(M=a*Math.pow(2,V-1)*Math.pow(2,p),S=0));p>=8;t[s+J]=255&M,J+=Ce,M/=256,p-=8);for(S=S<<p|M,N+=p;N>0;t[s+J]=255&S,J+=Ce,S/=256,N-=8);t[s+J-Ce]|=128*Te},ih=Pa;function Pa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pa.Varint=0,Pa.Fixed64=1,Pa.Bytes=2,Pa.Fixed32=5;var np=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ul(t){return t.type===Pa.Bytes?t.readVarint()+t.pos:t.pos+1}function Cf(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function kh(t,a,s){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(h);for(var p=s.pos-1;p>=t;p--)s.buf[p+h]=s.buf[p]}function Kp(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function F(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function ue(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function ke(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function Tt(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function tr(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function Ct(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function Yt(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function sr(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function pr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function gr(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function br(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Ar(t,a,s){t===1&&s.readMessage(zr,a)}function zr(t,a,s){if(t===3){var h=s.readMessage(vr,{}),p=h.width,x=h.height,S=h.left,M=h.top,L=h.advance;a.push({id:h.id,bitmap:new uu({width:p+6,height:x+6},h.bitmap),metrics:{width:p,height:x,left:S,top:M,advance:L}})}}function vr(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function _r(t){for(var a=0,s=0,h=0,p=t;h<p.length;h+=1){var x=p[h];a+=x.w*x.h,s=Math.max(s,x.w)}t.sort(function(Te,Ge){return Ge.h-Te.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],M=0,L=0,N=0,U=t;N<U.length;N+=1)for(var V=U[N],Y=S.length-1;Y>=0;Y--){var J=S[Y];if(!(V.w>J.w||V.h>J.h)){if(V.x=J.x,V.y=J.y,L=Math.max(L,V.y+V.h),M=Math.max(M,V.x+V.w),V.w===J.w&&V.h===J.h){var Ce=S.pop();Y<S.length&&(S[Y]=Ce)}else V.h===J.h?(J.x+=V.w,J.w-=V.w):V.w===J.w?(J.y+=V.h,J.h-=V.h):(S.push({x:J.x+V.w,y:J.y,w:J.w-V.w,h:V.h}),J.y+=V.h,J.h-=V.h);break}}return{w:M,h:L,fill:a/(M*L)||0}}Pa.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,t(p,a,this),this.pos===x&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=pr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=br(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=pr(this.buf,this.pos)+4294967296*pr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=pr(this.buf,this.pos)+4294967296*br(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=qp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=qp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,h=this.buf;return a=127&(s=h[this.pos++]),s<128?a:(a|=(127&(s=h[this.pos++]))<<7,s<128?a:(a|=(127&(s=h[this.pos++]))<<14,s<128?a:(a|=(127&(s=h[this.pos++]))<<21,s<128?a:function(p,x,S){var M,L,N=S.buf;if(M=(112&(L=N[S.pos++]))>>4,L<128||(M|=(127&(L=N[S.pos++]))<<3,L<128)||(M|=(127&(L=N[S.pos++]))<<10,L<128)||(M|=(127&(L=N[S.pos++]))<<17,L<128)||(M|=(127&(L=N[S.pos++]))<<24,L<128)||(M|=(1&(L=N[S.pos++]))<<31,L<128))return Cf(p,M,x);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&np?function(s,h,p){return np.decode(s.subarray(h,p))}(this.buf,a,t):function(s,h,p){for(var x="",S=h;S<p;){var M,L,N,U=s[S],V=null,Y=U>239?4:U>223?3:U>191?2:1;if(S+Y>p)break;Y===1?U<128&&(V=U):Y===2?(192&(M=s[S+1]))==128&&(V=(31&U)<<6|63&M)<=127&&(V=null):Y===3?(L=s[S+2],(192&(M=s[S+1]))==128&&(192&L)==128&&((V=(15&U)<<12|(63&M)<<6|63&L)<=2047||V>=55296&&V<=57343)&&(V=null)):Y===4&&(L=s[S+2],N=s[S+3],(192&(M=s[S+1]))==128&&(192&L)==128&&(192&N)==128&&((V=(15&U)<<18|(63&M)<<12|(63&L)<<6|63&N)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,Y=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),S+=Y}return x}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==Pa.Bytes)return t.push(this.readVarint(a));var s=Ul(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSVarint());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Pa.Bytes)return t.push(this.readBoolean());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFloat());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Pa.Bytes)return t.push(this.readDouble());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFixed32());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSFixed32());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFixed64());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSFixed64());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===Pa.Varint)for(;this.buf[this.pos++]>127;);else if(a===Pa.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Pa.Fixed32)this.pos+=4;else{if(a!==Pa.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gr(this.buf,-1&t,this.pos),gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gr(this.buf,-1&t,this.pos),gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var h,p;if(a>=0?(h=a%4294967296|0,p=a/4294967296|0):(p=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,p=p+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(x,S,M){M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7)}(h,0,s),function(x,S){var M=(7&x)<<4;S.buf[S.pos++]|=M|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(p,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,p,x){for(var S,M,L=0;L<p.length;L++){if((S=p.charCodeAt(L))>55295&&S<57344){if(!M){S>56319||L+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):M=S;continue}if(S<56320){h[x++]=239,h[x++]=191,h[x++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(h[x++]=239,h[x++]=191,h[x++]=189,M=null);S<128?h[x++]=S:(S<2048?h[x++]=S>>6|192:(S<65536?h[x++]=S>>12|224:(h[x++]=S>>18|240,h[x++]=S>>12&63|128),h[x++]=S>>6&63|128),h[x++]=63&S|128)}return x}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&kh(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),rp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),rp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var h=this.pos-s;h>=128&&kh(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,s){this.writeTag(t,Pa.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,Kp,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,F,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,Tt,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,ue,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,ke,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,tr,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,Ct,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,Yt,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,sr,a)},writeBytesField:function(t,a){this.writeTag(t,Pa.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,Pa.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,Pa.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,Pa.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,Pa.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,Pa.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,Pa.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,Pa.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,Pa.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,Pa.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var tt=function(t,a){var s=a.pixelRatio,h=a.version,p=a.stretchX,x=a.stretchY,S=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=p,this.stretchY=x,this.content=S,this.version=h},Ft={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ft.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ft.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ft.tlbr.get=function(){return this.tl.concat(this.br)},Ft.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(tt.prototype,Ft);var mr=function(t,a){var s={},h={};this.haveRenderCallbacks=[];var p=[];this.addImages(t,s,p),this.addImages(a,h,p);var x=_r(p),S=new wo({width:x.w||1,height:x.h||1});for(var M in t){var L=t[M],N=s[M].paddedRect;wo.copy(L.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},L.data)}for(var U in a){var V=a[U],Y=h[U].paddedRect,J=Y.x+1,Ce=Y.y+1,Te=V.data.width,Ge=V.data.height;wo.copy(V.data,S,{x:0,y:0},{x:J,y:Ce},V.data),wo.copy(V.data,S,{x:0,y:Ge-1},{x:J,y:Ce-1},{width:Te,height:1}),wo.copy(V.data,S,{x:0,y:0},{x:J,y:Ce+Ge},{width:Te,height:1}),wo.copy(V.data,S,{x:Te-1,y:0},{x:J-1,y:Ce},{width:1,height:Ge}),wo.copy(V.data,S,{x:0,y:0},{x:J+Te,y:Ce},{width:1,height:Ge})}this.image=S,this.iconPositions=s,this.patternPositions=h};mr.prototype.addImages=function(t,a,s){for(var h in t){var p=t[h],x={x:0,y:0,w:p.data.width+2,h:p.data.height+2};s.push(x),a[h]=new tt(x,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},mr.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},mr.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;s.update(a.data,void 0,{x:h[0],y:h[1]})}},cn("ImagePosition",tt),cn("ImageAtlas",mr);var kr={horizontal:1,vertical:2,horizontalOnly:3},or=function(){this.scale=1,this.fontStack="",this.imageName=null};or.forText=function(t,a){var s=new or;return s.scale=t||1,s.fontStack=a,s},or.forImage=function(t){var a=new or;return a.imageName=t,a};var Tr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Wr(t,a,s,h,p,x,S,M,L,N,U,V,Y,J,Ce,Te){var Ge,Ne=Tr.fromFeature(t,p);V===kr.vertical&&Ne.verticalizePunctuation();var et=Ps.processBidirectionalText,vt=Ps.processStyledBidirectionalText;if(et&&Ne.sections.length===1){Ge=[];for(var Lt=0,Bt=et(Ne.toString(),Xr(Ne,N,x,a,h,J,Ce));Lt<Bt.length;Lt+=1){var rr=Bt[Lt],wr=new Tr;wr.text=rr,wr.sections=Ne.sections;for(var Zr=0;Zr<rr.length;Zr++)wr.sectionIndex.push(0);Ge.push(wr)}}else if(vt){Ge=[];for(var Mn=0,on=vt(Ne.text,Ne.sectionIndex,Xr(Ne,N,x,a,h,J,Ce));Mn<on.length;Mn+=1){var Un=on[Mn],un=new Tr;un.text=Un[0],un.sectionIndex=Un[1],un.sections=Ne.sections,Ge.push(un)}}else Ge=function(An,Si){for(var bi=[],Ki=An.text,Dn=0,ua=0,qa=Si;ua<qa.length;ua+=1){var ho=qa[ua];bi.push(An.substring(Dn,ho)),Dn=ho}return Dn<Ki.length&&bi.push(An.substring(Dn,Ki.length)),bi}(Ne,Xr(Ne,N,x,a,h,J,Ce));var Ii=[],Wn={positionedLines:Ii,text:Ne.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:V,iconsInText:!1,verticalizable:!1};return function(An,Si,bi,Ki,Dn,ua,qa,ho,no,Ka,po,Bo){for(var ls=0,Zs=-17,cs=0,ks=0,Po=ho==="right"?1:ho==="left"?0:.5,Jo=0,Zi=0,Oa=Dn;Zi<Oa.length;Zi+=1){var ba=Oa[Zi];ba.trim();var $i=ba.getMaxScale(),Vs=24*($i-1),Es={positionedGlyphs:[],lineOffset:0};An.positionedLines[Jo]=Es;var Va=Es.positionedGlyphs,Io=0;if(ba.length()){for(var Ss=0;Ss<ba.length();Ss++){var la=ba.getSection(Ss),jl=ba.getSectionIndex(Ss),bu=ba.getCharCode(Ss),Gl=0,_o=null,Hl=null,Ju=null,es=24,Tf=!(no===kr.horizontal||!po&&!ff(bu)||po&&(Nn[bu]||(xc=bu,Br.Arabic(xc)||Br["Arabic Supplement"](xc)||Br["Arabic Extended-A"](xc)||Br["Arabic Presentation Forms-A"](xc)||Br["Arabic Presentation Forms-B"](xc))));if(la.imageName){var oh=Ki[la.imageName];if(!oh)continue;Ju=la.imageName,An.iconsInText=An.iconsInText||!0,Hl=oh.paddedRect;var _c=oh.displaySize;la.scale=24*la.scale/Bo,Gl=Vs+(24-_c[1]*la.scale),es=(_o={width:_c[0],height:_c[1],left:1,top:-3,advance:Tf?_c[1]:_c[0]}).advance;var sh=Tf?_c[0]*la.scale-24*$i:_c[1]*la.scale-24*$i;sh>0&&sh>Io&&(Io=sh)}else{var op=bi[la.fontStack],uh=op&&op[bu];if(uh&&uh.rect)Hl=uh.rect,_o=uh.metrics;else{var Fh=Si[la.fontStack],sp=Fh&&Fh[bu];if(!sp)continue;_o=sp.metrics}Gl=24*($i-la.scale)}Tf?(An.verticalizable=!0,Va.push({glyph:bu,imageName:Ju,x:ls,y:Zs+Gl,vertical:Tf,scale:la.scale,fontStack:la.fontStack,sectionIndex:jl,metrics:_o,rect:Hl}),ls+=es*la.scale+Ka):(Va.push({glyph:bu,imageName:Ju,x:ls,y:Zs+Gl,vertical:Tf,scale:la.scale,fontStack:la.fontStack,sectionIndex:jl,metrics:_o,rect:Hl}),ls+=_o.advance*la.scale+Ka)}Va.length!==0&&(cs=Math.max(ls-Ka,cs),hi(Va,0,Va.length-1,Po,Io)),ls=0;var up=ua*$i+Io;Es.lineOffset=Math.max(Io,Vs),Zs+=up,ks=Math.max(up,ks),++Jo}else Zs+=ua,++Jo}var xc,Nh=Zs- -17,lh=Yr(qa),Xc=lh.horizontalAlign,ch=lh.verticalAlign;(function(lp,Qp,cp,fp,Jp,Bh,hp,pp,dp){var fh,vp=(Qp-cp)*Jp;fh=Bh!==hp?-pp*fp- -17:(-fp*dp+.5)*hp;for(var hh=0,Yc=lp;hh<Yc.length;hh+=1)for(var Mf=0,mp=Yc[hh].positionedGlyphs;Mf<mp.length;Mf+=1){var zh=mp[Mf];zh.x+=vp,zh.y+=fh}})(An.positionedLines,Po,Xc,ch,cs,ks,ua,Nh,Dn.length),An.top+=-ch*Nh,An.bottom=An.top+Nh,An.left+=-Xc*cs,An.right=An.left+cs}(Wn,a,s,h,Ge,S,M,L,V,N,Y,Te),!function(An){for(var Si=0,bi=An;Si<bi.length;Si+=1)if(bi[Si].positionedGlyphs.length!==0)return!1;return!0}(Ii)&&Wn}Tr.fromFeature=function(t,a){for(var s=new Tr,h=0;h<t.sections.length;h++){var p=t.sections[h];p.image?s.addImageSection(p):s.addTextSection(p,a)}return s},Tr.prototype.length=function(){return this.text.length},Tr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Tr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Tr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Tr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var h=t.charCodeAt(s+1)||null,p=t.charCodeAt(s-1)||null;a+=h&&ul(h)&&!nh[t[s+1]]||p&&ul(p)&&!nh[t[s-1]]||!nh[t[s]]?t[s]:nh[t[s]]}return a}(this.text)},Tr.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&Nn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Nn[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Tr.prototype.substring=function(t,a){var s=new Tr;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Tr.prototype.toString=function(){return this.text},Tr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Tr.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(or.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(s)},Tr.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(or.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}else Ke("Can't add FormattedSection with an empty image.")},Tr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Nn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qt={};function $t(t,a,s,h,p,x){if(a.imageName){var S=h[a.imageName];return S?S.displaySize[0]*a.scale*24/x+p:0}var M=s[a.fontStack],L=M&&M[t];return L?L.metrics.advance*a.scale+p:0}function mn(t,a,s,h){var p=Math.pow(t-a,2);return h?t<a?p/2:2*p:p+Math.abs(s)*s}function Ur(t,a,s){var h=0;return t===10&&(h-=1e4),s&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function yr(t,a,s,h,p,x){for(var S=null,M=mn(a,s,p,x),L=0,N=h;L<N.length;L+=1){var U=N[L],V=mn(a-U.x,s,p,x)+U.badness;V<=M&&(S=U,M=V)}return{index:t,x:a,priorBreak:S,badness:M}}function Xr(t,a,s,h,p,x,S){if(x!=="point")return[];if(!t)return[];for(var M,L=[],N=function(Ge,Ne,et,vt,Lt,Bt){for(var rr=0,wr=0;wr<Ge.length();wr++){var Zr=Ge.getSection(wr);rr+=$t(Ge.getCharCode(wr),Zr,vt,Lt,Ne,Bt)}return rr/Math.max(1,Math.ceil(rr/et))}(t,a,s,h,p,S),U=t.text.indexOf("\u200B")>=0,V=0,Y=0;Y<t.length();Y++){var J=t.getSection(Y),Ce=t.getCharCode(Y);if(Nn[Ce]||(V+=$t(Ce,J,h,p,a,S)),Y<t.length()-1){var Te=!((M=Ce)<11904||!(Br["Bopomofo Extended"](M)||Br.Bopomofo(M)||Br["CJK Compatibility Forms"](M)||Br["CJK Compatibility Ideographs"](M)||Br["CJK Compatibility"](M)||Br["CJK Radicals Supplement"](M)||Br["CJK Strokes"](M)||Br["CJK Symbols and Punctuation"](M)||Br["CJK Unified Ideographs Extension A"](M)||Br["CJK Unified Ideographs"](M)||Br["Enclosed CJK Letters and Months"](M)||Br["Halfwidth and Fullwidth Forms"](M)||Br.Hiragana(M)||Br["Ideographic Description Characters"](M)||Br["Kangxi Radicals"](M)||Br["Katakana Phonetic Extensions"](M)||Br.Katakana(M)||Br["Vertical Forms"](M)||Br["Yi Radicals"](M)||Br["Yi Syllables"](M)));(qt[Ce]||Te||J.imageName)&&L.push(yr(Y+1,V,N,L,Ur(Ce,t.getCharCode(Y+1),Te&&U),!1))}}return function Ge(Ne){return Ne?Ge(Ne.priorBreak).concat(Ne.index):[]}(yr(t.length(),V,N,L,0,!0))}function Yr(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function hi(t,a,s,h,p){if(h||p)for(var x=t[s],S=(t[s].x+x.metrics.advance*x.scale)*h,M=a;M<=s;M++)t[M].x-=S,t[M].y+=p}function Jn(t,a,s,h,p,x){var S,M=t.image;if(M.content){var L=M.content,N=M.pixelRatio||1;S=[L[0]/N,L[1]/N,M.displaySize[0]-L[2]/N,M.displaySize[1]-L[3]/N]}var U,V,Y,J,Ce=a.left*x,Te=a.right*x;s==="width"||s==="both"?(J=p[0]+Ce-h[3],V=p[0]+Te+h[1]):V=(J=p[0]+(Ce+Te-M.displaySize[0])/2)+M.displaySize[0];var Ge=a.top*x,Ne=a.bottom*x;return s==="height"||s==="both"?(U=p[1]+Ge-h[0],Y=p[1]+Ne+h[2]):Y=(U=p[1]+(Ge+Ne-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:U,right:V,bottom:Y,left:J,collisionPadding:S}}qt[10]=!0,qt[32]=!0,qt[38]=!0,qt[40]=!0,qt[41]=!0,qt[43]=!0,qt[45]=!0,qt[47]=!0,qt[173]=!0,qt[183]=!0,qt[8203]=!0,qt[8208]=!0,qt[8211]=!0,qt[8231]=!0;var Gr=function(t){function a(s,h,p,x){t.call(this,s,h),this.angle=p,x!==void 0&&(this.segment=x)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(he);function Qr(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ei(t+1))};if(s.kind==="source")return{kind:"source"};for(var h=s.zoomStops,p=s.interpolationType,x=0;x<h.length&&h[x]<=t;)x++;for(var S=x=Math.max(0,x-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var M=h[x],L=h[S];return s.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:L,interpolationType:p}:{kind:"camera",minZoom:M,maxZoom:L,minSize:s.evaluate(new Ei(M)),maxSize:s.evaluate(new Ei(L)),interpolationType:p}}function Yn(t,a,s){var h=a.uSize,p=s.lowerSize;return t.kind==="source"?p/128:t.kind==="composite"?da(p/128,s.upperSize/128,a.uSizeT):h}function oi(t,a){var s=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var p=t.interpolationType,x=p?Qt(de.interpolationFactor(p,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=da(t.minSize,t.maxSize,x):s=x}return{uSizeT:s,uSize:h}}cn("Anchor",Gr);var Li=Object.freeze({__proto__:null,getSizeData:Qr,evaluateSizeForFeature:Yn,evaluateSizeForZoom:oi,SIZE_PACK_FACTOR:128});function Ya(t,a,s,h,p){if(a.segment===void 0)return!0;for(var x=a,S=a.segment+1,M=0;M>-s/2;){if(--S<0)return!1;M-=t[S].dist(x),x=t[S]}M+=t[S].dist(t[S+1]),S++;for(var L=[],N=0;M<s/2;){var U=t[S],V=t[S+1];if(!V)return!1;var Y=t[S-1].angleTo(U)-U.angleTo(V);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:M,angleDelta:Y}),N+=Y;M-L[0].distance>h;)N-=L.shift().angleDelta;if(N>p)return!1;S++,M+=U.dist(V)}return!0}function ro(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Pi(t,a,s){return t?.6*a*s:0}function $o(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Za(t,a,s,h,p,x){for(var S=Pi(s,p,x),M=$o(s,h)*x,L=0,N=ro(t)/2,U=0;U<t.length-1;U++){var V=t[U],Y=t[U+1],J=V.dist(Y);if(L+J>N){var Ce=(N-L)/J,Te=da(V.x,Y.x,Ce),Ge=da(V.y,Y.y,Ce),Ne=new Gr(Te,Ge,Y.angleTo(V),U);return Ne._round(),!S||Ya(t,Ne,M,S,a)?Ne:void 0}L+=J}}function Ho(t,a,s,h,p,x,S,M,L){var N=Pi(h,x,S),U=$o(h,p),V=U*S,Y=t[0].x===0||t[0].x===L||t[0].y===0||t[0].y===L;return a-V<a/4&&(a=V+a/4),function J(Ce,Te,Ge,Ne,et,vt,Lt,Bt,rr){for(var wr=vt/2,Zr=ro(Ce),Mn=0,on=Te-Ge,Un=[],un=0;un<Ce.length-1;un++){for(var Ii=Ce[un],Wn=Ce[un+1],An=Ii.dist(Wn),Si=Wn.angleTo(Ii);on+Ge<Mn+An;){var bi=((on+=Ge)-Mn)/An,Ki=da(Ii.x,Wn.x,bi),Dn=da(Ii.y,Wn.y,bi);if(Ki>=0&&Ki<rr&&Dn>=0&&Dn<rr&&on-wr>=0&&on+wr<=Zr){var ua=new Gr(Ki,Dn,Si,un);ua._round(),Ne&&!Ya(Ce,ua,vt,Ne,et)||Un.push(ua)}}Mn+=An}return Bt||Un.length||Lt||(Un=J(Ce,Mn/2,Ge,Ne,et,vt,Lt,!0,rr)),Un}(t,Y?a/2*M%a:(U/2+2*x)*S*M%a,a,N,s,V,Y,!1,L)}function Rn(t,a,s,h,p){for(var x=[],S=0;S<t.length;S++)for(var M=t[S],L=void 0,N=0;N<M.length-1;N++){var U=M[N],V=M[N+1];U.x<a&&V.x<a||(U.x<a?U=new he(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x<a&&(V=new he(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y<s&&V.y<s||(U.y<s?U=new he(U.x+(s-U.y)/(V.y-U.y)*(V.x-U.x),s)._round():V.y<s&&(V=new he(U.x+(s-U.y)/(V.y-U.y)*(V.x-U.x),s)._round()),U.x>=h&&V.x>=h||(U.x>=h?U=new he(h,U.y+(h-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x>=h&&(V=new he(h,U.y+(h-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y>=p&&V.y>=p||(U.y>=p?U=new he(U.x+(p-U.y)/(V.y-U.y)*(V.x-U.x),p)._round():V.y>=p&&(V=new he(U.x+(p-U.y)/(V.y-U.y)*(V.x-U.x),p)._round()),L&&U.equals(L[L.length-1])||x.push(L=[U]),L.push(V)))))}return x}function kn(t,a,s,h){var p=[],x=t.image,S=x.pixelRatio,M=x.paddedRect.w-2,L=x.paddedRect.h-2,N=t.right-t.left,U=t.bottom-t.top,V=x.stretchX||[[0,M]],Y=x.stretchY||[[0,L]],J=function(Ki,Dn){return Ki+Dn[1]-Dn[0]},Ce=V.reduce(J,0),Te=Y.reduce(J,0),Ge=M-Ce,Ne=L-Te,et=0,vt=Ce,Lt=0,Bt=Te,rr=0,wr=Ge,Zr=0,Mn=Ne;if(x.content&&h){var on=x.content;et=Co(V,0,on[0]),Lt=Co(Y,0,on[1]),vt=Co(V,on[0],on[2]),Bt=Co(Y,on[1],on[3]),rr=on[0]-et,Zr=on[1]-Lt,wr=on[2]-on[0]-vt,Mn=on[3]-on[1]-Bt}var Un=function(Ki,Dn,ua,qa){var ho=uo(Ki.stretch-et,vt,N,t.left),no=_i(Ki.fixed-rr,wr,Ki.stretch,Ce),Ka=uo(Dn.stretch-Lt,Bt,U,t.top),po=_i(Dn.fixed-Zr,Mn,Dn.stretch,Te),Bo=uo(ua.stretch-et,vt,N,t.left),ls=_i(ua.fixed-rr,wr,ua.stretch,Ce),Zs=uo(qa.stretch-Lt,Bt,U,t.top),cs=_i(qa.fixed-Zr,Mn,qa.stretch,Te),ks=new he(ho,Ka),Po=new he(Bo,Ka),Jo=new he(Bo,Zs),Zi=new he(ho,Zs),Oa=new he(no/S,po/S),ba=new he(ls/S,cs/S),$i=a*Math.PI/180;if($i){var Vs=Math.sin($i),Es=Math.cos($i),Va=[Es,-Vs,Vs,Es];ks._matMult(Va),Po._matMult(Va),Zi._matMult(Va),Jo._matMult(Va)}var Io=Ki.stretch+Ki.fixed,Ss=Dn.stretch+Dn.fixed;return{tl:ks,tr:Po,bl:Zi,br:Jo,tex:{x:x.paddedRect.x+1+Io,y:x.paddedRect.y+1+Ss,w:ua.stretch+ua.fixed-Io,h:qa.stretch+qa.fixed-Ss},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oa,pixelOffsetBR:ba,minFontScaleX:wr/S/N,minFontScaleY:Mn/S/U,isSDF:s}};if(h&&(x.stretchX||x.stretchY))for(var un=bs(V,Ge,Ce),Ii=bs(Y,Ne,Te),Wn=0;Wn<un.length-1;Wn++)for(var An=un[Wn],Si=un[Wn+1],bi=0;bi<Ii.length-1;bi++)p.push(Un(An,Ii[bi],Si,Ii[bi+1]));else p.push(Un({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:L+1}));return p}function Co(t,a,s){for(var h=0,p=0,x=t;p<x.length;p+=1){var S=x[p];h+=Math.max(a,Math.min(s,S[1]))-Math.max(a,Math.min(s,S[0]))}return h}function bs(t,a,s){for(var h=[{fixed:-1,stretch:0}],p=0,x=t;p<x.length;p+=1){var S=x[p],M=S[0],L=S[1],N=h[h.length-1];h.push({fixed:M-N.stretch,stretch:N.stretch}),h.push({fixed:M-N.stretch,stretch:N.stretch+(L-M)})}return h.push({fixed:a+1,stretch:s}),h}function uo(t,a,s,h){return t/a*s+h}function _i(t,a,s,h){return t-a*s/h}var Wo=function(t,a,s,h,p,x,S,M,L,N){if(this.boxStartIndex=t.length,L){var U=x.top,V=x.bottom,Y=x.collisionPadding;Y&&(U-=Y[1],V+=Y[3]);var J=V-U;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{var Ce=x.top*S-M,Te=x.bottom*S+M,Ge=x.left*S-M,Ne=x.right*S+M,et=x.collisionPadding;if(et&&(Ge-=et[0]*S,Ce-=et[1]*S,Ne+=et[2]*S,Te+=et[3]*S),N){var vt=new he(Ge,Ce),Lt=new he(Ne,Ce),Bt=new he(Ge,Te),rr=new he(Ne,Te),wr=N*Math.PI/180;vt._rotate(wr),Lt._rotate(wr),Bt._rotate(wr),rr._rotate(wr),Ge=Math.min(vt.x,Lt.x,Bt.x,rr.x),Ne=Math.max(vt.x,Lt.x,Bt.x,rr.x),Ce=Math.min(vt.y,Lt.y,Bt.y,rr.y),Te=Math.max(vt.y,Lt.y,Bt.y,rr.y)}t.emplaceBack(a.x,a.y,Ge,Ce,Ne,Te,s,h,p)}this.boxEndIndex=t.length},ia=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=ss),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function ss(t,a){return t<a?-1:t>a?1:0}function ei(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var h=1/0,p=1/0,x=-1/0,S=-1/0,M=t[0],L=0;L<M.length;L++){var N=M[L];(!L||N.x<h)&&(h=N.x),(!L||N.y<p)&&(p=N.y),(!L||N.x>x)&&(x=N.x),(!L||N.y>S)&&(S=N.y)}var U=Math.min(x-h,S-p),V=U/2,Y=new ia([],Ni);if(U===0)return new he(h,p);for(var J=h;J<x;J+=U)for(var Ce=p;Ce<S;Ce+=U)Y.push(new va(J+V,Ce+V,V,t));for(var Te=function(et){for(var vt=0,Lt=0,Bt=0,rr=et[0],wr=0,Zr=rr.length,Mn=Zr-1;wr<Zr;Mn=wr++){var on=rr[wr],Un=rr[Mn],un=on.x*Un.y-Un.x*on.y;Lt+=(on.x+Un.x)*un,Bt+=(on.y+Un.y)*un,vt+=3*un}return new va(Lt/vt,Bt/vt,0,et)}(t),Ge=Y.length;Y.length;){var Ne=Y.pop();(Ne.d>Te.d||!Te.d)&&(Te=Ne,s&&console.log("found best %d after %d probes",Math.round(1e4*Ne.d)/1e4,Ge)),Ne.max-Te.d<=a||(Y.push(new va(Ne.p.x-(V=Ne.h/2),Ne.p.y-V,V,t)),Y.push(new va(Ne.p.x+V,Ne.p.y-V,V,t)),Y.push(new va(Ne.p.x-V,Ne.p.y+V,V,t)),Y.push(new va(Ne.p.x+V,Ne.p.y+V,V,t)),Ge+=4)}return s&&(console.log("num probes: "+Ge),console.log("best distance: "+Te.d)),Te.p}function Ni(t,a){return a.max-t.max}function va(t,a,s,h){this.p=new he(t,a),this.h=s,this.d=function(p,x){for(var S=!1,M=1/0,L=0;L<x.length;L++)for(var N=x[L],U=0,V=N.length,Y=V-1;U<V;Y=U++){var J=N[U],Ce=N[Y];J.y>p.y!=Ce.y>p.y&&p.x<(Ce.x-J.x)*(p.y-J.y)/(Ce.y-J.y)+J.x&&(S=!S),M=Math.min(M,vl(p,J,Ce))}return(S?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ia.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ia.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},ia.prototype.peek=function(){return this.data[0]},ia.prototype._up=function(t){for(var a=this.data,s=this.compare,h=a[t];t>0;){var p=t-1>>1,x=a[p];if(s(h,x)>=0)break;a[t]=x,t=p}a[t]=h},ia.prototype._down=function(t){for(var a=this.data,s=this.compare,h=this.length>>1,p=a[t];t<h;){var x=1+(t<<1),S=a[x],M=x+1;if(M<this.length&&s(a[M],S)<0&&(x=M,S=a[M]),s(S,p)>=0)break;a[t]=S,t=x}a[t]=p};var Ao=Number.POSITIVE_INFINITY;function Zl(t,a){return a[1]!==Ao?function(s,h,p){var x=0,S=0;switch(h=Math.abs(h),p=Math.abs(p),s){case"top-right":case"top-left":case"top":S=p-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-p}switch(s){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,S]}(t,a[0],a[1]):function(s,h){var p=0,x=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-h;break;case"top":x=h-7}switch(s){case"top-right":case"bottom-right":p=-S;break;case"top-left":case"bottom-left":p=S;break;case"left":p=h;break;case"right":p=-h}return[p,x]}(t,a[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rt(t,a,s,h,p,x,S,M,L,N,U,V,Y,J,Ce){var Te=function(Lt,Bt,rr,wr,Zr,Mn,on,Un){for(var un=wr.layout.get("text-rotate").evaluate(Mn,{})*Math.PI/180,Ii=[],Wn=0,An=Bt.positionedLines;Wn<An.length;Wn+=1)for(var Si=An[Wn],bi=0,Ki=Si.positionedGlyphs;bi<Ki.length;bi+=1){var Dn=Ki[bi];if(Dn.rect){var ua=Dn.rect||{},qa=4,ho=!0,no=1,Ka=0,po=(Zr||Un)&&Dn.vertical,Bo=Dn.metrics.advance*Dn.scale/2;if(Un&&Bt.verticalizable&&(Ka=Si.lineOffset/2-(Dn.imageName?-(24-Dn.metrics.width*Dn.scale)/2:24*(Dn.scale-1))),Dn.imageName){var ls=on[Dn.imageName];ho=ls.sdf,qa=1/(no=ls.pixelRatio)}var Zs=Zr?[Dn.x+Bo,Dn.y]:[0,0],cs=Zr?[0,0]:[Dn.x+Bo+rr[0],Dn.y+rr[1]-Ka],ks=[0,0];po&&(ks=cs,cs=[0,0]);var Po=(Dn.metrics.left-qa)*Dn.scale-Bo+cs[0],Jo=(-Dn.metrics.top-qa)*Dn.scale+cs[1],Zi=Po+ua.w*Dn.scale/no,Oa=Jo+ua.h*Dn.scale/no,ba=new he(Po,Jo),$i=new he(Zi,Jo),Vs=new he(Po,Oa),Es=new he(Zi,Oa);if(po){var Va=new he(-Bo,Bo- -17),Io=-Math.PI/2,Ss=12-Bo,la=new he(22-Ss,-(Dn.imageName?Ss:0)),jl=new(Function.prototype.bind.apply(he,[null].concat(ks)));ba._rotateAround(Io,Va)._add(la)._add(jl),$i._rotateAround(Io,Va)._add(la)._add(jl),Vs._rotateAround(Io,Va)._add(la)._add(jl),Es._rotateAround(Io,Va)._add(la)._add(jl)}if(un){var bu=Math.sin(un),Gl=Math.cos(un),_o=[Gl,-bu,bu,Gl];ba._matMult(_o),$i._matMult(_o),Vs._matMult(_o),Es._matMult(_o)}var Hl=new he(0,0),Ju=new he(0,0);Ii.push({tl:ba,tr:$i,bl:Vs,br:Es,tex:ua,writingMode:Bt.writingMode,glyphOffset:Zs,sectionIndex:Dn.sectionIndex,isSDF:ho,pixelOffsetTL:Hl,pixelOffsetBR:Ju,minFontScaleX:0,minFontScaleY:0})}}return Ii}(0,s,M,p,x,S,h,t.allowVerticalPlacement),Ge=t.textSizeData,Ne=null;Ge.kind==="source"?(Ne=[128*p.layout.get("text-size").evaluate(S,{})])[0]>32640&&Ke(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ge.kind==="composite"&&((Ne=[128*J.compositeTextSizes[0].evaluate(S,{},Ce),128*J.compositeTextSizes[1].evaluate(S,{},Ce)])[0]>32640||Ne[1]>32640)&&Ke(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Te,Ne,M,x,S,N,a,L.lineStartIndex,L.lineLength,Y,Ce);for(var et=0,vt=U;et<vt.length;et+=1)V[vt[et]]=t.text.placedSymbolArray.length-1;return 4*Te.length}function dt(t){for(var a in t)return t[a];return null}function fn(t,a,s,h){var p=t.compareText;if(a in p){for(var x=p[a],S=x.length-1;S>=0;S--)if(h.dist(x[S])<s)return!0}else p[a]=[];return p[a].push(h),!1}var Ui=Is.VectorTileFeature.types,_e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function re(t,a,s,h,p,x,S,M,L,N,U,V,Y){var J=M?Math.min(32640,Math.round(M[0])):0,Ce=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(a,s,Math.round(32*h),Math.round(32*p),x,S,(J<<1)+(L?1:0),Ce,16*N,16*U,256*V,256*Y)}function Ue(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function rt(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(hf(s[a].text))return!0;return!1}var St=function(t){this.layoutVertexArray=new Dl,this.indexArray=new hl,this.programConfigurations=t,this.segments=new ae,this.dynamicLayoutVertexArray=new Yu,this.opacityVertexArray=new uc,this.placedSymbolArray=new d};St.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},St.prototype.upload=function(t,a,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,wd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_e,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))},St.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},cn("SymbolBuffers",St);var We=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new ae,this.collisionVertexArray=new jf};We.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Cd.members,!0)},We.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},cn("CollisionBuffers",We);var Le=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zs([]),this.placementViewportMatrix=zs([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qr(this.zoom,a["text-size"]),this.iconSizeData=Qr(this.zoom,a["icon-size"]);var s=this.layers[0].layout,h=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(x){return kr[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};Le.prototype.createArrays=function(){this.text=new St(new Zn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new St(new Zn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new w},Le.prototype.calculateGlyphDependencies=function(t,a,s,h,p){for(var x=0;x<t.length;x++)if(a[t.charCodeAt(x)]=!0,(s||h)&&p){var S=nh[t.charAt(x)];S&&(a[S.charCodeAt(0)]=!0)}},Le.prototype.populate=function(t,a,s){var h=this.layers[0],p=h.layout,x=p.get("text-font"),S=p.get("text-field"),M=p.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof Dt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),N=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,U=p.get("symbol-sort-key");if(this.features=[],L||N){for(var V=a.iconDependencies,Y=a.glyphDependencies,J=a.availableImages,Ce=new Ei(this.zoom),Te=0,Ge=t;Te<Ge.length;Te+=1){var Ne=Ge[Te],et=Ne.feature,vt=Ne.id,Lt=Ne.index,Bt=Ne.sourceLayerIndex,rr=h._featureFilter.needGeometry,wr=to(et,rr);if(h._featureFilter.filter(Ce,wr,s)){rr||(wr.geometry=Ua(et));var Zr=void 0;if(L){var Mn=h.getValueAndResolveTokens("text-field",wr,s,J),on=Dt.factory(Mn);rt(on)&&(this.hasRTLText=!0),(!this.hasRTLText||pf()==="unavailable"||this.hasRTLText&&Ps.isParsed())&&(Zr=Yp(on,h,wr))}var Un=void 0;if(N){var un=h.getValueAndResolveTokens("icon-image",wr,s,J);Un=un instanceof ea?un:ea.fromString(un)}if(Zr||Un){var Ii=this.sortFeaturesByKey?U.evaluate(wr,{},s):void 0;if(this.features.push({id:vt,text:Zr,icon:Un,index:Lt,sourceLayerIndex:Bt,geometry:wr.geometry,properties:et.properties,type:Ui[et.type],sortKey:Ii}),Un&&(V[Un.name]=!0),Zr){var Wn=x.evaluate(wr,{},s).join(","),An=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kr.vertical)>=0;for(var Si=0,bi=Zr.sections;Si<bi.length;Si+=1){var Ki=bi[Si];if(Ki.image)V[Ki.image.name]=!0;else{var Dn=oc(Zr.toString()),ua=Ki.fontStack||Wn,qa=Y[ua]=Y[ua]||{};this.calculateGlyphDependencies(Ki.text,qa,An,this.allowVerticalPlacement,Dn)}}}}}}p.get("symbol-placement")==="line"&&(this.features=function(ho){var no={},Ka={},po=[],Bo=0;function ls(Va){po.push(ho[Va]),Bo++}function Zs(Va,Io,Ss){var la=Ka[Va];return delete Ka[Va],Ka[Io]=la,po[la].geometry[0].pop(),po[la].geometry[0]=po[la].geometry[0].concat(Ss[0]),la}function cs(Va,Io,Ss){var la=no[Io];return delete no[Io],no[Va]=la,po[la].geometry[0].shift(),po[la].geometry[0]=Ss[0].concat(po[la].geometry[0]),la}function ks(Va,Io,Ss){var la=Ss?Io[0][Io[0].length-1]:Io[0][0];return Va+":"+la.x+":"+la.y}for(var Po=0;Po<ho.length;Po++){var Jo=ho[Po],Zi=Jo.geometry,Oa=Jo.text?Jo.text.toString():null;if(Oa){var ba=ks(Oa,Zi),$i=ks(Oa,Zi,!0);if(ba in Ka&&$i in no&&Ka[ba]!==no[$i]){var Vs=cs(ba,$i,Zi),Es=Zs(ba,$i,po[Vs].geometry);delete no[ba],delete Ka[$i],Ka[ks(Oa,po[Es].geometry,!0)]=Es,po[Vs].geometry=null}else ba in Ka?Zs(ba,$i,Zi):$i in no?cs(ba,$i,Zi):(ls(Po),no[ba]=Bo-1,Ka[$i]=Bo-1)}else ls(Po)}return po.filter(function(Va){return Va.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ho,no){return ho.sortKey-no.sortKey})}},Le.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},Le.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Le.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Le.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Le.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Le.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Le.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),p=t.dist(a[t.segment]),x={},S=t.segment+1;S<a.length;S++)x[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:h},S<a.length-1&&(h+=a[S+1].dist(a[S]));for(var M=t.segment||0;M>=0;M--)x[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:p},M>0&&(p+=a[M-1].dist(a[M]));for(var L=0;L<a.length;L++){var N=x[L];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Le.prototype.addSymbols=function(t,a,s,h,p,x,S,M,L,N,U,V){for(var Y=t.indexArray,J=t.layoutVertexArray,Ce=t.segments.prepareSegment(4*a.length,J,Y,this.canOverlap?x.sortKey:void 0),Te=this.glyphOffsetArray.length,Ge=Ce.vertexLength,Ne=this.allowVerticalPlacement&&S===kr.vertical?Math.PI/2:0,et=x.text&&x.text.sections,vt=0;vt<a.length;vt++){var Lt=a[vt],Bt=Lt.tl,rr=Lt.tr,wr=Lt.bl,Zr=Lt.br,Mn=Lt.tex,on=Lt.pixelOffsetTL,Un=Lt.pixelOffsetBR,un=Lt.minFontScaleX,Ii=Lt.minFontScaleY,Wn=Lt.glyphOffset,An=Lt.isSDF,Si=Lt.sectionIndex,bi=Ce.vertexLength,Ki=Wn[1];re(J,M.x,M.y,Bt.x,Ki+Bt.y,Mn.x,Mn.y,s,An,on.x,on.y,un,Ii),re(J,M.x,M.y,rr.x,Ki+rr.y,Mn.x+Mn.w,Mn.y,s,An,Un.x,on.y,un,Ii),re(J,M.x,M.y,wr.x,Ki+wr.y,Mn.x,Mn.y+Mn.h,s,An,on.x,Un.y,un,Ii),re(J,M.x,M.y,Zr.x,Ki+Zr.y,Mn.x+Mn.w,Mn.y+Mn.h,s,An,Un.x,Un.y,un,Ii),Ue(t.dynamicLayoutVertexArray,M,Ne),Y.emplaceBack(bi,bi+1,bi+2),Y.emplaceBack(bi+1,bi+2,bi+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wn[0]),vt!==a.length-1&&Si===a[vt+1].sectionIndex||t.programConfigurations.populatePaintArrays(J.length,x,x.index,{},V,et&&et[Si])}t.placedSymbolArray.emplaceBack(M.x,M.y,Te,this.glyphOffsetArray.length-Te,Ge,L,N,M.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],S,0,!1,0,U)},Le.prototype._addCollisionDebugVertex=function(t,a,s,h,p,x){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,p,Math.round(x.x),Math.round(x.y))},Le.prototype.addCollisionDebugVertices=function(t,a,s,h,p,x,S){var M=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),L=M.vertexLength,N=p.layoutVertexArray,U=p.collisionVertexArray,V=S.anchorX,Y=S.anchorY;this._addCollisionDebugVertex(N,U,x,V,Y,new he(t,a)),this._addCollisionDebugVertex(N,U,x,V,Y,new he(s,a)),this._addCollisionDebugVertex(N,U,x,V,Y,new he(s,h)),this._addCollisionDebugVertex(N,U,x,V,Y,new he(t,h)),M.vertexLength+=4;var J=p.indexArray;J.emplaceBack(L,L+1),J.emplaceBack(L+1,L+2),J.emplaceBack(L+2,L+3),J.emplaceBack(L+3,L),M.primitiveLength+=4},Le.prototype.addDebugCollisionBoxes=function(t,a,s,h){for(var p=t;p<a;p++){var x=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,h?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,s)}},Le.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new We(lc,tp.members,Nl),this.iconCollisionBox=new We(lc,tp.members,Nl);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},Le.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,h,p,x,S,M,L){for(var N={},U=a;U<s;U++){var V=t.get(U);N.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.textFeatureIndex=V.featureIndex;break}for(var Y=h;Y<p;Y++){var J=t.get(Y);N.verticalTextBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},N.verticalTextFeatureIndex=J.featureIndex;break}for(var Ce=x;Ce<S;Ce++){var Te=t.get(Ce);N.iconBox={x1:Te.x1,y1:Te.y1,x2:Te.x2,y2:Te.y2,anchorPointX:Te.anchorPointX,anchorPointY:Te.anchorPointY},N.iconFeatureIndex=Te.featureIndex;break}for(var Ge=M;Ge<L;Ge++){var Ne=t.get(Ge);N.verticalIconBox={x1:Ne.x1,y1:Ne.y1,x2:Ne.x2,y2:Ne.y2,anchorPointX:Ne.anchorPointX,anchorPointY:Ne.anchorPointY},N.verticalIconFeatureIndex=Ne.featureIndex;break}return N},Le.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Le.prototype.hasTextData=function(){return this.text.segments.get().length>0},Le.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Le.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Le.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Le.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Le.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),h=s.vertexStartIndex+4*s.numGlyphs,p=s.vertexStartIndex;p<h;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)},Le.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),h=[],p=[],x=[],S=0;S<this.symbolInstances.length;++S){x.push(S);var M=this.symbolInstances.get(S);h.push(0|Math.round(a*M.anchorX+s*M.anchorY)),p.push(M.featureIndex)}return x.sort(function(L,N){return h[L]-h[N]||p[N]-p[L]}),x},Le.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Le.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,h=this.symbolInstanceIndexes;s<h.length;s+=1){var p=this.symbolInstances.get(h[s]);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(function(x,S,M){x>=0&&M.indexOf(x)===S&&a.addIndicesForPlacedSymbol(a.text,x)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},cn("SymbolBucket",Le,{omit:["layers","collisionBoxArray","features","compareText"]}),Le.MAX_GLYPHS=65535,Le.addDynamicAttributes=Ue;var $e=new Fo({"symbol-placement":new Tn(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new Tn(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tn(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xn(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tn(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tn(ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tn(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tn(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tn(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new xn(ie.layout_symbol["icon-size"]),"icon-text-fit":new Tn(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tn(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new xn(ie.layout_symbol["icon-image"]),"icon-rotate":new xn(ie.layout_symbol["icon-rotate"]),"icon-padding":new Tn(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new Tn(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new xn(ie.layout_symbol["icon-offset"]),"icon-anchor":new xn(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tn(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tn(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tn(ie.layout_symbol["text-rotation-alignment"]),"text-field":new xn(ie.layout_symbol["text-field"]),"text-font":new xn(ie.layout_symbol["text-font"]),"text-size":new xn(ie.layout_symbol["text-size"]),"text-max-width":new xn(ie.layout_symbol["text-max-width"]),"text-line-height":new Tn(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new xn(ie.layout_symbol["text-letter-spacing"]),"text-justify":new xn(ie.layout_symbol["text-justify"]),"text-radial-offset":new xn(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tn(ie.layout_symbol["text-variable-anchor"]),"text-anchor":new xn(ie.layout_symbol["text-anchor"]),"text-max-angle":new Tn(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new Tn(ie.layout_symbol["text-writing-mode"]),"text-rotate":new xn(ie.layout_symbol["text-rotate"]),"text-padding":new Tn(ie.layout_symbol["text-padding"]),"text-keep-upright":new Tn(ie.layout_symbol["text-keep-upright"]),"text-transform":new xn(ie.layout_symbol["text-transform"]),"text-offset":new xn(ie.layout_symbol["text-offset"]),"text-allow-overlap":new Tn(ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tn(ie.layout_symbol["text-ignore-placement"]),"text-optional":new Tn(ie.layout_symbol["text-optional"])}),pe={paint:new Fo({"icon-opacity":new xn(ie.paint_symbol["icon-opacity"]),"icon-color":new xn(ie.paint_symbol["icon-color"]),"icon-halo-color":new xn(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new xn(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xn(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new Tn(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tn(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new xn(ie.paint_symbol["text-opacity"]),"text-color":new xn(ie.paint_symbol["text-color"],{runtimeType:jr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new xn(ie.paint_symbol["text-halo-color"]),"text-halo-width":new xn(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new xn(ie.paint_symbol["text-halo-blur"]),"text-translate":new Tn(ie.paint_symbol["text-translate"]),"text-translate-anchor":new Tn(ie.paint_symbol["text-translate-anchor"])}),layout:$e},Be=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:sn,this.defaultValue=t};Be.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Be.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Be.prototype.outputDefined=function(){return!1},Be.prototype.serialize=function(){return null},cn("FormatSectionOverride",Be,{omit:["defaultValue"]});var xe=function(t){function a(s){t.call(this,s,pe)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){if(t.prototype.recalculate.call(this,s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var p=this.layout.get("text-writing-mode");if(p){for(var x=[],S=0,M=p;S<M.length;S+=1){var L=M[S];x.indexOf(L)<0&&x.push(L)}this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,h,p,x){var S=this.layout.get(s).evaluate(h,{},p,x),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||Jl(M.value)||!S?S:function(L,N){return N.replace(/{([^{}]+)}/g,function(U,V){return V in L?String(L[V]):""})}(h.properties,S)},a.prototype.createBucket=function(s){return new Le(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,h=pe.paint.overridableProperties;s<h.length;s+=1){var p=h[s];if(a.hasPaintOverride(this.layout,p)){var x,S=this.paint.get(p),M=new Be(S),L=new Ic(M,S.property.specification);x=S.value.kind==="constant"||S.value.kind==="source"?new Tl("source",L):new sl("composite",L,S.value.zoomStops,S.value._interpolationType),this.paint._values[p]=new _s(S.property,x,S.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,h){var p=s.get("text-field"),x=pe.paint.properties[h],S=!1,M=function(U){for(var V=0,Y=U;V<Y.length;V+=1)if(x.overrides&&x.overrides.hasOverride(Y[V]))return void(S=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Dt)M(p.value.value.sections);else if(p.value.kind==="source"){var L=function(U){S||(U instanceof Na&&Yi(U.value)===Vi?M(U.value.sections):U instanceof xo?M(U.sections):U.eachChild(L))},N=p.value;N._styleExpression&&L(N._styleExpression.expression)}return S},a}(wa),nt={paint:new Fo({"background-color":new Tn(ie.paint_background["background-color"]),"background-pattern":new rs(ie.paint_background["background-pattern"]),"background-opacity":new Tn(ie.paint_background["background-opacity"])})},mt=function(t){function a(s){t.call(this,s,nt)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(wa),cr={paint:new Fo({"raster-opacity":new Tn(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tn(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tn(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tn(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new Tn(ie.paint_raster["raster-saturation"]),"raster-contrast":new Tn(ie.paint_raster["raster-contrast"]),"raster-resampling":new Tn(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new Tn(ie.paint_raster["raster-fade-duration"])})},Fr=function(t){function a(s){t.call(this,s,cr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(wa),Nr=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(wa),tn={circle:vf,heatmap:Hf,hillshade:qh,fill:th,"fill-extrusion":_l,line:Lh,symbol:xe,background:mt,raster:Fr},Lr=ge.HTMLImageElement,bn=ge.HTMLCanvasElement,an=ge.HTMLVideoElement,yn=ge.ImageData,gn=ge.ImageBitmap,hn=function(t,a,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,h)};hn.prototype.update=function(t,a,s){var h=t.width,p=t.height,x=!(this.size&&this.size[0]===h&&this.size[1]===p||s),S=this.context,M=S.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),x)this.size=[h,p],t instanceof Lr||t instanceof bn||t instanceof an||t instanceof yn||gn&&t instanceof gn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,p,0,this.format,M.UNSIGNED_BYTE,t.data);else{var L=s||{x:0,y:0},N=L.x,U=L.y;t instanceof Lr||t instanceof bn||t instanceof an||t instanceof yn||gn&&t instanceof gn?M.texSubImage2D(M.TEXTURE_2D,0,N,U,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,N,U,h,p,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},hn.prototype.bind=function(t,a,s){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),s!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},hn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},hn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var qn=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};qn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},qn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var fa=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ir(["receive","process"],this),this.invoker=new qn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Vr()?t:ge};function Qo(t,a,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}fa.prototype.send=function(t,a,s,h,p){var x=this;p===void 0&&(p=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[S]=s);var M=Ee(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!s,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Xs(a,M)},M),{cancel:function(){s&&delete x.callbacks[S],x.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:x.mapId})}}},fa.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else Vr()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},fa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},fa.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(Ms(a.error)):h(null,Ms(a.data)))}else{var p=!1,x=Ee(this.globalScope)?void 0:[],S=a.hasCallback?function(U,V){p=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:U?Xs(U):null,data:Xs(V,x)},x)}:function(U){p=!0},M=null,L=Ms(a.data);if(this.parent[a.type])M=this.parent[a.type](a.sourceMapId,L,S);else if(this.parent.getWorkerSource){var N=a.type.split(".");M=this.parent.getWorkerSource(a.sourceMapId,N[0],L.source)[N[1]](L,S)}else S(new Error("Could not find function "+a.type));!p&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},fa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ia=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ia.prototype.setNorthEast=function(t){return this._ne=t instanceof sa?new sa(t.lng,t.lat):sa.convert(t),this},Ia.prototype.setSouthWest=function(t){return this._sw=t instanceof sa?new sa(t.lng,t.lat):sa.convert(t),this},Ia.prototype.extend=function(t){var a,s,h=this._sw,p=this._ne;if(t instanceof sa)a=t,s=t;else{if(!(t instanceof Ia))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ia.convert(t)):this.extend(sa.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return h||p?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),p.lng=Math.max(s.lng,p.lng),p.lat=Math.max(s.lat,p.lat)):(this._sw=new sa(a.lng,a.lat),this._ne=new sa(s.lng,s.lat)),this},Ia.prototype.getCenter=function(){return new sa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ia.prototype.getSouthWest=function(){return this._sw},Ia.prototype.getNorthEast=function(){return this._ne},Ia.prototype.getNorthWest=function(){return new sa(this.getWest(),this.getNorth())},Ia.prototype.getSouthEast=function(){return new sa(this.getEast(),this.getSouth())},Ia.prototype.getWest=function(){return this._sw.lng},Ia.prototype.getSouth=function(){return this._sw.lat},Ia.prototype.getEast=function(){return this._ne.lng},Ia.prototype.getNorth=function(){return this._ne.lat},Ia.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ia.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ia.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ia.prototype.contains=function(t){var a=sa.convert(t),s=a.lng,h=a.lat,p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p},Ia.convert=function(t){return!t||t instanceof Ia?t:new Ia(t)};var sa=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};sa.prototype.wrap=function(){return new sa(ur(this.lng,-180,180),this.lat)},sa.prototype.toArray=function(){return[this.lng,this.lat]},sa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},sa.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,h=t.lat*a,p=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(p,1))},sa.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new Ia(new sa(this.lng-s,this.lat-a),new sa(this.lng+s,this.lat+a))},sa.convert=function(t){if(t instanceof sa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new sa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new sa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Rs=2*Math.PI*63710088e-1;function To(t){return Rs*Math.cos(t*Math.PI/180)}function Fu(t){return(180+t)/360}function lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Dh(t,a){return t/To(a)}function $s(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Vl=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};Vl.fromLngLat=function(t,a){a===void 0&&(a=0);var s=sa.convert(t);return new Vl(Fu(s.lng),lu(s.lat),Dh(a,s.lat))},Vl.prototype.toLngLat=function(){return new sa(360*this.x-180,$s(this.y))},Vl.prototype.toAltitude=function(){return this.z*To($s(this.y))},Vl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Rs*(t=$s(this.y),1/Math.cos(t*Math.PI/180));var t};var ah=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=Wc(0,t,t,a,s)};ah.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},ah.prototype.url=function(t,a){var s,h,p,x,S,M=(h=this.y,p=this.z,x=Qo(256*(s=this.x),256*(h=Math.pow(2,p)-h-1),p),S=Qo(256*(s+1),256*(h+1),p),x[0]+","+x[1]+","+S[0]+","+S[1]),L=function(N,U,V){for(var Y,J="",Ce=N;Ce>0;Ce--)J+=(U&(Y=1<<Ce-1)?1:0)+(V&Y?2:0);return J}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",M)},ah.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new he(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},ah.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var uv=function(t,a){this.wrap=t,this.canonical=a,this.key=Wc(t,a.z,a.z,a.x,a.y)},Xo=function(t,a,s,h,p){this.overscaledZ=t,this.wrap=a,this.canonical=new ah(s,+h,+p),this.key=Wc(a,t,s,h,p)};function Wc(t,a,s,h,p){(t*=2)<0&&(t=-1*t-1);var x=1<<s;return(x*x*t+x*p+h).toString(36)+s.toString(36)+a.toString(36)}Xo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xo.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},Xo.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?Wc(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Wc(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},Xo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},Xo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Xo(a,this.wrap,a,s,h),new Xo(a,this.wrap,a,s+1,h),new Xo(a,this.wrap,a,s,h+1),new Xo(a,this.wrap,a,s+1,h+1)]},Xo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xo.prototype.wrapped=function(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.unwrapTo=function(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xo.prototype.toUnwrapped=function(){return new uv(this.wrap,this.canonical)},Xo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Vl(t.x-this.wrap,t.y))},cn("CanonicalTileID",ah),cn("OverscaledTileID",Xo,{omit:["posMatrix"]});var Mo=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Ke('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var p=0;p<h;p++)this.data[this._idx(-1,p)]=this.data[this._idx(0,p)],this.data[this._idx(h,p)]=this.data[this._idx(h-1,p)],this.data[this._idx(p,-1)]=this.data[this._idx(p,0)],this.data[this._idx(p,h)]=this.data[this._idx(p,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};Mo.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[h],s[h+1],s[h+2])},Mo.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Mo.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},Mo.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},Mo.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},Mo.prototype.getPixels=function(){return new wo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Mo.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,p=a*this.dim+this.dim,x=s*this.dim,S=s*this.dim+this.dim;switch(a){case-1:h=p-1;break;case 1:p=h+1}switch(s){case-1:x=S-1;break;case 1:S=x+1}for(var M=-a*this.dim,L=-s*this.dim,N=x;N<S;N++)for(var U=h;U<p;U++)this.data[this._idx(U,N)]=t.data[this._idx(U+M,N+L)]},cn("DEMData",Mo);var ip=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};ip.prototype.encode=function(t){return this._stringToNumber[t]},ip.prototype.decode=function(t){return this._numberToString[t]};var ap=function(t,a,s,h,p){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=h,this.properties=t.properties,this.id=p},$p={geometry:{configurable:!0}};$p.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$p.geometry.set=function(t){this._geometry=t},ap.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(ap.prototype,$p);var Af=function(){this.state={},this.stateChanges={},this.deletedStates={}};Af.prototype.updateState=function(t,a,s){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Mt(this.stateChanges[t][h],s),this.deletedStates[t]===null)for(var p in this.deletedStates[t]={},this.state[t])p!==h&&(this.deletedStates[t][p]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var x in this.deletedStates[t][h]={},this.state[t][h])s[x]||(this.deletedStates[t][h][x]=null);else for(var S in s)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},Af.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},Af.prototype.getState=function(t,a){var s=String(a),h=Mt({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var p=this.deletedStates[t][a];if(p===null)return{};for(var x in p)delete h[x]}return h},Af.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},Af.prototype.coalesceChanges=function(t,a){var s={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var p={};for(var x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),Mt(this.state[h][x],this.stateChanges[h][x]),p[x]=this.state[h][x];s[h]=p}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var L in this.state[S])M[L]={},this.state[S][L]={};else for(var N in this.deletedStates[S]){if(this.deletedStates[S][N]===null)this.state[S][N]={};else for(var U=0,V=Object.keys(this.deletedStates[S][N]);U<V.length;U+=1)delete this.state[S][N][V[U]];M[N]=this.state[S][N]}s[S]=s[S]||{},Mt(s[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var Y in t)t[Y].setFeatureState(s,a)};var yc=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Iu(8192,16,0),this.grid3D=new Iu(8192,16,0),this.featureIndexArray=new j,this.promoteId=a};function lv(t,a,s,h,p){return Wt(t,function(x,S){var M=a instanceof hu?a.get(S):null;return M&&M.evaluate?M.evaluate(s,h,p):M})}function cv(t){for(var a=1/0,s=1/0,h=-1/0,p=-1/0,x=0,S=t;x<S.length;x+=1){var M=S[x];a=Math.min(a,M.x),s=Math.min(s,M.y),h=Math.max(h,M.x),p=Math.max(p,M.y)}return{minX:a,minY:s,maxX:h,maxY:p}}function vm(t,a){return a-t}yc.prototype.insert=function(t,a,s,h,p,x){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,p);for(var M=x?this.grid3D:this.grid,L=0;L<a.length;L++){for(var N=a[L],U=[1/0,1/0,-1/0,-1/0],V=0;V<N.length;V++){var Y=N[V];U[0]=Math.min(U[0],Y.x),U[1]=Math.min(U[1],Y.y),U[2]=Math.max(U[2],Y.x),U[3]=Math.max(U[3],Y.y)}U[0]<8192&&U[1]<8192&&U[2]>=0&&U[3]>=0&&M.insert(S,U[0],U[1],U[2],U[3])}},yc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Is.VectorTile(new ih(this.rawTileData)).layers,this.sourceLayerCoder=new ip(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},yc.prototype.query=function(t,a,s,h){var p=this;this.loadVTLayers();for(var x=t.params||{},S=8192/t.tileSize/t.scale,M=Pl(x.filter),L=t.queryGeometry,N=t.queryPadding*S,U=cv(L),V=this.grid.query(U.minX-N,U.minY-N,U.maxX+N,U.maxY+N),Y=cv(t.cameraQueryGeometry),J=this.grid3D.query(Y.minX-N,Y.minY-N,Y.maxX+N,Y.maxY+N,function(Lt,Bt,rr,wr){return function(Zr,Mn,on,Un,un){for(var Ii=0,Wn=Zr;Ii<Wn.length;Ii+=1){var An=Wn[Ii];if(Mn<=An.x&&on<=An.y&&Un>=An.x&&un>=An.y)return!0}var Si=[new he(Mn,on),new he(Mn,un),new he(Un,un),new he(Un,on)];if(Zr.length>2){for(var bi=0,Ki=Si;bi<Ki.length;bi+=1)if(ou(Zr,Ki[bi]))return!0}for(var Dn=0;Dn<Zr.length-1;Dn++)if(zl(Zr[Dn],Zr[Dn+1],Si))return!0;return!1}(t.cameraQueryGeometry,Lt-N,Bt-N,rr+N,wr+N)}),Ce=0,Te=J;Ce<Te.length;Ce+=1)V.push(Te[Ce]);V.sort(vm);for(var Ge,Ne={},et=function(Lt){var Bt=V[Lt];if(Bt!==Ge){Ge=Bt;var rr=p.featureIndexArray.get(Bt),wr=null;p.loadMatchingFeature(Ne,rr.bucketIndex,rr.sourceLayerIndex,rr.featureIndex,M,x.layers,x.availableImages,a,s,h,function(Zr,Mn,on){return wr||(wr=Ua(Zr)),Mn.queryIntersectsFeature(L,Zr,on,wr,p.z,t.transform,S,t.pixelPosMatrix)})}},vt=0;vt<V.length;vt++)et(vt);return Ne},yc.prototype.loadMatchingFeature=function(t,a,s,h,p,x,S,M,L,N,U){var V=this.bucketLayerIDs[a];if(!x||function(Zr,Mn){for(var on=0;on<Zr.length;on++)if(Mn.indexOf(Zr[on])>=0)return!0;return!1}(x,V)){var Y=this.sourceLayerCoder.decode(s),J=this.vtLayers[Y].feature(h);if(p.needGeometry){var Ce=to(J,!0);if(!p.filter(new Ei(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!p.filter(new Ei(this.tileID.overscaledZ),J))return;for(var Te=this.getId(J,Y),Ge=0;Ge<V.length;Ge++){var Ne=V[Ge];if(!(x&&x.indexOf(Ne)<0)){var et=M[Ne];if(et){var vt={};Te!==void 0&&N&&(vt=N.getState(et.sourceLayer||"_geojsonTileLayer",Te));var Lt=Mt({},L[Ne]);Lt.paint=lv(Lt.paint,et.paint,J,vt,S),Lt.layout=lv(Lt.layout,et.layout,J,vt,S);var Bt=!U||U(J,et,vt);if(Bt){var rr=new ap(J,this.z,this.x,this.y,Te);rr.layer=Lt;var wr=t[Ne];wr===void 0&&(wr=t[Ne]=[]),wr.push({featureIndex:h,feature:rr,intersectionZ:Bt})}}}}}},yc.prototype.lookupSymbolFeatures=function(t,a,s,h,p,x,S,M){var L={};this.loadVTLayers();for(var N=Pl(p),U=0,V=t;U<V.length;U+=1)this.loadMatchingFeature(L,s,h,V[U],N,x,S,M,a);return L},yc.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var h=0,p=s[a];h<p.length;h+=1)if(t===p[h])return!0;return!1},yc.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},cn("FeatureIndex",yc,{omit:["rawTileData","sourceLayerCoder"]});var us=function(t,a){this.tileID=t,this.uid=zt(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};us.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<di.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},us.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},us.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(N,U){var V={};if(!U)return V;for(var Y=function(){var Te=Ce[J],Ge=Te.layerIds.map(function(vt){return U.getLayer(vt)}).filter(Boolean);if(Ge.length!==0){Te.layers=Ge,Te.stateDependentLayerIds&&(Te.stateDependentLayers=Te.stateDependentLayerIds.map(function(vt){return Ge.filter(function(Lt){return Lt.id===vt})[0]}));for(var Ne=0,et=Ge;Ne<et.length;Ne+=1)V[et[Ne].id]=Te}},J=0,Ce=N;J<Ce.length;J+=1)Y();return V}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var p=this.buckets[h];if(p instanceof Le){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var x in this.buckets){var S=this.buckets[x];if(S instanceof Le&&S.hasRTLText){this.hasRTLText=!0,Ps.isLoading()||Ps.isLoaded()||pf()!=="deferred"||iu();break}}for(var M in this.queryPadding=0,this.buckets){var L=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(M).queryRadius(L))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},us.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},us.prototype.getBucket=function(t){return this.buckets[t.id]},us.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},us.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},us.prototype.queryRenderedFeatures=function(t,a,s,h,p,x,S,M,L,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:p,scale:x,tileSize:this.tileSize,pixelPosMatrix:N,transform:M,params:S,queryPadding:this.queryPadding*L},t,a,s):{}},us.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var h=s.loadVTLayers(),p=a?a.sourceLayer:"",x=h._geojsonTileLayer||h[p];if(x)for(var S=Pl(a&&a.filter),M=this.tileID.canonical,L=M.z,N=M.x,U=M.y,V={z:L,x:N,y:U},Y=0;Y<x.length;Y++){var J=x.feature(Y);if(S.needGeometry){var Ce=to(J,!0);if(!S.filter(new Ei(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!S.filter(new Ei(this.tileID.overscaledZ),J))continue;var Te=s.getId(J,p),Ge=new ap(J,L,N,U,Te);Ge.tile=V,t.push(Ge)}}},us.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},us.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},us.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=en(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),p=!1;if(this.expirationTime>h)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{var x=this.expirationTime-a;x?this.expirationTime=h+Math.max(x,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},us.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},us.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var p=this.buckets[h],x=p.layers[0].sourceLayer||"_geojsonTileLayer",S=s[x],M=t[x];if(S&&M&&Object.keys(M).length!==0){p.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=a&&a.style&&a.style.getLayer(h);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(p)))}}}},us.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},us.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<di.now()},us.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},us.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=di.now()+t},us.prototype.setDependencies=function(t,a){for(var s={},h=0,p=a;h<p.length;h+=1)s[p[h]]=!0;this.dependencies[t]=s},us.prototype.hasDependency=function(t,a){for(var s=0,h=t;s<h.length;s+=1){var p=this.dependencies[h[s]];if(p){for(var x=0,S=a;x<S.length;x+=1)if(p[S[x]])return!0}}return!1};var Ls=ge.performance,fv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Ls.mark(this._marks.start)};fv.prototype.finish=function(){Ls.mark(this._marks.end);var t=Ls.getEntriesByName(this._marks.measure);return t.length===0&&(Ls.measure(this._marks.measure,this._marks.start,this._marks.end),t=Ls.getEntriesByName(this._marks.measure),Ls.clearMarks(this._marks.start),Ls.clearMarks(this._marks.end),Ls.clearMeasures(this._marks.measure)),t},m.Actor=fa,m.AlphaImage=uu,m.CanonicalTileID=ah,m.CollisionBoxArray=f,m.Color=Fi,m.DEMData=Mo,m.DataConstantProperty=Tn,m.DictionaryCoder=ip,m.EXTENT=8192,m.ErrorEvent=Ze,m.EvaluationParameters=Ei,m.Event=Ae,m.Evented=qe,m.FeatureIndex=yc,m.FillBucket=Us,m.FillExtrusionBucket=$u,m.ImageAtlas=mr,m.ImagePosition=tt,m.LineBucket=qi,m.LngLat=sa,m.LngLatBounds=Ia,m.MercatorCoordinate=Vl,m.ONE_EM=24,m.OverscaledTileID=Xo,m.Point=he,m.Point$1=he,m.Properties=Fo,m.Protobuf=ih,m.RGBAImage=wo,m.RequestManager=Hi,m.RequestPerformance=fv,m.ResourceType=_n,m.SegmentVector=ae,m.SourceFeatureState=Af,m.StructArrayLayout1ui2=Nc,m.StructArrayLayout2f1f2i16=Fl,m.StructArrayLayout2i4=fl,m.StructArrayLayout3ui6=hl,m.StructArrayLayout4i8=pu,m.SymbolBucket=Le,m.Texture=hn,m.Tile=us,m.Transitionable=jo,m.Uniform1f=Or,m.Uniform1i=lr,m.Uniform2f=Pr,m.Uniform3f=$r,m.Uniform4f=Ln,m.UniformColor=Fn,m.UniformMatrix4f=ui,m.UnwrappedTileID=uv,m.ValidationError=Oe,m.WritingMode=kr,m.ZoomHistory=cf,m.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},m.addDynamicAttributes=Ue,m.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var h=t.length,p=new Array(t.length),x=null;t.forEach(function(S,M){a(S,function(L,N){L&&(x=L),p[M]=N,--h==0&&s(x,p)})})},m.bezier=ct,m.bindAll=ir,m.browser=di,m.cacheEntryPossiblyAdded=function(t){++yi>Ir&&(t.getActor().send("enforceCacheSizeLimit",Kt),yi=0)},m.clamp=Qt,m.clearTileCache=function(t){var a=ge.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},m.clipLine=Rn,m.clone=function(t){var a=new Xi(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},m.clone$1=Ye,m.clone$2=function(t){var a=new Xi(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},m.collisionCircleLayout=Ad,m.config=jn,m.create=function(){var t=new Xi(16);return Xi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new Xi(9);return Xi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new Xi(4);return Xi!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=Ie,m.createExpression=ec,m.createLayout=_a,m.createStyleLayer=function(t){return t.type==="custom"?new Nr(t):new tn[t.type](t)},m.cross=function(t,a,s){var h=a[0],p=a[1],x=a[2],S=s[0],M=s[1],L=s[2];return t[0]=p*L-x*M,t[1]=x*S-h*L,t[2]=h*M-p*S,t},m.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],s[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var p in a)if(!t(a[p],s[p]))return!1;return!0}return a===s},m.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},m.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},m.ease=xt,m.emitValidationErrors=kc,m.endsWith=W,m.enforceCacheSizeLimit=function(t){nn(),Ji&&Ji.then(function(a){a.keys().then(function(s){for(var h=0;h<s.length-t;h++)a.delete(s[h])})})},m.evaluateSizeForFeature=Yn,m.evaluateSizeForZoom=oi,m.evaluateVariableOffset=Zl,m.evented=Vf,m.extend=Mt,m.featureFilter=Pl,m.filterObject=ot,m.fromRotation=function(t,a){var s=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=s,t[2]=0,t[3]=-s,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Yr,m.getAnchorJustification=we,m.getArrayBuffer=Fa,m.getImage=X,m.getJSON=function(t,a){return Uo(Mt(t,{type:"json"}),a)},m.getRTLTextPluginStatus=pf,m.getReferrer=Mi,m.getVideo=function(t,a){var s,h,p=ge.document.createElement("video");p.muted=!0,p.onloadstart=function(){a(null,p)};for(var x=0;x<t.length;x++){var S=ge.document.createElement("source");s=t[x],h=void 0,(h=ge.document.createElement("a")).href=s,(h.protocol!==ge.document.location.protocol||h.host!==ge.document.location.host)&&(p.crossOrigin="Anonymous"),S.src=t[x],p.appendChild(S)}return{cancel:function(){}}},m.identity=zs,m.invert=function(t,a){var s=a[0],h=a[1],p=a[2],x=a[3],S=a[4],M=a[5],L=a[6],N=a[7],U=a[8],V=a[9],Y=a[10],J=a[11],Ce=a[12],Te=a[13],Ge=a[14],Ne=a[15],et=s*M-h*S,vt=s*L-p*S,Lt=s*N-x*S,Bt=h*L-p*M,rr=h*N-x*M,wr=p*N-x*L,Zr=U*Te-V*Ce,Mn=U*Ge-Y*Ce,on=U*Ne-J*Ce,Un=V*Ge-Y*Te,un=V*Ne-J*Te,Ii=Y*Ne-J*Ge,Wn=et*Ii-vt*un+Lt*Un+Bt*on-rr*Mn+wr*Zr;return Wn?(t[0]=(M*Ii-L*un+N*Un)*(Wn=1/Wn),t[1]=(p*un-h*Ii-x*Un)*Wn,t[2]=(Te*wr-Ge*rr+Ne*Bt)*Wn,t[3]=(Y*rr-V*wr-J*Bt)*Wn,t[4]=(L*on-S*Ii-N*Mn)*Wn,t[5]=(s*Ii-p*on+x*Mn)*Wn,t[6]=(Ge*Lt-Ce*wr-Ne*vt)*Wn,t[7]=(U*wr-Y*Lt+J*vt)*Wn,t[8]=(S*un-M*on+N*Zr)*Wn,t[9]=(h*on-s*un-x*Zr)*Wn,t[10]=(Ce*rr-Te*Lt+Ne*et)*Wn,t[11]=(V*Lt-U*rr-J*et)*Wn,t[12]=(M*Mn-S*Un-L*Zr)*Wn,t[13]=(s*Un-h*Mn+p*Zr)*Wn,t[14]=(Te*vt-Ce*Bt-Ge*et)*Wn,t[15]=(U*Bt-V*vt+Y*et)*Wn,t):null},m.isChar=Br,m.isMapboxURL=Di,m.keysDifference=function(t,a){var s=[];for(var h in t)h in a||s.push(h);return s},m.makeRequest=Uo,m.mapObject=Wt,m.mercatorXfromLng=Fu,m.mercatorYfromLat=lu,m.mercatorZfromAltitude=Dh,m.mul=Bc,m.multiply=os,m.mvt=Is,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,a){var s=a[0],h=a[1],p=a[2],x=s*s+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),t[0]=a[0]*x,t[1]=a[1]*x,t[2]=a[2]*x,t},m.number=da,m.offscreenCanvasSupported=li,m.ortho=function(t,a,s,h,p,x,S){var M=1/(a-s),L=1/(h-p),N=1/(x-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*L,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*N,t[11]=0,t[12]=(a+s)*M,t[13]=(p+h)*L,t[14]=(S+x)*N,t[15]=1,t},m.parseGlyphPBF=function(t){return new ih(t).readFields(Ar,[])},m.pbf=ih,m.performSymbolLayout=function(t,a,s,h,p,x,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,L=t.layers[0]._unevaluatedLayout._values,N={};if(t.textSizeData.kind==="composite"){var U=t.textSizeData,V=U.maxZoom;N.compositeTextSizes=[L["text-size"].possiblyEvaluate(new Ei(U.minZoom),S),L["text-size"].possiblyEvaluate(new Ei(V),S)]}if(t.iconSizeData.kind==="composite"){var Y=t.iconSizeData,J=Y.maxZoom;N.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new Ei(Y.minZoom),S),L["icon-size"].possiblyEvaluate(new Ei(J),S)]}N.layoutTextSize=L["text-size"].possiblyEvaluate(new Ei(t.zoom+1),S),N.layoutIconSize=L["icon-size"].possiblyEvaluate(new Ei(t.zoom+1),S),N.textMaxSize=L["text-size"].possiblyEvaluate(new Ei(18));for(var Ce=24*M.get("text-line-height"),Te=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ge=M.get("text-keep-upright"),Ne=M.get("text-size"),et=function(){var Bt=Lt[vt],rr=M.get("text-font").evaluate(Bt,{},S).join(","),wr=Ne.evaluate(Bt,{},S),Zr=N.layoutTextSize.evaluate(Bt,{},S),Mn=N.layoutIconSize.evaluate(Bt,{},S),on={horizontal:{},vertical:void 0},Un=Bt.text,un=[0,0];if(Un){var Ii=Un.toString(),Wn=24*M.get("text-letter-spacing").evaluate(Bt,{},S),An=function(Zi){for(var Oa=0,ba=Zi;Oa<ba.length;Oa+=1)if($i=ba[Oa].charCodeAt(0),Br.Arabic($i)||Br["Arabic Supplement"]($i)||Br["Arabic Extended-A"]($i)||Br["Arabic Presentation Forms-A"]($i)||Br["Arabic Presentation Forms-B"]($i))return!1;var $i;return!0}(Ii)?Wn:0,Si=M.get("text-anchor").evaluate(Bt,{},S),bi=M.get("text-variable-anchor");if(!bi){var Ki=M.get("text-radial-offset").evaluate(Bt,{},S);un=Ki?Zl(Si,[24*Ki,Ao]):M.get("text-offset").evaluate(Bt,{},S).map(function(Zi){return 24*Zi})}var Dn=Te?"center":M.get("text-justify").evaluate(Bt,{},S),ua=M.get("symbol-placement"),qa=ua==="point"?24*M.get("text-max-width").evaluate(Bt,{},S):0,ho=function(){t.allowVerticalPlacement&&oc(Ii)&&(on.vertical=Wr(Un,a,s,p,rr,qa,Ce,Si,"left",An,un,kr.vertical,!0,ua,Zr,wr))};if(!Te&&bi){for(var no=Dn==="auto"?bi.map(function(Zi){return we(Zi)}):[Dn],Ka=!1,po=0;po<no.length;po++){var Bo=no[po];if(!on.horizontal[Bo])if(Ka)on.horizontal[Bo]=on.horizontal[0];else{var ls=Wr(Un,a,s,p,rr,qa,Ce,"center",Bo,An,un,kr.horizontal,!1,ua,Zr,wr);ls&&(on.horizontal[Bo]=ls,Ka=ls.positionedLines.length===1)}}ho()}else{Dn==="auto"&&(Dn=we(Si));var Zs=Wr(Un,a,s,p,rr,qa,Ce,Si,Dn,An,un,kr.horizontal,!1,ua,Zr,wr);Zs&&(on.horizontal[Dn]=Zs),ho(),oc(Ii)&&Te&&Ge&&(on.vertical=Wr(Un,a,s,p,rr,qa,Ce,Si,Dn,An,un,kr.vertical,!1,ua,Zr,wr))}}var cs=void 0,ks=!1;if(Bt.icon&&Bt.icon.name){var Po=h[Bt.icon.name];Po&&(cs=function(Zi,Oa,ba){var $i=Yr(ba),Vs=Oa[0]-Zi.displaySize[0]*$i.horizontalAlign,Es=Oa[1]-Zi.displaySize[1]*$i.verticalAlign;return{image:Zi,top:Es,bottom:Es+Zi.displaySize[1],left:Vs,right:Vs+Zi.displaySize[0]}}(p[Bt.icon.name],M.get("icon-offset").evaluate(Bt,{},S),M.get("icon-anchor").evaluate(Bt,{},S)),ks=Po.sdf,t.sdfIcons===void 0?t.sdfIcons=Po.sdf:t.sdfIcons!==Po.sdf&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Po.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Jo=dt(on.horizontal)||on.vertical;t.iconsInText=!!Jo&&Jo.iconsInText,(Jo||cs)&&function(Zi,Oa,ba,$i,Vs,Es,Va,Io,Ss,la,jl){var bu=Es.textMaxSize.evaluate(Oa,{});bu===void 0&&(bu=Va);var Gl,_o=Zi.layers[0].layout,Hl=_o.get("icon-offset").evaluate(Oa,{},jl),Ju=dt(ba.horizontal),es=Va/24,Tf=Zi.tilePixelRatio*es,oh=Zi.tilePixelRatio*bu/24,_c=Zi.tilePixelRatio*Io,sh=Zi.tilePixelRatio*_o.get("symbol-spacing"),op=_o.get("text-padding")*Zi.tilePixelRatio,uh=_o.get("icon-padding")*Zi.tilePixelRatio,Fh=_o.get("text-max-angle")/180*Math.PI,sp=_o.get("text-rotation-alignment")==="map"&&_o.get("symbol-placement")!=="point",up=_o.get("icon-rotation-alignment")==="map"&&_o.get("symbol-placement")!=="point",xc=_o.get("symbol-placement"),Nh=sh/2,lh=_o.get("icon-text-fit");$i&&lh!=="none"&&(Zi.allowVerticalPlacement&&ba.vertical&&(Gl=Jn($i,ba.vertical,lh,_o.get("icon-text-fit-padding"),Hl,es)),Ju&&($i=Jn($i,Ju,lh,_o.get("icon-text-fit-padding"),Hl,es)));var Xc=function(mm,gp){gp.x<0||gp.x>=8192||gp.y<0||gp.y>=8192||function(Oo,Wl,gm,Pf,Id,dv,ed,el,Xl,Uh,yp,_p,xp,Od,If,Rd,Ld,vv,mv,gv,Eu,bp,kd,xl,yv){var _v,ph,dh,Zh,vh,mh=Oo.addToLineVertexArray(Wl,gm),Dd=0,Fd=0,xv=0,bv=0,Nd=-1,Bd=-1,qc={},Ev=be(""),zd=0,td=0;if(el._unevaluatedLayout.getValue("text-radial-offset")===void 0?(zd=(_v=el.layout.get("text-offset").evaluate(Eu,{},xl).map(function(Cp){return 24*Cp}))[0],td=_v[1]):(zd=24*el.layout.get("text-radial-offset").evaluate(Eu,{},xl),td=Ao),Oo.allowVerticalPlacement&&Pf.vertical){var Ud=el.layout.get("text-rotate").evaluate(Eu,{},xl)+90;Zh=new Wo(Xl,Wl,Uh,yp,_p,Pf.vertical,xp,Od,If,Ud),ed&&(vh=new Wo(Xl,Wl,Uh,yp,_p,ed,Ld,vv,If,Ud))}if(Id){var rd=el.layout.get("icon-rotate").evaluate(Eu,{}),nd=el.layout.get("icon-text-fit")!=="none",Zd=kn(Id,rd,kd,nd),id=ed?kn(ed,rd,kd,nd):void 0;dh=new Wo(Xl,Wl,Uh,yp,_p,Id,Ld,vv,!1,rd),Dd=4*Zd.length;var Vh=Oo.iconSizeData,Ep=null;Vh.kind==="source"?(Ep=[128*el.layout.get("icon-size").evaluate(Eu,{})])[0]>32640&&Ke(Oo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Vh.kind==="composite"&&((Ep=[128*bp.compositeIconSizes[0].evaluate(Eu,{},xl),128*bp.compositeIconSizes[1].evaluate(Eu,{},xl)])[0]>32640||Ep[1]>32640)&&Ke(Oo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Oo.addSymbols(Oo.icon,Zd,Ep,gv,mv,Eu,!1,Wl,mh.lineStartIndex,mh.lineLength,-1,xl),Nd=Oo.icon.placedSymbolArray.length-1,id&&(Fd=4*id.length,Oo.addSymbols(Oo.icon,id,Ep,gv,mv,Eu,kr.vertical,Wl,mh.lineStartIndex,mh.lineLength,-1,xl),Bd=Oo.icon.placedSymbolArray.length-1)}for(var Kc in Pf.horizontal){var Sp=Pf.horizontal[Kc];if(!ph){Ev=be(Sp.text);var Sv=el.layout.get("text-rotate").evaluate(Eu,{},xl);ph=new Wo(Xl,Wl,Uh,yp,_p,Sp,xp,Od,If,Sv)}var Vd=Sp.positionedLines.length===1;if(xv+=Rt(Oo,Wl,Sp,dv,el,If,Eu,Rd,mh,Pf.vertical?kr.horizontal:kr.horizontalOnly,Vd?Object.keys(Pf.horizontal):[Kc],qc,Nd,bp,xl),Vd)break}Pf.vertical&&(bv+=Rt(Oo,Wl,Pf.vertical,dv,el,If,Eu,Rd,mh,kr.vertical,["vertical"],qc,Bd,bp,xl));var wv=ph?ph.boxStartIndex:Oo.collisionBoxArray.length,ym=ph?ph.boxEndIndex:Oo.collisionBoxArray.length,_m=Zh?Zh.boxStartIndex:Oo.collisionBoxArray.length,xm=Zh?Zh.boxEndIndex:Oo.collisionBoxArray.length,bm=dh?dh.boxStartIndex:Oo.collisionBoxArray.length,Em=dh?dh.boxEndIndex:Oo.collisionBoxArray.length,Cv=vh?vh.boxStartIndex:Oo.collisionBoxArray.length,Av=vh?vh.boxEndIndex:Oo.collisionBoxArray.length,Yl=-1,wp=function(Cp,Mv){return Cp&&Cp.circleDiameter?Math.max(Cp.circleDiameter,Mv):Mv};Yl=wp(ph,Yl),Yl=wp(Zh,Yl),Yl=wp(dh,Yl);var Tv=(Yl=wp(vh,Yl))>-1?1:0;Tv&&(Yl*=yv/24),Oo.glyphOffsetArray.length>=Le.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Eu.sortKey!==void 0&&Oo.addToSortKeyRanges(Oo.symbolInstances.length,Eu.sortKey),Oo.symbolInstances.emplaceBack(Wl.x,Wl.y,qc.right>=0?qc.right:-1,qc.center>=0?qc.center:-1,qc.left>=0?qc.left:-1,qc.vertical||-1,Nd,Bd,Ev,wv,ym,_m,xm,bm,Em,Cv,Av,Uh,xv,bv,Dd,Fd,Tv,0,xp,zd,td,Yl)}(Zi,gp,mm,ba,$i,Vs,Gl,Zi.layers[0],Zi.collisionBoxArray,Oa.index,Oa.sourceLayerIndex,Zi.index,Tf,op,sp,Ss,_c,uh,up,Hl,Oa,Es,la,jl,Va)};if(xc==="line")for(var ch=0,lp=Rn(Oa.geometry,0,0,8192,8192);ch<lp.length;ch+=1)for(var Qp=lp[ch],cp=0,fp=Ho(Qp,sh,Fh,ba.vertical||Ju,$i,24,oh,Zi.overscaling,8192);cp<fp.length;cp+=1){var Jp=fp[cp];Ju&&fn(Zi,Ju.text,Nh,Jp)||Xc(Qp,Jp)}else if(xc==="line-center")for(var Bh=0,hp=Oa.geometry;Bh<hp.length;Bh+=1){var pp=hp[Bh];if(pp.length>1){var dp=Za(pp,Fh,ba.vertical||Ju,$i,24,oh);dp&&Xc(pp,dp)}}else if(Oa.type==="Polygon")for(var fh=0,vp=Jf(Oa.geometry,0);fh<vp.length;fh+=1){var hh=vp[fh],Yc=ei(hh,16);Xc(hh[0],new Gr(Yc.x,Yc.y,0))}else if(Oa.type==="LineString")for(var Mf=0,mp=Oa.geometry;Mf<mp.length;Mf+=1){var zh=mp[Mf];Xc(zh,new Gr(zh[0].x,zh[0].y,0))}else if(Oa.type==="Point")for(var Td=0,hv=Oa.geometry;Td<hv.length;Td+=1)for(var Md=0,pv=hv[Td];Md<pv.length;Md+=1){var Pd=pv[Md];Xc([Pd],new Gr(Pd.x,Pd.y,0))}}(t,Bt,on,cs,h,N,Zr,Mn,un,ks,S)},vt=0,Lt=t.features;vt<Lt.length;vt+=1)et();x&&t.generateCollisionDebugBuffers()},m.perspective=function(t,a,s,h,p){var x,S=1/Math.tan(a/2);return t[0]=S/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,p!=null&&p!==1/0?(t[10]=(p+h)*(x=1/(h-p)),t[14]=2*p*h*x):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,a){for(var s={},h=0;h<a.length;h++){var p=a[h];p in t&&(s[p]=t[p])}return s},m.plugin=Ps,m.polygonIntersectsPolygon=ku,m.postMapLoadEvent=kt,m.postTurnstileEvent=mo,m.potpack=_r,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=cn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Fs,pluginURL:Ru}),Vf.on("pluginStateChange",t),t},m.renderColorRamp=Gf,m.rotate=function(t,a,s){var h=a[0],p=a[1],x=a[2],S=a[3],M=Math.sin(s),L=Math.cos(s);return t[0]=h*L+x*M,t[1]=p*L+S*M,t[2]=h*-M+x*L,t[3]=p*-M+S*L,t},m.rotateX=function(t,a,s){var h=Math.sin(s),p=Math.cos(s),x=a[4],S=a[5],M=a[6],L=a[7],N=a[8],U=a[9],V=a[10],Y=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=x*p+N*h,t[5]=S*p+U*h,t[6]=M*p+V*h,t[7]=L*p+Y*h,t[8]=N*p-x*h,t[9]=U*p-S*h,t[10]=V*p-M*h,t[11]=Y*p-L*h,t},m.rotateZ=function(t,a,s){var h=Math.sin(s),p=Math.cos(s),x=a[0],S=a[1],M=a[2],L=a[3],N=a[4],U=a[5],V=a[6],Y=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=x*p+N*h,t[1]=S*p+U*h,t[2]=M*p+V*h,t[3]=L*p+Y*h,t[4]=N*p-x*h,t[5]=U*p-S*h,t[6]=V*p-M*h,t[7]=Y*p-L*h,t},m.scale=function(t,a,s){var h=s[0],p=s[1],x=s[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*p,t[5]=a[5]*p,t[6]=a[6]*p,t[7]=a[7]*p,t[8]=a[8]*x,t[9]=a[9]*x,t[10]=a[10]*x,t[11]=a[11]*x,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},m.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},m.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},m.setCacheLimits=function(t,a){Kt=t,Ir=a},m.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),Fs==="deferred"||Fs==="loading"||Fs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ru=di.resolveURL(t),Fs="deferred",Ou=a,ll(),s||iu()},m.sphericalToCartesian=function(t){var a=t[0],s=t[1],h=t[2];return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h)}},m.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},m.styleSpec=ie,m.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},m.symbolSize=Li,m.transformMat3=function(t,a,s){var h=a[0],p=a[1],x=a[2];return t[0]=h*s[0]+p*s[3]+x*s[6],t[1]=h*s[1]+p*s[4]+x*s[7],t[2]=h*s[2]+p*s[5]+x*s[8],t},m.transformMat4=zc,m.translate=function(t,a,s){var h,p,x,S,M,L,N,U,V,Y,J,Ce,Te=s[0],Ge=s[1],Ne=s[2];return a===t?(t[12]=a[0]*Te+a[4]*Ge+a[8]*Ne+a[12],t[13]=a[1]*Te+a[5]*Ge+a[9]*Ne+a[13],t[14]=a[2]*Te+a[6]*Ge+a[10]*Ne+a[14],t[15]=a[3]*Te+a[7]*Ge+a[11]*Ne+a[15]):(p=a[1],x=a[2],S=a[3],M=a[4],L=a[5],N=a[6],U=a[7],V=a[8],Y=a[9],J=a[10],Ce=a[11],t[0]=h=a[0],t[1]=p,t[2]=x,t[3]=S,t[4]=M,t[5]=L,t[6]=N,t[7]=U,t[8]=V,t[9]=Y,t[10]=J,t[11]=Ce,t[12]=h*Te+M*Ge+V*Ne+a[12],t[13]=p*Te+L*Ge+Y*Ne+a[13],t[14]=x*Te+N*Ge+J*Ne+a[14],t[15]=S*Te+U*Ge+Ce*Ne+a[15]),t},m.triggerPluginCompletionEvent=Zf,m.uniqueId=zt,m.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},m.validateLight=ic,m.validateStyle=za,m.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},m.vectorTile=Is,m.version="1.13.2",m.warnOnce=Ke,m.webpSupported=ni,m.window=ge,m.wrap=ur}),me(["./shared"],function(m){"use strict";function Ie(Z){var X=typeof Z;if(X==="number"||X==="boolean"||X==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){for(var Q="[",fe=0,Ae=Z;fe<Ae.length;fe+=1)Q+=Ie(Ae[fe])+",";return Q+"]"}for(var Ze=Object.keys(Z).sort(),qe="{",ie=0;ie<Ze.length;ie++)qe+=JSON.stringify(Ze[ie])+":"+Ie(Z[Ze[ie]])+",";return qe+"}"}function G(Z){for(var X="",Q=0,fe=m.refProperties;Q<fe.length;Q+=1)X+="/"+Ie(Z[fe[Q]]);return X}var ce=function(Z){this.keyCache={},Z&&this.replace(Z)};ce.prototype.replace=function(Z){this._layerConfigs={},this._layers={},this.update(Z,[])},ce.prototype.update=function(Z,X){for(var Q=this,fe=0,Ae=Z;fe<Ae.length;fe+=1){var Ze=Ae[fe];this._layerConfigs[Ze.id]=Ze;var qe=this._layers[Ze.id]=m.createStyleLayer(Ze);qe._featureFilter=m.featureFilter(qe.filter),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id]}for(var ie=0,Oe=X;ie<Oe.length;ie+=1){var st=Oe[ie];delete this.keyCache[st],delete this._layerConfigs[st],delete this._layers[st]}this.familiesBySource={};for(var fr=0,At=function(Dr,jr){for(var ci={},Kr=0;Kr<Dr.length;Kr++){var Pn=jr&&jr[Dr[Kr].id]||G(Dr[Kr]);jr&&(jr[Dr[Kr].id]=Pn);var Vi=ci[Pn];Vi||(Vi=ci[Pn]=[]),Vi.push(Dr[Kr])}var si=[];for(var Ci in ci)si.push(ci[Ci]);return si}(m.values(this._layerConfigs),this.keyCache);fr<At.length;fr+=1){var Pt=At[fr].map(function(Dr){return Q._layers[Dr.id]}),hr=Pt[0];if(hr.visibility!=="none"){var vn=hr.source||"",sn=this.familiesBySource[vn];sn||(sn=this.familiesBySource[vn]={});var Et=hr.sourceLayer||"_geojsonTileLayer",qr=sn[Et];qr||(qr=sn[Et]=[]),qr.push(Pt)}}};var he=function(Z){var X={},Q=[];for(var fe in Z){var Ae=Z[fe],Ze=X[fe]={};for(var qe in Ae){var ie=Ae[+qe];if(ie&&ie.bitmap.width!==0&&ie.bitmap.height!==0){var Oe={x:0,y:0,w:ie.bitmap.width+2,h:ie.bitmap.height+2};Q.push(Oe),Ze[qe]={rect:Oe,metrics:ie.metrics}}}}var st=m.potpack(Q),fr=new m.AlphaImage({width:st.w||1,height:st.h||1});for(var At in Z){var Pt=Z[At];for(var hr in Pt){var vn=Pt[+hr];if(vn&&vn.bitmap.width!==0&&vn.bitmap.height!==0){var sn=X[At][hr].rect;m.AlphaImage.copy(vn.bitmap,fr,{x:0,y:0},{x:sn.x+1,y:sn.y+1},vn.bitmap)}}}this.image=fr,this.positions=X};m.register("GlyphAtlas",he);var Fe=function(Z){this.tileID=new m.OverscaledTileID(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId};function ge(Z,X,Q){for(var fe=new m.EvaluationParameters(X),Ae=0,Ze=Z;Ae<Ze.length;Ae+=1)Ze[Ae].recalculate(fe,Q)}function Qe(Z,X){var Q=m.getArrayBuffer(Z.request,function(fe,Ae,Ze,qe){fe?X(fe):Ae&&X(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Ae)),rawData:Ae,cacheControl:Ze,expires:qe})});return function(){Q.cancel(),X()}}Fe.prototype.parse=function(Z,X,Q,fe,Ae){var Ze=this;this.status="parsing",this.data=Z,this.collisionBoxArray=new m.CollisionBoxArray;var qe=new m.DictionaryCoder(Object.keys(Z.layers).sort()),ie=new m.FeatureIndex(this.tileID,this.promoteId);ie.bucketLayerIDs=[];var Oe,st,fr,At,Pt={},hr={featureIndex:ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q},vn=X.familiesBySource[this.source];for(var sn in vn){var Et=Z.layers[sn];if(Et){Et.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+sn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var qr=qe.encode(sn),Dr=[],jr=0;jr<Et.length;jr++){var ci=Et.feature(jr),Kr=ie.getId(ci,sn);Dr.push({feature:ci,id:Kr,index:jr,sourceLayerIndex:qr})}for(var Pn=0,Vi=vn[sn];Pn<Vi.length;Pn+=1){var si=Vi[Pn],Ci=si[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(ge(si,this.zoom,Q),(Pt[Ci.id]=Ci.createBucket({index:ie.bucketLayerIDs.length,layers:si,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qr,sourceID:this.source})).populate(Dr,hr,this.tileID.canonical),ie.bucketLayerIDs.push(si.map(function(xi){return xi.id})))}}}var gi=m.mapObject(hr.glyphDependencies,function(xi){return Object.keys(xi).map(Number)});Object.keys(gi).length?fe.send("getGlyphs",{uid:this.uid,stacks:gi},function(xi,Ai){Oe||(Oe=xi,st=Ai,Aa.call(Ze))}):st={};var _t=Object.keys(hr.iconDependencies);_t.length?fe.send("getImages",{icons:_t,source:this.source,tileID:this.tileID,type:"icons"},function(xi,Ai){Oe||(Oe=xi,fr=Ai,Aa.call(Ze))}):fr={};var jt=Object.keys(hr.patternDependencies);function Aa(){if(Oe)return Ae(Oe);if(st&&fr&&At){var xi=new he(st),Ai=new m.ImageAtlas(fr,At);for(var Fi in Pt){var Hr=Pt[Fi];Hr instanceof m.SymbolBucket?(ge(Hr.layers,this.zoom,Q),m.performSymbolLayout(Hr,st,xi.positions,fr,Ai.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Hr.hasPattern&&(Hr instanceof m.LineBucket||Hr instanceof m.FillBucket||Hr instanceof m.FillExtrusionBucket)&&(ge(Hr.layers,this.zoom,Q),Hr.addFeatures(hr,this.tileID.canonical,Ai.patternPositions))}this.status="done",Ae(null,{buckets:m.values(Pt).filter(function(En){return!En.isEmpty()}),featureIndex:ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xi.image,imageAtlas:Ai,glyphMap:this.returnDependencies?st:null,iconMap:this.returnDependencies?fr:null,glyphPositions:this.returnDependencies?xi.positions:null})}}jt.length?fe.send("getImages",{icons:jt,source:this.source,tileID:this.tileID,type:"patterns"},function(xi,Ai){Oe||(Oe=xi,At=Ai,Aa.call(Ze))}):At={},Aa.call(this)};var ct=function(Z,X,Q,fe){this.actor=Z,this.layerIndex=X,this.availableImages=Q,this.loadVectorData=fe||Qe,this.loading={},this.loaded={}};ct.prototype.loadTile=function(Z,X){var Q=this,fe=Z.uid;this.loading||(this.loading={});var Ae=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new m.RequestPerformance(Z.request),Ze=this.loading[fe]=new Fe(Z);Ze.abort=this.loadVectorData(Z,function(qe,ie){if(delete Q.loading[fe],qe||!ie)return Ze.status="done",Q.loaded[fe]=Ze,X(qe);var Oe=ie.rawData,st={};ie.expires&&(st.expires=ie.expires),ie.cacheControl&&(st.cacheControl=ie.cacheControl);var fr={};if(Ae){var At=Ae.finish();At&&(fr.resourceTiming=JSON.parse(JSON.stringify(At)))}Ze.vectorTile=ie.vectorTile,Ze.parse(ie.vectorTile,Q.layerIndex,Q.availableImages,Q.actor,function(Pt,hr){if(Pt||!hr)return X(Pt);X(null,m.extend({rawTileData:Oe.slice(0)},hr,st,fr))}),Q.loaded=Q.loaded||{},Q.loaded[fe]=Ze})},ct.prototype.reloadTile=function(Z,X){var Q=this,fe=this.loaded,Ae=Z.uid,Ze=this;if(fe&&fe[Ae]){var qe=fe[Ae];qe.showCollisionBoxes=Z.showCollisionBoxes;var ie=function(Oe,st){var fr=qe.reloadCallback;fr&&(delete qe.reloadCallback,qe.parse(qe.vectorTile,Ze.layerIndex,Q.availableImages,Ze.actor,fr)),X(Oe,st)};qe.status==="parsing"?qe.reloadCallback=ie:qe.status==="done"&&(qe.vectorTile?qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,ie):ie())}},ct.prototype.abortTile=function(Z,X){var Q=this.loading,fe=Z.uid;Q&&Q[fe]&&Q[fe].abort&&(Q[fe].abort(),delete Q[fe]),X()},ct.prototype.removeTile=function(Z,X){var Q=this.loaded,fe=Z.uid;Q&&Q[fe]&&delete Q[fe],X()};var xt=m.window.ImageBitmap,Qt=function(){this.loaded={}};function ur(Z,X){if(Z.length!==0){Mt(Z[0],X);for(var Q=1;Q<Z.length;Q++)Mt(Z[Q],!X)}}function Mt(Z,X){for(var Q=0,fe=0,Ae=Z.length,Ze=Ae-1;fe<Ae;Ze=fe++)Q+=(Z[fe][0]-Z[Ze][0])*(Z[Ze][1]+Z[fe][1]);Q>=0!=!!X&&Z.reverse()}Qt.prototype.loadTile=function(Z,X){var Q=Z.uid,fe=Z.encoding,Ae=Z.rawImageData,Ze=xt&&Ae instanceof xt?this.getImageData(Ae):Ae,qe=new m.DEMData(Q,Ze,fe);this.loaded=this.loaded||{},this.loaded[Q]=qe,X(null,qe)},Qt.prototype.getImageData=function(Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);var X=this.offscreenCanvasContext.getImageData(-1,-1,Z.width+2,Z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:X.width,height:X.height},X.data)},Qt.prototype.removeTile=function(Z){var X=this.loaded,Q=Z.uid;X&&X[Q]&&delete X[Q]};var Jt=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,zt=function(Z){this._feature=Z,this.extent=m.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))};zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Z=[],X=0,Q=this._feature.geometry;X<Q.length;X+=1){var fe=Q[X];Z.push([new m.Point$1(fe[0],fe[1])])}return Z}for(var Ae=[],Ze=0,qe=this._feature.geometry;Ze<qe.length;Ze+=1){for(var ie=[],Oe=0,st=qe[Ze];Oe<st.length;Oe+=1){var fr=st[Oe];ie.push(new m.Point$1(fr[0],fr[1]))}Ae.push(ie)}return Ae},zt.prototype.toGeoJSON=function(Z,X,Q){return Jt.call(this,Z,X,Q)};var lt=function(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=Z.length,this._features=Z};lt.prototype.feature=function(Z){return new zt(this._features[Z])};var pt=m.vectorTile.VectorTileFeature,ir=W;function W(Z,X){this.options=X||{},this.features=Z,this.length=Z.length}function Wt(Z,X){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=X||4096}W.prototype.feature=function(Z){return new Wt(this.features[Z],this.options.extent)},Wt.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var X=0;X<Z.length;X++){for(var Q=Z[X],fe=[],Ae=0;Ae<Q.length;Ae++)fe.push(new m.Point$1(Q[Ae][0],Q[Ae][1]));this.geometry.push(fe)}return this.geometry},Wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,X=1/0,Q=-1/0,fe=1/0,Ae=-1/0,Ze=0;Ze<Z.length;Ze++)for(var qe=Z[Ze],ie=0;ie<qe.length;ie++){var Oe=qe[ie];X=Math.min(X,Oe.x),Q=Math.max(Q,Oe.x),fe=Math.min(fe,Oe.y),Ae=Math.max(Ae,Oe.y)}return[X,fe,Q,Ae]},Wt.prototype.toGeoJSON=pt.prototype.toGeoJSON;var ot=bt,Ye=ir;function bt(Z){var X=new m.pbf;return function(Q,fe){for(var Ae in Q.layers)fe.writeMessage(3,Ke,Q.layers[Ae])}(Z,X),X.finish()}function Ke(Z,X){var Q;X.writeVarintField(15,Z.version||1),X.writeStringField(1,Z.name||""),X.writeVarintField(5,Z.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<Z.length;Q++)fe.feature=Z.feature(Q),X.writeMessage(2,Xt,fe);var Ae=fe.keys;for(Q=0;Q<Ae.length;Q++)X.writeStringField(3,Ae[Q]);var Ze=fe.values;for(Q=0;Q<Ze.length;Q++)X.writeMessage(4,Ee,Ze[Q])}function Xt(Z,X){var Q=Z.feature;Q.id!==void 0&&X.writeVarintField(1,Q.id),X.writeMessage(2,Sr,Z),X.writeVarintField(3,Q.type),X.writeMessage(4,C,Q)}function Sr(Z,X){var Q=Z.feature,fe=Z.keys,Ae=Z.values,Ze=Z.keycache,qe=Z.valuecache;for(var ie in Q.properties){var Oe=Ze[ie];Oe===void 0&&(fe.push(ie),Ze[ie]=Oe=fe.length-1),X.writeVarint(Oe);var st=Q.properties[ie],fr=typeof st;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(st=JSON.stringify(st));var At=fr+":"+st,Pt=qe[At];Pt===void 0&&(Ae.push(st),qe[At]=Pt=Ae.length-1),X.writeVarint(Pt)}}function Vr(Z,X){return(X<<3)+(7&Z)}function en(Z){return Z<<1^Z>>31}function C(Z,X){for(var Q=Z.loadGeometry(),fe=Z.type,Ae=0,Ze=0,qe=Q.length,ie=0;ie<qe;ie++){var Oe=Q[ie],st=1;fe===1&&(st=Oe.length),X.writeVarint(Vr(1,st));for(var fr=fe===3?Oe.length-1:Oe.length,At=0;At<fr;At++){At===1&&fe!==1&&X.writeVarint(Vr(2,fr-1));var Pt=Oe[At].x-Ae,hr=Oe[At].y-Ze;X.writeVarint(en(Pt)),X.writeVarint(en(hr)),Ae+=Pt,Ze+=hr}fe===3&&X.writeVarint(Vr(7,1))}}function Ee(Z,X){var Q=typeof Z;Q==="string"?X.writeStringField(1,Z):Q==="boolean"?X.writeBooleanField(7,Z):Q==="number"&&(Z%1!=0?X.writeDoubleField(3,Z):Z<0?X.writeSVarintField(6,Z):X.writeVarintField(5,Z))}function Re(Z,X,Q,fe){yt(Z,Q,fe),yt(X,2*Q,2*fe),yt(X,2*Q+1,2*fe+1)}function yt(Z,X,Q){var fe=Z[X];Z[X]=Z[Q],Z[Q]=fe}function ft(Z,X,Q,fe){var Ae=Z-Q,Ze=X-fe;return Ae*Ae+Ze*Ze}ot.fromVectorTileJs=bt,ot.fromGeojsonVt=function(Z,X){X=X||{};var Q={};for(var fe in Z)Q[fe]=new ir(Z[fe].features,X),Q[fe].name=fe,Q[fe].version=X.version,Q[fe].extent=X.extent;return bt({layers:Q})},ot.GeoJSONWrapper=Ye;var It=function(Z){return Z[0]},Ht=function(Z){return Z[1]},xr=function(Z,X,Q,fe,Ae){X===void 0&&(X=It),Q===void 0&&(Q=Ht),fe===void 0&&(fe=64),Ae===void 0&&(Ae=Float64Array),this.nodeSize=fe,this.points=Z;for(var Ze=Z.length<65536?Uint16Array:Uint32Array,qe=this.ids=new Ze(Z.length),ie=this.coords=new Ae(2*Z.length),Oe=0;Oe<Z.length;Oe++)qe[Oe]=Oe,ie[2*Oe]=X(Z[Oe]),ie[2*Oe+1]=Q(Z[Oe]);(function st(fr,At,Pt,hr,vn,sn){if(!(vn-hr<=Pt)){var Et=hr+vn>>1;(function qr(Dr,jr,ci,Kr,Pn,Vi){for(;Pn>Kr;){if(Pn-Kr>600){var si=Pn-Kr+1,Ci=ci-Kr+1,gi=Math.log(si),_t=.5*Math.exp(2*gi/3),jt=.5*Math.sqrt(gi*_t*(si-_t)/si)*(Ci-si/2<0?-1:1);qr(Dr,jr,ci,Math.max(Kr,Math.floor(ci-Ci*_t/si+jt)),Math.min(Pn,Math.floor(ci+(si-Ci)*_t/si+jt)),Vi)}var Aa=jr[2*ci+Vi],xi=Kr,Ai=Pn;for(Re(Dr,jr,Kr,ci),jr[2*Pn+Vi]>Aa&&Re(Dr,jr,Kr,Pn);xi<Ai;){for(Re(Dr,jr,xi,Ai),xi++,Ai--;jr[2*xi+Vi]<Aa;)xi++;for(;jr[2*Ai+Vi]>Aa;)Ai--}jr[2*Kr+Vi]===Aa?Re(Dr,jr,Kr,Ai):Re(Dr,jr,++Ai,Pn),Ai<=ci&&(Kr=Ai+1),ci<=Ai&&(Pn=Ai-1)}})(fr,At,Et,hr,vn,sn%2),st(fr,At,Pt,hr,Et-1,sn+1),st(fr,At,Pt,Et+1,vn,sn+1)}})(qe,ie,fe,0,qe.length-1,0)};xr.prototype.range=function(Z,X,Q,fe){return function(Ae,Ze,qe,ie,Oe,st,fr){for(var At,Pt,hr=[0,Ae.length-1,0],vn=[];hr.length;){var sn=hr.pop(),Et=hr.pop(),qr=hr.pop();if(Et-qr<=fr)for(var Dr=qr;Dr<=Et;Dr++)Pt=Ze[2*Dr+1],(At=Ze[2*Dr])>=qe&&At<=Oe&&Pt>=ie&&Pt<=st&&vn.push(Ae[Dr]);else{var jr=Math.floor((qr+Et)/2);Pt=Ze[2*jr+1],(At=Ze[2*jr])>=qe&&At<=Oe&&Pt>=ie&&Pt<=st&&vn.push(Ae[jr]);var ci=(sn+1)%2;(sn===0?qe<=At:ie<=Pt)&&(hr.push(qr),hr.push(jr-1),hr.push(ci)),(sn===0?Oe>=At:st>=Pt)&&(hr.push(jr+1),hr.push(Et),hr.push(ci))}}return vn}(this.ids,this.coords,Z,X,Q,fe,this.nodeSize)},xr.prototype.within=function(Z,X,Q){return function(fe,Ae,Ze,qe,ie,Oe){for(var st=[0,fe.length-1,0],fr=[],At=ie*ie;st.length;){var Pt=st.pop(),hr=st.pop(),vn=st.pop();if(hr-vn<=Oe)for(var sn=vn;sn<=hr;sn++)ft(Ae[2*sn],Ae[2*sn+1],Ze,qe)<=At&&fr.push(fe[sn]);else{var Et=Math.floor((vn+hr)/2),qr=Ae[2*Et],Dr=Ae[2*Et+1];ft(qr,Dr,Ze,qe)<=At&&fr.push(fe[Et]);var jr=(Pt+1)%2;(Pt===0?Ze-ie<=qr:qe-ie<=Dr)&&(st.push(vn),st.push(Et-1),st.push(jr)),(Pt===0?Ze+ie>=qr:qe+ie>=Dr)&&(st.push(Et+1),st.push(hr),st.push(jr))}}return fr}(this.ids,this.coords,Z,X,Q,this.nodeSize)};var Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},dn=function(Z){this.options=ha(Object.create(Kn),Z),this.trees=new Array(this.options.maxZoom+1)};function di(Z,X,Q,fe,Ae){return{x:Z,y:X,zoom:1/0,id:Q,parentId:-1,numPoints:fe,properties:Ae}}function jn(Z,X){var Q=Z.geometry.coordinates,fe=Q[1];return{x:Hn(Q[0]),y:mi(fe),zoom:1/0,index:X,parentId:-1}}function ni(Z){return{type:"Feature",id:Z.id,properties:vi(Z),geometry:{type:"Point",coordinates:[(fe=Z.x,360*(fe-.5)),(X=Z.y,Q=(180-360*X)*Math.PI/180,360*Math.atan(Math.exp(Q))/Math.PI-90)]}};var X,Q,fe}function vi(Z){var X=Z.numPoints,Q=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return ha(ha({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:X,point_count_abbreviated:Q})}function Hn(Z){return Z/360+.5}function mi(Z){var X=Math.sin(Z*Math.PI/180),Q=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Q<0?0:Q>1?1:Q}function ha(Z,X){for(var Q in X)Z[Q]=X[Q];return Z}function Hi(Z){return Z.x}function Di(Z){return Z.y}function Qi(Z,X,Q,fe,Ae,Ze){var qe=Ae-Q,ie=Ze-fe;if(qe!==0||ie!==0){var Oe=((Z-Q)*qe+(X-fe)*ie)/(qe*qe+ie*ie);Oe>1?(Q=Ae,fe=Ze):Oe>0&&(Q+=qe*Oe,fe+=ie*Oe)}return(qe=Z-Q)*qe+(ie=X-fe)*ie}function pa(Z,X,Q,fe){var Ae={id:Z===void 0?null:Z,type:X,geometry:Q,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ze){var qe=Ze.geometry,ie=Ze.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Lo(Ze,qe);else if(ie==="Polygon"||ie==="MultiLineString")for(var Oe=0;Oe<qe.length;Oe++)Lo(Ze,qe[Oe]);else if(ie==="MultiPolygon")for(Oe=0;Oe<qe.length;Oe++)for(var st=0;st<qe[Oe].length;st++)Lo(Ze,qe[Oe][st])}(Ae),Ae}function Lo(Z,X){for(var Q=0;Q<X.length;Q+=3)Z.minX=Math.min(Z.minX,X[Q]),Z.minY=Math.min(Z.minY,X[Q+1]),Z.maxX=Math.max(Z.maxX,X[Q]),Z.maxY=Math.max(Z.maxY,X[Q+1])}function La(Z,X,Q,fe){if(X.geometry){var Ae=X.geometry.coordinates,Ze=X.geometry.type,qe=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),ie=[],Oe=X.id;if(Q.promoteId?Oe=X.properties[Q.promoteId]:Q.generateId&&(Oe=fe||0),Ze==="Point")ga(Ae,ie);else if(Ze==="MultiPoint")for(var st=0;st<Ae.length;st++)ga(Ae[st],ie);else if(Ze==="LineString")Bi(Ae,ie,qe,!1);else if(Ze==="MultiLineString"){if(Q.lineMetrics){for(st=0;st<Ae.length;st++)Bi(Ae[st],ie=[],qe,!1),Z.push(pa(Oe,"LineString",ie,X.properties));return}aa(Ae,ie,qe,!1)}else if(Ze==="Polygon")aa(Ae,ie,qe,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(st=0;st<X.geometry.geometries.length;st++)La(Z,{id:Oe,geometry:X.geometry.geometries[st],properties:X.properties},Q,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(st=0;st<Ae.length;st++){var fr=[];aa(Ae[st],fr,qe,!0),ie.push(fr)}}Z.push(pa(Oe,Ze,ie,X.properties))}}function ga(Z,X){X.push(Ji(Z[0])),X.push(Cs(Z[1])),X.push(0)}function Bi(Z,X,Q,fe){for(var Ae,Ze,qe=0,ie=0;ie<Z.length;ie++){var Oe=Ji(Z[ie][0]),st=Cs(Z[ie][1]);X.push(Oe),X.push(st),X.push(0),ie>0&&(qe+=fe?(Ae*st-Oe*Ze)/2:Math.sqrt(Math.pow(Oe-Ae,2)+Math.pow(st-Ze,2))),Ae=Oe,Ze=st}var fr=X.length-3;X[2]=1,function At(Pt,hr,vn,sn){for(var Et,qr=sn,Dr=vn-hr>>1,jr=vn-hr,ci=Pt[hr],Kr=Pt[hr+1],Pn=Pt[vn],Vi=Pt[vn+1],si=hr+3;si<vn;si+=3){var Ci=Qi(Pt[si],Pt[si+1],ci,Kr,Pn,Vi);if(Ci>qr)Et=si,qr=Ci;else if(Ci===qr){var gi=Math.abs(si-Dr);gi<jr&&(Et=si,jr=gi)}}qr>sn&&(Et-hr>3&&At(Pt,hr,Et,sn),Pt[Et+2]=qr,vn-Et>3&&At(Pt,Et,vn,sn))}(X,0,fr,Q),X[fr+2]=1,X.size=Math.abs(qe),X.start=0,X.end=X.size}function aa(Z,X,Q,fe){for(var Ae=0;Ae<Z.length;Ae++){var Ze=[];Bi(Z[Ae],Ze,Q,fe),X.push(Ze)}}function Ji(Z){return Z/360+.5}function Cs(Z){var X=Math.sin(Z*Math.PI/180),Q=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Q<0?0:Q>1?1:Q}function le(Z,X,Q,fe,Ae,Ze,qe,ie){if(fe/=X,Ze>=(Q/=X)&&qe<fe)return Z;if(qe<Q||Ze>=fe)return null;for(var Oe=[],st=0;st<Z.length;st++){var fr=Z[st],At=fr.geometry,Pt=fr.type,hr=Ae===0?fr.minX:fr.minY,vn=Ae===0?fr.maxX:fr.maxY;if(hr>=Q&&vn<fe)Oe.push(fr);else if(!(vn<Q||hr>=fe)){var sn=[];if(Pt==="Point"||Pt==="MultiPoint")ii(At,sn,Q,fe,Ae);else if(Pt==="LineString")mo(At,sn,Q,fe,Ae,!1,ie.lineMetrics);else if(Pt==="MultiLineString")kt(At,sn,Q,fe,Ae,!1);else if(Pt==="Polygon")kt(At,sn,Q,fe,Ae,!0);else if(Pt==="MultiPolygon")for(var Et=0;Et<At.length;Et++){var qr=[];kt(At[Et],qr,Q,fe,Ae,!0),qr.length&&sn.push(qr)}if(sn.length){if(ie.lineMetrics&&Pt==="LineString"){for(Et=0;Et<sn.length;Et++)Oe.push(pa(fr.id,Pt,sn[Et],fr.tags));continue}Pt!=="LineString"&&Pt!=="MultiLineString"||(sn.length===1?(Pt="LineString",sn=sn[0]):Pt="MultiLineString"),Pt!=="Point"&&Pt!=="MultiPoint"||(Pt=sn.length===3?"Point":"MultiPoint"),Oe.push(pa(fr.id,Pt,sn,fr.tags))}}}return Oe.length?Oe:null}function ii(Z,X,Q,fe,Ae){for(var Ze=0;Ze<Z.length;Ze+=3){var qe=Z[Ze+Ae];qe>=Q&&qe<=fe&&(X.push(Z[Ze]),X.push(Z[Ze+1]),X.push(Z[Ze+2]))}}function mo(Z,X,Q,fe,Ae,Ze,qe){for(var ie,Oe,st=Js(Z),fr=Ae===0?Ir:nn,At=Z.start,Pt=0;Pt<Z.length-3;Pt+=3){var hr=Z[Pt],vn=Z[Pt+1],sn=Z[Pt+2],Et=Z[Pt+3],qr=Z[Pt+4],Dr=Ae===0?hr:vn,jr=Ae===0?Et:qr,ci=!1;qe&&(ie=Math.sqrt(Math.pow(hr-Et,2)+Math.pow(vn-qr,2))),Dr<Q?jr>Q&&(Oe=fr(st,hr,vn,Et,qr,Q),qe&&(st.start=At+ie*Oe)):Dr>fe?jr<fe&&(Oe=fr(st,hr,vn,Et,qr,fe),qe&&(st.start=At+ie*Oe)):Kt(st,hr,vn,sn),jr<Q&&Dr>=Q&&(Oe=fr(st,hr,vn,Et,qr,Q),ci=!0),jr>fe&&Dr<=fe&&(Oe=fr(st,hr,vn,Et,qr,fe),ci=!0),!Ze&&ci&&(qe&&(st.end=At+ie*Oe),X.push(st),st=Js(Z)),qe&&(At+=ie)}var Kr=Z.length-3;hr=Z[Kr],vn=Z[Kr+1],sn=Z[Kr+2],(Dr=Ae===0?hr:vn)>=Q&&Dr<=fe&&Kt(st,hr,vn,sn),Kr=st.length-3,Ze&&Kr>=3&&(st[Kr]!==st[0]||st[Kr+1]!==st[1])&&Kt(st,st[0],st[1],st[2]),st.length&&X.push(st)}function Js(Z){var X=[];return X.size=Z.size,X.start=Z.start,X.end=Z.end,X}function kt(Z,X,Q,fe,Ae,Ze){for(var qe=0;qe<Z.length;qe++)mo(Z[qe],X,Q,fe,Ae,Ze,!1)}function Kt(Z,X,Q,fe){Z.push(X),Z.push(Q),Z.push(fe)}function Ir(Z,X,Q,fe,Ae,Ze){var qe=(Ze-X)/(fe-X);return Z.push(Ze),Z.push(Q+(Ae-Q)*qe),Z.push(1),qe}function nn(Z,X,Q,fe,Ae,Ze){var qe=(Ze-Q)/(Ae-Q);return Z.push(X+(fe-X)*qe),Z.push(Ze),Z.push(1),qe}function Sn(Z,X){for(var Q=[],fe=0;fe<Z.length;fe++){var Ae,Ze=Z[fe],qe=Ze.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")Ae=Bn(Ze.geometry,X);else if(qe==="MultiLineString"||qe==="Polygon"){Ae=[];for(var ie=0;ie<Ze.geometry.length;ie++)Ae.push(Bn(Ze.geometry[ie],X))}else if(qe==="MultiPolygon")for(Ae=[],ie=0;ie<Ze.geometry.length;ie++){for(var Oe=[],st=0;st<Ze.geometry[ie].length;st++)Oe.push(Bn(Ze.geometry[ie][st],X));Ae.push(Oe)}Q.push(pa(Ze.id,qe,Ae,Ze.tags))}return Q}function Bn(Z,X){var Q=[];Q.size=Z.size,Z.start!==void 0&&(Q.start=Z.start,Q.end=Z.end);for(var fe=0;fe<Z.length;fe+=3)Q.push(Z[fe]+X,Z[fe+1],Z[fe+2]);return Q}function yi(Z,X){if(Z.transformed)return Z;var Q,fe,Ae,Ze=1<<Z.z,qe=Z.x,ie=Z.y;for(Q=0;Q<Z.features.length;Q++){var Oe=Z.features[Q],st=Oe.geometry,fr=Oe.type;if(Oe.geometry=[],fr===1)for(fe=0;fe<st.length;fe+=2)Oe.geometry.push(li(st[fe],st[fe+1],X,Ze,qe,ie));else for(fe=0;fe<st.length;fe++){var At=[];for(Ae=0;Ae<st[fe].length;Ae+=2)At.push(li(st[fe][Ae],st[fe][Ae+1],X,Ze,qe,ie));Oe.geometry.push(At)}}return Z.transformed=!0,Z}function li(Z,X,Q,fe,Ae,Ze){return[Math.round(Q*(Z*fe-Ae)),Math.round(Q*(X*fe-Ze))]}function _n(Z,X,Q,fe,Ae){for(var Ze=X===Ae.maxZoom?0:Ae.tolerance/((1<<X)*Ae.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:fe,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ie=0;ie<Z.length;ie++){qe.numFeatures++,Oi(qe,Z[ie],Ze,Ae);var Oe=Z[ie].minX,st=Z[ie].minY,fr=Z[ie].maxX,At=Z[ie].maxY;Oe<qe.minX&&(qe.minX=Oe),st<qe.minY&&(qe.minY=st),fr>qe.maxX&&(qe.maxX=fr),At>qe.maxY&&(qe.maxY=At)}return qe}function Oi(Z,X,Q,fe){var Ae=X.geometry,Ze=X.type,qe=[];if(Ze==="Point"||Ze==="MultiPoint")for(var ie=0;ie<Ae.length;ie+=3)qe.push(Ae[ie]),qe.push(Ae[ie+1]),Z.numPoints++,Z.numSimplified++;else if(Ze==="LineString")Mi(qe,Ae,Z,Q,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(ie=0;ie<Ae.length;ie++)Mi(qe,Ae[ie],Z,Q,Ze==="Polygon",ie===0);else if(Ze==="MultiPolygon")for(var Oe=0;Oe<Ae.length;Oe++){var st=Ae[Oe];for(ie=0;ie<st.length;ie++)Mi(qe,st[ie],Z,Q,!0,ie===0)}if(qe.length){var fr=X.tags||null;if(Ze==="LineString"&&fe.lineMetrics){for(var At in fr={},X.tags)fr[At]=X.tags[At];fr.mapbox_clip_start=Ae.start/Ae.size,fr.mapbox_clip_end=Ae.end/Ae.size}var Pt={geometry:qe,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:fr};X.id!==null&&(Pt.id=X.id),Z.features.push(Pt)}}function Mi(Z,X,Q,fe,Ae,Ze){var qe=fe*fe;if(fe>0&&X.size<(Ae?qe:fe))Q.numPoints+=X.length/3;else{for(var ie=[],Oe=0;Oe<X.length;Oe+=3)(fe===0||X[Oe+2]>qe)&&(Q.numSimplified++,ie.push(X[Oe]),ie.push(X[Oe+1])),Q.numPoints++;Ae&&function(st,fr){for(var At=0,Pt=0,hr=st.length,vn=hr-2;Pt<hr;vn=Pt,Pt+=2)At+=(st[Pt]-st[vn])*(st[Pt+1]+st[vn+1]);if(At>0===fr)for(Pt=0,hr=st.length;Pt<hr/2;Pt+=2){var sn=st[Pt],Et=st[Pt+1];st[Pt]=st[hr-2-Pt],st[Pt+1]=st[hr-1-Pt],st[hr-2-Pt]=sn,st[hr-1-Pt]=Et}}(ie,Ze),Z.push(ie)}}function Ja(Z,X){var Q=(X=this.options=function(Ae,Ze){for(var qe in Ze)Ae[qe]=Ze[qe];return Ae}(Object.create(this.options),X)).debug;if(Q&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe=function(Ae,Ze){var qe=[];if(Ae.type==="FeatureCollection")for(var ie=0;ie<Ae.features.length;ie++)La(qe,Ae.features[ie],Ze,ie);else La(qe,Ae.type==="Feature"?Ae:{geometry:Ae},Ze);return qe}(Z,X);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(fe=function(Ae,Ze){var qe=Ze.buffer/Ze.extent,ie=Ae,Oe=le(Ae,1,-1-qe,qe,0,-1,2,Ze),st=le(Ae,1,1-qe,2+qe,0,-1,2,Ze);return(Oe||st)&&(ie=le(Ae,1,-qe,1+qe,0,-1,2,Ze)||[],Oe&&(ie=Sn(Oe,1).concat(ie)),st&&(ie=ie.concat(Sn(st,-1)))),ie}(fe,X)).length&&this.splitTile(fe,0,0,0),Q&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fs(Z,X,Q){return 32*((1<<Z)*Q+X)+Z}function Uo(Z,X){var Q=Z.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);var fe=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!fe)return X(null,null);var Ae=new lt(fe.features),Ze=ot(Ae);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),X(null,{vectorTile:Ae,rawData:Ze.buffer})}dn.prototype.load=function(Z){var X=this.options,Q=X.log,fe=X.minZoom,Ae=X.maxZoom,Ze=X.nodeSize;Q&&console.time("total time");var qe="prepare "+Z.length+" points";Q&&console.time(qe),this.points=Z;for(var ie=[],Oe=0;Oe<Z.length;Oe++)Z[Oe].geometry&&ie.push(jn(Z[Oe],Oe));this.trees[Ae+1]=new xr(ie,Hi,Di,Ze,Float32Array),Q&&console.timeEnd(qe);for(var st=Ae;st>=fe;st--){var fr=+Date.now();ie=this._cluster(ie,st),this.trees[st]=new xr(ie,Hi,Di,Ze,Float32Array),Q&&console.log("z%d: %d clusters in %dms",st,ie.length,+Date.now()-fr)}return Q&&console.timeEnd("total time"),this},dn.prototype.getClusters=function(Z,X){var Q=((Z[0]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,Z[1])),Ae=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,Ze=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)Q=-180,Ae=180;else if(Q>Ae){var qe=this.getClusters([Q,fe,180,Ze],X),ie=this.getClusters([-180,fe,Ae,Ze],X);return qe.concat(ie)}for(var Oe=this.trees[this._limitZoom(X)],st=[],fr=0,At=Oe.range(Hn(Q),mi(Ze),Hn(Ae),mi(fe));fr<At.length;fr+=1){var Pt=Oe.points[At[fr]];st.push(Pt.numPoints?ni(Pt):this.points[Pt.index])}return st},dn.prototype.getChildren=function(Z){var X=this._getOriginId(Z),Q=this._getOriginZoom(Z),fe="No cluster with the specified id.",Ae=this.trees[Q];if(!Ae)throw new Error(fe);var Ze=Ae.points[X];if(!Ze)throw new Error(fe);for(var qe=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),ie=[],Oe=0,st=Ae.within(Ze.x,Ze.y,qe);Oe<st.length;Oe+=1){var fr=Ae.points[st[Oe]];fr.parentId===Z&&ie.push(fr.numPoints?ni(fr):this.points[fr.index])}if(ie.length===0)throw new Error(fe);return ie},dn.prototype.getLeaves=function(Z,X,Q){var fe=[];return this._appendLeaves(fe,Z,X=X||10,Q=Q||0,0),fe},dn.prototype.getTile=function(Z,X,Q){var fe=this.trees[this._limitZoom(Z)],Ae=Math.pow(2,Z),Ze=this.options,qe=Ze.radius/Ze.extent,ie=(Q-qe)/Ae,Oe=(Q+1+qe)/Ae,st={features:[]};return this._addTileFeatures(fe.range((X-qe)/Ae,ie,(X+1+qe)/Ae,Oe),fe.points,X,Q,Ae,st),X===0&&this._addTileFeatures(fe.range(1-qe/Ae,ie,1,Oe),fe.points,Ae,Q,Ae,st),X===Ae-1&&this._addTileFeatures(fe.range(0,ie,qe/Ae,Oe),fe.points,-1,Q,Ae,st),st.features.length?st:null},dn.prototype.getClusterExpansionZoom=function(Z){for(var X=this._getOriginZoom(Z)-1;X<=this.options.maxZoom;){var Q=this.getChildren(Z);if(X++,Q.length!==1)break;Z=Q[0].properties.cluster_id}return X},dn.prototype._appendLeaves=function(Z,X,Q,fe,Ae){for(var Ze=0,qe=this.getChildren(X);Ze<qe.length;Ze+=1){var ie=qe[Ze],Oe=ie.properties;if(Oe&&Oe.cluster?Ae+Oe.point_count<=fe?Ae+=Oe.point_count:Ae=this._appendLeaves(Z,Oe.cluster_id,Q,fe,Ae):Ae<fe?Ae++:Z.push(ie),Z.length===Q)break}return Ae},dn.prototype._addTileFeatures=function(Z,X,Q,fe,Ae,Ze){for(var qe=0,ie=Z;qe<ie.length;qe+=1){var Oe=X[ie[qe]],st=Oe.numPoints,fr={type:1,geometry:[[Math.round(this.options.extent*(Oe.x*Ae-Q)),Math.round(this.options.extent*(Oe.y*Ae-fe))]],tags:st?vi(Oe):this.points[Oe.index].properties},At=void 0;st?At=Oe.id:this.options.generateId?At=Oe.index:this.points[Oe.index].id&&(At=this.points[Oe.index].id),At!==void 0&&(fr.id=At),Ze.features.push(fr)}},dn.prototype._limitZoom=function(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))},dn.prototype._cluster=function(Z,X){for(var Q=[],fe=this.options,Ae=fe.reduce,Ze=fe.minPoints,qe=fe.radius/(fe.extent*Math.pow(2,X)),ie=0;ie<Z.length;ie++){var Oe=Z[ie];if(!(Oe.zoom<=X)){Oe.zoom=X;for(var st=this.trees[X+1],fr=st.within(Oe.x,Oe.y,qe),At=Oe.numPoints||1,Pt=At,hr=0,vn=fr;hr<vn.length;hr+=1){var sn=st.points[vn[hr]];sn.zoom>X&&(Pt+=sn.numPoints||1)}if(Pt>=Ze){for(var Et=Oe.x*At,qr=Oe.y*At,Dr=Ae&&At>1?this._map(Oe,!0):null,jr=(ie<<5)+(X+1)+this.points.length,ci=0,Kr=fr;ci<Kr.length;ci+=1){var Pn=st.points[Kr[ci]];if(!(Pn.zoom<=X)){Pn.zoom=X;var Vi=Pn.numPoints||1;Et+=Pn.x*Vi,qr+=Pn.y*Vi,Pn.parentId=jr,Ae&&(Dr||(Dr=this._map(Oe,!0)),Ae(Dr,this._map(Pn)))}}Oe.parentId=jr,Q.push(di(Et/Pt,qr/Pt,jr,Pt,Dr))}else if(Q.push(Oe),Pt>1)for(var si=0,Ci=fr;si<Ci.length;si+=1){var gi=st.points[Ci[si]];gi.zoom<=X||(gi.zoom=X,Q.push(gi))}}}return Q},dn.prototype._getOriginId=function(Z){return Z-this.points.length>>5},dn.prototype._getOriginZoom=function(Z){return(Z-this.points.length)%32},dn.prototype._map=function(Z,X){if(Z.numPoints)return X?ha({},Z.properties):Z.properties;var Q=this.points[Z.index].properties,fe=this.options.map(Q);return X&&fe===Q?ha({},fe):fe},Ja.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ja.prototype.splitTile=function(Z,X,Q,fe,Ae,Ze,qe){for(var ie=[Z,X,Q,fe],Oe=this.options,st=Oe.debug;ie.length;){fe=ie.pop(),Q=ie.pop(),X=ie.pop(),Z=ie.pop();var fr=1<<X,At=fs(X,Q,fe),Pt=this.tiles[At];if(!Pt&&(st>1&&console.time("creation"),Pt=this.tiles[At]=_n(Z,X,Q,fe,Oe),this.tileCoords.push({z:X,x:Q,y:fe}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Q,fe,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));var hr="z"+X;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(Pt.source=Z,Ae){if(X===Oe.maxZoom||X===Ae)continue;var vn=1<<Ae-X;if(Q!==Math.floor(Ze/vn)||fe!==Math.floor(qe/vn))continue}else if(X===Oe.indexMaxZoom||Pt.numPoints<=Oe.indexMaxPoints)continue;if(Pt.source=null,Z.length!==0){st>1&&console.time("clipping");var sn,Et,qr,Dr,jr,ci,Kr=.5*Oe.buffer/Oe.extent,Pn=.5-Kr,Vi=.5+Kr,si=1+Kr;sn=Et=qr=Dr=null,jr=le(Z,fr,Q-Kr,Q+Vi,0,Pt.minX,Pt.maxX,Oe),ci=le(Z,fr,Q+Pn,Q+si,0,Pt.minX,Pt.maxX,Oe),Z=null,jr&&(sn=le(jr,fr,fe-Kr,fe+Vi,1,Pt.minY,Pt.maxY,Oe),Et=le(jr,fr,fe+Pn,fe+si,1,Pt.minY,Pt.maxY,Oe),jr=null),ci&&(qr=le(ci,fr,fe-Kr,fe+Vi,1,Pt.minY,Pt.maxY,Oe),Dr=le(ci,fr,fe+Pn,fe+si,1,Pt.minY,Pt.maxY,Oe),ci=null),st>1&&console.timeEnd("clipping"),ie.push(sn||[],X+1,2*Q,2*fe),ie.push(Et||[],X+1,2*Q,2*fe+1),ie.push(qr||[],X+1,2*Q+1,2*fe),ie.push(Dr||[],X+1,2*Q+1,2*fe+1)}}},Ja.prototype.getTile=function(Z,X,Q){var fe=this.options,Ae=fe.extent,Ze=fe.debug;if(Z<0||Z>24)return null;var qe=1<<Z,ie=fs(Z,X=(X%qe+qe)%qe,Q);if(this.tiles[ie])return yi(this.tiles[ie],Ae);Ze>1&&console.log("drilling down to z%d-%d-%d",Z,X,Q);for(var Oe,st=Z,fr=X,At=Q;!Oe&&st>0;)st--,fr=Math.floor(fr/2),At=Math.floor(At/2),Oe=this.tiles[fs(st,fr,At)];return Oe&&Oe.source?(Ze>1&&console.log("found parent tile z%d-%d-%d",st,fr,At),Ze>1&&console.time("drilling down"),this.splitTile(Oe.source,st,fr,At,Z,X,Q),Ze>1&&console.timeEnd("drilling down"),this.tiles[ie]?yi(this.tiles[ie],Ae):null):null};var Fa=function(Z){function X(Q,fe,Ae,Ze){Z.call(this,Q,fe,Ae,Uo),Ze&&(this.loadGeoJSON=Ze)}return Z&&(X.__proto__=Z),(X.prototype=Object.create(Z&&Z.prototype)).constructor=X,X.prototype.loadData=function(Q,fe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=fe,this._pendingLoadDataParams=Q,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},X.prototype._loadData=function(){var Q=this;if(this._pendingCallback&&this._pendingLoadDataParams){var fe=this._pendingCallback,Ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ze=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new m.RequestPerformance(Ae.request);this.loadGeoJSON(Ae,function(qe,ie){if(qe||!ie)return fe(qe);if(typeof ie!="object")return fe(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));(function Pt(hr,vn){var sn,Et=hr&&hr.type;if(Et==="FeatureCollection")for(sn=0;sn<hr.features.length;sn++)Pt(hr.features[sn],vn);else if(Et==="GeometryCollection")for(sn=0;sn<hr.geometries.length;sn++)Pt(hr.geometries[sn],vn);else if(Et==="Feature")Pt(hr.geometry,vn);else if(Et==="Polygon")ur(hr.coordinates,vn);else if(Et==="MultiPolygon")for(sn=0;sn<hr.coordinates.length;sn++)ur(hr.coordinates[sn],vn);return hr})(ie,!0);try{if(Ae.filter){var Oe=m.createExpression(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(function(Pt){return Pt.key+": "+Pt.message}).join(", "));var st=ie.features.filter(function(Pt){return Oe.value.evaluate({zoom:0},Pt)});ie={type:"FeatureCollection",features:st}}Q._geoJSONIndex=Ae.cluster?new dn(function(Pt){var hr=Pt.superclusterOptions,vn=Pt.clusterProperties;if(!vn||!hr)return hr;for(var sn={},Et={},qr={accumulated:null,zoom:0},Dr={properties:null},jr=Object.keys(vn),ci=0,Kr=jr;ci<Kr.length;ci+=1){var Pn=Kr[ci],Vi=vn[Pn],si=Vi[0],Ci=m.createExpression(Vi[1]),gi=m.createExpression(typeof si=="string"?[si,["accumulated"],["get",Pn]]:si);sn[Pn]=Ci.value,Et[Pn]=gi.value}return hr.map=function(_t){Dr.properties=_t;for(var jt={},Aa=0,xi=jr;Aa<xi.length;Aa+=1){var Ai=xi[Aa];jt[Ai]=sn[Ai].evaluate(qr,Dr)}return jt},hr.reduce=function(_t,jt){Dr.properties=jt;for(var Aa=0,xi=jr;Aa<xi.length;Aa+=1){var Ai=xi[Aa];qr.accumulated=_t[Ai],_t[Ai]=Et[Ai].evaluate(qr,Dr)}},hr}(Ae)).load(ie.features):function(Pt,hr){return new Ja(Pt,hr)}(ie,Ae.geojsonVtOptions)}catch(Pt){return fe(Pt)}Q.loaded={};var fr={};if(Ze){var At=Ze.finish();At&&(fr.resourceTiming={},fr.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(At)))}fe(null,fr)})}},X.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},X.prototype.reloadTile=function(Q,fe){var Ae=this.loaded;return Ae&&Ae[Q.uid]?Z.prototype.reloadTile.call(this,Q,fe):this.loadTile(Q,fe)},X.prototype.loadGeoJSON=function(Q,fe){if(Q.request)m.getJSON(Q.request,fe);else{if(typeof Q.data!="string")return fe(new Error("Input data given to '"+Q.source+"' is not a valid GeoJSON object."));try{return fe(null,JSON.parse(Q.data))}catch(Ae){return fe(new Error("Input data given to '"+Q.source+"' is not a valid GeoJSON object."))}}},X.prototype.removeSource=function(Q,fe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),fe()},X.prototype.getClusterExpansionZoom=function(Q,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(Ae){fe(Ae)}},X.prototype.getClusterChildren=function(Q,fe){try{fe(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(Ae){fe(Ae)}},X.prototype.getClusterLeaves=function(Q,fe){try{fe(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(Ae){fe(Ae)}},X}(ct),ya=function(Z){var X=this;this.self=Z,this.actor=new m.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ct,geojson:Fa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Q,fe){if(X.workerSourceTypes[Q])throw new Error('Worker source with name "'+Q+'" already registered.');X.workerSourceTypes[Q]=fe},this.self.registerRTLTextPlugin=function(Q){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=Q.applyArabicShaping,m.plugin.processBidirectionalText=Q.processBidirectionalText,m.plugin.processStyledBidirectionalText=Q.processStyledBidirectionalText}};return ya.prototype.setReferrer=function(Z,X){this.referrer=X},ya.prototype.setImages=function(Z,X,Q){for(var fe in this.availableImages[Z]=X,this.workerSources[Z]){var Ae=this.workerSources[Z][fe];for(var Ze in Ae)Ae[Ze].availableImages=X}Q()},ya.prototype.setLayers=function(Z,X,Q){this.getLayerIndex(Z).replace(X),Q()},ya.prototype.updateLayers=function(Z,X,Q){this.getLayerIndex(Z).update(X.layers,X.removedIds),Q()},ya.prototype.loadTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).loadTile(X,Q)},ya.prototype.loadDEMTile=function(Z,X,Q){this.getDEMWorkerSource(Z,X.source).loadTile(X,Q)},ya.prototype.reloadTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).reloadTile(X,Q)},ya.prototype.abortTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).abortTile(X,Q)},ya.prototype.removeTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).removeTile(X,Q)},ya.prototype.removeDEMTile=function(Z,X){this.getDEMWorkerSource(Z,X.source).removeTile(X)},ya.prototype.removeSource=function(Z,X,Q){if(this.workerSources[Z]&&this.workerSources[Z][X.type]&&this.workerSources[Z][X.type][X.source]){var fe=this.workerSources[Z][X.type][X.source];delete this.workerSources[Z][X.type][X.source],fe.removeSource!==void 0?fe.removeSource(X,Q):Q()}},ya.prototype.loadWorkerSource=function(Z,X,Q){try{this.self.importScripts(X.url),Q()}catch(fe){Q(fe.toString())}},ya.prototype.syncRTLPluginState=function(Z,X,Q){try{m.plugin.setState(X);var fe=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&fe!=null){this.self.importScripts(fe);var Ae=m.plugin.isParsed();Q(Ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+fe),Ae)}}catch(Ze){Q(Ze.toString())}},ya.prototype.getAvailableImages=function(Z){var X=this.availableImages[Z];return X||(X=[]),X},ya.prototype.getLayerIndex=function(Z){var X=this.layerIndexes[Z];return X||(X=this.layerIndexes[Z]=new ce),X},ya.prototype.getWorkerSource=function(Z,X,Q){var fe=this;return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][X]||(this.workerSources[Z][X]={}),this.workerSources[Z][X][Q]||(this.workerSources[Z][X][Q]=new this.workerSourceTypes[X]({send:function(Ae,Ze,qe){fe.actor.send(Ae,Ze,qe,Z)}},this.getLayerIndex(Z),this.getAvailableImages(Z))),this.workerSources[Z][X][Q]},ya.prototype.getDEMWorkerSource=function(Z,X){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][X]||(this.demWorkerSources[Z][X]=new Qt),this.demWorkerSources[Z][X]},ya.prototype.enforceCacheSizeLimit=function(Z,X){m.enforceCacheSizeLimit(X)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ya(self)),ya}),me(["./shared"],function(m){"use strict";var Ie=m.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,z=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(z);try{R=new Worker(j),T=!0}catch(ne){T=!1}return R&&R.terminate(),URL.revokeObjectURL(j),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var z=R.getImageData(0,0,1,1);return z&&z.width===T.width}()?(d[w=b&&b.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(T){var R=function(j){var ne=document.createElement("canvas"),ae=Object.create(f.webGLContextAttributes);return ae.failIfMajorPerformanceCaveat=j,ne.probablySupportsContext?ne.probablySupportsContext("webgl",ae)||ne.probablySupportsContext("experimental-webgl",ae):ne.supportsContext?ne.supportsContext("webgl",ae)||ne.supportsContext("experimental-webgl",ae):ne.getContext("webgl",ae)||ne.getContext("experimental-webgl",ae)}(T);if(!R)return!1;var z=R.createShader(R.VERTEX_SHADER);return!(!z||R.isContextLost())&&(R.shaderSource(z,"void main() {}"),R.compileShader(z),R.getShaderParameter(z,R.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),G={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},ce=m.window.document&&m.window.document.documentElement.style;function he(l){if(!ce)return l[0];for(var f=0;f<l.length;f++)if(l[f]in ce)return l[f];return l[0]}var Fe,ge=he(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);G.disableDrag=function(){ce&&ge&&(Fe=ce[ge],ce[ge]="none")},G.enableDrag=function(){ce&&ge&&(ce[ge]=Fe)};var Qe=he(["transform","WebkitTransform"]);G.setTransform=function(l,f){l.style[Qe]=f};var ct=!1;try{var xt=Object.defineProperty({},"passive",{get:function(){ct=!0}});m.window.addEventListener("test",xt,xt),m.window.removeEventListener("test",xt,xt)}catch(l){ct=!1}G.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&ct?d:d.capture)},G.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&ct?d:d.capture)};var Qt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Qt,!0)};function ur(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}G.suppressClick=function(){m.window.addEventListener("click",Qt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Qt,!0)},0)},G.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},G.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],b=0;b<f.length;b++)d.push(new m.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return d},G.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},G.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Mt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,b=this.requestors;d<b.length;d+=1){var w=b[d];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var b=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var b=0,w=0,T=c;w<T.length;w+=1){var R=T[w];if(R[0]<b||R[1]<R[0]||d<R[1])return!1;b=R[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var b=!0;if(!this.isLoaded())for(var w=0,T=c;w<T.length;w+=1)this.images[T[w]]||(b=!1);this.isLoaded()||b?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var b={},w=0,T=c;w<T.length;w+=1){var R=T[w];this.images[R]||this.fire(new m.Event("styleimagemissing",{id:R}));var z=this.images[R];z?b[R]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:Boolean(z.userImage&&z.userImage.render)}:m.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],b=this.getImage(c);if(!b)return null;if(d&&d.position.version===b.version)return d.position;if(d)d.position.version=b.version;else{var w={w:b.data.width+2,h:b.data.height+2,x:0,y:0},T=new m.ImagePosition(w,b);this.patterns[c]={bin:w,position:T}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var b=m.potpack(c),w=b.w,T=b.h,R=this.atlasImage;for(var z in R.resize({width:w||1,height:T||1}),this.patterns){var j=this.patterns[z].bin,ne=j.x+1,ae=j.y+1,oe=this.images[z].data,Se=oe.width,Me=oe.height;m.RGBAImage.copy(oe,R,{x:0,y:0},{x:ne,y:ae},{width:Se,height:Me}),m.RGBAImage.copy(oe,R,{x:0,y:Me-1},{x:ne,y:ae-1},{width:Se,height:1}),m.RGBAImage.copy(oe,R,{x:0,y:0},{x:ne,y:ae+Me},{width:Se,height:1}),m.RGBAImage.copy(oe,R,{x:Se-1,y:0},{x:ne-1,y:ae},{width:1,height:Me}),m.RGBAImage.copy(oe,R,{x:0,y:0},{x:ne+Se,y:ae},{width:1,height:Me})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,b=c;d<b.length;d+=1){var w=b[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var T=this.images[w];ur(T)&&this.updateImage(w,T)}}},f}(m.Evented),Jt=pt,zt=pt,lt=1e20;function pt(l,f,c,d,b,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=b||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ir(l,f,c,d,b,w,T){for(var R=0;R<f;R++){for(var z=0;z<c;z++)d[z]=l[z*f+R];for(W(d,b,w,T,c),z=0;z<c;z++)l[z*f+R]=b[z]}for(z=0;z<c;z++){for(R=0;R<f;R++)d[R]=l[z*f+R];for(W(d,b,w,T,f),R=0;R<f;R++)l[z*f+R]=Math.sqrt(b[R])}}function W(l,f,c,d,b){c[0]=0,d[0]=-lt,d[1]=+lt;for(var w=1,T=0;w<b;w++){for(var R=(l[w]+w*w-(l[c[T]]+c[T]*c[T]))/(2*w-2*c[T]);R<=d[T];)T--,R=(l[w]+w*w-(l[c[T]]+c[T]*c[T]))/(2*w-2*c[T]);c[++T]=w,d[T]=R,d[T+1]=+lt}for(w=0,T=0;w<b;w++){for(;d[T+1]<w;)T++;f[w]=(w-c[T])*(w-c[T])+l[c[T]]}}pt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var b=f.data[4*d+3]/255;this.gridOuter[d]=b===1?0:b===0?lt:Math.pow(Math.max(0,.5-b),2),this.gridInner[d]=b===1?lt:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Jt.default=zt;var Wt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Wt.prototype.setURL=function(l){this.url=l},Wt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var b in l)for(var w=0,T=l[b];w<T.length;w+=1)d.push({stack:b,id:T[w]});m.asyncAll(d,function(R,z){var j=R.stack,ne=R.id,ae=c.entries[j];ae||(ae=c.entries[j]={glyphs:{},requests:{},ranges:{}});var oe=ae.glyphs[ne];if(oe===void 0){if(oe=c._tinySDF(ae,j,ne))return ae.glyphs[ne]=oe,void z(null,{stack:j,id:ne,glyph:oe});var Se=Math.floor(ne/256);if(256*Se>65535)z(new Error("glyphs > 65535 not supported"));else if(ae.ranges[Se])z(null,{stack:j,id:ne,glyph:oe});else{var Me=ae.requests[Se];Me||(Me=ae.requests[Se]=[],Wt.loadGlyphRange(j,Se,c.url,c.requestManager,function(Ve,be){if(be){for(var ze in be)c._doesCharSupportLocalGlyph(+ze)||(ae.glyphs[+ze]=be[+ze]);ae.ranges[Se]=!0}for(var Xe=0,ut=Me;Xe<ut.length;Xe+=1)(0,ut[Xe])(Ve,be);delete ae.requests[Se]})),Me.push(function(Ve,be){Ve?z(Ve):be&&z(null,{stack:j,id:ne,glyph:be[ne]||null})})}}else z(null,{stack:j,id:ne,glyph:oe})},function(R,z){if(R)f(R);else if(z){for(var j={},ne=0,ae=z;ne<ae.length;ne+=1){var oe=ae[ne],Se=oe.stack,Me=oe.id,Ve=oe.glyph;(j[Se]||(j[Se]={}))[Me]=Ve&&{id:Ve.id,bitmap:Ve.bitmap.clone(),metrics:Ve.metrics}}f(null,j)}})},Wt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Wt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),b=l.tinySDF=new Wt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Wt.loadGlyphRange=function(l,f,c,d,b){var w=256*f,T=w+255,R=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+T),m.ResourceType.Glyphs);m.getArrayBuffer(R,function(z,j){if(z)b(z);else if(j){for(var ne={},ae=0,oe=m.parseGlyphPBF(j);ae<oe.length;ae+=1){var Se=oe[ae];ne[Se.id]=Se}b(null,ne)}})},Wt.TinySDF=Jt;var ot=function(){this.specification=m.styleSpec.light.position};ot.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},ot.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var Ye=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new ot,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),bt=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(Ye),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var b in c){var w=c[b];m.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),w):this._transitionable.setValue(b,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,b){return(!b||b.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Ke=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ke.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Ke.prototype.getDashRanges=function(l,f,c){var d=[],b=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,T=!0;d.push({left:b,right:w,isDash:T,zeroLength:l[0]===0});for(var R=l[0],z=1;z<l.length;z++){var j=l[z];d.push({left:b=R*c,right:w=(R+=j)*c,isDash:T=!T,zeroLength:j===0})}return d},Ke.prototype.addRoundDash=function(l,f,c){for(var d=f/2,b=-c;b<=c;b++)for(var w=this.width*(this.nextRow+c+b),T=0,R=l[T],z=0;z<this.width;z++){z/R.right>1&&(R=l[++T]);var j=Math.abs(z-R.left),ne=Math.abs(z-R.right),ae=Math.min(j,ne),oe=void 0,Se=b/c*(d+1);if(R.isDash){var Me=d-Math.abs(Se);oe=Math.sqrt(ae*ae+Me*Me)}else oe=d-Math.sqrt(ae*ae+Se*Se);this.data[w+z]=Math.max(0,Math.min(255,oe+128))}},Ke.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var b=l[0],w=l[l.length-1];b.isDash===w.isDash&&(b.left=w.left-this.width,w.right=b.right+this.width);for(var T=this.width*this.nextRow,R=0,z=l[R],j=0;j<this.width;j++){j/z.right>1&&(z=l[++R]);var ne=Math.abs(j-z.left),ae=Math.abs(j-z.right),oe=Math.min(ne,ae);this.data[T+j]=Math.max(0,Math.min(255,(z.isDash?oe:-oe)+128))}},Ke.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var b=0,w=0;w<l.length;w++)b+=l[w];if(b!==0){var T=this.width/b,R=this.getDashRanges(l,this.width,T);f?this.addRoundDash(R,T,c):this.addRegularDash(R)}var z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=d,this.dirty=!0,z},Ke.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Xt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),b=0;b<d.length;b++){var w=new l.Actor(d[b],c,this.id);w.name="Worker "+b,this.actors.push(w)}};function Sr(l,f,c){var d=function(b,w){if(b)return c(b);if(w){var T=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(T.vectorLayers=w.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=f.canonicalizeTileset(T,l.url),c(null,T)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Xt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,b){d.send(l,f,b)},c=c||function(){})},Xt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Xt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Xt.Actor=m.Actor;var Vr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Vr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Vr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=d&&l.y<w};var en=function(l){function f(c,d,b,w){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):b&&(m.extend(c,b),b.bounds&&(c.tileBounds=new Vr(b.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(b,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,z){return delete c.request,c.aborted?d(null):R&&R.status!==404?d(R):(z&&z.resourceTiming&&(c.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&c.setExpiryData(z),c.loadVectorData(z,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,T.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,T.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),C=function(l){function f(c,d,b,w){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):b&&(m.extend(c,b),b.bounds&&(c.tileBounds=new Vr(b.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(b.tiles),m.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var b=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(T,R){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(T)c.state="errored",d(T);else if(R){b.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=b.map.painter.context,j=z.gl;c.texture=b.map.painter.getTileTexture(R.width),c.texture?c.texture.update(R,{useMipmap:!0}):(c.texture=new m.Texture(z,R,j.RGBA,{useMipmap:!0}),c.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&j.texParameterf(j.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(b.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ee=function(l){function f(c,d,b,w){l.call(this,c,d,b,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(T,R){T&&(c.state="errored",d(T)),R&&(c.dem=R,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(b,m.ResourceType.Tile),function(T,R){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(T)c.state="errored",d(T);else if(R){this.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=m.window.ImageBitmap&&R instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?R:m.browser.getImageData(R,1),j={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",j,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,b=Math.pow(2,d.z),w=(d.x-1+b)%b,T=d.x===0?c.wrap-1:c.wrap,R=(d.x+1+b)%b,z=d.x+1===b?c.wrap+1:c.wrap,j={};return j[new m.OverscaledTileID(c.overscaledZ,T,d.z,w,d.y).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,z,d.z,R,d.y).key]={backfilled:!1},d.y>0&&(j[new m.OverscaledTileID(c.overscaledZ,T,d.z,w,d.y-1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,z,d.z,R,d.y-1).key]={backfilled:!1}),d.y+1<b&&(j[new m.OverscaledTileID(c.overscaledZ,T,d.z,w,d.y+1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,z,d.z,R,d.y+1).key]={backfilled:!1}),j},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(C),Re=function(l){function f(c,d,b,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var T=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*T,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*T,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*T,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)d.fire(new m.ErrorEvent(b));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,b,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:b},w),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var b=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(b.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(w),this.actor.send(this.type+".loadData",b,function(T,R){d._removed||R&&R.abandoned||(d._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[d.id]&&(d._resourceTiming=R.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:b.source},null),c(T))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var b=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete c.request,c.unloadVectorData(),c.aborted?d(null):T?d(T):(c.loadVectorData(R,b.map.painter,w==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),yt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ft=function(l){function f(c,d,b,w){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var b=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,T){b._loaded=!0,w?b.fire(new m.ErrorEvent(w)):T&&(b.image=T,c&&(b.coordinates=c),d&&d(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var b=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,z=1/0,j=-1/0,ne=-1/0,ae=0,oe=T;ae<oe.length;ae+=1){var Se=oe[ae];R=Math.min(R,Se.x),z=Math.min(z,Se.y),j=Math.max(j,Se.x),ne=Math.max(ne,Se.y)}var Me=Math.max(j-R,ne-z),Ve=Math.max(0,Math.floor(-Math.log(Me)/Math.LN2)),be=Math.pow(2,Ve);return new m.CanonicalTileID(Ve,Math.floor((R+j)/2*be),Math.floor((z+ne)/2*be))}(b),this.minzoom=this.maxzoom=this.tileID.z;var w=b.map(function(T){return d.tileID.getTilePoint(T)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),It=function(l){function f(c,d,b,w){l.call(this,c,d,b,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var b=0,w=d.urls;b<w.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(w[b],m.ResourceType.Source).url);m.getVideo(this.urls,function(T,R){c._loaded=!0,T?c.fire(new m.ErrorEvent(T)):R&&(c.video=R,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ft),Ht=function(l){function f(c,d,b,w){l.call(this,c,d,b,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,b=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[w];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var b=d[c];if(isNaN(b)||b<=0)return!0}return!1},f}(ft),xr={vector:en,raster:C,"raster-dem":Ee,geojson:Re,video:It,image:ft,canvas:Ht};function Kn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function dn(l,f,c,d,b,w){var T=function(Ve,be,ze){if(Ve)for(var Xe=0,ut=Ve;Xe<ut.length;Xe+=1){var Ut=be[ut[Xe]];if(Ut&&Ut.source===ze&&Ut.type==="fill-extrusion")return!0}else for(var Ot in be){var Zt=be[Ot];if(Zt.source===ze&&Zt.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),R=w.maxPitchScaleFactor(),z=l.tilesIn(d,R,T);z.sort(di);for(var j=[],ne=0,ae=z;ne<ae.length;ne+=1){var oe=ae[ne];j.push({wrappedTileID:oe.tileID.wrapped().key,queryResults:oe.tile.queryRenderedFeatures(f,c,l._state,oe.queryGeometry,oe.cameraQueryGeometry,oe.scale,b,w,R,Kn(l.transform,oe.tileID))})}var Se=function(Ve){for(var be={},ze={},Xe=0,ut=Ve;Xe<ut.length;Xe+=1){var Ut=ut[Xe],Ot=Ut.queryResults,Zt=Ut.wrappedTileID,lr=ze[Zt]=ze[Zt]||{};for(var Or in Ot)for(var Pr=Ot[Or],$r=lr[Or]=lr[Or]||{},Ln=be[Or]=be[Or]||[],Fn=0,zn=Pr;Fn<zn.length;Fn+=1){var ui=zn[Fn];$r[ui.featureIndex]||($r[ui.featureIndex]=!0,Ln.push(ui))}}return be}(j);for(var Me in Se)Se[Me].forEach(function(Ve){var be=Ve.feature,ze=l.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=ze});return Se}function di(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var jn=function(l,f){this.max=l,this.onRemove=f,this.reset()};jn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},jn.prototype.add=function(l,f,c){var d=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},jn.prototype.has=function(l){return l.wrapped().key in this.data},jn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},jn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},jn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},jn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},jn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][d];return this.data[c].splice(d,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},jn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},jn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,b=this.data[c];d<b.length;d+=1){var w=b[d];l(w.value)||f.push(w)}for(var T=0,R=f;T<R.length;T+=1){var z=R[T];this.remove(z.value.tileID,z)}};var ni=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ni.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ni.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ni.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Hn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Hn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Hn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Hn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Hn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var b=this.attributes[d],w=f.attributes[b.name];w!==void 0&&l.vertexAttribPointer(w,b.components,l[vi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mi.prototype.get=function(){return this.current},mi.prototype.set=function(l){},mi.prototype.getDefault=function(){return this.default},mi.prototype.setDefault=function(){this.set(this.default)};var ha=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Hi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(mi),Di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(mi),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),pa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(mi),Lo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(mi),La=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(mi),ga=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(mi),Bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(mi),aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),Ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(mi),Cs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(mi),le=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(mi),ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),mo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Js=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(mi),kt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(mi),Kt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(mi),Ir=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(mi),nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(mi),Sn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(mi),Bn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),yi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),_n=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(mi),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(mi),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(mi),Ja=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(mi),fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(mi),Uo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),Fa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),ya=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(mi),Z=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(ya),X=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ya),Q=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Z(l,b),d&&(this.depthAttachment=new X(l,b))};Q.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var fe=function(l,f,c){this.func=l,this.mask=f,this.range=c};fe.ReadOnly=!1,fe.ReadWrite=!0,fe.disabled=new fe(519,fe.ReadOnly,[0,1]);var Ae=function(l,f,c,d,b,w){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=b,this.pass=w};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var Ze=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ze.disabled=new Ze(Ze.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ze.unblended=new Ze(Ze.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ze.alphaBlended=new Ze([1,771],m.Color.transparent,[!0,!0,!0,!0]);var qe=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};qe.disabled=new qe(!1,1029,2305),qe.backCCW=new qe(!0,1029,2305);var ie=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ha(this),this.clearDepth=new Hi(this),this.clearStencil=new Di(this),this.colorMask=new Qi(this),this.depthMask=new pa(this),this.stencilMask=new Lo(this),this.stencilFunc=new La(this),this.stencilOp=new ga(this),this.stencilTest=new Bi(this),this.depthRange=new aa(this),this.depthTest=new Ji(this),this.depthFunc=new Cs(this),this.blend=new le(this),this.blendFunc=new ii(this),this.blendColor=new mo(this),this.blendEquation=new Js(this),this.cullFace=new kt(this),this.cullFaceSide=new Kt(this),this.frontFace=new Ir(this),this.program=new nn(this),this.activeTexture=new Sn(this),this.viewport=new Bn(this),this.bindFramebuffer=new yi(this),this.bindRenderbuffer=new li(this),this.bindTexture=new _n(this),this.bindVertexBuffer=new Oi(this),this.bindElementBuffer=new Mi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ja(this),this.pixelStoreUnpack=new fs(this),this.pixelStoreUnpackPremultiplyAlpha=new Uo(this),this.pixelStoreUnpackFlipY=new Fa(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ie.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ie.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ie.prototype.createIndexBuffer=function(l,f){return new ni(this,l,f)},ie.prototype.createVertexBuffer=function(l,f,c){return new Hn(this,l,f,c)},ie.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,b=d.createRenderbuffer();return this.bindRenderbuffer.set(b),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},ie.prototype.createFramebuffer=function(l,f,c){return new Q(this,l,f,c)},ie.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,b=0;f&&(b|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(b)},ie.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ie.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ie.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ie.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ze.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ie.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Oe=function(l){function f(c,d,b){var w=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(T,R,z,j){var ne=new xr[R.type](T,R,z,j);if(ne.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ne.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ne),ne}(c,d,b,this),this._tiles={},this._cache=new jn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[d];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(st).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,b=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&b.push(this._tiles[w]);return c?b.sort(function(T,R){var z=T.tileID,j=R.tileID,ne=new m.Point(z.canonical.x,z.canonical.y)._rotate(d.transform.angle),ae=new m.Point(j.canonical.x,j.canonical.y)._rotate(d.transform.angle);return z.overscaledZ-j.overscaledZ||ae.y-ne.y||ae.x-ne.x}).map(function(T){return T.tileID.key}):b.map(function(T){return T.tileID}).sort(st).map(function(T){return T.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=d),this._loadTile(b,this._tileLoaded.bind(this,b,c,d)))},f.prototype._tileLoaded=function(c,d,b,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),b=0;b<d.length;b++){var w=d[b];if(c.neighboringTiles&&c.neighboringTiles[w]){var T=this.getTileByID(w);R(c,T),R(T,c)}}function R(z,j){z.needsHillshadePrepare=!0;var ne=j.tileID.canonical.x-z.tileID.canonical.x,ae=j.tileID.canonical.y-z.tileID.canonical.y,oe=Math.pow(2,z.tileID.canonical.z),Se=j.tileID.key;ne===0&&ae===0||Math.abs(ae)>1||(Math.abs(ne)>1&&(Math.abs(ne+oe)===1?ne+=oe:Math.abs(ne-oe)===1&&(ne-=oe)),j.dem&&z.dem&&(z.dem.backfillBorder(j.dem,ne,ae),z.neighboringTiles&&z.neighboringTiles[Se]&&(z.neighboringTiles[Se].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,b,w){for(var T in this._tiles){var R=this._tiles[T];if(!(w[T]||!R.hasData()||R.tileID.overscaledZ<=d||R.tileID.overscaledZ>b)){for(var z=R.tileID;R&&R.tileID.overscaledZ>d+1;){var j=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[j.key])&&R.hasData()&&(z=j)}for(var ne=z;ne.overscaledZ>d;)if(c[(ne=ne.scaledTo(ne.overscaledZ-1)).key]){w[z.key]=z;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=d?b:null}for(var w=c.overscaledZ-1;w>=d;w--){var T=c.scaledTo(w),R=this._getLoadedTile(T);if(R)return R}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*b*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(T)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var b={};for(var w in this._tiles){var T=this._tiles[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),b[T.tileID.key]=T}for(var R in this._tiles=b,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(lr){return new m.OverscaledTileID(lr.canonical.z,lr.wrap,lr.canonical.z,lr.canonical.x,lr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(lr){return d._source.hasTile(lr)}))):b=[];var w=c.coveringZoomLevel(this._source),T=Math.max(w-f.maxOverzooming,this._source.minzoom),R=Math.max(w+f.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(b,w);if(fr(this._source.type)){for(var j={},ne={},ae=0,oe=Object.keys(z);ae<oe.length;ae+=1){var Se=oe[ae],Me=z[Se],Ve=this._tiles[Se];if(Ve&&!(Ve.fadeEndTime&&Ve.fadeEndTime<=m.browser.now())){var be=this.findLoadedParent(Me,T);be&&(this._addTile(be.tileID),j[be.tileID.key]=be.tileID),ne[Se]=Me}}for(var ze in this._retainLoadedChildren(ne,w,R,z),j)z[ze]||(this._coveredTiles[ze]=!0,z[ze]=j[ze])}for(var Xe in z)this._tiles[Xe].clearFadeHold();for(var ut=0,Ut=m.keysDifference(this._tiles,z);ut<Ut.length;ut+=1){var Ot=Ut[ut],Zt=this._tiles[Ot];Zt.hasSymbolBuckets&&!Zt.holdingForFade()?Zt.setHoldDuration(this.map._fadeDuration):Zt.hasSymbolBuckets&&!Zt.symbolFadeFinished()||this._removeTile(Ot)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var b={},w={},T=Math.max(d-f.maxOverzooming,this._source.minzoom),R=Math.max(d+f.maxUnderzooming,this._source.minzoom),z={},j=0,ne=c;j<ne.length;j+=1){var ae=ne[j],oe=this._addTile(ae);b[ae.key]=ae,oe.hasData()||d<this._source.maxzoom&&(z[ae.key]=ae)}this._retainLoadedChildren(z,d,R,b);for(var Se=0,Me=c;Se<Me.length;Se+=1){var Ve=Me[Se],be=this._tiles[Ve.key];if(!be.hasData()){if(d+1>this._source.maxzoom){var ze=Ve.children(this._source.maxzoom)[0],Xe=this.getTile(ze);if(Xe&&Xe.hasData()){b[ze.key]=ze;continue}}else{var ut=Ve.children(this._source.maxzoom);if(b[ut[0].key]&&b[ut[1].key]&&b[ut[2].key]&&b[ut[3].key])continue}for(var Ut=be.wasRequested(),Ot=Ve.overscaledZ-1;Ot>=T;--Ot){var Zt=Ve.scaledTo(Ot);if(w[Zt.key]||(w[Zt.key]=!0,!(be=this.getTile(Zt))&&Ut&&(be=this._addTile(Zt)),be&&(b[Zt.key]=Zt,Ut=be.wasRequested(),be.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],b=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){b=this._loadedParentTiles[w.key];break}d.push(w.key);var T=w.scaledTo(w.overscaledZ-1);if(b=this._getLoadedTile(T))break;w=T}for(var R=0,z=d;R<z.length;R+=1)this._loadedParentTiles[z[R]]=b}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var b=Boolean(d);return b||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,b||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},w))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,b){var w=this,T=[],R=this.transform;if(!R)return T;for(var z=b?R.getCameraQueryGeometry(c):c,j=c.map(function(Ot){return R.pointCoordinate(Ot)}),ne=z.map(function(Ot){return R.pointCoordinate(Ot)}),ae=this.getIds(),oe=1/0,Se=1/0,Me=-1/0,Ve=-1/0,be=0,ze=ne;be<ze.length;be+=1){var Xe=ze[be];oe=Math.min(oe,Xe.x),Se=Math.min(Se,Xe.y),Me=Math.max(Me,Xe.x),Ve=Math.max(Ve,Xe.y)}for(var ut=function(Ot){var Zt=w._tiles[ae[Ot]];if(!Zt.holdingForFade()){var lr=Zt.tileID,Or=Math.pow(2,R.zoom-Zt.tileID.overscaledZ),Pr=d*Zt.queryPadding*m.EXTENT/Zt.tileSize/Or,$r=[lr.getTilePoint(new m.MercatorCoordinate(oe,Se)),lr.getTilePoint(new m.MercatorCoordinate(Me,Ve))];if($r[0].x-Pr<m.EXTENT&&$r[0].y-Pr<m.EXTENT&&$r[1].x+Pr>=0&&$r[1].y+Pr>=0){var Ln=j.map(function(zn){return lr.getTilePoint(zn)}),Fn=ne.map(function(zn){return lr.getTilePoint(zn)});T.push({tile:Zt,tileID:lr,queryGeometry:Ln,cameraQueryGeometry:Fn,scale:Or})}}},Ut=0;Ut<ae.length;Ut++)ut(Ut);return T},f.prototype.getVisibleCoordinates=function(c){for(var d=this,b=this.getRenderableIds(c).map(function(z){return d._tiles[z].tileID}),w=0,T=b;w<T.length;w+=1){var R=T[w];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(fr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,b){this._state.updateState(c=c||"_geojsonTileLayer",d,b)},f.prototype.removeFeatureState=function(c,d,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,b)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,b){var w=this._tiles[c];w&&w.setDependencies(d,b)},f.prototype.reloadTilesForDependencies=function(c,d){for(var b in this._tiles)this._tiles[b].hasDependency(c,d)&&this._reloadTile(b,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},f}(m.Evented);function st(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function fr(l){return l==="raster"||l==="image"||l==="video"}function At(){return new m.window.Worker(cc.workerUrl)}Oe.maxOverzooming=10,Oe.maxUnderzooming=3;var Pt="mapboxgl_preloaded_worker_pool",hr=function(){this.active={}};hr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new At);return this.active[l]=!0,this.workers.slice()},hr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},hr.prototype.isPreloaded=function(){return!!this.active[Pt]},hr.prototype.numActive=function(){return Object.keys(this.active).length};var vn,sn=Math.floor(m.browser.hardwareConcurrency/2);function Et(){return vn||(vn=new hr),vn}function qr(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Dr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=qr(l[d],f[l[d].ref]));return l}hr.workerCount=Math.max(Math.min(sn,6),1);var jr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ci(l,f,c){c.push({command:jr.addSource,args:[l,f[l]]})}function Kr(l,f,c){f.push({command:jr.removeSource,args:[l]}),c[l]=!0}function Pn(l,f,c,d){Kr(l,c,d),ci(l,f,c)}function Vi(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function si(l,f,c,d,b,w){var T;for(T in f=f||{},l=l||{})l.hasOwnProperty(T)&&(m.deepEqual(l[T],f[T])||c.push({command:w,args:[d,T,f[T],b]}));for(T in f)f.hasOwnProperty(T)&&!l.hasOwnProperty(T)&&(m.deepEqual(l[T],f[T])||c.push({command:w,args:[d,T,f[T],b]}))}function Ci(l){return l.id}function gi(l,f){return l[f.id]=f,l}var _t=function(l,f){this.reset(l,f)};_t.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},_t.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var b=f-1,w=this._distances[b],T=c-w,R=T>0?(d-w)/T:0;return this.points[b].mult(1-R).add(this.points[f].mult(R))};var jt=function(l,f,c){var d=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Aa(l,f,c,d,b){var w=m.create();return f?(m.scale(w,w,[1/b,1/b,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function xi(l,f,c,d,b){if(f){var w=m.clone(l);return m.scale(w,w,[b,b,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ai(l,f){var c=[l.x,l.y,0,1];Ta(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Fi(l,f){return .5+l/f*.5}function Hr(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function En(l,f,c,d,b,w,T,R){var z=d?l.textSizeData:l.iconSizeData,j=m.evaluateSizeForZoom(z,c.transform.zoom),ne=[256/c.width*2+1,256/c.height*2+1],ae=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ae.clear();for(var oe=l.lineVertexArray,Se=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Me=c.transform.width/c.transform.height,Ve=!1,be=0;be<Se.length;be++){var ze=Se.get(be);if(ze.hidden||ze.writingMode===m.WritingMode.vertical&&!Ve)Na(ze.numGlyphs,ae);else{Ve=!1;var Xe=[ze.anchorX,ze.anchorY,0,1];if(m.transformMat4(Xe,Xe,f),Hr(Xe,ne)){var ut=Fi(c.transform.cameraToCenterDistance,Xe[3]),Ut=m.evaluateSizeForFeature(z,j,ze),Ot=T?Ut/ut:Ut*ut,Zt=new m.Point(ze.anchorX,ze.anchorY),lr=Ai(Zt,b).point,Or={},Pr=ye(ze,Ot,!1,R,f,b,w,l.glyphOffsetArray,oe,ae,lr,Zt,Or,Me);Ve=Pr.useVertical,(Pr.notEnoughRoom||Ve||Pr.needsFlipping&&ye(ze,Ot,!0,R,f,b,w,l.glyphOffsetArray,oe,ae,lr,Zt,Or,Me).notEnoughRoom)&&Na(ze.numGlyphs,ae)}else Na(ze.numGlyphs,ae)}}d?l.text.dynamicLayoutVertexBuffer.updateData(ae):l.icon.dynamicLayoutVertexBuffer.updateData(ae)}function Dt(l,f,c,d,b,w,T,R,z,j,ne){var ae=R.glyphStartIndex+R.numGlyphs,oe=R.lineStartIndex,Se=R.lineStartIndex+R.lineLength,Me=f.getoffsetX(R.glyphStartIndex),Ve=f.getoffsetX(ae-1),be=Yi(l*Me,c,d,b,w,T,R.segment,oe,Se,z,j,ne);if(!be)return null;var ze=Yi(l*Ve,c,d,b,w,T,R.segment,oe,Se,z,j,ne);return ze?{first:be,last:ze}:null}function ea(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ye(l,f,c,d,b,w,T,R,z,j,ne,ae,oe,Se){var Me,Ve=f/24,be=l.lineOffsetX*Ve,ze=l.lineOffsetY*Ve;if(l.numGlyphs>1){var Xe=l.glyphStartIndex+l.numGlyphs,ut=l.lineStartIndex,Ut=l.lineStartIndex+l.lineLength,Ot=Dt(Ve,R,be,ze,c,ne,ae,l,z,w,oe);if(!Ot)return{notEnoughRoom:!0};var Zt=Ai(Ot.first.point,T).point,lr=Ai(Ot.last.point,T).point;if(d&&!c){var Or=ea(l.writingMode,Zt,lr,Se);if(Or)return Or}Me=[Ot.first];for(var Pr=l.glyphStartIndex+1;Pr<Xe-1;Pr++)Me.push(Yi(Ve*R.getoffsetX(Pr),be,ze,c,ne,ae,l.segment,ut,Ut,z,w,oe));Me.push(Ot.last)}else{if(d&&!c){var $r=Ai(ae,b).point,Ln=l.lineStartIndex+l.segment+1,Fn=new m.Point(z.getx(Ln),z.gety(Ln)),zn=Ai(Fn,b),ui=zn.signedDistanceFromCamera>0?zn.point:Yo(ae,Fn,$r,1,b),rn=ea(l.writingMode,$r,ui,Se);if(rn)return rn}var ti=Yi(Ve*R.getoffsetX(l.glyphStartIndex),be,ze,c,ne,ae,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,z,w,oe);if(!ti)return{notEnoughRoom:!0};Me=[ti]}for(var ai=0,$n=Me;ai<$n.length;ai+=1){var Gn=$n[ai];m.addDynamicAttributes(j,Gn.point,Gn.angle)}return{}}function Yo(l,f,c,d,b){var w=Ai(l.add(l.sub(f)._unit()),b).point,T=c.sub(w);return c.add(T._mult(d/T.mag()))}function Yi(l,f,c,d,b,w,T,R,z,j,ne,ae){var oe=d?l-f:l+f,Se=oe>0?1:-1,Me=0;d&&(Se*=-1,Me=Math.PI),Se<0&&(Me+=Math.PI);for(var Ve=Se>0?R+T:R+T+1,be=b,ze=b,Xe=0,ut=0,Ut=Math.abs(oe),Ot=[];Xe+ut<=Ut;){if((Ve+=Se)<R||Ve>=z)return null;if(ze=be,Ot.push(be),(be=ae[Ve])===void 0){var Zt=new m.Point(j.getx(Ve),j.gety(Ve)),lr=Ai(Zt,ne);if(lr.signedDistanceFromCamera>0)be=ae[Ve]=lr.point;else{var Or=Ve-Se;be=Yo(Xe===0?w:new m.Point(j.getx(Or),j.gety(Or)),Zt,ze,Ut-Xe+1,ne)}}Xe+=ut,ut=ze.dist(be)}var Pr=(Ut-Xe)/ut,$r=be.sub(ze),Ln=$r.mult(Pr)._add(ze);Ln._add($r._unit()._perp()._mult(c*Se));var Fn=Me+Math.atan2(be.y-ze.y,be.x-ze.x);return Ot.push(Ln),{point:Ln,angle:Fn,path:Ot}}jt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},jt.prototype.insert=function(l,f,c,d,b){this._forEachCell(f,c,d,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(b)},jt.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},jt.prototype._insertBoxCell=function(l,f,c,d,b,w){this.boxCells[b].push(w)},jt.prototype._insertCircleCell=function(l,f,c,d,b,w){this.circleCells[b].push(w)},jt.prototype._query=function(l,f,c,d,b,w){if(c<0||l>this.width||d<0||f>this.height)return!b&&[];var T=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(b)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var z=0;z<this.circleKeys.length;z++){var j=this.circles[3*z],ne=this.circles[3*z+1],ae=this.circles[3*z+2];T.push({key:this.circleKeys[z],x1:j-ae,y1:ne-ae,x2:j+ae,y2:ne+ae})}return w?T.filter(w):T}return this._forEachCell(l,f,c,d,this._queryCell,T,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?T.length>0:T},jt.prototype._queryCircle=function(l,f,c,d,b){var w=l-c,T=l+c,R=f-c,z=f+c;if(T<0||w>this.width||z<0||R>this.height)return!d&&[];var j=[];return this._forEachCell(w,R,T,z,this._queryCellCircle,j,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),d?j.length>0:j},jt.prototype.query=function(l,f,c,d,b){return this._query(l,f,c,d,!1,b)},jt.prototype.hitTest=function(l,f,c,d,b){return this._query(l,f,c,d,!0,b)},jt.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},jt.prototype._queryCell=function(l,f,c,d,b,w,T,R){var z=T.seenUids,j=this.boxCells[b];if(j!==null)for(var ne=this.bboxes,ae=0,oe=j;ae<oe.length;ae+=1){var Se=oe[ae];if(!z.box[Se]){z.box[Se]=!0;var Me=4*Se;if(l<=ne[Me+2]&&f<=ne[Me+3]&&c>=ne[Me+0]&&d>=ne[Me+1]&&(!R||R(this.boxKeys[Se]))){if(T.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Se],x1:ne[Me],y1:ne[Me+1],x2:ne[Me+2],y2:ne[Me+3]})}}}var Ve=this.circleCells[b];if(Ve!==null)for(var be=this.circles,ze=0,Xe=Ve;ze<Xe.length;ze+=1){var ut=Xe[ze];if(!z.circle[ut]){z.circle[ut]=!0;var Ut=3*ut;if(this._circleAndRectCollide(be[Ut],be[Ut+1],be[Ut+2],l,f,c,d)&&(!R||R(this.circleKeys[ut]))){if(T.hitTest)return w.push(!0),!0;var Ot=be[Ut],Zt=be[Ut+1],lr=be[Ut+2];w.push({key:this.circleKeys[ut],x1:Ot-lr,y1:Zt-lr,x2:Ot+lr,y2:Zt+lr})}}}},jt.prototype._queryCellCircle=function(l,f,c,d,b,w,T,R){var z=T.circle,j=T.seenUids,ne=this.boxCells[b];if(ne!==null)for(var ae=this.bboxes,oe=0,Se=ne;oe<Se.length;oe+=1){var Me=Se[oe];if(!j.box[Me]){j.box[Me]=!0;var Ve=4*Me;if(this._circleAndRectCollide(z.x,z.y,z.radius,ae[Ve+0],ae[Ve+1],ae[Ve+2],ae[Ve+3])&&(!R||R(this.boxKeys[Me])))return w.push(!0),!0}}var be=this.circleCells[b];if(be!==null)for(var ze=this.circles,Xe=0,ut=be;Xe<ut.length;Xe+=1){var Ut=ut[Xe];if(!j.circle[Ut]){j.circle[Ut]=!0;var Ot=3*Ut;if(this._circlesCollide(ze[Ot],ze[Ot+1],ze[Ot+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[Ut])))return w.push(!0),!0}}},jt.prototype._forEachCell=function(l,f,c,d,b,w,T,R){for(var z=this._convertToXCellCoord(l),j=this._convertToYCellCoord(f),ne=this._convertToXCellCoord(c),ae=this._convertToYCellCoord(d),oe=z;oe<=ne;oe++)for(var Se=j;Se<=ae;Se++)if(b.call(this,l,f,c,d,this.xCellCount*Se+oe,w,T,R))return},jt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},jt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},jt.prototype._circlesCollide=function(l,f,c,d,b,w){var T=d-l,R=b-f,z=c+w;return z*z>T*T+R*R},jt.prototype._circleAndRectCollide=function(l,f,c,d,b,w,T){var R=(w-d)/2,z=Math.abs(l-(d+R));if(z>R+c)return!1;var j=(T-b)/2,ne=Math.abs(f-(b+j));if(ne>j+c)return!1;if(z<=R||ne<=j)return!0;var ae=z-R,oe=ne-j;return ae*ae+oe*oe<=c*c};var fu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Na(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(fu,3*d)}}function Ta(l,f,c){var d=f[0],b=f[1];return l[0]=c[0]*d+c[4]*b+c[12],l[1]=c[1]*d+c[5]*b+c[13],l[3]=c[3]*d+c[7]*b+c[15],l}var Ga=function(l,f,c){f===void 0&&(f=new jt(l.width+200,l.height+200,25)),c===void 0&&(c=new jt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ta(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ga.prototype.placeCollisionBox=function(l,f,c,d,b){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),T=c*w.perspectiveRatio,R=l.x1*T+w.point.x,z=l.y1*T+w.point.y,j=l.x2*T+w.point.x,ne=l.y2*T+w.point.y;return!this.isInsideGrid(R,z,j,ne)||!f&&this.grid.hitTest(R,z,j,ne,b)?{box:[],offscreen:!1}:{box:[R,z,j,ne],offscreen:this.isOffscreen(R,z,j,ne)}},Ga.prototype.placeCollisionCircles=function(l,f,c,d,b,w,T,R,z,j,ne,ae,oe){var Se=[],Me=new m.Point(f.anchorX,f.anchorY),Ve=Ai(Me,w),be=Fi(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),ze=(j?b/be:b*be)/m.ONE_EM,Xe=Ai(Me,T).point,ut=Dt(ze,d,f.lineOffsetX*ze,f.lineOffsetY*ze,!1,Xe,Me,f,c,T,{}),Ut=!1,Ot=!1,Zt=!0;if(ut){for(var lr=.5*ae*be+oe,Or=new m.Point(-100,-100),Pr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),$r=new _t,Ln=ut.first,Fn=ut.last,zn=[],ui=Ln.path.length-1;ui>=1;ui--)zn.push(Ln.path[ui]);for(var rn=1;rn<Fn.path.length;rn++)zn.push(Fn.path[rn]);var ti=2.5*lr;if(R){var ai=zn.map(function(Ks){return Ai(Ks,R)});zn=ai.some(function(Ks){return Ks.signedDistanceFromCamera<=0})?[]:ai.map(function(Ks){return Ks.point})}var $n=[];if(zn.length>0){for(var Gn=zn[0].clone(),fi=zn[0].clone(),Xn=1;Xn<zn.length;Xn++)Gn.x=Math.min(Gn.x,zn[Xn].x),Gn.y=Math.min(Gn.y,zn[Xn].y),fi.x=Math.max(fi.x,zn[Xn].x),fi.y=Math.max(fi.y,zn[Xn].y);$n=Gn.x>=Or.x&&fi.x<=Pr.x&&Gn.y>=Or.y&&fi.y<=Pr.y?[zn]:fi.x<Or.x||Gn.x>Pr.x||fi.y<Or.y||Gn.y>Pr.y?[]:m.clipLine([zn],Or.x,Or.y,Pr.x,Pr.y)}for(var Zn=0,xa=$n;Zn<xa.length;Zn+=1){var Xa;$r.reset(xa[Zn],.25*lr),Xa=$r.length<=.5*lr?1:Math.ceil($r.paddedLength/ti)+1;for(var No=0;No<Xa;No++){var So=No/Math.max(Xa-1,1),Ua=$r.lerp(So),to=Ua.x+100,xs=Ua.y+100;Se.push(to,xs,lr,0);var is=to-lr,ku=xs-lr,as=to+lr,qs=xs+lr;if(Zt=Zt&&this.isOffscreen(is,ku,as,qs),Ot=Ot||this.isInsideGrid(is,ku,as,qs),!l&&this.grid.hitTestCircle(to,xs,lr,ne)&&(Ut=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ut}}}}return{circles:!z&&Ut||!Ot?[]:Se,offscreen:Zt,collisionDetected:Ut}},Ga.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,b=-1/0,w=-1/0,T=0,R=l;T<R.length;T+=1){var z=R[T],j=new m.Point(z.x+100,z.y+100);c=Math.min(c,j.x),d=Math.min(d,j.y),b=Math.max(b,j.x),w=Math.max(w,j.y),f.push(j)}for(var ne={},ae={},oe=0,Se=this.grid.query(c,d,b,w).concat(this.ignoredGrid.query(c,d,b,w));oe<Se.length;oe+=1){var Me=Se[oe],Ve=Me.key;if(ne[Ve.bucketInstanceId]===void 0&&(ne[Ve.bucketInstanceId]={}),!ne[Ve.bucketInstanceId][Ve.featureIndex]){var be=[new m.Point(Me.x1,Me.y1),new m.Point(Me.x2,Me.y1),new m.Point(Me.x2,Me.y2),new m.Point(Me.x1,Me.y2)];m.polygonIntersectsPolygon(f,be)&&(ne[Ve.bucketInstanceId][Ve.featureIndex]=!0,ae[Ve.bucketInstanceId]===void 0&&(ae[Ve.bucketInstanceId]=[]),ae[Ve.bucketInstanceId].push(Ve.featureIndex))}}return ae},Ga.prototype.insertCollisionBox=function(l,f,c,d,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:b},l[0],l[1],l[2],l[3])},Ga.prototype.insertCollisionCircles=function(l,f,c,d,b){for(var w=f?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:d,collisionGroupID:b},R=0;R<l.length;R+=4)w.insertCircle(T,l[R],l[R+1],l[R+2])},Ga.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return Ta(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ga.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Ga.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Ga.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var xo=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};xo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Zo=function(l,f,c,d,b){this.text=new xo(l?l.text:null,f,c,b),this.icon=new xo(l?l.icon:null,f,d,b)};Zo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var wu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},lo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},ko=function(l,f,c,d,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=b},ra=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ha(l,f,c,d,b){var w=m.getAnchorAlignment(l),T=-(w.horizontalAlign-.5)*f,R=-(w.verticalAlign-.5)*c,z=m.evaluateVariableOffset(l,d);return new m.Point(T+z[0]*b,R+z[1]*b)}function Do(l,f,c,d,b,w){var T=l.x1,R=l.x2,z=l.y1,j=l.y2,ne=l.anchorPointX,ae=l.anchorPointY,oe=new m.Point(f,c);return d&&oe._rotate(b?w:-w),{x1:T+oe.x,y1:z+oe.y,x2:R+oe.x,y2:j+oe.y,anchorPointX:ne,anchorPointY:ae}}ra.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Wa=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new Ga(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ra(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function As(l,f,c,d,b){l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0)}Wa.prototype.getBucketParts=function(l,f,c,d){var b=c.getBucket(f),w=c.latestFeatureIndex;if(b&&w&&f.id===b.layerIds[0]){var T=c.collisionBoxArray,R=b.layers[0].layout,z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),j=c.tileSize/m.EXTENT,ne=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ae=R.get("text-pitch-alignment")==="map",oe=R.get("text-rotation-alignment")==="map",Se=ta(c,1,this.transform.zoom),Me=Aa(ne,ae,oe,this.transform,Se),Ve=null;if(ae){var be=xi(ne,ae,oe,this.transform,Se);Ve=m.multiply([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[b.bucketInstanceId]=new ko(b.bucketInstanceId,w,b.sourceLayerIndex,b.index,c.tileID);var ze={bucket:b,layout:R,posMatrix:ne,textLabelPlaneMatrix:Me,labelToScreenMatrix:Ve,scale:z,textPixelRatio:j,holdingForFade:c.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(d)for(var Xe=0,ut=b.sortKeyRanges;Xe<ut.length;Xe+=1){var Ut=ut[Xe];l.push({sortKey:Ut.sortKey,symbolInstanceStart:Ut.symbolInstanceStart,symbolInstanceEnd:Ut.symbolInstanceEnd,parameters:ze})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ze})}},Wa.prototype.attemptAnchorPlacement=function(l,f,c,d,b,w,T,R,z,j,ne,ae,oe,Se,Me){var Ve,be=[ae.textOffset0,ae.textOffset1],ze=Ha(l,c,d,be,b),Xe=this.collisionIndex.placeCollisionBox(Do(f,ze.x,ze.y,w,T,this.transform.angle),ne,R,z,j.predicate);if(!Me||this.collisionIndex.placeCollisionBox(Do(Me,ze.x,ze.y,w,T,this.transform.angle),ne,R,z,j.predicate).box.length!==0)return Xe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ae.crossTileID]&&this.prevPlacement.placements[ae.crossTileID]&&this.prevPlacement.placements[ae.crossTileID].text&&(Ve=this.prevPlacement.variableOffsets[ae.crossTileID].anchor),this.variableOffsets[ae.crossTileID]={textOffset:be,width:c,height:d,anchor:l,textBoxScale:b,prevAnchor:Ve},this.markUsedJustification(oe,l,ae,Se),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,Se,ae),this.placedOrientations[ae.crossTileID]=Se),{shift:ze,placedGlyphBoxes:Xe}):void 0},Wa.prototype.placeLayerBucketPart=function(l,f,c){var d=this,b=l.parameters,w=b.bucket,T=b.layout,R=b.posMatrix,z=b.textLabelPlaneMatrix,j=b.labelToScreenMatrix,ne=b.textPixelRatio,ae=b.holdingForFade,oe=b.collisionBoxArray,Se=b.partiallyEvaluatedTextSize,Me=b.collisionGroup,Ve=T.get("text-optional"),be=T.get("icon-optional"),ze=T.get("text-allow-overlap"),Xe=T.get("icon-allow-overlap"),ut=T.get("text-rotation-alignment")==="map",Ut=T.get("text-pitch-alignment")==="map",Ot=T.get("icon-text-fit")!=="none",Zt=T.get("symbol-z-order")==="viewport-y",lr=ze&&(Xe||!w.hasIconData()||be),Or=Xe&&(ze||!w.hasTextData()||Ve);!w.collisionArrays&&oe&&w.deserializeCollisionBoxes(oe);var Pr=function(rn,ti){if(!f[rn.crossTileID])if(ae)d.placements[rn.crossTileID]=new wu(!1,!1,!1);else{var ai,$n=!1,Gn=!1,fi=!0,Xn=null,Zn={box:null,offscreen:null},xa={box:null,offscreen:null},Xa=null,No=null,So=0,Ua=0,to=0;ti.textFeatureIndex?So=ti.textFeatureIndex:rn.useRuntimeCollisionCircles&&(So=rn.featureIndex),ti.verticalTextFeatureIndex&&(Ua=ti.verticalTextFeatureIndex);var xs=ti.textBox;if(xs){var is=function(Xi){var zs=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Xi&&d.prevPlacement){var os=d.prevPlacement.placedOrientations[rn.crossTileID];os&&(d.placedOrientations[rn.crossTileID]=os,d.markUsedOrientation(w,zs=os,rn))}return zs},ku=function(Xi,zs){if(w.allowVerticalPlacement&&rn.numVerticalGlyphVertices>0&&ti.verticalTextBox)for(var os=0,Ku=w.writingModes;os<Ku.length&&(Ku[os]===m.WritingMode.vertical?(Zn=zs(),xa=Zn):Zn=Xi(),!(Zn&&Zn.box&&Zn.box.length));os+=1);else Zn=Xi()};if(T.get("text-variable-anchor")){var as=T.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[rn.crossTileID]){var qs=d.prevPlacement.variableOffsets[rn.crossTileID];as.indexOf(qs.anchor)>0&&(as=as.filter(function(Xi){return Xi!==qs.anchor})).unshift(qs.anchor)}var Ks=function(Xi,zs,os){for(var Ku=Xi.x2-Xi.x1,Bc=Xi.y2-Xi.y1,zc=rn.textBoxScale,vf=Ot&&!Xe?zs:null,Ko={box:[],offscreen:!1},pc=ze?2*as.length:as.length,su=0;su<pc;++su){var ml=d.attemptAnchorPlacement(as[su%as.length],Xi,Ku,Bc,zc,ut,Ut,ne,R,Me,su>=as.length,rn,w,os,vf);if(ml&&(Ko=ml.placedGlyphBoxes)&&Ko.box&&Ko.box.length){$n=!0,Xn=ml.shift;break}}return Ko};ku(function(){return Ks(xs,ti.iconBox,m.WritingMode.horizontal)},function(){var Xi=ti.verticalTextBox;return w.allowVerticalPlacement&&!(Zn&&Zn.box&&Zn.box.length)&&rn.numVerticalGlyphVertices>0&&Xi?Ks(Xi,ti.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Zn&&($n=Zn.box,fi=Zn.offscreen);var fc=is(Zn&&Zn.box);if(!$n&&d.prevPlacement){var Bl=d.prevPlacement.variableOffsets[rn.crossTileID];Bl&&(d.variableOffsets[rn.crossTileID]=Bl,d.markUsedJustification(w,Bl.anchor,rn,fc))}}else{var mu=function(Xi,zs){var os=d.collisionIndex.placeCollisionBox(Xi,ze,ne,R,Me.predicate);return os&&os.box&&os.box.length&&(d.markUsedOrientation(w,zs,rn),d.placedOrientations[rn.crossTileID]=zs),os};ku(function(){return mu(xs,m.WritingMode.horizontal)},function(){var Xi=ti.verticalTextBox;return w.allowVerticalPlacement&&rn.numVerticalGlyphVertices>0&&Xi?mu(Xi,m.WritingMode.vertical):{box:null,offscreen:null}}),is(Zn&&Zn.box&&Zn.box.length)}}if($n=(ai=Zn)&&ai.box&&ai.box.length>0,fi=ai&&ai.offscreen,rn.useRuntimeCollisionCircles){var vl=w.text.placedSymbolArray.get(rn.centerJustifiedTextSymbolIndex),hc=m.evaluateSizeForFeature(w.textSizeData,Se,vl),ou=T.get("text-padding");Xa=d.collisionIndex.placeCollisionCircles(ze,vl,w.lineVertexArray,w.glyphOffsetArray,hc,R,z,j,c,Ut,Me.predicate,rn.collisionCircleDiameter,ou),$n=ze||Xa.circles.length>0&&!Xa.collisionDetected,fi=fi&&Xa.offscreen}if(ti.iconFeatureIndex&&(to=ti.iconFeatureIndex),ti.iconBox){var zl=function(Xi){var zs=Ot&&Xn?Do(Xi,Xn.x,Xn.y,ut,Ut,d.transform.angle):Xi;return d.collisionIndex.placeCollisionBox(zs,Xe,ne,R,Me.predicate)};Gn=xa&&xa.box&&xa.box.length&&ti.verticalIconBox?(No=zl(ti.verticalIconBox)).box.length>0:(No=zl(ti.iconBox)).box.length>0,fi=fi&&No.offscreen}var gu=Ve||rn.numHorizontalGlyphVertices===0&&rn.numVerticalGlyphVertices===0,go=be||rn.numIconVertices===0;if(gu||go?go?gu||(Gn=Gn&&$n):$n=Gn&&$n:Gn=$n=Gn&&$n,$n&&ai&&ai.box&&d.collisionIndex.insertCollisionBox(ai.box,T.get("text-ignore-placement"),w.bucketInstanceId,xa&&xa.box&&Ua?Ua:So,Me.ID),Gn&&No&&d.collisionIndex.insertCollisionBox(No.box,T.get("icon-ignore-placement"),w.bucketInstanceId,to,Me.ID),Xa&&($n&&d.collisionIndex.insertCollisionCircles(Xa.circles,T.get("text-ignore-placement"),w.bucketInstanceId,So,Me.ID),c)){var yu=w.bucketInstanceId,qu=d.collisionCircleArrays[yu];qu===void 0&&(qu=d.collisionCircleArrays[yu]=new lo);for(var Du=0;Du<Xa.circles.length;Du+=4)qu.circles.push(Xa.circles[Du+0]),qu.circles.push(Xa.circles[Du+1]),qu.circles.push(Xa.circles[Du+2]),qu.circles.push(Xa.collisionDetected?1:0)}d.placements[rn.crossTileID]=new wu($n||lr,Gn||Or,fi||w.justReloaded),f[rn.crossTileID]=!0}};if(Zt)for(var $r=w.getSortedSymbolIndexes(this.transform.angle),Ln=$r.length-1;Ln>=0;--Ln){var Fn=$r[Ln];Pr(w.symbolInstances.get(Fn),w.collisionArrays[Fn])}else for(var zn=l.symbolInstanceStart;zn<l.symbolInstanceEnd;zn++)Pr(w.symbolInstances.get(zn),w.collisionArrays[zn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var ui=this.collisionCircleArrays[w.bucketInstanceId];m.invert(ui.invProjMatrix,R),ui.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Wa.prototype.markUsedJustification=function(l,f,c,d){var b;b=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<T.length;w+=1){var R=T[w];R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:c.crossTileID)}},Wa.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,b=f===m.WritingMode.vertical?f:0,w=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<T.length;w+=1)l.text.placedSymbolArray.get(T[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},Wa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},w=f?f.variableOffsets:{},T=f?f.placedOrientations:{};for(var R in this.placements){var z=this.placements[R],j=b[R];j?(this.opacities[R]=new Zo(j,d,z.text,z.icon),c=c||z.text!==j.text.placed||z.icon!==j.icon.placed):(this.opacities[R]=new Zo(null,d,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(var ne in b){var ae=b[ne];if(!this.opacities[ne]){var oe=new Zo(ae,d,!1,!1);oe.isHidden()||(this.opacities[ne]=oe,c=c||ae.text.placed||ae.icon.placed)}}for(var Se in w)this.variableOffsets[Se]||!this.opacities[Se]||this.opacities[Se].isHidden()||(this.variableOffsets[Se]=w[Se]);for(var Me in T)this.placedOrientations[Me]||!this.opacities[Me]||this.opacities[Me].isHidden()||(this.placedOrientations[Me]=T[Me]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Wa.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,b=f;d<b.length;d+=1){var w=b[d],T=w.getBucket(l);T&&w.latestFeatureIndex&&l.id===T.layerIds[0]&&this.updateBucketOpacities(T,c,w.collisionBoxArray)}},Wa.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,w=new Zo(null,0,!1,!1,!0),T=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),z=b.get("text-variable-anchor"),j=b.get("text-rotation-alignment")==="map",ne=b.get("text-pitch-alignment")==="map",ae=b.get("icon-text-fit")!=="none",oe=new Zo(null,0,T&&(R||!l.hasIconData()||b.get("icon-optional")),R&&(T||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Se=function(ze,Xe,ut){for(var Ut=0;Ut<Xe/4;Ut++)ze.opacityVertexArray.emplaceBack(ut)},Me=function(ze){var Xe=l.symbolInstances.get(ze),ut=Xe.numHorizontalGlyphVertices,Ut=Xe.numVerticalGlyphVertices,Ot=Xe.crossTileID,Zt=d.opacities[Ot];f[Ot]?Zt=w:Zt||(d.opacities[Ot]=Zt=oe),f[Ot]=!0;var lr=Xe.numIconVertices>0,Or=d.placedOrientations[Xe.crossTileID],Pr=Or===m.WritingMode.vertical,$r=Or===m.WritingMode.horizontal||Or===m.WritingMode.horizontalOnly;if(ut>0||Ut>0){var Ln=Cn(Zt.text);Se(l.text,ut,Pr?Ti:Ln),Se(l.text,Ut,$r?Ti:Ln);var Fn=Zt.text.isHidden();[Xe.rightJustifiedTextSymbolIndex,Xe.centerJustifiedTextSymbolIndex,Xe.leftJustifiedTextSymbolIndex].forEach(function(Zn){Zn>=0&&(l.text.placedSymbolArray.get(Zn).hidden=Fn||Pr?1:0)}),Xe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Xe.verticalPlacedTextSymbolIndex).hidden=Fn||$r?1:0);var zn=d.variableOffsets[Xe.crossTileID];zn&&d.markUsedJustification(l,zn.anchor,Xe,Or);var ui=d.placedOrientations[Xe.crossTileID];ui&&(d.markUsedJustification(l,"left",Xe,ui),d.markUsedOrientation(l,ui,Xe))}if(lr){var rn=Cn(Zt.icon),ti=!(ae&&Xe.verticalPlacedIconSymbolIndex&&Pr);Xe.placedIconSymbolIndex>=0&&(Se(l.icon,Xe.numIconVertices,ti?rn:Ti),l.icon.placedSymbolArray.get(Xe.placedIconSymbolIndex).hidden=Zt.icon.isHidden()),Xe.verticalPlacedIconSymbolIndex>=0&&(Se(l.icon,Xe.numVerticalIconVertices,ti?Ti:rn),l.icon.placedSymbolArray.get(Xe.verticalPlacedIconSymbolIndex).hidden=Zt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ai=l.collisionArrays[ze];if(ai){var $n=new m.Point(0,0);if(ai.textBox||ai.verticalTextBox){var Gn=!0;if(z){var fi=d.variableOffsets[Ot];fi?($n=Ha(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textBoxScale),j&&$n._rotate(ne?d.transform.angle:-d.transform.angle)):Gn=!1}ai.textBox&&As(l.textCollisionBox.collisionVertexArray,Zt.text.placed,!Gn||Pr,$n.x,$n.y),ai.verticalTextBox&&As(l.textCollisionBox.collisionVertexArray,Zt.text.placed,!Gn||$r,$n.x,$n.y)}var Xn=Boolean(!$r&&ai.verticalIconBox);ai.iconBox&&As(l.iconCollisionBox.collisionVertexArray,Zt.icon.placed,Xn,ae?$n.x:0,ae?$n.y:0),ai.verticalIconBox&&As(l.iconCollisionBox.collisionVertexArray,Zt.icon.placed,!Xn,ae?$n.x:0,ae?$n.y:0)}}},Ve=0;Ve<l.symbolInstances.length;Ve++)Me(Ve);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var be=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=be.invProjMatrix,l.placementViewportMatrix=be.viewportMatrix,l.collisionCircleArray=be.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Wa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Wa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Wa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Wa.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Wa.prototype.setStale=function(){this.stale=!0};var Sl=Math.pow(2,25),hs=Math.pow(2,24),K=Math.pow(2,17),ve=Math.pow(2,16),He=Math.pow(2,9),wt=Math.pow(2,8),Mr=Math.pow(2,1);function Cn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Sl+f*hs+c*K+f*ve+c*He+f*wt+c*Mr+f}var Ti=0,eo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};eo.prototype.continuePlacement=function(l,f,c,d,b){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var ka=function(l,f,c,d,b,w,T){this.placement=new Wa(l,b,w,T),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};ka.prototype.isDone=function(){return this._done},ka.prototype.continuePlacement=function(l,f,c){for(var d=this,b=m.browser.now(),w=function(){var z=m.browser.now()-b;return!d._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var T=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new eo(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},ka.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ba=512/m.EXTENT/2,Vo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var b=f.get(d),w=b.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};Vo.prototype.getScaledCoordinates=function(l,f){var c=Ba/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},Vo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var w=l.get(b);if(!w.crossTileID){var T=this.indexedSymbolInstances[w.key];if(T)for(var R=this.getScaledCoordinates(w,f),z=0,j=T;z<j.length;z+=1){var ne=j[z];if(Math.abs(ne.coord.x-R.x)<=d&&Math.abs(ne.coord.y-R.y)<=d&&!c[ne.crossTileID]){c[ne.crossTileID]=!0,w.crossTileID=ne.crossTileID;break}}}}};var ps=function(){this.maxCrossTileID=0};ps.prototype.generate=function(){return++this.maxCrossTileID};var io=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};io.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],b={};for(var w in d){var T=d[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),b[T.tileID.key]=T}this.indexes[c]=b}this.lng=l},io.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var T=this.indexes[w];if(Number(w)>l.overscaledZ)for(var R in T){var z=T[R];z.tileID.isChildOf(l)&&z.findMatches(f.symbolInstances,l,b)}else{var j=T[l.scaledTo(Number(w)).key];j&&j.findMatches(f.symbolInstances,l,b)}}for(var ne=0;ne<f.symbolInstances.length;ne++){var ae=f.symbolInstances.get(ne);ae.crossTileID||(ae.crossTileID=c.generate(),b[ae.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Vo(l,f.symbolInstances,f.bucketInstanceId),!0},io.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,b=f.indexedSymbolInstances[c];d<b.length;d+=1)delete this.usedCrossTileIDs[l][b[d].crossTileID]},io.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var b in d)l[d[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[b]),delete d[b],f=!0)}return f};var bo=function(){this.layerIndexes={},this.crossTileIDs=new ps,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};bo.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new io);var b=!1,w={};d.handleWrapJump(c);for(var T=0,R=f;T<R.length;T+=1){var z=R[T],j=z.getBucket(l);j&&l.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(z.tileID,j,this.crossTileIDs)&&(b=!0),w[j.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(b=!0),b},bo.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ds=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Ts=m.pick(jr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ds=m.pick(jr,["setCenter","setZoom","setBearing","setPitch"]),eu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,b=m.styleSpec.$root[c];b.required&&(d=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),vs=function(l){function f(c,d){var b=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Xt(Et(),this),this.imageManager=new Mt,this.imageManager.setEventedParent(this),this.glyphManager=new Wt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Ke(256,512),this.crossTileSymbolIndex=new bo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(T){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,z){if(m.triggerPluginCompletionEvent(R),z&&z.every(function(ne){return ne}))for(var j in w.sourceCaches)w.sourceCaches[j].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=b.sourceCaches[T.sourceId];if(R){var z=R.getSource();if(z&&z.vectorLayerIds)for(var j in b._layers){var ne=b._layers[j];ne.source===z.id&&b._validateLayer(ne)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var T=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(T,function(R,z){b._request=null,R?b.fire(new m.ErrorEvent(R)):z&&b._load(z,w)})},f.prototype.loadJSON=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){b._request=null,b._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(eu,!1)},f.prototype._load=function(c,d){if(!d||!ds(this,m.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Dr(this.stylesheet.layers);this._order=w.map(function(j){return j.id}),this._layers={},this._serializedLayers={};for(var T=0,R=w;T<R.length;T+=1){var z=R[T];(z=m.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new bt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(b,w,T){var R,z,j,ne=m.browser.devicePixelRatio>1?"@2x":"",ae=m.getJSON(w.transformRequest(w.normalizeSpriteURL(b,ne,".json"),m.ResourceType.SpriteJSON),function(Me,Ve){ae=null,j||(j=Me,R=Ve,Se())}),oe=m.getImage(w.transformRequest(w.normalizeSpriteURL(b,ne,".png"),m.ResourceType.SpriteImage),function(Me,Ve){oe=null,j||(j=Me,z=Ve,Se())});function Se(){if(j)T(j);else if(R&&z){var Me=m.browser.getImageData(z),Ve={};for(var be in R){var ze=R[be],Xe=ze.width,ut=ze.height,Ut=ze.x,Ot=ze.y,Zt=ze.sdf,lr=ze.pixelRatio,Or=ze.stretchX,Pr=ze.stretchY,$r=ze.content,Ln=new m.RGBAImage({width:Xe,height:ut});m.RGBAImage.copy(Me,Ln,{x:Ut,y:Ot},{x:0,y:0},{width:Xe,height:ut}),Ve[be]={data:Ln,pixelRatio:lr,sdf:Zt,stretchX:Or,stretchY:Pr,content:$r}}T(null,Ve)}}return{cancel:function(){ae&&(ae.cancel(),ae=null),oe&&(oe.cancel(),oe=null)}}}(c,this.map._requestManager,function(b,w){if(d._spriteRequest=null,b)d.fire(new m.ErrorEvent(b));else if(w)for(var T in w)d.imageManager.addImage(T,w[T]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var b=c.sourceLayer;if(b){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(b)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],b=0,w=c;b<w.length;b+=1){var T=this._layers[w[b]];T.type!=="custom"&&d.push(T.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var T in(b.length||w.length)&&this._updateWorkerLayers(b,w),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var j={};for(var ne in this.sourceCaches){var ae=this.sourceCaches[ne];j[ne]=ae.used,ae.used=!1}for(var oe=0,Se=this._order;oe<Se.length;oe+=1){var Me=this._layers[Se[oe]];Me.recalculate(c,this._availableImages),!Me.isHidden(c.zoom)&&Me.source&&(this.sourceCaches[Me.source].used=!0)}for(var Ve in j){var be=this.sourceCaches[Ve];j[Ve]!==be.used&&be.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ve}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ds(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Dr(c.layers);var b=function(T,R){if(!T)return[{command:jr.setStyle,args:[R]}];var z=[];try{if(!m.deepEqual(T.version,R.version))return[{command:jr.setStyle,args:[R]}];m.deepEqual(T.center,R.center)||z.push({command:jr.setCenter,args:[R.center]}),m.deepEqual(T.zoom,R.zoom)||z.push({command:jr.setZoom,args:[R.zoom]}),m.deepEqual(T.bearing,R.bearing)||z.push({command:jr.setBearing,args:[R.bearing]}),m.deepEqual(T.pitch,R.pitch)||z.push({command:jr.setPitch,args:[R.pitch]}),m.deepEqual(T.sprite,R.sprite)||z.push({command:jr.setSprite,args:[R.sprite]}),m.deepEqual(T.glyphs,R.glyphs)||z.push({command:jr.setGlyphs,args:[R.glyphs]}),m.deepEqual(T.transition,R.transition)||z.push({command:jr.setTransition,args:[R.transition]}),m.deepEqual(T.light,R.light)||z.push({command:jr.setLight,args:[R.light]});var j={},ne=[];(function(oe,Se,Me,Ve){var be;for(be in Se=Se||{},oe=oe||{})oe.hasOwnProperty(be)&&(Se.hasOwnProperty(be)||Kr(be,Me,Ve));for(be in Se)Se.hasOwnProperty(be)&&(oe.hasOwnProperty(be)?m.deepEqual(oe[be],Se[be])||(oe[be].type==="geojson"&&Se[be].type==="geojson"&&Vi(oe,Se,be)?Me.push({command:jr.setGeoJSONSourceData,args:[be,Se[be].data]}):Pn(be,Se,Me,Ve)):ci(be,Se,Me))})(T.sources,R.sources,ne,j);var ae=[];T.layers&&T.layers.forEach(function(oe){j[oe.source]?z.push({command:jr.removeLayer,args:[oe.id]}):ae.push(oe)}),z=z.concat(ne),function(oe,Se,Me){Se=Se||[];var Ve,be,ze,Xe,ut,Ut,Ot,Zt=(oe=oe||[]).map(Ci),lr=Se.map(Ci),Or=oe.reduce(gi,{}),Pr=Se.reduce(gi,{}),$r=Zt.slice(),Ln=Object.create(null);for(Ve=0,be=0;Ve<Zt.length;Ve++)Pr.hasOwnProperty(ze=Zt[Ve])?be++:(Me.push({command:jr.removeLayer,args:[ze]}),$r.splice($r.indexOf(ze,be),1));for(Ve=0,be=0;Ve<lr.length;Ve++)$r[$r.length-1-Ve]!==(ze=lr[lr.length-1-Ve])&&(Or.hasOwnProperty(ze)?(Me.push({command:jr.removeLayer,args:[ze]}),$r.splice($r.lastIndexOf(ze,$r.length-be),1)):be++,Me.push({command:jr.addLayer,args:[Pr[ze],Ut=$r[$r.length-Ve]]}),$r.splice($r.length-Ve,0,ze),Ln[ze]=!0);for(Ve=0;Ve<lr.length;Ve++)if(Xe=Or[ze=lr[Ve]],ut=Pr[ze],!Ln[ze]&&!m.deepEqual(Xe,ut))if(m.deepEqual(Xe.source,ut.source)&&m.deepEqual(Xe["source-layer"],ut["source-layer"])&&m.deepEqual(Xe.type,ut.type)){for(Ot in si(Xe.layout,ut.layout,Me,ze,null,jr.setLayoutProperty),si(Xe.paint,ut.paint,Me,ze,null,jr.setPaintProperty),m.deepEqual(Xe.filter,ut.filter)||Me.push({command:jr.setFilter,args:[ze,ut.filter]}),m.deepEqual(Xe.minzoom,ut.minzoom)&&m.deepEqual(Xe.maxzoom,ut.maxzoom)||Me.push({command:jr.setLayerZoomRange,args:[ze,ut.minzoom,ut.maxzoom]}),Xe)Xe.hasOwnProperty(Ot)&&Ot!=="layout"&&Ot!=="paint"&&Ot!=="filter"&&Ot!=="metadata"&&Ot!=="minzoom"&&Ot!=="maxzoom"&&(Ot.indexOf("paint.")===0?si(Xe[Ot],ut[Ot],Me,ze,Ot.slice(6),jr.setPaintProperty):m.deepEqual(Xe[Ot],ut[Ot])||Me.push({command:jr.setLayerProperty,args:[ze,Ot,ut[Ot]]}));for(Ot in ut)ut.hasOwnProperty(Ot)&&!Xe.hasOwnProperty(Ot)&&Ot!=="layout"&&Ot!=="paint"&&Ot!=="filter"&&Ot!=="metadata"&&Ot!=="minzoom"&&Ot!=="maxzoom"&&(Ot.indexOf("paint.")===0?si(Xe[Ot],ut[Ot],Me,ze,Ot.slice(6),jr.setPaintProperty):m.deepEqual(Xe[Ot],ut[Ot])||Me.push({command:jr.setLayerProperty,args:[ze,Ot,ut[Ot]]}))}else Me.push({command:jr.removeLayer,args:[ze]}),Ut=$r[$r.lastIndexOf(ze)+1],Me.push({command:jr.addLayer,args:[ut,Ut]})}(ae,R.layers,z)}catch(oe){console.warn("Unable to compute style diff:",oe),z=[{command:jr.setStyle,args:[R]}]}return z}(this.serialize(),c).filter(function(T){return!(T.command in Ds)});if(b.length===0)return!1;var w=b.filter(function(T){return!(T.command in Ts)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(T){return T.command}).join(", ")+".");return b.forEach(function(T){T.command!=="setTransition"&&d[T.command].apply(d,T.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,b){var w=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,b))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var T=this.sourceCaches[c]=new Oe(c,d,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:T.serialize(),sourceId:c}}),T.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var T;if(c.type==="custom"){if(ds(this,m.validateCustomStyleLayer(c)))return;T=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},b))return;T=m.createStyleLayer(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[T.id]=T.serialize()}var R=d?this._order.indexOf(d):this._order.length;if(d&&R===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(R,0,w),this._layerOrderChanged=!0,this._layers[w]=T,this._removedLayers[w]&&T.source&&T.type!=="custom"){var z=this._removedLayers[w];delete this._removedLayers[w],z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var b=this._order.indexOf(c);this._order.splice(b,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,b){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===b||(d!=null&&(w.minzoom=d),b!=null&&(w.maxzoom=b),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,b)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,b,w){w===void 0&&(w={}),this._checkLoaded();var T=this.getLayer(c);T?m.deepEqual(T.getLayoutProperty(d),b)||(T.setLayoutProperty(d,b,w),this._updateLayer(T)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var b=this.getLayer(c);if(b)return b.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,b,w){w===void 0&&(w={}),this._checkLoaded();var T=this.getLayer(c);T?m.deepEqual(T.getPaintProperty(d),b)||(T.setPaintProperty(d,b,w)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var b=c.source,w=c.sourceLayer,T=this.sourceCaches[b];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var b=c.source,w=this.sourceCaches[b];if(w!==void 0){var T=w.getSource().type,R=T==="vector"?c.sourceLayer:void 0;T!=="vector"||R?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(R,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,b=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(b,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,b=function(Or){return d._layers[Or].type==="fill-extrusion"},w={},T=[],R=this._order.length-1;R>=0;R--){var z=this._order[R];if(b(z)){w[z]=R;for(var j=0,ne=c;j<ne.length;j+=1){var ae=ne[j][z];if(ae)for(var oe=0,Se=ae;oe<Se.length;oe+=1)T.push(Se[oe])}}}T.sort(function(Or,Pr){return Pr.intersectionZ-Or.intersectionZ});for(var Me=[],Ve=this._order.length-1;Ve>=0;Ve--){var be=this._order[Ve];if(b(be))for(var ze=T.length-1;ze>=0;ze--){var Xe=T[ze].feature;if(w[Xe.layer.id]<Ve)break;Me.push(Xe),T.pop()}else for(var ut=0,Ut=c;ut<Ut.length;ut+=1){var Ot=Ut[ut][be];if(Ot)for(var Zt=0,lr=Ot;Zt<lr.length;Zt+=1)Me.push(lr[Zt].feature)}}return Me},f.prototype.queryRenderedFeatures=function(c,d,b){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=d.layers;T<R.length;T+=1){var z=R[T],j=this._layers[z];if(!j)return this.fire(new m.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];w[j.source]=!0}}var ne=[];for(var ae in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[ae]||ne.push(dn(this.sourceCaches[ae],this._layers,this._serializedLayers,c,d,b));return this.placement&&ne.push(function(oe,Se,Me,Ve,be,ze,Xe){for(var ut={},Ut=ze.queryRenderedSymbols(Ve),Ot=[],Zt=0,lr=Object.keys(Ut).map(Number);Zt<lr.length;Zt+=1)Ot.push(Xe[lr[Zt]]);Ot.sort(di);for(var Or=function(){var zn=$r[Pr],ui=zn.featureIndex.lookupSymbolFeatures(Ut[zn.bucketInstanceId],Se,zn.bucketIndex,zn.sourceLayerIndex,be.filter,be.layers,be.availableImages,oe);for(var rn in ui){var ti=ut[rn]=ut[rn]||[],ai=ui[rn];ai.sort(function(fi,Xn){var Zn=zn.featureSortOrder;if(Zn){var xa=Zn.indexOf(fi.featureIndex);return Zn.indexOf(Xn.featureIndex)-xa}return Xn.featureIndex-fi.featureIndex});for(var $n=0,Gn=ai;$n<Gn.length;$n+=1)ti.push(Gn[$n])}},Pr=0,$r=Ot;Pr<$r.length;Pr+=1)Or();var Ln=function(zn){ut[zn].forEach(function(ui){var rn=ui.feature,ti=Me[oe[zn].source].getFeatureState(rn.layer["source-layer"],rn.id);rn.source=rn.layer.source,rn.layer["source-layer"]&&(rn.sourceLayer=rn.layer["source-layer"]),rn.state=ti})};for(var Fn in ut)Ln(Fn);return ut}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ne)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var b=this.sourceCaches[c];return b?function(w,T){for(var R=w.getRenderableIds().map(function(Se){return w.getTileByID(Se)}),z=[],j={},ne=0;ne<R.length;ne++){var ae=R[ne],oe=ae.tileID.canonical.key;j[oe]||(j[oe]=!0,ae.querySourceFeatures(z,T))}return z}(b,d):[]},f.prototype.addSourceType=function(c,d,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var b=this.light.getLight(),w=!1;for(var T in c)if(!m.deepEqual(c[T],b[T])){w=!0;break}if(w){var R={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(R)}},f.prototype._validate=function(c,d,b,w,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ds(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:b,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,b,w,T){T===void 0&&(T=!1);for(var R=!1,z=!1,j={},ne=0,ae=this._order;ne<ae.length;ne+=1){var oe=this._layers[ae[ne]];if(oe.type==="symbol"){if(!j[oe.source]){var Se=this.sourceCaches[oe.source];j[oe.source]=Se.getRenderableIds(!0).map(function(Xe){return Se.getTileByID(Xe)}).sort(function(Xe,ut){return ut.tileID.overscaledZ-Xe.tileID.overscaledZ||(Xe.tileID.isLessThan(ut.tileID)?-1:1)})}var Me=this.crossTileSymbolIndex.addLayer(oe,j[oe.source],c.center.lng);R=R||Me}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new ka(c,this._order,T,d,b,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),z=!0),R&&this.pauseablePlacement.placement.setStale()),z||R)for(var Ve=0,be=this._order;Ve<be.length;Ve+=1){var ze=this._layers[be[Ve]];ze.type==="symbol"&&this.placement.updateLayerOpacities(ze,j[ze.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,b){this.imageManager.getImages(d.icons,b),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,b){this.glyphManager.getGlyphs(d.stacks,b)},f.prototype.getResource=function(c,d,b){return m.makeRequest(d,b)},f}(m.Evented);vs.getSourceType=function(l){return xr[l]},vs.setSourceType=function(l,f){xr[l]=f},vs.registerForPluginStateChange=m.registerForPluginStateChange;var da=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),ma=zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ts=zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ef=zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),wl=zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Gs=zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ql=zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),zu=zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Hs=zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),il=zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),g=zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),A=zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),D=zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),H=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),de=zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),je=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),it=zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),at=zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),er=zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ar=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),wn=zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Qn=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),On=zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ji=zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ca=zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ea=zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function zi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=w?w.concat(b):b,R={};return{fragmentSource:l=l.replace(c,function(z,j,ne,ae,oe){return R[oe]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_`+oe+`
varying `+ne+" "+ae+" "+oe+`;
#else
uniform `+ne+" "+ae+" u_"+oe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+oe+`
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`}),vertexSource:f=f.replace(c,function(z,j,ne,ae,oe){var Se=ae==="float"?"vec2":"vec4",Me=oe.match(/color/)?"color":Se;return R[oe]?j==="define"?`
#ifndef HAS_UNIFORM_u_`+oe+`
uniform lowp float u_`+oe+`_t;
attribute `+ne+" "+Se+" a_"+oe+`;
varying `+ne+" "+ae+" "+oe+`;
#else
uniform `+ne+" "+ae+" u_"+oe+`;
#endif
`:Me==="vec4"?`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+oe+" = a_"+oe+`;
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+oe+" = unpack_mix_"+Me+"(a_"+oe+", u_"+oe+`_t);
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_`+oe+`
uniform lowp float u_`+oe+`_t;
attribute `+ne+" "+Se+" a_"+oe+`;
#else
uniform `+ne+" "+ae+" u_"+oe+`;
#endif
`:Me==="vec4"?`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+ne+" "+ae+" "+oe+" = a_"+oe+`;
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+ne+" "+ae+" "+oe+" = unpack_mix_"+Me+"(a_"+oe+", u_"+oe+`_t);
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`}),staticAttributes:d,staticUniforms:T}}var ms=Object.freeze({__proto__:null,prelude:ma,background:ts,backgroundPattern:ef,circle:wl,clippingMask:Gs,heatmap:Ql,heatmapTexture:zu,collisionBox:Hs,collisionCircle:il,debug:g,fill:A,fillOutline:D,fillOutlinePattern:O,fillPattern:H,fillExtrusion:de,fillExtrusionPattern:je,hillshadePrepare:it,hillshade:at,line:er,lineGradient:ar,linePattern:wn,lineSDF:Qn,raster:On,symbolIcon:ji,symbolSDF:ca,symbolTextAndIcon:Ea}),tu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Uu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}tu.prototype.bind=function(l,f,c,d,b,w,T,R){this.context=l;for(var z=this.boundPaintVertexBuffers.length!==d.length,j=0;!z&&j<d.length;j++)this.boundPaintVertexBuffers[j]!==d[j]&&(z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!z&&this.boundIndexBuffer===b&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(l.bindVertexArrayOES.set(this.vao),T&&T.bind(),b&&b.dynamicDraw&&b.bind(),R&&R.bind()):this.freshBind(f,c,d,b,w,T,R)},tu.prototype.freshBind=function(l,f,c,d,b,w,T){var R,z=l.numAttributes,j=this.context,ne=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=T;else{R=j.currentNumAttributes||0;for(var ae=z;ae<R;ae++)ne.disableVertexAttribArray(ae)}f.enableAttributes(ne,l);for(var oe=0,Se=c;oe<Se.length;oe+=1)Se[oe].enableAttributes(ne,l);w&&w.enableAttributes(ne,l),T&&T.enableAttributes(ne,l),f.bind(),f.setVertexAttribPointers(ne,l,b);for(var Me=0,Ve=c;Me<Ve.length;Me+=1){var be=Ve[Me];be.bind(),be.setVertexAttribPointers(ne,l,b)}w&&(w.bind(),w.setVertexAttribPointers(ne,l,b)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(ne,l,b)),j.currentNumAttributes=z},tu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var tf=function(l,f,c,d,b,w){var T=l.gl;this.program=T.createProgram();for(var R=Uu(c.staticAttributes),z=d?d.getBinderAttributes():[],j=R.concat(z),ne=c.staticUniforms?Uu(c.staticUniforms):[],ae=d?d.getBinderUniforms():[],oe=[],Se=0,Me=ne.concat(ae);Se<Me.length;Se+=1){var Ve=Me[Se];oe.indexOf(Ve)<0&&oe.push(Ve)}var be=d?d.defines():[];w&&be.push("#define OVERDRAW_INSPECTOR;");var ze=be.concat(ma.fragmentSource,c.fragmentSource).join(`
`),Xe=be.concat(ma.vertexSource,c.vertexSource).join(`
`),ut=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ut,ze),T.compileShader(ut),T.attachShader(this.program,ut);var Ut=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Ut,Xe),T.compileShader(Ut),T.attachShader(this.program,Ut),this.attributes={};var Ot={};this.numAttributes=j.length;for(var Zt=0;Zt<this.numAttributes;Zt++)j[Zt]&&(T.bindAttribLocation(this.program,Zt,j[Zt]),this.attributes[j[Zt]]=Zt);T.linkProgram(this.program),T.deleteShader(Ut),T.deleteShader(ut);for(var lr=0;lr<oe.length;lr++){var Or=oe[lr];if(Or&&!Ot[Or]){var Pr=T.getUniformLocation(this.program,Or);Pr&&(Ot[Or]=Pr)}}this.fixedUniforms=b(l,Ot),this.binderUniforms=d?d.getUniforms(l,Ot):[]}}};function al(l,f,c){var d=1/ta(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,T=w*(c.tileID.canonical.x+c.tileID.wrap*b),R=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}tf.prototype.draw=function(l,f,c,d,b,w,T,R,z,j,ne,ae,oe,Se,Me,Ve){var be,ze=l.gl;if(!this.failedToCreate){for(var Xe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(b),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Xe].set(T[Xe]);Se&&Se.setUniforms(l,this.binderUniforms,ae,{zoom:oe});for(var ut=(be={},be[ze.LINES]=2,be[ze.TRIANGLES]=3,be[ze.LINE_STRIP]=1,be)[f],Ut=0,Ot=ne.get();Ut<Ot.length;Ut+=1){var Zt=Ot[Ut],lr=Zt.vaos||(Zt.vaos={});(lr[R]||(lr[R]=new tu)).bind(l,this,z,Se?Se.getPaintVertexBuffers():[],j,Zt.vertexOffset,Me,Ve),ze.drawElements(f,Zt.primitiveLength*ut,ze.UNSIGNED_SHORT,Zt.primitiveOffset*ut*2)}}};var Tc=function(l,f,c,d){var b=f.style.light,w=b.properties.get("position"),T=[w.x,w.y,w.z],R=m.create$1();b.properties.get("anchor")==="viewport"&&m.fromRotation(R,-f.transform.angle),m.transformMat3(T,T,R);var z=b.properties.get("color");return{u_matrix:l,u_lightpos:T,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:d}},Cu=function(l,f,c,d,b,w,T){return m.extend(Tc(l,f,c,d),al(w,f,T),{u_height_factor:-Math.pow(2,b.overscaledZ)/T.tileSize/8})},Au=function(l){return{u_matrix:l}},Tu=function(l,f,c,d){return m.extend(Au(l),al(c,f,d))},ao=function(l,f){return{u_matrix:l,u_world:f}},Ff=function(l,f,c,d,b){return m.extend(Tu(l,f,c,d),{u_world:b})},Nf=function(l,f,c,d){var b,w,T=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var R=ta(c,1,T.zoom);b=!0,w=[R,R]}else b=!1,w=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},qo=function(l,f,c){var d=ta(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*b),f.pixelsToGLUnits[1]/(d*b)],u_overscale_factor:w}},Mc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Mu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},ru=function(l){return{u_matrix:l}},rf=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ta(f,1,c),u_intensity:d}},Cl=function(l,f,c){var d=l.transform;return{u_matrix:Pc(l,f,c),u_ratio:1/ta(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ri=function(l,f,c,d){return m.extend(Cl(l,f,c),{u_image:0,u_image_height:d})},Al=function(l,f,c,d){var b=l.transform,w=ol(f,b);return{u_matrix:Pc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ta(f,1,b.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},xh=function(l,f,c,d,b){var w=l.lineAtlas,T=ol(f,l.transform),R=c.layout.get("line-cap")==="round",z=w.getDash(d.from,R),j=w.getDash(d.to,R),ne=z.width*b.fromScale,ae=j.width*b.toScale;return m.extend(Cl(l,f,c),{u_patternscale_a:[T/ne,-z.height/2],u_patternscale_b:[T/ae,-j.height/2],u_sdfgamma:w.width/(256*Math.min(ne,ae)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:j.y,u_mix:b.t})};function ol(l,f){return 1/ta(l,1,f.tileZoom)}function Pc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Bf=function(l,f,c,d,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(T=b.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(w=b.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:bh(b.paint.get("raster-hue-rotate"))};var w,T};function bh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var zf,Ic=function(l,f,c,d,b,w,T,R,z,j){var ne=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ne.width/ne.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+d,u_texsize:j,u_texture:0}},Jl=function(l,f,c,d,b,w,T,R,z,j,ne){var ae=b.transform;return m.extend(Ic(l,f,c,d,b,w,T,R,z,j),{u_gamma_scale:d?Math.cos(ae._pitch)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ne})},ec=function(l,f,c,d,b,w,T,R,z,j){return m.extend(Jl(l,f,c,d,b,w,T,R,!0,z,!0),{u_texsize_icon:j,u_texture_icon:1})},Tl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},sl=function(l,f,c,d,b,w){return m.extend(function(T,R,z,j){var ne=z.imageManager.getPattern(T.from.toString()),ae=z.imageManager.getPattern(T.to.toString()),oe=z.imageManager.getPixelSize(),Se=oe.width,Me=oe.height,Ve=Math.pow(2,j.tileID.overscaledZ),be=j.tileSize*Math.pow(2,z.transform.tileZoom)/Ve,ze=be*(j.tileID.canonical.x+j.tileID.wrap*Ve),Xe=be*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ne.tl,u_pattern_br_a:ne.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[Se,Me],u_mix:R.t,u_pattern_size_a:ne.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/ta(j,1,z.transform.tileZoom),u_pixel_coord_upper:[ze>>16,Xe>>16],u_pixel_coord_lower:[65535&ze,65535&Xe]}}(d,w,c,b),{u_matrix:l,u_opacity:f})},Ml={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Zu(l,f,c,d,b,w,T){for(var R=l.context,z=R.gl,j=l.useProgram("collisionBox"),ne=[],ae=0,oe=0,Se=0;Se<d.length;Se++){var Me=d[Se],Ve=f.getTile(Me),be=Ve.getBucket(c);if(be){var ze=Me.posMatrix;b[0]===0&&b[1]===0||(ze=l.translatePosMatrix(Me.posMatrix,Ve,b,w));var Xe=T?be.textCollisionBox:be.iconCollisionBox,ut=be.collisionCircleArray;if(ut.length>0){var Ut=m.create(),Ot=ze;m.mul(Ut,be.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Ut,Ut,be.placementViewportMatrix),ne.push({circleArray:ut,circleOffset:oe,transform:Ot,invTransform:Ut}),oe=ae+=ut.length/4}Xe&&j.draw(R,z.LINES,fe.disabled,Ae.disabled,l.colorModeForRenderPass(),qe.disabled,qo(ze,l.transform,Ve),c.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,l.transform.zoom,null,null,Xe.collisionVertexBuffer)}}if(T&&ne.length){var Zt=l.useProgram("collisionCircle"),lr=new m.StructArrayLayout2f1f2i16;lr.resize(4*ae),lr._trim();for(var Or=0,Pr=0,$r=ne;Pr<$r.length;Pr+=1)for(var Ln=$r[Pr],Fn=0;Fn<Ln.circleArray.length/4;Fn++){var zn=4*Fn,ui=Ln.circleArray[zn+0],rn=Ln.circleArray[zn+1],ti=Ln.circleArray[zn+2],ai=Ln.circleArray[zn+3];lr.emplace(Or++,ui,rn,ti,ai,0),lr.emplace(Or++,ui,rn,ti,ai,1),lr.emplace(Or++,ui,rn,ti,ai,2),lr.emplace(Or++,ui,rn,ti,ai,3)}(!zf||zf.length<2*ae)&&(zf=function(Xa){var No=2*Xa,So=new m.StructArrayLayout3ui6;So.resize(No),So._trim();for(var Ua=0;Ua<No;Ua++){var to=6*Ua;So.uint16[to+0]=4*Ua+0,So.uint16[to+1]=4*Ua+1,So.uint16[to+2]=4*Ua+2,So.uint16[to+3]=4*Ua+2,So.uint16[to+4]=4*Ua+3,So.uint16[to+5]=4*Ua+0}return So}(ae));for(var $n=R.createIndexBuffer(zf,!0),Gn=R.createVertexBuffer(lr,m.collisionCircleLayout.members,!0),fi=0,Xn=ne;fi<Xn.length;fi+=1){var Zn=Xn[fi],xa=Mc(Zn.transform,Zn.invTransform,l.transform);Zt.draw(R,z.TRIANGLES,fe.disabled,Ae.disabled,l.colorModeForRenderPass(),qe.disabled,xa,c.id,Gn,$n,m.SegmentVector.simpleSegment(0,2*Zn.circleOffset,Zn.circleArray.length,Zn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Gn.destroy(),$n.destroy()}}var Ws=m.identity(new Float32Array(16));function nf(l,f,c,d,b,w){var T=m.getAnchorAlignment(l),R=-(T.horizontalAlign-.5)*f,z=-(T.verticalAlign-.5)*c,j=m.evaluateVariableOffset(l,d);return new m.Point((R/b+j[0])*w,(z/b+j[1])*w)}function af(l,f,c,d,b,w,T,R,z,j,ne){var ae=l.text.placedSymbolArray,oe=l.text.dynamicLayoutVertexArray,Se=l.icon.dynamicLayoutVertexArray,Me={};oe.clear();for(var Ve=0;Ve<ae.length;Ve++){var be=ae.get(Ve),ze=be.hidden||!be.crossTileID||l.allowVerticalPlacement&&!be.placedOrientation?null:d[be.crossTileID];if(ze){var Xe=new m.Point(be.anchorX,be.anchorY),ut=Ai(Xe,c?R:T),Ut=Fi(w.cameraToCenterDistance,ut.signedDistanceFromCamera),Ot=b.evaluateSizeForFeature(l.textSizeData,j,be)*Ut/m.ONE_EM;c&&(Ot*=l.tilePixelRatio/z);for(var Zt=nf(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textBoxScale,Ot),lr=c?Ai(Xe.add(Zt),T).point:ut.point.add(f?Zt.rotate(-w.angle):Zt),Or=l.allowVerticalPlacement&&be.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Pr=0;Pr<be.numGlyphs;Pr++)m.addDynamicAttributes(oe,lr,Or);ne&&be.associatedIconIndex>=0&&(Me[be.associatedIconIndex]={shiftedAnchor:lr,angle:Or})}else Na(be.numGlyphs,oe)}if(ne){Se.clear();for(var $r=l.icon.placedSymbolArray,Ln=0;Ln<$r.length;Ln++){var Fn=$r.get(Ln);if(Fn.hidden)Na(Fn.numGlyphs,Se);else{var zn=Me[Ln];if(zn)for(var ui=0;ui<Fn.numGlyphs;ui++)m.addDynamicAttributes(Se,zn.shiftedAnchor,zn.angle);else Na(Fn.numGlyphs,Se)}}l.icon.dynamicLayoutVertexBuffer.updateData(Se)}l.text.dynamicLayoutVertexBuffer.updateData(oe)}function Uf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function nu(l,f,c,d,b,w,T,R,z,j,ne,ae){for(var oe=l.context,Se=oe.gl,Me=l.transform,Ve=R==="map",be=z==="map",ze=Ve&&c.layout.get("symbol-placement")!=="point",Xe=Ve&&!be&&!ze,ut=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ut=!1,Ot=l.depthModeForSublayer(0,fe.ReadOnly),Zt=c.layout.get("text-variable-anchor"),lr=[],Or=0,Pr=d;Or<Pr.length;Or+=1){var $r=Pr[Or],Ln=f.getTile($r),Fn=Ln.getBucket(c);if(Fn){var zn=b?Fn.text:Fn.icon;if(zn&&zn.segments.get().length){var ui=zn.programConfigurations.get(c.id),rn=b||Fn.sdfIcons,ti=b?Fn.textSizeData:Fn.iconSizeData,ai=be||Me.pitch!==0,$n=l.useProgram(Uf(rn,b,Fn),ui),Gn=m.evaluateSizeForZoom(ti,Me.zoom),fi=void 0,Xn=[0,0],Zn=void 0,xa=void 0,Xa=null,No=void 0;if(b)Zn=Ln.glyphAtlasTexture,xa=Se.LINEAR,fi=Ln.glyphAtlasTexture.size,Fn.iconsInText&&(Xn=Ln.imageAtlasTexture.size,Xa=Ln.imageAtlasTexture,No=ai||l.options.rotating||l.options.zooming||ti.kind==="composite"||ti.kind==="camera"?Se.LINEAR:Se.NEAREST);else{var So=c.layout.get("icon-size").constantOr(0)!==1||Fn.iconsNeedLinear;Zn=Ln.imageAtlasTexture,xa=rn||l.options.rotating||l.options.zooming||So||ai?Se.LINEAR:Se.NEAREST,fi=Ln.imageAtlasTexture.size}var Ua=ta(Ln,1,l.transform.zoom),to=Aa($r.posMatrix,be,Ve,l.transform,Ua),xs=xi($r.posMatrix,be,Ve,l.transform,Ua),is=Zt&&Fn.hasTextData(),ku=c.layout.get("icon-text-fit")!=="none"&&is&&Fn.hasIconData();ze&&En(Fn,$r.posMatrix,l,b,to,xs,be,j);var as=l.translatePosMatrix($r.posMatrix,Ln,w,T),qs=ze||b&&Zt||ku?Ws:to,Ks=l.translatePosMatrix(xs,Ln,w,T,!0),fc=rn&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Bl={program:$n,buffers:zn,uniformValues:rn?Fn.iconsInText?ec(ti.kind,Gn,Xe,be,l,as,qs,Ks,fi,Xn):Jl(ti.kind,Gn,Xe,be,l,as,qs,Ks,b,fi,!0):Ic(ti.kind,Gn,Xe,be,l,as,qs,Ks,b,fi),atlasTexture:Zn,atlasTextureIcon:Xa,atlasInterpolation:xa,atlasInterpolationIcon:No,isSDF:rn,hasHalo:fc};if(ut&&Fn.canOverlap){Ut=!0;for(var mu=0,vl=zn.segments.get();mu<vl.length;mu+=1){var hc=vl[mu];lr.push({segments:new m.SegmentVector([hc]),sortKey:hc.sortKey,state:Bl})}}else lr.push({segments:zn.segments,sortKey:0,state:Bl})}}}Ut&&lr.sort(function(qu,Du){return qu.sortKey-Du.sortKey});for(var ou=0,zl=lr;ou<zl.length;ou+=1){var gu=zl[ou],go=gu.state;if(oe.activeTexture.set(Se.TEXTURE0),go.atlasTexture.bind(go.atlasInterpolation,Se.CLAMP_TO_EDGE),go.atlasTextureIcon&&(oe.activeTexture.set(Se.TEXTURE1),go.atlasTextureIcon&&go.atlasTextureIcon.bind(go.atlasInterpolationIcon,Se.CLAMP_TO_EDGE)),go.isSDF){var yu=go.uniformValues;go.hasHalo&&(yu.u_is_halo=1,tc(go.buffers,gu.segments,c,l,go.program,Ot,ne,ae,yu)),yu.u_is_halo=0}tc(go.buffers,gu.segments,c,l,go.program,Ot,ne,ae,go.uniformValues)}}function tc(l,f,c,d,b,w,T,R,z){var j=d.context;b.draw(j,j.gl.TRIANGLES,w,T,R,qe.disabled,z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Oc(l,f,c,d,b,w,T){var R,z,j,ne,ae,oe=l.context.gl,Se=c.paint.get("fill-pattern"),Me=Se&&Se.constantOr(1),Ve=c.getCrossfadeParameters();T?(z=Me&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=oe.LINES):(z=Me?"fillPattern":"fill",R=oe.TRIANGLES);for(var be=0,ze=d;be<ze.length;be+=1){var Xe=ze[be],ut=f.getTile(Xe);if(!Me||ut.patternsLoaded()){var Ut=ut.getBucket(c);if(Ut){var Ot=Ut.programConfigurations.get(c.id),Zt=l.useProgram(z,Ot);Me&&(l.context.activeTexture.set(oe.TEXTURE0),ut.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ot.updatePaintBuffers(Ve));var lr=Se.constantOr(null);if(lr&&ut.imageAtlas){var Or=ut.imageAtlas,Pr=Or.patternPositions[lr.to.toString()],$r=Or.patternPositions[lr.from.toString()];Pr&&$r&&Ot.setConstantPatternPositions(Pr,$r)}var Ln=l.translatePosMatrix(Xe.posMatrix,ut,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){ne=Ut.indexBuffer2,ae=Ut.segments2;var Fn=[oe.drawingBufferWidth,oe.drawingBufferHeight];j=z==="fillOutlinePattern"&&Me?Ff(Ln,l,Ve,ut,Fn):ao(Ln,Fn)}else ne=Ut.indexBuffer,ae=Ut.segments,j=Me?Tu(Ln,l,Ve,ut):Au(Ln);Zt.draw(l.context,R,b,l.stencilModeForClipping(Xe),w,qe.disabled,j,c.id,Ut.layoutVertexBuffer,ne,ae,c.paint,l.transform.zoom,Ot)}}}}function of(l,f,c,d,b,w,T){for(var R=l.context,z=R.gl,j=c.paint.get("fill-extrusion-pattern"),ne=j.constantOr(1),ae=c.getCrossfadeParameters(),oe=c.paint.get("fill-extrusion-opacity"),Se=0,Me=d;Se<Me.length;Se+=1){var Ve=Me[Se],be=f.getTile(Ve),ze=be.getBucket(c);if(ze){var Xe=ze.programConfigurations.get(c.id),ut=l.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",Xe);ne&&(l.context.activeTexture.set(z.TEXTURE0),be.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Xe.updatePaintBuffers(ae));var Ut=j.constantOr(null);if(Ut&&be.imageAtlas){var Ot=be.imageAtlas,Zt=Ot.patternPositions[Ut.to.toString()],lr=Ot.patternPositions[Ut.from.toString()];Zt&&lr&&Xe.setConstantPatternPositions(Zt,lr)}var Or=l.translatePosMatrix(Ve.posMatrix,be,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Pr=c.paint.get("fill-extrusion-vertical-gradient"),$r=ne?Cu(Or,l,Pr,oe,Ve,ae,be):Tc(Or,l,Pr,oe);ut.draw(R,R.gl.TRIANGLES,b,w,T,qe.backCCW,$r,c.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,c.paint,l.transform.zoom,Xe)}}}function Pl(l,f,c,d,b,w){var T=l.context,R=T.gl,z=f.fbo;if(z){var j=l.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());var ne=function(ae,oe,Se){var Me=Se.paint.get("hillshade-shadow-color"),Ve=Se.paint.get("hillshade-highlight-color"),be=Se.paint.get("hillshade-accent-color"),ze=Se.paint.get("hillshade-illumination-direction")*(Math.PI/180);Se.paint.get("hillshade-illumination-anchor")==="viewport"&&(ze-=ae.transform.angle);var Xe,ut,Ut,Ot=!ae.options.moving;return{u_matrix:ae.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Ot),u_image:0,u_latrange:(Xe=oe.tileID,ut=Math.pow(2,Xe.canonical.z),Ut=Xe.canonical.y,[new m.MercatorCoordinate(0,Ut/ut).toLngLat().lat,new m.MercatorCoordinate(0,(Ut+1)/ut).toLngLat().lat]),u_light:[Se.paint.get("hillshade-exaggeration"),ze],u_shadow:Me,u_highlight:Ve,u_accent:be}}(l,f,c);j.draw(T,R.TRIANGLES,d,b,w,qe.disabled,ne,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Yh(l,f,c,d,b,w){var T=l.context,R=T.gl,z=f.dem;if(z&&z.data){var j=z.dim,ne=z.stride,ae=z.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ne),f.demTexture){var oe=f.demTexture;oe.update(ae,{premultiply:!1}),oe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(T,ae,R.RGBA,{premultiply:!1}),f.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Se=f.fbo;if(!Se){var Me=new m.Texture(T,{width:j,height:j,data:null},R.RGBA);Me.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Se=f.fbo=T.createFramebuffer(j,j,!0)).colorAttachment.set(Me.texture)}T.bindFramebuffer.set(Se.framebuffer),T.viewport.set([0,0,j,j]),l.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,d,b,w,qe.disabled,function(Ve,be){var ze=be.stride,Xe=m.create();return m.ortho(Xe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Xe,Xe,[0,-m.EXTENT,0]),{u_matrix:Xe,u_image:1,u_dimension:[ze,ze],u_zoom:Ve.overscaledZ,u_unpack:be.getUnpackVector()}}(f.tileID,z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function sf(l,f,c,d,b){var w=d.paint.get("raster-fade-duration");if(w>0){var T=m.browser.now(),R=(T-l.timeAdded)/w,z=f?(T-f.timeAdded)/w:-1,j=c.getSource(),ne=b.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),ae=!f||Math.abs(f.tileID.overscaledZ-ne)>Math.abs(l.tileID.overscaledZ-ne),oe=ae&&l.refreshedUponExpiration?1:m.clamp(ae?R:1-z,0,1);return l.refreshedUponExpiration&&R>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}var Il=new m.Color(1,0,0,1),uf=new m.Color(0,1,0,1),lf=new m.Color(0,0,1,1),Ol=new m.Color(1,0,1,1),Rc=new m.Color(0,1,1,1);function Eh(l,f,c,d){rc(l,0,f+c/2,l.transform.width,c,d)}function Sh(l,f,c,d){rc(l,f-c/2,0,c,l.transform.height,d)}function rc(l,f,c,d,b,w){var T=l.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,b*m.browser.devicePixelRatio),T.clear({color:w}),R.disable(R.SCISSOR_TEST)}function wh(l,f,c){var d=l.context,b=d.gl,w=c.posMatrix,T=l.useProgram("debug"),R=fe.disabled,z=Ae.disabled,j=l.colorModeForRenderPass();d.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),T.draw(d,b.LINE_STRIP,R,z,j,qe.disabled,Mu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ne=f.getTileByID(c.key).latestRawTileData,ae=Math.floor((ne&&ne.byteLength||0)/1024),oe=f.getTile(c).tileSize,Se=512/Math.min(oe,512)*(c.overscaledZ/l.transform.zoom)*.5,Me=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Me+=" => "+c.overscaledZ),function(Ve,be){Ve.initDebugOverlayCanvas();var ze=Ve.debugOverlayCanvas,Xe=Ve.context.gl,ut=Ve.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,ze.width,ze.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(be,5,5),ut.strokeText(be,5,5),Ve.debugOverlayTexture.update(ze),Ve.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(l,Me+" "+ae+"kb"),T.draw(d,b.TRIANGLES,R,z,Ze.alphaBlended,qe.disabled,Mu(w,m.Color.transparent,Se),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Rl={symbol:function(l,f,c,d,b){if(l.renderPass==="translucent"){var w=Ae.disabled,T=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,z,j,ne,ae,oe,Se){for(var Me=z.transform,Ve=ae==="map",be=oe==="map",ze=0,Xe=R;ze<Xe.length;ze+=1){var ut=Xe[ze],Ut=ne.getTile(ut),Ot=Ut.getBucket(j);if(Ot&&Ot.text&&Ot.text.segments.get().length){var Zt=m.evaluateSizeForZoom(Ot.textSizeData,Me.zoom),lr=ta(Ut,1,z.transform.zoom),Or=Aa(ut.posMatrix,be,Ve,z.transform,lr),Pr=j.layout.get("icon-text-fit")!=="none"&&Ot.hasIconData();if(Zt){var $r=Math.pow(2,Me.zoom-Ut.tileID.overscaledZ);af(Ot,Ve,be,Se,m.symbolSize,Me,Or,ut.posMatrix,$r,Zt,Pr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&nu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,T),c.paint.get("text-opacity").constantOr(1)!==0&&nu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,T),f.map.showCollisionBoxes&&(Zu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Zu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),R=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||w.constantOr(1)!==0&&T.constantOr(1)!==0){for(var z=l.context,j=z.gl,ne=l.depthModeForSublayer(0,fe.ReadOnly),ae=Ae.disabled,oe=l.colorModeForRenderPass(),Se=[],Me=0;Me<d.length;Me++){var Ve=d[Me],be=f.getTile(Ve),ze=be.getBucket(c);if(ze){var Xe=ze.programConfigurations.get(c.id),ut={programConfiguration:Xe,program:l.useProgram("circle",Xe),layoutVertexBuffer:ze.layoutVertexBuffer,indexBuffer:ze.indexBuffer,uniformValues:Nf(l,Ve,be,c)};if(R)for(var Ut=0,Ot=ze.segments.get();Ut<Ot.length;Ut+=1){var Zt=Ot[Ut];Se.push({segments:new m.SegmentVector([Zt]),sortKey:Zt.sortKey,state:ut})}else Se.push({segments:ze.segments,sortKey:0,state:ut})}}R&&Se.sort(function(Ln,Fn){return Ln.sortKey-Fn.sortKey});for(var lr=0,Or=Se;lr<Or.length;lr+=1){var Pr=Or[lr],$r=Pr.state;$r.program.draw(z,j.TRIANGLES,ne,ae,oe,qe.disabled,$r.uniformValues,c.id,$r.layoutVertexBuffer,$r.indexBuffer,Pr.segments,c.paint,l.transform.zoom,$r.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,w=b.gl,T=Ae.disabled,R=new Ze([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Se,Me,Ve){var be=Se.gl;Se.activeTexture.set(be.TEXTURE1),Se.viewport.set([0,0,Me.width/4,Me.height/4]);var ze=Ve.heatmapFbo;if(ze)be.bindTexture(be.TEXTURE_2D,ze.colorAttachment.get()),Se.bindFramebuffer.set(ze.framebuffer);else{var Xe=be.createTexture();be.bindTexture(be.TEXTURE_2D,Xe),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),ze=Ve.heatmapFbo=Se.createFramebuffer(Me.width/4,Me.height/4,!1),function(ut,Ut,Ot,Zt){var lr=ut.gl;lr.texImage2D(lr.TEXTURE_2D,0,lr.RGBA,Ut.width/4,Ut.height/4,0,lr.RGBA,ut.extRenderToTextureHalfFloat?ut.extTextureHalfFloat.HALF_FLOAT_OES:lr.UNSIGNED_BYTE,null),Zt.colorAttachment.set(Ot)}(Se,Me,Xe,ze)}})(b,l,c),b.clear({color:m.Color.transparent});for(var z=0;z<d.length;z++){var j=d[z];if(!f.hasRenderableParent(j)){var ne=f.getTile(j),ae=ne.getBucket(c);if(ae){var oe=ae.programConfigurations.get(c.id);l.useProgram("heatmap",oe).draw(b,w.TRIANGLES,fe.disabled,T,R,qe.disabled,rf(j.posMatrix,ne,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,c.paint,l.transform.zoom,oe)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Se,Me){var Ve=Se.context,be=Ve.gl,ze=Me.heatmapFbo;if(ze){Ve.activeTexture.set(be.TEXTURE0),be.bindTexture(be.TEXTURE_2D,ze.colorAttachment.get()),Ve.activeTexture.set(be.TEXTURE1);var Xe=Me.colorRampTexture;Xe||(Xe=Me.colorRampTexture=new m.Texture(Ve,Me.colorRamp,be.RGBA)),Xe.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se.useProgram("heatmapTexture").draw(Ve,be.TRIANGLES,fe.disabled,Ae.disabled,Se.colorModeForRenderPass(),qe.disabled,function(ut,Ut,Ot,Zt){var lr=m.create();m.ortho(lr,0,ut.width,ut.height,0,0,1);var Or=ut.context.gl;return{u_matrix:lr,u_world:[Or.drawingBufferWidth,Or.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ut.paint.get("heatmap-opacity")}}(Se,Me),Me.id,Se.viewportBuffer,Se.quadTriangleIndexBuffer,Se.viewportSegments,Me.paint,Se.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(b.constantOr(1)!==0&&w.constantOr(1)!==0)for(var T=l.depthModeForSublayer(0,fe.ReadOnly),R=l.colorModeForRenderPass(),z=c.paint.get("line-dasharray"),j=c.paint.get("line-pattern"),ne=j.constantOr(1),ae=c.paint.get("line-gradient"),oe=c.getCrossfadeParameters(),Se=ne?"linePattern":z?"lineSDF":ae?"lineGradient":"line",Me=l.context,Ve=Me.gl,be=!0,ze=0,Xe=d;ze<Xe.length;ze+=1){var ut=Xe[ze],Ut=f.getTile(ut);if(!ne||Ut.patternsLoaded()){var Ot=Ut.getBucket(c);if(Ot){var Zt=Ot.programConfigurations.get(c.id),lr=l.context.program.get(),Or=l.useProgram(Se,Zt),Pr=be||Or.program!==lr,$r=j.constantOr(null);if($r&&Ut.imageAtlas){var Ln=Ut.imageAtlas,Fn=Ln.patternPositions[$r.to.toString()],zn=Ln.patternPositions[$r.from.toString()];Fn&&zn&&Zt.setConstantPatternPositions(Fn,zn)}var ui=ne?Al(l,Ut,c,oe):z?xh(l,Ut,c,z,oe):ae?Ri(l,Ut,c,Ot.lineClipsArray.length):Cl(l,Ut,c);if(ne)Me.activeTexture.set(Ve.TEXTURE0),Ut.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),Zt.updatePaintBuffers(oe);else if(z&&(Pr||l.lineAtlas.dirty))Me.activeTexture.set(Ve.TEXTURE0),l.lineAtlas.bind(Me);else if(ae){var rn=Ot.gradients[c.id],ti=rn.texture;if(c.gradientVersion!==rn.version){var ai=256;if(c.stepInterpolant){var $n=f.getSource().maxzoom,Gn=ut.canonical.z===$n?Math.ceil(1<<l.transform.maxZoom-ut.canonical.z):1;ai=m.clamp(m.nextPowerOfTwo(Ot.maxLineLength/m.EXTENT*1024*Gn),256,Me.maxTextureSize)}rn.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ai,image:rn.gradient||void 0,clips:Ot.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new m.Texture(Me,rn.gradient,Ve.RGBA),rn.version=c.gradientVersion,ti=rn.texture}Me.activeTexture.set(Ve.TEXTURE0),ti.bind(c.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Or.draw(Me,Ve.TRIANGLES,T,l.stencilModeForClipping(ut),R,qe.disabled,ui,c.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,c.paint,l.transform.zoom,Zt,Ot.layoutVertexBuffer2),be=!1}}}}},fill:function(l,f,c,d){var b=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var T=l.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&b.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){var j=l.depthModeForSublayer(1,l.renderPass==="opaque"?fe.ReadWrite:fe.ReadOnly);Oc(l,f,c,d,j,T,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ne=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,fe.ReadOnly);Oc(l,f,c,d,ne,T,!0)}}},"fill-extrusion":function(l,f,c,d){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var w=new fe(l.context.gl.LEQUAL,fe.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))of(l,f,c,d,w,Ae.disabled,Ze.disabled),of(l,f,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var T=l.colorModeForRenderPass();of(l,f,c,d,w,Ae.disabled,T)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,w=l.depthModeForSublayer(0,fe.ReadOnly),T=l.colorModeForRenderPass(),R=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],z=R[0],j=0,ne=R[1];j<ne.length;j+=1){var ae=ne[j],oe=f.getTile(ae);oe.needsHillshadePrepare&&l.renderPass==="offscreen"?Yh(l,oe,c,w,Ae.disabled,T):l.renderPass==="translucent"&&Pl(l,oe,c,w,z[ae.overscaledZ],T)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var b=l.context,w=b.gl,T=f.getSource(),R=l.useProgram("raster"),z=l.colorModeForRenderPass(),j=T instanceof ft?[{},d]:l.stencilConfigForOverlap(d),ne=j[0],ae=j[1],oe=ae[ae.length-1].overscaledZ,Se=!l.options.moving,Me=0,Ve=ae;Me<Ve.length;Me+=1){var be=Ve[Me],ze=l.depthModeForSublayer(be.overscaledZ-oe,c.paint.get("raster-opacity")===1?fe.ReadWrite:fe.ReadOnly,w.LESS),Xe=f.getTile(be),ut=l.transform.calculatePosMatrix(be.toUnwrapped(),Se);Xe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Ut=f.findLoadedParent(be,0),Ot=sf(Xe,Ut,f,c,l.transform),Zt=void 0,lr=void 0,Or=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),Xe.texture.bind(Or,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(w.TEXTURE1),Ut?(Ut.texture.bind(Or,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Zt=Math.pow(2,Ut.tileID.overscaledZ-Xe.tileID.overscaledZ),lr=[Xe.tileID.canonical.x*Zt%1,Xe.tileID.canonical.y*Zt%1]):Xe.texture.bind(Or,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Pr=Bf(ut,lr||[0,0],Zt||1,Ot,c);T instanceof ft?R.draw(b,w.TRIANGLES,ze,Ae.disabled,z,qe.disabled,Pr,c.id,T.boundsBuffer,l.quadTriangleIndexBuffer,T.boundsSegments):R.draw(b,w.TRIANGLES,ze,ne[be.overscaledZ],z,qe.disabled,Pr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var w=l.context,T=w.gl,R=l.transform,z=R.tileSize,j=c.paint.get("background-pattern");if(!l.isPatternMissing(j)){var ne=!j&&d.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ne){var ae=Ae.disabled,oe=l.depthModeForSublayer(0,ne==="opaque"?fe.ReadWrite:fe.ReadOnly),Se=l.colorModeForRenderPass(),Me=l.useProgram(j?"backgroundPattern":"background"),Ve=R.coveringTiles({tileSize:z});j&&(w.activeTexture.set(T.TEXTURE0),l.imageManager.bind(l.context));for(var be=c.getCrossfadeParameters(),ze=0,Xe=Ve;ze<Xe.length;ze+=1){var ut=Xe[ze],Ut=l.transform.calculatePosMatrix(ut.toUnwrapped()),Ot=j?sl(Ut,b,l,j,{tileID:ut,tileSize:z},be):Tl(Ut,b,d);Me.draw(w,T.TRIANGLES,oe,ae,Se,qe.disabled,Ot,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)wh(l,f,c[d])},custom:function(l,f,c){var d=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var w=b.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(b,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Ae.disabled);var T=b.renderingMode==="3d"?new fe(l.context.gl.LEQUAL,fe.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,fe.ReadOnly);d.setDepthMode(T),b.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Wi=function(l,f){this.context=new ie(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Oe.maxUnderzooming+Oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bo,this.gpuTimers={}};Wi.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Wi.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,da.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,da.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,yt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var b=new m.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,da.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var T=new m.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(T),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new Ae({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Wi.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,fe.disabled,this.stencilClearMode,Ze.disabled,qe.disabled,ru(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Wi.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ze.disabled),c.setDepthMode(fe.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,T=f;w<T.length;w+=1){var R=T[w],z=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;b.draw(c,d.TRIANGLES,fe.disabled,new Ae({func:d.ALWAYS,mask:0},z,255,d.KEEP,d.KEEP,d.REPLACE),Ze.disabled,qe.disabled,ru(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Wi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Ae({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Wi.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Ae({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Wi.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(z,j){return j.overscaledZ-z.overscaledZ}),b=d[d.length-1].overscaledZ,w=d[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var T={},R=0;R<w;R++)T[R+b]=new Ae({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[T,d]}return[(f={},f[b]=Ae.disabled,f),d]},Wi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ze([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ze.unblended:Ze.alphaBlended},Wi.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return fe.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new fe(c||this.context.gl.LEQUAL,f,[d,d])},Wi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Wi.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,b=this.style.sourceCaches;for(var w in b){var T=b[w];T.used&&T.prepare(this.context)}var R,z,j={},ne={},ae={};for(var oe in b){var Se=b[oe];j[oe]=Se.getVisibleCoordinates(),ne[oe]=j[oe].slice().reverse(),ae[oe]=Se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Me=0;Me<d.length;Me++)if(this.style._layers[d[Me]].is3D()){this.opaquePassCutoff=Me;break}this.renderPass="offscreen";for(var Ve=0,be=d;Ve<be.length;Ve+=1){var ze=this.style._layers[be[Ve]];if(ze.hasOffscreenPass()&&!ze.isHidden(this.transform.zoom)){var Xe=ne[ze.source];(ze.type==="custom"||Xe.length)&&this.renderLayer(this,b[ze.source],ze,Xe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var ut=this.style._layers[d[this.currentLayer]],Ut=b[ut.source],Ot=j[ut.source];this._renderTileClippingMasks(ut,Ot),this.renderLayer(this,Ut,ut,Ot)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Zt=this.style._layers[d[this.currentLayer]],lr=b[Zt.source],Or=(Zt.type==="symbol"?ae:ne)[Zt.source];this._renderTileClippingMasks(Zt,j[Zt.source]),this.renderLayer(this,lr,Zt,Or)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Pr){Pr.source&&!Pr.isHidden(c.transform.zoom)&&(Pr.source!==(z&&z.id)&&(z=c.style.sourceCaches[Pr.source]),(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z))}),R&&Rl.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Pr){var $r=Pr.transform.padding;Eh(Pr,Pr.transform.height-($r.top||0),3,Il),Eh(Pr,$r.bottom||0,3,uf),Sh(Pr,$r.left||0,3,lf),Sh(Pr,Pr.transform.width-($r.right||0),3,Ol);var Ln=Pr.transform.centerPoint;(function(Fn,zn,ui,rn){rc(Fn,zn-1,ui-10,2,20,rn),rc(Fn,zn-10,ui-1,20,2,rn)})(Pr,Ln.x,Pr.transform.height-Ln.y,Rc)}(this),this.context.setDefault()},Wi.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Rl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Wi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Wi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Wi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Wi.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],b=this.context.extTimerQuery,w=b.getQueryObjectEXT(d.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(d.query),f[c]=w}return f},Wi.prototype.translatePosMatrix=function(l,f,c,d,b){if(!c[0]&&!c[1])return l;var w=b?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var T=Math.sin(w),R=Math.cos(w);c=[c[0]*R-c[1]*T,c[0]*T+c[1]*R]}var z=[b?c[0]:ta(f,c[0],this.transform.zoom),b?c[1]:ta(f,c[1],this.transform.zoom),0],j=new Float32Array(16);return m.translate(j,l,z),j},Wi.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Wi.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Wi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Wi.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new tf(this.context,l,ms[l],f,Ml[l],this._showOverdrawInspector)),this.cache[c]},Wi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Wi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Wi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Wi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var nc=function(l,f){this.points=l,this.planes=f};nc.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return m.transformMat4([],T,l)}).map(function(T){return m.scale$1([],T,1/T[3]/f*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=m.sub([],b[T[0]],b[T[1]]),z=m.sub([],b[T[2]],b[T[1]]),j=m.normalize([],m.cross([],R,z)),ne=-m.dot(j,b[T[1]]);return j.concat(ne)});return new nc(b,w)};var oa=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};oa.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],d[b]=f[b]?this.center[b]:this.max[b];return d[2]=this.max[2],new oa(c,d)},oa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},oa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},oa.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var b=l.planes[d],w=0,T=0;T<f.length;T++)w+=m.dot$1(b,f[T])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var R=0;R<3;R++){for(var z=Number.MAX_VALUE,j=-Number.MAX_VALUE,ne=0;ne<l.points.length;ne++){var ae=l.points[ne][R]-this.min[R];z=Math.min(z,ae),j=Math.max(j,ae)}if(j<0||z>this.max[R]-this.min[R])return 0}return 1};var Pu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Pu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Pu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},Pu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Pu.prototype.clone=function(){return new Pu(this.top,this.bottom,this.left,this.right)},Pu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gi=function(l,f,c,d,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gi.prototype.clone=function(){var l=new Gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new m.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Gi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Gi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Gi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),b=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),T=Math.floor(Math.min(c.x,d.x,b.x,w.x)),R=Math.floor(Math.max(c.x,d.x,b.x,w.x)),z=T-1;z<=R+1;z++)z!==0&&f.push(new m.UnwrappedTileID(z,l));return f},Gi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),w=[b*d.x,b*d.y,0],T=nc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),R=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=f);var z=function(Pr){return{aabb:new oa([Pr*b,0,0],[(Pr+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Pr,fullyVisible:!1}},j=[],ne=[],ae=f,oe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Se=1;Se<=3;Se++)j.push(z(-Se)),j.push(z(Se));for(j.push(z(0));j.length>0;){var Me=j.pop(),Ve=Me.x,be=Me.y,ze=Me.fullyVisible;if(!ze){var Xe=Me.aabb.intersects(T);if(Xe===0)continue;ze=Xe===2}var ut=Me.aabb.distanceX(w),Ut=Me.aabb.distanceY(w),Ot=Math.max(Math.abs(ut),Math.abs(Ut));if(Me.zoom===ae||Ot>3+(1<<ae-Me.zoom)-2&&Me.zoom>=R)ne.push({tileID:new m.OverscaledTileID(Me.zoom===ae?oe:Me.zoom,Me.wrap,Me.zoom,Ve,be),distanceSq:m.sqrLen([w[0]-.5-Ve,w[1]-.5-be])});else for(var Zt=0;Zt<4;Zt++){var lr=(Ve<<1)+Zt%2,Or=(be<<1)+(Zt>>1);j.push({aabb:Me.aabb.quadrant(Zt),zoom:Me.zoom+1,x:lr,y:Or,wrap:Me.wrap,fullyVisible:ze})}}return ne.sort(function(Pr,$r){return Pr.distanceSq-$r.distanceSq}).map(function(Pr){return Pr.tileID})},Gi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Gi.prototype.zoomScale=function(l){return Math.pow(2,l)},Gi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Gi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Gi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Gi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),w=new m.MercatorCoordinate(b.x-(c.x-d.x),b.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Gi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Gi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Gi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Gi.prototype.coordinateLocation=function(l){return l.toLngLat()},Gi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],b=c[3],w=f[1]/d,T=c[1]/b,R=f[2]/d,z=c[2]/b,j=R===z?0:(0-R)/(z-R);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/b,j)/this.worldSize,m.number(w,T,j)/this.worldSize)},Gi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Gi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var b=l.canonical,w=this.worldSize/this.zoomScale(b.z),T=b.x+Math.pow(2,b.z)*l.wrap,R=m.identity(new Float64Array(16));return m.translate(R,R,[T*w,b.y*w,0]),m.scale(R,R,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(R,f?this.alignedProjMatrix:this.projMatrix,R),d[c]=new Float32Array(R),d[c]},Gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,b=-90,w=90,T=-180,R=180,z=this.size,j=this._unmodified;if(this.latRange){var ne=this.latRange;b=m.mercatorYfromLat(ne[1])*this.worldSize,l=(w=m.mercatorYfromLat(ne[0])*this.worldSize)-b<z.y?z.y/(w-b):0}if(this.lngRange){var ae=this.lngRange;T=m.mercatorXfromLng(ae[0])*this.worldSize,f=(R=m.mercatorXfromLng(ae[1])*this.worldSize)-T<z.x?z.x/(R-T):0}var oe=this.point,Se=Math.max(f||0,l||0);if(Se)return this.center=this.unproject(new m.Point(f?(R+T)/2:oe.x,l?(w+b)/2:oe.y)),this.zoom+=this.scaleZoom(Se),this._unmodified=j,void(this._constraining=!1);if(this.latRange){var Me=oe.y,Ve=z.y/2;Me-Ve<b&&(d=b+Ve),Me+Ve>w&&(d=w-Ve)}if(this.lngRange){var be=oe.x,ze=z.x/2;be-ze<T&&(c=T+ze),be+ze>R&&(c=R-ze)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:oe.x,d!==void 0?d:oe.y))),this._unmodified=j,this._constraining=!1}},Gi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,w=b.x,T=b.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),z=this.height/50,j=new Float64Array(16);m.perspective(j,this._fov,this.width/this.height,z,R),j[8]=2*-l.x/this.width,j[9]=2*l.y/this.height,m.scale(j,j,[1,-1,1]),m.translate(j,j,[0,0,-this.cameraToCenterDistance]),m.rotateX(j,j,this._pitch),m.rotateZ(j,j,this.angle),m.translate(j,j,[-w,-T,0]),this.mercatorMatrix=m.scale([],j,[this.worldSize,this.worldSize,this.worldSize]),m.scale(j,j,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=j,this.invProjMatrix=m.invert([],this.projMatrix);var ne=this.width%2/2,ae=this.height%2/2,oe=Math.cos(this.angle),Se=Math.sin(this.angle),Me=w-Math.round(w)+oe*ne+Se*ae,Ve=T-Math.round(T)+oe*ae+Se*ne,be=new Float64Array(j);if(m.translate(be,be,[Me>.5?Me-1:Me,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=be,j=m.create(),m.scale(j,j,[this.width/2,-this.height/2,1]),m.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=m.create(),m.scale(j,j,[1,-1,1]),m.translate(j,j,[-1,-1,0]),m.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(j=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=j,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Gi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,b=f.x,w=f.y,T=0,R=l;T<R.length;T+=1){var z=R[T];c=Math.min(c,z.x),d=Math.min(d,z.y),b=Math.max(b,z.x),w=Math.max(w,z.y)}return[new m.Point(c,d),new m.Point(b,d),new m.Point(b,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(Gi.prototype,Ma);var gs=function(l){var f,c,d,b;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,b=function(){d=null,c&&(f(),d=setTimeout(b,300),c=!1)},function(){return c=!0,d||b(),d})};gs.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},gs.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},gs.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,d),w=Math.round(f.lng*b)/b,T=Math.round(f.lat*b)/b,R=this._map.getBearing(),z=this._map.getPitch(),j="";if(j+=l?"/"+w+"/"+T+"/"+c:c+"/"+T+"/"+w,(R||z)&&(j+="/"+Math.round(10*R)/10),z&&(j+="/"+Math.round(z)),this._hashName){var ne=this._hashName,ae=!1,oe=m.window.location.hash.slice(1).split("&").map(function(Se){var Me=Se.split("=")[0];return Me===ne?(ae=!0,Me+"="+j):Se}).filter(function(Se){return Se});return ae||oe.push(ne+"="+j),"#"+oe.join("&")}return"#"+j},gs.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},gs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},gs.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Lc={linearity:.3,easing:m.bezier(0,0,.3,1)},Vu=m.extend({deceleration:2500,maxSpeed:1400},Lc),za=m.extend({deceleration:20,maxSpeed:1400},Lc),ic=m.extend({deceleration:1e3,maxSpeed:360},Lc),Ll=m.extend({deceleration:1e3,maxSpeed:90},Lc),ju=function(l){this._map=l,this.clear()};function kc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Iu(l,f,c){var d=c.maxSpeed,b=c.linearity,w=c.deceleration,T=m.clamp(l*b/(f/1e3),-d,d),R=Math.abs(T)/(w*b);return{easing:c.easing,duration:1e3*R,amount:T*(R/2)}}ju.prototype.clear=function(){this._inertiaBuffer=[]},ju.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},ju.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},ju.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var b=d[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(f.pan.mag()){var R=Iu(f.pan.mag(),w,m.extend({},Vu,l||{}));T.offset=f.pan.mult(R.amount/f.pan.mag()),T.center=this._map.transform.center,kc(T,R)}if(f.zoom){var z=Iu(f.zoom,w,za);T.zoom=this._map.transform.zoom+z.amount,kc(T,z)}if(f.bearing){var j=Iu(f.bearing,w,ic);T.bearing=this._map.transform.bearing+m.clamp(j.amount,-179,179),kc(T,j)}if(f.pitch){var ne=Iu(f.pitch,w,Ll);T.pitch=this._map.transform.pitch+ne.amount,kc(T,ne)}if(T.zoom||T.bearing){var ae=f.pinchAround===void 0?f.around:f.pinchAround;T.around=ae?this._map.unproject(ae):this._map.getCenter()}return this.clear(),m.extend(T,{noMoveStart:!0})}};var co=function(l){function f(d,b,w,T){T===void 0&&(T={});var R=G.mousePos(b.getCanvasContainer(),w),z=b.unproject(R);l.call(this,d,m.extend({point:R,lngLat:z,originalEvent:w},T)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),kl=function(l){function f(d,b,w){var T=d==="touchend"?w.changedTouches:w.touches,R=G.touchPos(b.getCanvasContainer(),T),z=R.map(function(ae){return b.unproject(ae)}),j=R.reduce(function(ae,oe,Se,Me){return ae.add(oe.div(Me.length))},new m.Point(0,0)),ne=b.unproject(j);l.call(this,d,{points:R,point:j,lngLats:z,lngLat:ne,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),ac=function(l){function f(d,b,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),fo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};fo.prototype.reset=function(){delete this._mousedownPos},fo.prototype.wheel=function(l){return this._firePreventable(new ac(l.type,this._map,l))},fo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new co(l.type,this._map,l))},fo.prototype.mouseup=function(l){this._map.fire(new co(l.type,this._map,l))},fo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new co(l.type,this._map,l))},fo.prototype.dblclick=function(l){return this._firePreventable(new co(l.type,this._map,l))},fo.prototype.mouseover=function(l){this._map.fire(new co(l.type,this._map,l))},fo.prototype.mouseout=function(l){this._map.fire(new co(l.type,this._map,l))},fo.prototype.touchstart=function(l){return this._firePreventable(new kl(l.type,this._map,l))},fo.prototype.touchmove=function(l){this._map.fire(new kl(l.type,this._map,l))},fo.prototype.touchend=function(l){this._map.fire(new kl(l.type,this._map,l))},fo.prototype.touchcancel=function(l){this._map.fire(new kl(l.type,this._map,l))},fo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},fo.prototype.isEnabled=function(){return!0},fo.prototype.isActive=function(){return!1},fo.prototype.enable=function(){},fo.prototype.disable=function(){};var cn=function(l){this._map=l};cn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},cn.prototype.mousemove=function(l){this._map.fire(new co(l.type,this._map,l))},cn.prototype.mousedown=function(){this._delayContextMenu=!0},cn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new co("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},cn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new co(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},cn.prototype.isEnabled=function(){return!0},cn.prototype.isActive=function(){return!1},cn.prototype.enable=function(){},cn.prototype.disable=function(){};var oo=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Gu(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}oo.prototype.isEnabled=function(){return!!this._enabled},oo.prototype.isActive=function(){return!!this._active},oo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},oo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},oo.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(G.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},oo.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(d.x,c.x),w=Math.max(d.x,c.x),T=Math.min(d.y,c.y),R=Math.max(d.y,c.y);G.setTransform(this._box,"translate("+b+"px,"+T+"px)"),this._box.style.width=w-b+"px",this._box.style.height=R-T+"px"}}},oo.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,b=f;if(this.reset(),G.suppressClick(),d.x!==b.x||d.y!==b.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},oo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},oo.prototype.blur=function(){this.reset()},oo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos},oo.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var Da=function(l){this.reset(),this.numTouches=l.numTouches};Da.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Da.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var b=new m.Point(0,0),w=0,T=d;w<T.length;w+=1)b._add(T[w]);return b.div(d.length)}(f),this.touches=Gu(c,f)))},Da.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=Gu(c,f);for(var b in this.touches){var w=d[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}},Da.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Xs=function(l){this.singleTap=new Da(l),this.numTaps=l.numTaps,this.reset()};Xs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Xs.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Xs.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Xs.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var b=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(b&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ms=function(){this._zoomIn=new Xs({numTouches:1,numTaps:2}),this._zoomOut=new Xs({numTouches:2,numTaps:1}),this.reset()};Ms.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ms.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ms.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ms.prototype.touchend=function(l,f,c){var d=this,b=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(b)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:l})}}):void 0},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(){this._enabled=!0},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var cf={0:1,2:2},Br=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Br.prototype.blur=function(){this.reset()},Br.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Br.prototype._correctButton=function(l,f){return!1},Br.prototype._move=function(l,f){return{}},Br.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=G.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Br.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,b){var w=cf[b];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Br.prototype.mouseupWindow=function(l){this._lastPoint&&G.mouseButton(l)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())},Br.prototype.enable=function(){this._enabled=!0},Br.prototype.disable=function(){this._enabled=!1,this.reset()},Br.prototype.isEnabled=function(){return this._enabled},Br.prototype.isActive=function(){return this._active};var oc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Br),ff=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=.8*(d.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Br),ul=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=-.5*(d.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Br),Sa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Sa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Sa.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Sa.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Sa.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Sa.prototype.touchcancel=function(){this.reset()},Sa.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=Gu(c,f),b=new m.Point(0,0),w=new m.Point(0,0),T=0;for(var R in d){var z=d[R],j=this._touches[R];j&&(b._add(z),w._add(z.sub(j)),T++,d[R]=z)}if(this._touches=d,!(T<this._minTouches)&&w.mag()){var ne=w.div(T);if(this._sum._add(ne),!(this._sum.mag()<this._clickTolerance))return{around:b.div(T),panDelta:ne}}},Sa.prototype.enable=function(){this._enabled=!0},Sa.prototype.disable=function(){this._enabled=!1,this.reset()},Sa.prototype.isEnabled=function(){return this._enabled},Sa.prototype.isActive=function(){return this._active};var ys=function(){this.reset()};function hf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Ou(l,f){return Math.log(l/f)/Math.LN2}ys.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ys.prototype._start=function(l){},ys.prototype._move=function(l,f,c){return{}},ys.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},ys.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,b=d[1],w=hf(c,f,d[0]),T=hf(c,f,b);if(w&&T){var R=this._aroundCenter?null:w.add(T).div(2);return this._move([w,T],R,l)}}},ys.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,b=d[1],w=hf(c,f,d[0]),T=hf(c,f,b);w&&T||(this._active&&G.suppressClick(),this.reset())}},ys.prototype.touchcancel=function(){this.reset()},ys.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ys.prototype.disable=function(){this._enabled=!1,this.reset()},ys.prototype.isEnabled=function(){return this._enabled},ys.prototype.isActive=function(){return this._active};var Fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ou(this._distance,b),pinchAround:d}},f}(ys);function Ru(l,f){return 180*l.angleWith(f)/Math.PI}var Zf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ru(this._vector,b),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,b=Ru(c,this._startVector);return Math.abs(b)<d},f}(ys);function ll(l){return Math.abs(l.y)>Math.abs(l.x)}var Vf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ll(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,b){var w=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,T,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,b){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,T=d.mag()>=2;if(w||T){if(!w||!T)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var R=c.y>0==d.y>0;return ll(c)&&ll(d)&&R}},f}(ys),pf={panStep:100,bearingStep:15,pitchStep:10},iu=function(){var l=pf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ps(l){return l*(2-l)}iu.prototype.blur=function(){this.reset()},iu.prototype.reset=function(){this._active=!1},iu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,b=0,w=0,T=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),T=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,b=0),{cameraAnimation:function(R){var z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Ps,zoom:c?Math.round(z)+c*(l.shiftKey?2:1):z,bearing:R.getBearing()+d*f._bearingStep,pitch:R.getPitch()+b*f._pitchStep,offset:[-w*f._panStep,-T*f._panStep],center:R.getCenter()},{originalEvent:l})}}}},iu.prototype.enable=function(){this._enabled=!0},iu.prototype.disable=function(){this._enabled=!1,this.reset()},iu.prototype.isEnabled=function(){return this._enabled},iu.prototype.isActive=function(){return this._active},iu.prototype.disableRotation=function(){this._rotationDisabled=!0},iu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ei=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Ei.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ei.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ei.prototype.isEnabled=function(){return!!this._enabled},Ei.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ei.prototype.isZooming=function(){return!!this._zooming},Ei.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ei.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ei.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Ei.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ei.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=G.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ei.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,T=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,R=this._startZoom,z=this._easing,j=!1;if(this._type==="wheel"&&R&&z){var ne=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),ae=z(ne);w=m.number(R,T,ae),ne<1?this._frameId||(this._frameId=!0):j=!0}else w=T,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ei.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,b=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(b*b+1e-4)*.01,T=Math.sqrt(.0729-w*w);f=m.bezier(w,T,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Ei.prototype.blur=function(){this.reset()},Ei.prototype.reset=function(){this._active=!1};var Lu=function(l,f){this._clickZoom=l,this._tapZoom=f};Lu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Lu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Lu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Lu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var au=function(){this.reset()};au.prototype.reset=function(){this._active=!1},au.prototype.blur=function(){this.reset()},au.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},au.prototype.enable=function(){this._enabled=!0},au.prototype.disable=function(){this._enabled=!1,this.reset()},au.prototype.isEnabled=function(){return this._enabled},au.prototype.isActive=function(){return this._active};var jo=function(){this._tap=new Xs({numTouches:1,numTaps:1}),this.reset()};jo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},jo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},jo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],b=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},jo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},jo.prototype.touchcancel=function(){this.reset()},jo.prototype.enable=function(){this._enabled=!0},jo.prototype.disable=function(){this._enabled=!1,this.reset()},jo.prototype.isEnabled=function(){return this._enabled},jo.prototype.isActive=function(){return this._active};var cl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};cl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},cl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},cl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},cl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Ns=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};Ns.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Ns.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Ns.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Ns.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ys=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Ys.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ys.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ys.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ys.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ys.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ys.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var _s=function(l){return l.zoom||l.drag||l.pitch||l.rotate},hu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function Tn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var xn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,b=this._listeners;d<b.length;d+=1){var w=b[d],T=w[0];G.addEventListener(T,w[1],T===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};xn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];G.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},xn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new fo(f,l));var d=f.boxZoom=new oo(f,l);this._add("boxZoom",d);var b=new Ms,w=new au;f.doubleClickZoom=new Lu(w,b),this._add("tapZoom",b),this._add("clickZoom",w);var T=new jo;this._add("tapDragZoom",T);var R=f.touchPitch=new Vf;this._add("touchPitch",R);var z=new ff(l),j=new ul(l);f.dragRotate=new Ns(l,z,j),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);var ne=new oc(l),ae=new Sa(l);f.dragPan=new cl(c,ne,ae),this._add("mousePan",ne),this._add("touchPan",ae,["touchZoom","touchRotate"]);var oe=new Zf,Se=new Fs;f.touchZoomRotate=new Ys(c,Se,oe,T),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",Se,["touchPan","touchRotate"]);var Me=f.scrollZoom=new Ei(f,this);this._add("scrollZoom",Me,["mousePan"]);var Ve=f.keyboard=new iu;this._add("keyboard",Ve),this._add("blockableMapEvent",new cn(f));for(var be=0,ze=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];be<ze.length;be+=1){var Xe=ze[be];l.interactive&&l[Xe]&&f[Xe].enable(l[Xe])}},xn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},xn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},xn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},xn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},xn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},xn.prototype.isMoving=function(){return Boolean(_s(this._eventsInProgress))||this.isZooming()},xn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},xn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},xn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var b=d[c];this._el.contains(b.target)&&f.push(b)}return f},xn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},b={},w={},T=l.touches?this._getMapTouches(l.touches):void 0,R=T?G.touchPos(this._el,T):G.mousePos(this._el,l),z=0,j=this._handlers;z<j.length;z+=1){var ne=j[z],ae=ne.handlerName,oe=ne.handler,Se=ne.allowed;if(oe.isEnabled()){var Me=void 0;this._blockedByActive(w,Se,ae)?oe.reset():oe[f||l.type]&&(Me=oe[f||l.type](l,R,T),this.mergeHandlerResult(d,b,Me,ae,c),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()),(Me||oe.isActive())&&(w[ae]=oe)}}var Ve={};for(var be in this._previousActiveHandlers)w[be]||(Ve[be]=c);this._previousActiveHandlers=w,(Object.keys(Ve).length||Tn(d))&&(this._changes.push([d,b,Ve]),this._triggerRenderFrame()),(Object.keys(w).length||Tn(d))&&this._map._stop(!0),this._updatingCamera=!1;var ze=d.cameraAnimation;ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ze(this._map))},xn.prototype.mergeHandlerResult=function(l,f,c,d,b){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},xn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,b=this._changes;d<b.length;d+=1){var w=b[d],T=w[0],R=w[1],z=w[2];T.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(l.around=T.around),T.pinchAround!==void 0&&(l.pinchAround=T.pinchAround),T.noInertia&&(l.noInertia=T.noInertia),m.extend(f,R),m.extend(c,z)}this._updateMapTransform(l,f,c),this._changes=[]},xn.prototype._updateMapTransform=function(l,f,c){var d=this._map,b=d.transform;if(!Tn(l))return this._fireEvents(f,c,!0);var w=l.panDelta,T=l.zoomDelta,R=l.bearingDelta,z=l.pitchDelta,j=l.around,ne=l.pinchAround;ne!==void 0&&(j=ne),d._stop(!0),j=j||d.transform.centerPoint;var ae=b.pointLocation(w?j.sub(w):j);R&&(b.bearing+=R),z&&(b.pitch+=z),T&&(b.zoom+=T),b.setLocationAtPoint(ae,j),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},xn.prototype._fireEvents=function(l,f,c){var d=this,b=_s(this._eventsInProgress),w=_s(l),T={};for(var R in l)this._eventsInProgress[R]||(T[R+"start"]=l[R].originalEvent),this._eventsInProgress[R]=l[R];for(var z in!b&&w&&this._fireEvent("movestart",w.originalEvent),T)this._fireEvent(z,T[z]);for(var j in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(j,l[j].originalEvent);var ne,ae={};for(var oe in this._eventsInProgress){var Se=this._eventsInProgress[oe],Me=Se.handlerName,Ve=Se.originalEvent;this._handlersById[Me].isActive()||(delete this._eventsInProgress[oe],ae[oe+"end"]=ne=f[Me]||Ve)}for(var be in ae)this._fireEvent(be,ae[be]);var ze=_s(this._eventsInProgress);if(c&&(b||w)&&!ze){this._updatingCamera=!0;var Xe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ut=function(Ut){return Ut!==0&&-d._bearingSnap<Ut&&Ut<d._bearingSnap};Xe?(ut(Xe.bearing||this._map.getBearing())&&(Xe.bearing=0),this._map.easeTo(Xe,{originalEvent:ne})):(this._map.fire(new m.Event("moveend",{originalEvent:ne})),ut(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},xn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},xn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new hu("renderFrame",{timeStamp:f})),l._applyChanges()})},xn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Dc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,b){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),b)},f.prototype.panTo=function(c,d,b){return this.easeTo(m.extend({center:c},d),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,b){return this.easeTo(m.extend({zoom:c},d),b)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,b){return this.easeTo(m.extend({bearing:c},d),b)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var b=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,d)},f.prototype._cameraForBoxAndBearing=function(c,d,b,w){var T={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var R=w.padding;w.padding={top:R,bottom:R,right:R,left:R}}w.padding=m.extend(T,w.padding);var z=this.transform,j=z.padding,ne=z.project(m.LngLat.convert(c)),ae=z.project(m.LngLat.convert(d)),oe=ne.rotate(-b*Math.PI/180),Se=ae.rotate(-b*Math.PI/180),Me=new m.Point(Math.max(oe.x,Se.x),Math.max(oe.y,Se.y)),Ve=new m.Point(Math.min(oe.x,Se.x),Math.min(oe.y,Se.y)),be=Me.sub(Ve),ze=(z.width-(j.left+j.right+w.padding.left+w.padding.right))/be.x,Xe=(z.height-(j.top+j.bottom+w.padding.top+w.padding.bottom))/be.y;if(!(Xe<0||ze<0)){var ut=Math.min(z.scaleZoom(z.scale*Math.min(ze,Xe)),w.maxZoom),Ut=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Ot=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(b*Math.PI/180),Zt=Ut.add(Ot).mult(z.scale/z.zoomScale(ut));return{center:z.unproject(ne.add(ae).div(2).sub(Zt)),zoom:ut,bearing:b}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,b){return this._fitInternal(this.cameraForBounds(c,d),d,b)},f.prototype.fitScreenCoordinates=function(c,d,b,w,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),b,w),w,T)},f.prototype._fitInternal=function(c,d,b){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,b):this.flyTo(d,b)):this},f.prototype.jumpTo=function(c,d){this.stop();var b=this.transform,w=!1,T=!1,R=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(w=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=m.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(T=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(R=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),T&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),R&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var b=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,T=this.getZoom(),R=this.getBearing(),z=this.getPitch(),j=this.getPadding(),ne="zoom"in c?+c.zoom:T,ae="bearing"in c?this._normalizeBearing(c.bearing,R):R,oe="pitch"in c?+c.pitch:z,Se="padding"in c?c.padding:w.padding,Me=m.Point.convert(c.offset),Ve=w.centerPoint.add(Me),be=w.pointLocation(Ve),ze=m.LngLat.convert(c.center||be);this._normalizeCenter(ze);var Xe,ut,Ut=w.project(be),Ot=w.project(ze).sub(Ut),Zt=w.zoomScale(ne-T);c.around&&(Xe=m.LngLat.convert(c.around),ut=w.locationPoint(Xe));var lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ne!==T,this._rotating=this._rotating||R!==ae,this._pitching=this._pitching||oe!==z,this._padding=!w.isPaddingEqual(Se),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,lr),this._ease(function(Or){if(b._zooming&&(w.zoom=m.number(T,ne,Or)),b._rotating&&(w.bearing=m.number(R,ae,Or)),b._pitching&&(w.pitch=m.number(z,oe,Or)),b._padding&&(w.interpolatePadding(j,Se,Or),Ve=w.centerPoint.add(Me)),Xe)w.setLocationAtPoint(Xe,ut);else{var Pr=w.zoomScale(w.zoom-T),$r=ne>T?Math.min(2,Zt):Math.max(.5,Zt),Ln=Math.pow($r,1-Or),Fn=w.unproject(Ut.add(Ot.mult(Or*Ln)).mult(Pr));w.setLocationAtPoint(w.renderWorldCopies?Fn.wrap():Fn,Ve)}b._fireMoveEvents(d)},function(Or){b._afterEase(d,Or)},c),this},f.prototype._prepareEase=function(c,d,b){b===void 0&&(b={}),this._moving=!0,d||b.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var b=this._zooming,w=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),T&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var b=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var T=this.transform,R=this.getZoom(),z=this.getBearing(),j=this.getPitch(),ne=this.getPadding(),ae="zoom"in c?m.clamp(+c.zoom,T.minZoom,T.maxZoom):R,oe="bearing"in c?this._normalizeBearing(c.bearing,z):z,Se="pitch"in c?+c.pitch:j,Me="padding"in c?c.padding:T.padding,Ve=T.zoomScale(ae-R),be=m.Point.convert(c.offset),ze=T.centerPoint.add(be),Xe=T.pointLocation(ze),ut=m.LngLat.convert(c.center||Xe);this._normalizeCenter(ut);var Ut=T.project(Xe),Ot=T.project(ut).sub(Ut),Zt=c.curve,lr=Math.max(T.width,T.height),Or=lr/Ve,Pr=Ot.mag();if("minZoom"in c){var $r=m.clamp(Math.min(c.minZoom,R,ae),T.minZoom,T.maxZoom),Ln=lr/T.zoomScale($r-R);Zt=Math.sqrt(Ln/Pr*2)}var Fn=Zt*Zt;function zn(Xn){var Zn=(Or*Or-lr*lr+(Xn?-1:1)*Fn*Fn*Pr*Pr)/(2*(Xn?Or:lr)*Fn*Pr);return Math.log(Math.sqrt(Zn*Zn+1)-Zn)}function ui(Xn){return(Math.exp(Xn)-Math.exp(-Xn))/2}function rn(Xn){return(Math.exp(Xn)+Math.exp(-Xn))/2}var ti=zn(0),ai=function(Xn){return rn(ti)/rn(ti+Zt*Xn)},$n=function(Xn){return lr*((rn(ti)*(ui(Zn=ti+Zt*Xn)/rn(Zn))-ui(ti))/Fn)/Pr;var Zn},Gn=(zn(1)-ti)/Zt;if(Math.abs(Pr)<1e-6||!isFinite(Gn)){if(Math.abs(lr-Or)<1e-6)return this.easeTo(c,d);var fi=Or<lr?-1:1;Gn=Math.abs(Math.log(Or/lr))/Zt,$n=function(){return 0},ai=function(Xn){return Math.exp(fi*Zt*Xn)}}return c.duration="duration"in c?+c.duration:1e3*Gn/("screenSpeed"in c?+c.screenSpeed/Zt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=z!==oe,this._pitching=Se!==j,this._padding=!T.isPaddingEqual(Me),this._prepareEase(d,!1),this._ease(function(Xn){var Zn=Xn*Gn,xa=1/ai(Zn);T.zoom=Xn===1?ae:R+T.scaleZoom(xa),b._rotating&&(T.bearing=m.number(z,oe,Xn)),b._pitching&&(T.pitch=m.number(j,Se,Xn)),b._padding&&(T.interpolatePadding(ne,Me,Xn),ze=T.centerPoint.add(be));var Xa=Xn===1?ut:T.unproject(Ut.add(Ot.mult($n(Zn))).mult(xa));T.setLocationAtPoint(T.renderWorldCopies?Xa.wrap():Xa,ze),b._fireMoveEvents(d)},function(){return b._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,d,b){b.animate===!1||b.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var b=Math.abs(c-d);return Math.abs(c-360-d)<b&&(c-=360),Math.abs(c+360-d)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var b=c.lng-d.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(m.Evented),rs=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};rs.prototype.getDefaultPosition=function(){return"bottom-right"},rs.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},rs.prototype.onRemove=function(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},rs.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},rs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},rs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,b,w){return b.value&&(d+=b.key+"="+b.value+(w<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},rs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},rs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var b=c[d];if(b.used){var w=b.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(R,z){return R.length-z.length});var T=(l=l.filter(function(R,z){for(var j=z+1;j<l.length;j++)if(l[j].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,l.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},rs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ns=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};ns.prototype.onAdd=function(l){this._map=l,this._container=G.create("div","mapboxgl-ctrl");var f=G.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ns.prototype.onRemove=function(){G.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ns.prototype.getDefaultPosition=function(){return"bottom-left"},ns.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ns.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},ns.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Fo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Fo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Fo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var b=d[c];if(b.id===l)return void(b.cancelled=!0)}},Fo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var b=d[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Fo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Hu=m.window.HTMLImageElement,Wu=m.window.HTMLElement,na=m.window.ImageBitmap,_a={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},sc=function(l){function f(d){var b=this;if((d=m.extend({},_a,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Gi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Fo,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},wa,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Wu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new xn(this,d),this._hash=d.hash&&new gs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new rs({customAttribution:d.customAttribution})),this.addControl(new ns,d.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(T){b._update(T.dataType==="style"),b.fire(new m.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){b.fire(new m.Event(T.dataType+"dataloading",T))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,b){if(b===void 0&&(b=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var T=this._controlPositions[b];return b.indexOf("bottom")!==-1?T.insertBefore(w,T.firstChild):T.appendChild(w),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(d);return b>-1&&this._controls.splice(b,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var b=this._containerDimensions(),w=b[0],T=b[1];if(w===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(w,T),this.transform.resize(w,T),this.painter.resize(w,T);var R=!this._moving;return R&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),R&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,b,w){var T,R=this;if(d==="mouseenter"||d==="mouseover"){var z=!1;return{layer:b,listener:w,delegates:{mousemove:function(ne){var ae=R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[];ae.length?z||(z=!0,w.call(R,new co(d,R,ne.originalEvent,{features:ae}))):z=!1},mouseout:function(){z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var j=!1;return{layer:b,listener:w,delegates:{mousemove:function(ne){(R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[]).length?j=!0:j&&(j=!1,w.call(R,new co(d,R,ne.originalEvent)))},mouseout:function(ne){j&&(j=!1,w.call(R,new co(d,R,ne.originalEvent)))}}}}return{layer:b,listener:w,delegates:(T={},T[d]=function(ne){var ae=R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[];ae.length&&(ne.features=ae,w.call(R,ne),delete ne.features)},T)}},f.prototype.on=function(d,b,w){if(w===void 0)return l.prototype.on.call(this,d,b);var T=this._createDelegatedListener(d,b,w);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(T),T.delegates)this.on(R,T.delegates[R]);return this},f.prototype.once=function(d,b,w){if(w===void 0)return l.prototype.once.call(this,d,b);var T=this._createDelegatedListener(d,b,w);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},f.prototype.off=function(d,b,w){var T=this;return w===void 0?l.prototype.off.call(this,d,b):(this._delegatedListeners&&this._delegatedListeners[d]&&function(R){for(var z=R[d],j=0;j<z.length;j++){var ne=z[j];if(ne.layer===b&&ne.listener===w){for(var ae in ne.delegates)T.off(ae,ne.delegates[ae]);return z.splice(j,1),T}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,b){if(!this.style)return[];var w;if(b!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(b=d,d=void 0),b=b||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var T=m.Point.convert(d[0]),R=m.Point.convert(d[1]);w=[T,new m.Point(R.x,T.y),R,new m.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(w,b,this.transform)},f.prototype.querySourceFeatures=function(d,b){return this.style.querySourceFeatures(d,b)},f.prototype.setStyle=function(d,b){return(b=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(d,b))},f.prototype._getUIString=function(d){var b=this._locale[d];if(b==null)throw new Error("Missing UI string '"+d+"'");return b},f.prototype._updateStyle=function(d,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new vs(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,b){var w=this;if(typeof d=="string"){var T=this._requestManager.normalizeStyleURL(d),R=this._requestManager.transformRequest(T,m.ResourceType.Style);m.getJSON(R,function(z,j){z?w.fire(new m.ErrorEvent(z)):j&&w._updateDiff(j,b)})}else typeof d=="object"&&this._updateDiff(d,b)},f.prototype._updateDiff=function(d,b){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,b){return this._lazyInitEmptyStyle(),this.style.addSource(d,b),this._update(!0)},f.prototype.isSourceLoaded=function(d){var b=this.style&&this.style.sourceCaches[d];if(b!==void 0)return b.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var b in d){var w=d[b]._tiles;for(var T in w){var R=w[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,b,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,b,w)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,b,w){w===void 0&&(w={});var T=w.pixelRatio;T===void 0&&(T=1);var R=w.sdf;R===void 0&&(R=!1);var z=w.stretchX,j=w.stretchY,ne=w.content;if(this._lazyInitEmptyStyle(),b instanceof Hu||na&&b instanceof na){var ae=m.browser.getImageData(b);this.style.addImage(d,{data:new m.RGBAImage({width:ae.width,height:ae.height},ae.data),pixelRatio:T,stretchX:z,stretchY:j,content:ne,sdf:R,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var oe=b;this.style.addImage(d,{data:new m.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:T,stretchX:z,stretchY:j,content:ne,sdf:R,version:0,userImage:oe}),oe.onAdd&&oe.onAdd(this,d)}},f.prototype.updateImage=function(d,b){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=b instanceof Hu||na&&b instanceof na?m.browser.getImageData(b):b,R=T.width,z=T.height,j=T.data;return R===void 0||z===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==w.data.width||z!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(j,!(b instanceof Hu||na&&b instanceof na)),void this.style.updateImage(d,w))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,b){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,b){return this._lazyInitEmptyStyle(),this.style.addLayer(d,b),this._update(!0)},f.prototype.moveLayer=function(d,b){return this.style.moveLayer(d,b),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,b,w){return this.style.setLayerZoomRange(d,b,w),this._update(!0)},f.prototype.setFilter=function(d,b,w){return w===void 0&&(w={}),this.style.setFilter(d,b,w),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,b,w,T){return T===void 0&&(T={}),this.style.setPaintProperty(d,b,w,T),this._update(!0)},f.prototype.getPaintProperty=function(d,b){return this.style.getPaintProperty(d,b)},f.prototype.setLayoutProperty=function(d,b,w,T){return T===void 0&&(T={}),this.style.setLayoutProperty(d,b,w,T),this._update(!0)},f.prototype.getLayoutProperty=function(d,b){return this.style.getLayoutProperty(d,b)},f.prototype.setLight=function(d,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(d,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,b){return this.style.setFeatureState(d,b),this._update()},f.prototype.removeFeatureState=function(d,b){return this.style.removeFeatureState(d,b),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,b=0;return this._container&&(d=this._container.clientWidth||400,b=this._container.clientHeight||300),[d,b]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=G.create("div","mapboxgl-canvas-container",d);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var T=this._controlContainer=G.create("div","mapboxgl-control-container",d),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){R[z]=G.create("div","mapboxgl-ctrl-"+z,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,b){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*b,this._canvas.style.width=d+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var d=m.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);b?(this.painter=new Wi(b,this.transform),m.webpSupported.testSupport(b)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var b,w=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,b),T=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var j=this.transform.zoom,ne=m.browser.now();this.style.zoomHistory.update(j,ne);var ae=new m.EvaluationParameters(j,{now:ne,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),oe=ae.crossFadingFactor();oe===1&&oe===this._crossFadingFactor||(z=!0,this._crossFadingFactor=oe),this.style.update(ae)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Se=m.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,b),setTimeout(function(){var be=R.getQueryObjectEXT(b,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(b),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Se,gpuTime:be}))},50)}if(this.listens("gpu-timing-layer")){var Me=this.painter.collectGpuTimers();setTimeout(function(){var be=w.painter.queryGpuTimers(Me);w.fire(new m.Event("gpu-timing-layer",{layerTimes:be}))},50)}var Ve=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ve||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||Ve||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,b=this._controls;d<b.length;d+=1)b[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),fl(this._canvasContainer),fl(this._controlContainer),fl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(b){d._frame=null,d._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,b){m.setCacheLimits(d,b)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(Dc);function fl(l){l.parentNode&&l.parentNode.removeChild(l)}var pu={showCompass:!0,showZoom:!0,visualizePitch:!1},du=function(l){var f=this;this.options=m.extend({},pu,l),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};du.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},du.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},du.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Eo(this._map,this._compass,this.options.visualizePitch)),this._container},du.prototype.onRemove=function(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},du.prototype._createButton=function(l,f){var c=G.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},du.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var Eo=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new ff({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ul({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),G.addEventListener(f,"mousedown",this.mousedown),G.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(f,"touchmove",this.touchmove),G.addEventListener(f,"touchend",this.touchend),G.addEventListener(f,"touchcancel",this.reset)};function Xu(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),b=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<w?l=d:c.locationPoint(b).distSqr(f)<w&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var T=c.locationPoint(l);if(T.x>=0&&T.y>=0&&T.x<=c.width&&T.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Eo.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),G.disableDrag()},Eo.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},Eo.prototype.off=function(){var l=this.element;G.removeEventListener(l,"mousedown",this.mousedown),G.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(l,"touchmove",this.touchmove),G.removeEventListener(l,"touchend",this.touchend),G.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Eo.prototype.offTemp=function(){G.enableDrag(),G.removeEventListener(m.window,"mousemove",this.mousemove),G.removeEventListener(m.window,"mouseup",this.mouseup)},Eo.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),G.mousePos(this.element,l)),G.addEventListener(m.window,"mousemove",this.mousemove),G.addEventListener(m.window,"mouseup",this.mouseup)},Eo.prototype.mousemove=function(l){this.move(l,G.mousePos(this.element,l))},Eo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Eo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Eo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Eo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Eo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var vu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dl(l,f,c){var d=l.classList;for(var b in vu)d.remove("mapboxgl-"+c+"-anchor-"+b);d.add("mapboxgl-"+c+"-anchor-"+f)}var Yu,uc=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");var b=G.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var w=G.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var T=G.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=G.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var z=0,j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<j.length;z+=1){var ne=j[z],ae=G.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",ne.rx),ae.setAttributeNS(null,"ry",ne.ry),R.appendChild(ae)}var oe=G.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"fill",this._color);var Se=G.createNS("http://www.w3.org/2000/svg","path");Se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),oe.appendChild(Se);var Me=G.createNS("http://www.w3.org/2000/svg","g");Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"fill","#000000");var Ve=G.createNS("http://www.w3.org/2000/svg","path");Ve.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Me.appendChild(Ve);var be=G.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"transform","translate(6.0, 7.0)"),be.setAttributeNS(null,"fill","#FFFFFF");var ze=G.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Xe=G.createNS("http://www.w3.org/2000/svg","circle");Xe.setAttributeNS(null,"fill","#000000"),Xe.setAttributeNS(null,"opacity","0.25"),Xe.setAttributeNS(null,"cx","5.5"),Xe.setAttributeNS(null,"cy","5.5"),Xe.setAttributeNS(null,"r","5.4999962");var ut=G.createNS("http://www.w3.org/2000/svg","circle");ut.setAttributeNS(null,"fill","#FFFFFF"),ut.setAttributeNS(null,"cx","5.5"),ut.setAttributeNS(null,"cy","5.5"),ut.setAttributeNS(null,"r","5.4999962"),ze.appendChild(Xe),ze.appendChild(ut),T.appendChild(R),T.appendChild(oe),T.appendChild(Me),T.appendChild(be),T.appendChild(ze),b.appendChild(T),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ut){Ut.preventDefault()}),this._element.addEventListener("mousedown",function(Ut){Ut.preventDefault()}),Dl(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,b=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,b=this._element;this._popup&&(d===b||b.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Xu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,vu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Fc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},lc=0,Fl=!1,jf=function(l){function f(c){l.call(this),this.options=m.extend({},Fc,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Yu!==void 0?d(Yu):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(b){d(Yu=b.state!=="denied")}):d(Yu=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,lc=0,Fl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),b=c.coords;return d&&(b.longitude<d.getWest()||b.longitude>d.getEast()||b.latitude<d.getSouth()||b.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,w=this._map.getBearing(),T=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(b),T,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),b=this._map.unproject([1,c]),w=d.distanceTo(b),T=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Fl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new uc(this._dotElement),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new uc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||d._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lc--,Fl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++lc>1?(c={maximumAge:6e5,timeout:0},Fl=!0):(c=this.options.positionOptions,Fl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),hl={maxWidth:100,unit:"metric"},pl=function(l){this.options=m.extend({},hl,l),m.bindAll(["_onMove","setUnit"],this)};function Bs(l,f,c){var d=c&&c.maxWidth||100,b=l._container.clientHeight/2,w=l.unproject([0,b]),T=l.unproject([d,b]),R=w.distanceTo(T);if(c&&c.unit==="imperial"){var z=3.2808*R;z>5280?dl(f,d,z/5280,l._getUIString("ScaleControl.Miles")):dl(f,d,z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?dl(f,d,R/1852,l._getUIString("ScaleControl.NauticalMiles")):R>=1e3?dl(f,d,R/1e3,l._getUIString("ScaleControl.Kilometers")):dl(f,d,R,l._getUIString("ScaleControl.Meters"))}function dl(l,f,c,d){var b,w,T,R=(b=c,(w=Math.pow(10,(""+Math.floor(b)).length-1))*(T=(T=b/w)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(z){var j=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*j)/j}(T)));l.style.width=f*(R/c)+"px",l.innerHTML=R+"&nbsp;"+d}pl.prototype.getDefaultPosition=function(){return"bottom-left"},pl.prototype._onMove=function(){Bs(this._map,this._container,this.options)},pl.prototype.onAdd=function(l){return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},pl.prototype.onRemove=function(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},pl.prototype.setUnit=function(l){this.options.unit=l,Bs(this._map,this._container,this.options)};var Go=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Go.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Go.prototype.onRemove=function(){G.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Go.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Go.prototype._setupUI=function(){var l=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Go.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Go.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Go.prototype._isFullscreen=function(){return this._fullscreen},Go.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Go.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var df={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Nc=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(df),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,b=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)b.appendChild(d);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ae){return d._container.classList.add(ae)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,T=function ae(oe){if(oe){if(typeof oe=="number"){var Se=Math.round(Math.sqrt(.5*Math.pow(oe,2)));return{center:new m.Point(0,0),top:new m.Point(0,oe),"top-left":new m.Point(Se,Se),"top-right":new m.Point(-Se,Se),bottom:new m.Point(0,-oe),"bottom-left":new m.Point(Se,-Se),"bottom-right":new m.Point(-Se,-Se),left:new m.Point(oe,0),right:new m.Point(-oe,0)}}if(oe instanceof m.Point||Array.isArray(oe)){var Me=m.Point.convert(oe);return{center:Me,top:Me,"top-left":Me,"top-right":Me,bottom:Me,"bottom-left":Me,"bottom-right":Me,left:Me,right:Me}}return{center:m.Point.convert(oe.center||[0,0]),top:m.Point.convert(oe.top||[0,0]),"top-left":m.Point.convert(oe["top-left"]||[0,0]),"top-right":m.Point.convert(oe["top-right"]||[0,0]),bottom:m.Point.convert(oe.bottom||[0,0]),"bottom-left":m.Point.convert(oe["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(oe["bottom-right"]||[0,0]),left:m.Point.convert(oe.left||[0,0]),right:m.Point.convert(oe.right||[0,0])}}return ae(new m.Point(0,0))}(this.options.offset);if(!w){var R,z=this._container.offsetWidth,j=this._container.offsetHeight;R=b.y+T.bottom.y<j?["top"]:b.y>this._map.transform.height-j?["bottom"]:[],b.x<z/2?R.push("left"):b.x>this._map.transform.width-z/2&&R.push("right"),w=R.length===0?"bottom":R.join("-")}var ne=b.add(T[w]).round();G.setTransform(this._container,vu[w]+" translate("+ne.x+"px,"+ne.y+"px)"),Dl(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Nl);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),cc={version:m.version,supported:Ie,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:sc,NavigationControl:du,GeolocateControl:jf,AttributionControl:rs,ScaleControl:pl,FullscreenControl:Go,Popup:Nc,Marker:uc,Style:vs,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Et().acquire(Pt)},clearPrewarmedResources:function(){var l=vn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Pt),vn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return hr.workerCount},set workerCount(l){hr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return cc}),Pe})},78892:function(Cr,te,$){var Pe=$(97671);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var me;(function(m){(function(Ie){var G=typeof $.g=="object"?$.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=he(m);typeof G.Reflect=="undefined"?G.Reflect=m:ce=he(G.Reflect,ce),Ie(ce);function he(Fe,ge){return function(Qe,ct){typeof Fe[Qe]!="function"&&Object.defineProperty(Fe,Qe,{configurable:!0,writable:!0,value:ct}),ge&&ge(Qe,ct)}}})(function(Ie){var G=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",he=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Fe=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ge=typeof Object.create=="function",Qe={__proto__:[]}instanceof Array,ct=!ge&&!Qe,xt={create:ge?function(){return Js(Object.create(null))}:Qe?function(){return Js({__proto__:null})}:function(){return Js({})},has:ct?function(kt,Kt){return G.call(kt,Kt)}:function(kt,Kt){return Kt in kt},get:ct?function(kt,Kt){return G.call(kt,Kt)?kt[Kt]:void 0}:function(kt,Kt){return kt[Kt]}},Qt=Object.getPrototypeOf(Function),ur=typeof Pe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Mt=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:le(),Jt=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ii(),zt=!ur&&typeof WeakMap=="function"?WeakMap:mo(),lt=new zt;function pt(kt,Kt,Ir,nn){if(dn(Ir)){if(!Di(kt))throw new TypeError;if(!pa(Kt))throw new TypeError;return Vr(kt,Kt)}else{if(!Di(kt))throw new TypeError;if(!ni(Kt))throw new TypeError;if(!ni(nn)&&!dn(nn)&&!di(nn))throw new TypeError;return di(nn)&&(nn=void 0),Ir=Hi(Ir),en(kt,Kt,Ir,nn)}}Ie("decorate",pt);function ir(kt,Kt){function Ir(nn,Sn){if(!ni(nn))throw new TypeError;if(!dn(Sn)&&!Lo(Sn))throw new TypeError;It(kt,Kt,nn,Sn)}return Ir}Ie("metadata",ir);function W(kt,Kt,Ir,nn){if(!ni(Ir))throw new TypeError;return dn(nn)||(nn=Hi(nn)),It(kt,Kt,Ir,nn)}Ie("defineMetadata",W);function Wt(kt,Kt,Ir){if(!ni(Kt))throw new TypeError;return dn(Ir)||(Ir=Hi(Ir)),Ee(kt,Kt,Ir)}Ie("hasMetadata",Wt);function ot(kt,Kt,Ir){if(!ni(Kt))throw new TypeError;return dn(Ir)||(Ir=Hi(Ir)),Re(kt,Kt,Ir)}Ie("hasOwnMetadata",ot);function Ye(kt,Kt,Ir){if(!ni(Kt))throw new TypeError;return dn(Ir)||(Ir=Hi(Ir)),yt(kt,Kt,Ir)}Ie("getMetadata",Ye);function bt(kt,Kt,Ir){if(!ni(Kt))throw new TypeError;return dn(Ir)||(Ir=Hi(Ir)),ft(kt,Kt,Ir)}Ie("getOwnMetadata",bt);function Ke(kt,Kt){if(!ni(kt))throw new TypeError;return dn(Kt)||(Kt=Hi(Kt)),Ht(kt,Kt)}Ie("getMetadataKeys",Ke);function Xt(kt,Kt){if(!ni(kt))throw new TypeError;return dn(Kt)||(Kt=Hi(Kt)),xr(kt,Kt)}Ie("getOwnMetadataKeys",Xt);function Sr(kt,Kt,Ir){if(!ni(Kt))throw new TypeError;dn(Ir)||(Ir=Hi(Ir));var nn=C(Kt,Ir,!1);if(dn(nn)||!nn.delete(kt))return!1;if(nn.size>0)return!0;var Sn=lt.get(Kt);return Sn.delete(Ir),Sn.size>0||lt.delete(Kt),!0}Ie("deleteMetadata",Sr);function Vr(kt,Kt){for(var Ir=kt.length-1;Ir>=0;--Ir){var nn=kt[Ir],Sn=nn(Kt);if(!dn(Sn)&&!di(Sn)){if(!pa(Sn))throw new TypeError;Kt=Sn}}return Kt}function en(kt,Kt,Ir,nn){for(var Sn=kt.length-1;Sn>=0;--Sn){var Bn=kt[Sn],yi=Bn(Kt,Ir,nn);if(!dn(yi)&&!di(yi)){if(!ni(yi))throw new TypeError;nn=yi}}return nn}function C(kt,Kt,Ir){var nn=lt.get(kt);if(dn(nn)){if(!Ir)return;nn=new Mt,lt.set(kt,nn)}var Sn=nn.get(Kt);if(dn(Sn)){if(!Ir)return;Sn=new Mt,nn.set(Kt,Sn)}return Sn}function Ee(kt,Kt,Ir){var nn=Re(kt,Kt,Ir);if(nn)return!0;var Sn=Cs(Kt);return di(Sn)?!1:Ee(kt,Sn,Ir)}function Re(kt,Kt,Ir){var nn=C(Kt,Ir,!1);return dn(nn)?!1:mi(nn.has(kt))}function yt(kt,Kt,Ir){var nn=Re(kt,Kt,Ir);if(nn)return ft(kt,Kt,Ir);var Sn=Cs(Kt);if(!di(Sn))return yt(kt,Sn,Ir)}function ft(kt,Kt,Ir){var nn=C(Kt,Ir,!1);if(!dn(nn))return nn.get(kt)}function It(kt,Kt,Ir,nn){var Sn=C(Ir,nn,!0);Sn.set(kt,Kt)}function Ht(kt,Kt){var Ir=xr(kt,Kt),nn=Cs(kt);if(nn===null)return Ir;var Sn=Ht(nn,Kt);if(Sn.length<=0)return Ir;if(Ir.length<=0)return Sn;for(var Bn=new Jt,yi=[],li=0,_n=Ir;li<_n.length;li++){var Oi=_n[li],Mi=Bn.has(Oi);Mi||(Bn.add(Oi),yi.push(Oi))}for(var Ja=0,fs=Sn;Ja<fs.length;Ja++){var Oi=fs[Ja],Mi=Bn.has(Oi);Mi||(Bn.add(Oi),yi.push(Oi))}return yi}function xr(kt,Kt){var Ir=[],nn=C(kt,Kt,!1);if(dn(nn))return Ir;for(var Sn=nn.keys(),Bn=ga(Sn),yi=0;;){var li=aa(Bn);if(!li)return Ir.length=yi,Ir;var _n=Bi(li);try{Ir[yi]=_n}catch(Oi){try{Ji(Bn)}finally{throw Oi}}yi++}}function Kn(kt){if(kt===null)return 1;switch(typeof kt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return kt===null?1:6;default:return 6}}function dn(kt){return kt===void 0}function di(kt){return kt===null}function jn(kt){return typeof kt=="symbol"}function ni(kt){return typeof kt=="object"?kt!==null:typeof kt=="function"}function vi(kt,Kt){switch(Kn(kt)){case 0:return kt;case 1:return kt;case 2:return kt;case 3:return kt;case 4:return kt;case 5:return kt}var Ir=Kt===3?"string":Kt===5?"number":"default",nn=La(kt,he);if(nn!==void 0){var Sn=nn.call(kt,Ir);if(ni(Sn))throw new TypeError;return Sn}return Hn(kt,Ir==="default"?"number":Ir)}function Hn(kt,Kt){if(Kt==="string"){var Ir=kt.toString;if(Qi(Ir)){var nn=Ir.call(kt);if(!ni(nn))return nn}var Sn=kt.valueOf;if(Qi(Sn)){var nn=Sn.call(kt);if(!ni(nn))return nn}}else{var Sn=kt.valueOf;if(Qi(Sn)){var nn=Sn.call(kt);if(!ni(nn))return nn}var Bn=kt.toString;if(Qi(Bn)){var nn=Bn.call(kt);if(!ni(nn))return nn}}throw new TypeError}function mi(kt){return!!kt}function ha(kt){return""+kt}function Hi(kt){var Kt=vi(kt,3);return jn(Kt)?Kt:ha(Kt)}function Di(kt){return Array.isArray?Array.isArray(kt):kt instanceof Object?kt instanceof Array:Object.prototype.toString.call(kt)==="[object Array]"}function Qi(kt){return typeof kt=="function"}function pa(kt){return typeof kt=="function"}function Lo(kt){switch(Kn(kt)){case 3:return!0;case 4:return!0;default:return!1}}function La(kt,Kt){var Ir=kt[Kt];if(Ir!=null){if(!Qi(Ir))throw new TypeError;return Ir}}function ga(kt){var Kt=La(kt,Fe);if(!Qi(Kt))throw new TypeError;var Ir=Kt.call(kt);if(!ni(Ir))throw new TypeError;return Ir}function Bi(kt){return kt.value}function aa(kt){var Kt=kt.next();return Kt.done?!1:Kt}function Ji(kt){var Kt=kt.return;Kt&&Kt.call(kt)}function Cs(kt){var Kt=Object.getPrototypeOf(kt);if(typeof kt!="function"||kt===Qt||Kt!==Qt)return Kt;var Ir=kt.prototype,nn=Ir&&Object.getPrototypeOf(Ir);if(nn==null||nn===Object.prototype)return Kt;var Sn=nn.constructor;return typeof Sn!="function"||Sn===kt?Kt:Sn}function le(){var kt={},Kt=[],Ir=function(){function yi(li,_n,Oi){this._index=0,this._keys=li,this._values=_n,this._selector=Oi}return yi.prototype["@@iterator"]=function(){return this},yi.prototype[Fe]=function(){return this},yi.prototype.next=function(){var li=this._index;if(li>=0&&li<this._keys.length){var _n=this._selector(this._keys[li],this._values[li]);return li+1>=this._keys.length?(this._index=-1,this._keys=Kt,this._values=Kt):this._index++,{value:_n,done:!1}}return{value:void 0,done:!0}},yi.prototype.throw=function(li){throw this._index>=0&&(this._index=-1,this._keys=Kt,this._values=Kt),li},yi.prototype.return=function(li){return this._index>=0&&(this._index=-1,this._keys=Kt,this._values=Kt),{value:li,done:!0}},yi}();return function(){function yi(){this._keys=[],this._values=[],this._cacheKey=kt,this._cacheIndex=-2}return Object.defineProperty(yi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),yi.prototype.has=function(li){return this._find(li,!1)>=0},yi.prototype.get=function(li){var _n=this._find(li,!1);return _n>=0?this._values[_n]:void 0},yi.prototype.set=function(li,_n){var Oi=this._find(li,!0);return this._values[Oi]=_n,this},yi.prototype.delete=function(li){var _n=this._find(li,!1);if(_n>=0){for(var Oi=this._keys.length,Mi=_n+1;Mi<Oi;Mi++)this._keys[Mi-1]=this._keys[Mi],this._values[Mi-1]=this._values[Mi];return this._keys.length--,this._values.length--,li===this._cacheKey&&(this._cacheKey=kt,this._cacheIndex=-2),!0}return!1},yi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=kt,this._cacheIndex=-2},yi.prototype.keys=function(){return new Ir(this._keys,this._values,nn)},yi.prototype.values=function(){return new Ir(this._keys,this._values,Sn)},yi.prototype.entries=function(){return new Ir(this._keys,this._values,Bn)},yi.prototype["@@iterator"]=function(){return this.entries()},yi.prototype[Fe]=function(){return this.entries()},yi.prototype._find=function(li,_n){return this._cacheKey!==li&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=li)),this._cacheIndex<0&&_n&&(this._cacheIndex=this._keys.length,this._keys.push(li),this._values.push(void 0)),this._cacheIndex},yi}();function nn(yi,li){return yi}function Sn(yi,li){return li}function Bn(yi,li){return[yi,li]}}function ii(){return function(){function kt(){this._map=new Mt}return Object.defineProperty(kt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),kt.prototype.has=function(Kt){return this._map.has(Kt)},kt.prototype.add=function(Kt){return this._map.set(Kt,Kt),this},kt.prototype.delete=function(Kt){return this._map.delete(Kt)},kt.prototype.clear=function(){this._map.clear()},kt.prototype.keys=function(){return this._map.keys()},kt.prototype.values=function(){return this._map.values()},kt.prototype.entries=function(){return this._map.entries()},kt.prototype["@@iterator"]=function(){return this.keys()},kt.prototype[Fe]=function(){return this.keys()},kt}()}function mo(){var kt=16,Kt=xt.create(),Ir=nn();return function(){function _n(){this._key=nn()}return _n.prototype.has=function(Oi){var Mi=Sn(Oi,!1);return Mi!==void 0?xt.has(Mi,this._key):!1},_n.prototype.get=function(Oi){var Mi=Sn(Oi,!1);return Mi!==void 0?xt.get(Mi,this._key):void 0},_n.prototype.set=function(Oi,Mi){var Ja=Sn(Oi,!0);return Ja[this._key]=Mi,this},_n.prototype.delete=function(Oi){var Mi=Sn(Oi,!1);return Mi!==void 0?delete Mi[this._key]:!1},_n.prototype.clear=function(){this._key=nn()},_n}();function nn(){var _n;do _n="@@WeakMap@@"+li();while(xt.has(Kt,_n));return Kt[_n]=!0,_n}function Sn(_n,Oi){if(!G.call(_n,Ir)){if(!Oi)return;Object.defineProperty(_n,Ir,{value:xt.create()})}return _n[Ir]}function Bn(_n,Oi){for(var Mi=0;Mi<Oi;++Mi)_n[Mi]=Math.random()*255|0;return _n}function yi(_n){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(_n)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(_n)):Bn(new Uint8Array(_n),_n):Bn(new Array(_n),_n)}function li(){var _n=yi(kt);_n[6]=_n[6]&79|64,_n[8]=_n[8]&191|128;for(var Oi="",Mi=0;Mi<kt;++Mi){var Ja=_n[Mi];(Mi===4||Mi===6||Mi===8)&&(Oi+="-"),Ja<16&&(Oi+="0"),Oi+=Ja.toString(16).toLowerCase()}return Oi}}function Js(kt){return kt.__=void 0,delete kt.__,kt}})})(me||(me={}))},83437:function(Cr){(function(te,$){Cr.exports=$()})(this,function(){"use strict";function te(ot,Ye,bt,Ke,Xt,Sr){if(!(Xt-Ke<=bt)){var Vr=Ke+Xt>>1;$(ot,Ye,Vr,Ke,Xt,Sr%2),te(ot,Ye,bt,Ke,Vr-1,Sr+1),te(ot,Ye,bt,Vr+1,Xt,Sr+1)}}function $(ot,Ye,bt,Ke,Xt,Sr){for(;Xt>Ke;){if(Xt-Ke>600){var Vr=Xt-Ke+1,en=bt-Ke+1,C=Math.log(Vr),Ee=.5*Math.exp(2*C/3),Re=.5*Math.sqrt(C*Ee*(Vr-Ee)/Vr)*(en-Vr/2<0?-1:1),yt=Math.max(Ke,Math.floor(bt-en*Ee/Vr+Re)),ft=Math.min(Xt,Math.floor(bt+(Vr-en)*Ee/Vr+Re));$(ot,Ye,bt,yt,ft,Sr)}var It=Ye[2*bt+Sr],Ht=Ke,xr=Xt;for(Pe(ot,Ye,Ke,bt),Ye[2*Xt+Sr]>It&&Pe(ot,Ye,Ke,Xt);Ht<xr;){for(Pe(ot,Ye,Ht,xr),Ht++,xr--;Ye[2*Ht+Sr]<It;)Ht++;for(;Ye[2*xr+Sr]>It;)xr--}Ye[2*Ke+Sr]===It?Pe(ot,Ye,Ke,xr):(xr++,Pe(ot,Ye,xr,Xt)),xr<=bt&&(Ke=xr+1),bt<=xr&&(Xt=xr-1)}}function Pe(ot,Ye,bt,Ke){me(ot,bt,Ke),me(Ye,2*bt,2*Ke),me(Ye,2*bt+1,2*Ke+1)}function me(ot,Ye,bt){var Ke=ot[Ye];ot[Ye]=ot[bt],ot[bt]=Ke}function m(ot,Ye,bt,Ke,Xt,Sr,Vr){for(var en=[0,ot.length-1,0],C=[],Ee,Re;en.length;){var yt=en.pop(),ft=en.pop(),It=en.pop();if(ft-It<=Vr){for(var Ht=It;Ht<=ft;Ht++)Ee=Ye[2*Ht],Re=Ye[2*Ht+1],Ee>=bt&&Ee<=Xt&&Re>=Ke&&Re<=Sr&&C.push(ot[Ht]);continue}var xr=Math.floor((It+ft)/2);Ee=Ye[2*xr],Re=Ye[2*xr+1],Ee>=bt&&Ee<=Xt&&Re>=Ke&&Re<=Sr&&C.push(ot[xr]);var Kn=(yt+1)%2;(yt===0?bt<=Ee:Ke<=Re)&&(en.push(It),en.push(xr-1),en.push(Kn)),(yt===0?Xt>=Ee:Sr>=Re)&&(en.push(xr+1),en.push(ft),en.push(Kn))}return C}function Ie(ot,Ye,bt,Ke,Xt,Sr){for(var Vr=[0,ot.length-1,0],en=[],C=Xt*Xt;Vr.length;){var Ee=Vr.pop(),Re=Vr.pop(),yt=Vr.pop();if(Re-yt<=Sr){for(var ft=yt;ft<=Re;ft++)G(Ye[2*ft],Ye[2*ft+1],bt,Ke)<=C&&en.push(ot[ft]);continue}var It=Math.floor((yt+Re)/2),Ht=Ye[2*It],xr=Ye[2*It+1];G(Ht,xr,bt,Ke)<=C&&en.push(ot[It]);var Kn=(Ee+1)%2;(Ee===0?bt-Xt<=Ht:Ke-Xt<=xr)&&(Vr.push(yt),Vr.push(It-1),Vr.push(Kn)),(Ee===0?bt+Xt>=Ht:Ke+Xt>=xr)&&(Vr.push(It+1),Vr.push(Re),Vr.push(Kn))}return en}function G(ot,Ye,bt,Ke){var Xt=ot-bt,Sr=Ye-Ke;return Xt*Xt+Sr*Sr}var ce=function(ot){return ot[0]},he=function(ot){return ot[1]},Fe=function(Ye,bt,Ke,Xt,Sr){bt===void 0&&(bt=ce),Ke===void 0&&(Ke=he),Xt===void 0&&(Xt=64),Sr===void 0&&(Sr=Float64Array),this.nodeSize=Xt,this.points=Ye;for(var Vr=Ye.length<65536?Uint16Array:Uint32Array,en=this.ids=new Vr(Ye.length),C=this.coords=new Sr(Ye.length*2),Ee=0;Ee<Ye.length;Ee++)en[Ee]=Ee,C[2*Ee]=bt(Ye[Ee]),C[2*Ee+1]=Ke(Ye[Ee]);te(en,C,Xt,0,en.length-1,0)};Fe.prototype.range=function(Ye,bt,Ke,Xt){return m(this.ids,this.coords,Ye,bt,Ke,Xt,this.nodeSize)},Fe.prototype.within=function(Ye,bt,Ke){return Ie(this.ids,this.coords,Ye,bt,Ke,this.nodeSize)};var ge={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ot){return ot}},Qe=Math.fround||function(ot){return function(Ye){return ot[0]=+Ye,ot[0]}}(new Float32Array(1)),ct=function(Ye){this.options=ir(Object.create(ge),Ye),this.trees=new Array(this.options.maxZoom+1)};ct.prototype.load=function(Ye){var bt=this.options,Ke=bt.log,Xt=bt.minZoom,Sr=bt.maxZoom,Vr=bt.nodeSize;Ke&&console.time("total time");var en="prepare "+Ye.length+" points";Ke&&console.time(en),this.points=Ye;for(var C=[],Ee=0;Ee<Ye.length;Ee++)!Ye[Ee].geometry||C.push(Qt(Ye[Ee],Ee));this.trees[Sr+1]=new Fe(C,W,Wt,Vr,Float32Array),Ke&&console.timeEnd(en);for(var Re=Sr;Re>=Xt;Re--){var yt=+Date.now();C=this._cluster(C,Re),this.trees[Re]=new Fe(C,W,Wt,Vr,Float32Array),Ke&&console.log("z%d: %d clusters in %dms",Re,C.length,+Date.now()-yt)}return Ke&&console.timeEnd("total time"),this},ct.prototype.getClusters=function(Ye,bt){var Ke=((Ye[0]+180)%360+360)%360-180,Xt=Math.max(-90,Math.min(90,Ye[1])),Sr=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,Vr=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)Ke=-180,Sr=180;else if(Ke>Sr){var en=this.getClusters([Ke,Xt,180,Vr],bt),C=this.getClusters([-180,Xt,Sr,Vr],bt);return en.concat(C)}for(var Ee=this.trees[this._limitZoom(bt)],Re=Ee.range(Jt(Ke),zt(Vr),Jt(Sr),zt(Xt)),yt=[],ft=0,It=Re;ft<It.length;ft+=1){var Ht=It[ft],xr=Ee.points[Ht];yt.push(xr.numPoints?ur(xr):this.points[xr.index])}return yt},ct.prototype.getChildren=function(Ye){var bt=this._getOriginId(Ye),Ke=this._getOriginZoom(Ye),Xt="No cluster with the specified id.",Sr=this.trees[Ke];if(!Sr)throw new Error(Xt);var Vr=Sr.points[bt];if(!Vr)throw new Error(Xt);for(var en=this.options.radius/(this.options.extent*Math.pow(2,Ke-1)),C=Sr.within(Vr.x,Vr.y,en),Ee=[],Re=0,yt=C;Re<yt.length;Re+=1){var ft=yt[Re],It=Sr.points[ft];It.parentId===Ye&&Ee.push(It.numPoints?ur(It):this.points[It.index])}if(Ee.length===0)throw new Error(Xt);return Ee},ct.prototype.getLeaves=function(Ye,bt,Ke){bt=bt||10,Ke=Ke||0;var Xt=[];return this._appendLeaves(Xt,Ye,bt,Ke,0),Xt},ct.prototype.getTile=function(Ye,bt,Ke){var Xt=this.trees[this._limitZoom(Ye)],Sr=Math.pow(2,Ye),Vr=this.options,en=Vr.extent,C=Vr.radius,Ee=C/en,Re=(Ke-Ee)/Sr,yt=(Ke+1+Ee)/Sr,ft={features:[]};return this._addTileFeatures(Xt.range((bt-Ee)/Sr,Re,(bt+1+Ee)/Sr,yt),Xt.points,bt,Ke,Sr,ft),bt===0&&this._addTileFeatures(Xt.range(1-Ee/Sr,Re,1,yt),Xt.points,Sr,Ke,Sr,ft),bt===Sr-1&&this._addTileFeatures(Xt.range(0,Re,Ee/Sr,yt),Xt.points,-1,Ke,Sr,ft),ft.features.length?ft:null},ct.prototype.getClusterExpansionZoom=function(Ye){for(var bt=this._getOriginZoom(Ye)-1;bt<=this.options.maxZoom;){var Ke=this.getChildren(Ye);if(bt++,Ke.length!==1)break;Ye=Ke[0].properties.cluster_id}return bt},ct.prototype._appendLeaves=function(Ye,bt,Ke,Xt,Sr){for(var Vr=this.getChildren(bt),en=0,C=Vr;en<C.length;en+=1){var Ee=C[en],Re=Ee.properties;if(Re&&Re.cluster?Sr+Re.point_count<=Xt?Sr+=Re.point_count:Sr=this._appendLeaves(Ye,Re.cluster_id,Ke,Xt,Sr):Sr<Xt?Sr++:Ye.push(Ee),Ye.length===Ke)break}return Sr},ct.prototype._addTileFeatures=function(Ye,bt,Ke,Xt,Sr,Vr){for(var en=0,C=Ye;en<C.length;en+=1){var Ee=C[en],Re=bt[Ee],yt=Re.numPoints,ft=void 0,It=void 0,Ht=void 0;if(yt)ft=Mt(Re),It=Re.x,Ht=Re.y;else{var xr=this.points[Re.index];ft=xr.properties,It=Jt(xr.geometry.coordinates[0]),Ht=zt(xr.geometry.coordinates[1])}var Kn={type:1,geometry:[[Math.round(this.options.extent*(It*Sr-Ke)),Math.round(this.options.extent*(Ht*Sr-Xt))]],tags:ft},dn=void 0;yt?dn=Re.id:this.options.generateId?dn=Re.index:this.points[Re.index].id&&(dn=this.points[Re.index].id),dn!==void 0&&(Kn.id=dn),Vr.features.push(Kn)}},ct.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},ct.prototype._cluster=function(Ye,bt){for(var Ke=[],Xt=this.options,Sr=Xt.radius,Vr=Xt.extent,en=Xt.reduce,C=Xt.minPoints,Ee=Sr/(Vr*Math.pow(2,bt)),Re=0;Re<Ye.length;Re++){var yt=Ye[Re];if(!(yt.zoom<=bt)){yt.zoom=bt;for(var ft=this.trees[bt+1],It=ft.within(yt.x,yt.y,Ee),Ht=yt.numPoints||1,xr=Ht,Kn=0,dn=It;Kn<dn.length;Kn+=1){var di=dn[Kn],jn=ft.points[di];jn.zoom>bt&&(xr+=jn.numPoints||1)}if(xr>Ht&&xr>=C){for(var ni=yt.x*Ht,vi=yt.y*Ht,Hn=en&&Ht>1?this._map(yt,!0):null,mi=(Re<<5)+(bt+1)+this.points.length,ha=0,Hi=It;ha<Hi.length;ha+=1){var Di=Hi[ha],Qi=ft.points[Di];if(!(Qi.zoom<=bt)){Qi.zoom=bt;var pa=Qi.numPoints||1;ni+=Qi.x*pa,vi+=Qi.y*pa,Qi.parentId=mi,en&&(Hn||(Hn=this._map(yt,!0)),en(Hn,this._map(Qi)))}}yt.parentId=mi,Ke.push(xt(ni/xr,vi/xr,mi,xr,Hn))}else if(Ke.push(yt),xr>1)for(var Lo=0,La=It;Lo<La.length;Lo+=1){var ga=La[Lo],Bi=ft.points[ga];Bi.zoom<=bt||(Bi.zoom=bt,Ke.push(Bi))}}}return Ke},ct.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},ct.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},ct.prototype._map=function(Ye,bt){if(Ye.numPoints)return bt?ir({},Ye.properties):Ye.properties;var Ke=this.points[Ye.index].properties,Xt=this.options.map(Ke);return bt&&Xt===Ke?ir({},Xt):Xt};function xt(ot,Ye,bt,Ke,Xt){return{x:Qe(ot),y:Qe(Ye),zoom:Infinity,id:bt,parentId:-1,numPoints:Ke,properties:Xt}}function Qt(ot,Ye){var bt=ot.geometry.coordinates,Ke=bt[0],Xt=bt[1];return{x:Qe(Jt(Ke)),y:Qe(zt(Xt)),zoom:Infinity,index:Ye,parentId:-1}}function ur(ot){return{type:"Feature",id:ot.id,properties:Mt(ot),geometry:{type:"Point",coordinates:[lt(ot.x),pt(ot.y)]}}}function Mt(ot){var Ye=ot.numPoints,bt=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return ir(ir({},ot.properties),{cluster:!0,cluster_id:ot.id,point_count:Ye,point_count_abbreviated:bt})}function Jt(ot){return ot/360+.5}function zt(ot){var Ye=Math.sin(ot*Math.PI/180),bt=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return bt<0?0:bt>1?1:bt}function lt(ot){return(ot-.5)*360}function pt(ot){var Ye=(180-ot*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function ir(ot,Ye){for(var bt in Ye)ot[bt]=Ye[bt];return ot}function W(ot){return ot.x}function Wt(ot){return ot.y}return ct})},48027:function(Cr){Cr.exports.RADIUS=6378137,Cr.exports.FLATTENING=1/298.257223563,Cr.exports.POLAR_RADIUS=63567523142e-4}}]);
